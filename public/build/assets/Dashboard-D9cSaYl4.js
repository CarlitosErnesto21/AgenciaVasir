import{A as te}from"./AuthenticatedLayout-DUM_3oij.js";import{a4 as ae,E as z,r,o as Z,w as se,k as oe,c as M,d as b,p as h,$ as w,a0 as le,x as re,h as F,j as ne,e as l,y as ie,t as de,F as ue,N as S}from"./vendor-CqKcGHPa.js";import{s as q}from"./app-BBBiwed9.js";import"./ui-CVJOYm3g.js";import ce from"./LoadingState-Z4RWo1eI.js";import ve from"./MetricasCard-BblevU2N.js";import pe from"./WidgetsSecundarios-95-zLecb.js";import me from"./ActividadReciente-rsDgoLMM.js";import fe from"./ModalesInteractivos-C57hZD6a.js";import ge from"./GraficosSection-Wycg6HGZ.js";import be from"./FormularioDatosCompletos-D8QZJPJy.js";import"./index-qhcjOIPB.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vue-tel-input-J95PmLrS.js";const he={key:2,class:"px-2 sm:px-4 lg:px-6 py-4 sm:py-6 space-y-4 sm:space-y-6 mt-1 sm:mt-1"},ye={class:"flex justify-between items-center"},xe=["disabled"],_e={class:"grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6"},ke={class:"bg-white rounded-lg shadow-sm border border-gray-100 p-4 sm:p-6"},we={class:"h-48 sm:h-64"},Se={key:1,class:"flex items-center justify-center h-full"},De={class:"bg-white rounded-lg shadow-sm border border-gray-100 p-4 sm:p-6"},Re={class:"h-48 sm:h-64"},Ae={key:1,class:"flex items-center justify-center h-full"},$e={class:"grid grid-cols-1 xl:grid-cols-2 gap-4 sm:gap-6"},Ce=5*60*1e3,Ze={__name:"Dashboard",setup(je){const i=ae().props.user,G=z(()=>i&&i.roles&&i.roles.some(e=>e.name==="Administrador")),A=z(()=>i&&i.empleado?i.empleado:null),$=r(!1),L=z(()=>{if(!i)return!1;const e=A.value;return G.value&&(!e||!e.cargo||!e.telefono)});Z(()=>{L.value&&($.value=!0)}),se(L,e=>{e&&($.value=!0)});const P=r(),E=r(),H=r(),Y=r(),y=r(!0),o=r({}),V=r(null),T=r(null),D=r([{label:"Ventas Hoy",value:"0",icon:"pi pi-shopping-cart",color:"from-[#ef233c] to-[#d90429]",text:"text-[#7b1f26]",key:"ventas_hoy",category:"ventas",description:"Ventas del día"},{label:"Ingresos Hoy",value:"$0",icon:"pi pi-dollar",color:"from-[#ffd600] to-[#ffb700]",text:"text-[#a68700]",key:"ingresos_hoy",category:"ventas",description:"Ingresos del día"},{label:"Reservas del Mes",value:"0",icon:"pi pi-calendar-plus",color:"from-[#6c00f9] to-[#480ca8]",text:"text-[#240046]",key:"reservas_mes",category:"reservas",description:"Reservas este mes"},{label:"Tours Activos",value:"0",icon:"pi pi-map-marker",color:"from-[#0077b6] to-[#023e8a]",text:"text-[#03045e]",key:"tours_activos",category:"reservas",description:"Tours disponibles"}]),R=r([{title:"Reservas Pendientes",value:"0",icon:"pi pi-clock",color:"bg-[#fff3b0] border-[#ffd600]",iconColor:"text-[#ffd600]",key:"reservas_pendientes"},{title:"Productos Stock Bajo",value:"0",icon:"pi pi-exclamation-triangle",color:"bg-[#ffe5e5] border-[#ef233c]",iconColor:"text-[#d90429]",key:"productos_stock_bajo"},{title:"Valor Inventario",value:"$0",icon:"pi pi-wallet",color:"bg-[#e5daff] border-[#6c00f9]",iconColor:"text-[#480ca8]",key:"valor_total_inventario"},{title:"Clientes Activos",value:"0",icon:"pi pi-users",color:"bg-[#d0f1ff] border-[#0077b6]",iconColor:"text-[#023e8a]",key:"clientes_activos"}]),C=r(!1),j=r(!1),J=()=>{C.value=!C.value},K=()=>{j.value=!j.value},I=(e,t=null)=>{if(e.includes("$")){let s;return t&&t.valor_total_inventario?s=parseFloat(t.valor_total_inventario):s=parseFloat(e.replace(/[$,.\s]/g,"")),isNaN(s)?"$0":s>=1e6?"$"+(s/1e6).toFixed(1)+"M":s>=1e3?"$"+(s/1e3).toFixed(0)+"k":"$"+s.toFixed(0)}return e},U=async(e=!1)=>{const t=Date.now();if(!e&&V.value&&T.value&&t<T.value){o.value=V.value,O(o.value.inventario,o.value.ventas,o.value.reservas,o.value.resumenReservas,o.value.tours),N(o.value.inventario,o.value.ventas,o.value.stockBajo,o.value.reservas,o.value.resumenReservas),y.value=!1;return}y.value=!0;try{const s={headers:{Accept:"application/json"},timeout:1e4},[n,x,v,d,p,m]=await Promise.allSettled([S.get("/api/inventario/resumen",s),S.get("/api/ventas?desde="+new Date(Date.now()-30*24*60*60*1e3).toISOString().split("T")[0],s),S.get("/api/inventario/stock-bajo?limit=20",s),S.get("/api/reservas?per_page=100&desde="+new Date(Date.now()-60*24*60*60*1e3).toISOString().split("T")[0],s),S.get("/api/reservas/resumen",s),S.get("/api/tours?estado=activo,disponible&limit=50",s)]),_=n.status==="fulfilled"?n.value.data.data||n.value.data||{}:{},u=x.status==="fulfilled"?x.value.data.data||x.value.data||[]:[],f=v.status==="fulfilled"?v.value.data.data||v.value.data||[]:[],k=d.status==="fulfilled"?d.value.data.data||d.value.data||[]:[],g=p.status==="fulfilled"?p.value.data.data||p.value.data||[]:[],B=m.status==="fulfilled"?m.value.data.data||m.value.data||[]:[];O(_,u,k,g,B),N(_,u,f,k,g),o.value={inventario:_,ventas:u,stockBajo:f,reservas:k,resumenReservas:g,tours:B},V.value={...o.value},T.value=Date.now()+Ce}catch{O({},[],[],[],[]),N({},[],[],[])}finally{y.value=!1}},O=(e,t,s,n,x)=>{const v=Array.isArray(t)?t:[],d=Array.isArray(s)?s:[],p=Array.isArray(x)?x:[],m=new Date().toISOString().split("T")[0],_=v.filter(a=>a.fecha?a.fecha.split("T")[0]===m:!1).length,u=v.filter(a=>a.fecha?a.fecha.split("T")[0]===m:!1).reduce((a,c)=>a+(parseFloat(c.total)||0),0),f=new Date().getMonth(),k=new Date().getFullYear(),g=d.filter(a=>{if(!a.fecha_reserva&&!a.fecha)return!1;const c=new Date(a.fecha_reserva||a.fecha);return c.getMonth()===f&&c.getFullYear()===k}).length,B=p.filter(a=>!a.estado||a.estado.toLowerCase()==="activo"||a.estado.toLowerCase()==="disponible").length;D.value[0].value=_.toString(),D.value[1].value=`$${u.toLocaleString("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2})}`,D.value[2].value=g.toString(),D.value[3].value=B.toString();const X=d.filter(a=>a.estado&&a.estado.toLowerCase()==="pendiente").length,ee=new Set(d.map(a=>{var c;return(c=a.cliente)==null?void 0:c.id}).filter(a=>a)).size;R.value[0].value=X.toString(),R.value[1].value=(e.productos_stock_bajo||0).toString(),R.value[2].value=`$${Number(e.valor_total_inventario||0).toLocaleString("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2})}`,R.value[3].value=ee.toString()},N=(e,t,s,n,x)=>{const v=e.total_productos||0,d=e.productos_stock_bajo||0,p=e.productos_agotados||0,m=e.productos_disponibles||Math.max(0,v-d-p),_=Array.isArray(n)?n:[];P.value={labels:["Productos Disponibles","Stock Bajo","Agotados"],datasets:[{label:"Estado del Inventario",data:[m,d,p],backgroundColor:["#10b981","#f59e0b","#ef4444"],hoverBackgroundColor:["#34d399","#fbbf24","#f87171"]}]};const u=_.reduce((f,k)=>{const g=k.estado||"Sin estado";return f[g]=(f[g]||0)+1,f},{});Object.keys(u).length===0&&(u["Sin reservas"]=0),E.value={labels:Object.keys(u),datasets:[{label:"Reservas por Estado",data:Object.values(u),backgroundColor:["#f59e0b","#10b981","#ef4444","#3b82f6"]}]}},Q=()=>({maintainAspectRatio:!1,plugins:{title:{display:!0,text:"Estado del Inventario",font:{size:18}},legend:{display:!0,position:"bottom",labels:{usePointStyle:!0,color:"#374151"}},tooltip:{callbacks:{label:function(e){return`${e.label}: ${e.parsed} productos`}}}}}),W=()=>({maintainAspectRatio:!1,plugins:{title:{display:!0,text:"Reservas por Estado",font:{size:18}},legend:{display:!1},tooltip:{callbacks:{label:function(e){return`${e.label}: ${e.parsed.y} reservas`}}}},scales:{x:{ticks:{color:"#374151"},grid:{color:"#e5e7eb"}},y:{beginAtZero:!0,ticks:{color:"#374151"},grid:{color:"#e5e7eb"}}}});return Z(()=>{H.value=Q(),Y.value=W(),U()}),(e,t)=>{const s=oe("Toast");return b(),M(ue,null,[h(w(le),{title:"Dashboard"}),h(te,null,{default:re(()=>[h(s,{class:"z-[9999]"}),$.value?(b(),F(be,{key:0,empleado:A.value&&A.value.value?A.value.value:{},"user-id":w(i)&&w(i).id?w(i).id:null,onClose:t[0]||(t[0]=n=>$.value=!1)},null,8,["empleado","user-id"])):ne("",!0),y.value?(b(),F(ce,{key:1})):(b(),M("div",he,[l("div",ye,[t[4]||(t[4]=l("h1",{class:"text-2xl sm:text-3xl font-bold text-blue-600"},"Dashboard administrativo",-1)),l("button",{onClick:t[1]||(t[1]=n=>U(!0)),disabled:y.value,class:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white text-sm font-medium rounded-lg transition-colors duration-200"},[l("i",{class:ie(["pi pi-refresh",{"animate-spin":y.value}])},null,2),l("span",null,de(y.value?"Actualizando...":"Actualizar"),1)],8,xe)]),h(ve,{metrics:D.value,"dashboard-data":o.value,"format-value-for-mobile":I},null,8,["metrics","dashboard-data"]),l("div",_e,[h(pe,{widgets:R.value,"dashboard-data":o.value,"format-value-for-mobile":I,onToggleReservasModal:J,onToggleStockModal:K},null,8,["widgets","dashboard-data"]),l("div",ke,[t[6]||(t[6]=l("h3",{class:"text-base sm:text-lg font-semibold text-gray-900 mb-3 sm:mb-4"},"Inventario por Estado",-1)),l("div",we,[P.value?(b(),F(w(q),{key:0,type:"pie",data:P.value,options:H.value,class:"w-full h-full"},null,8,["data","options"])):(b(),M("div",Se,t[5]||(t[5]=[l("p",{class:"text-gray-500 text-xs sm:text-sm"},"No hay datos de inventario",-1)])))])]),l("div",De,[t[8]||(t[8]=l("h3",{class:"text-base sm:text-lg font-semibold text-gray-900 mb-3 sm:mb-4"},"Reservas por Estado",-1)),l("div",Re,[E.value?(b(),F(w(q),{key:0,type:"bar",data:E.value,options:Y.value,class:"w-full h-full"},null,8,["data","options"])):(b(),M("div",Ae,t[7]||(t[7]=[l("p",{class:"text-gray-500 text-xs sm:text-sm"},"No hay datos de reservas",-1)])))])])]),l("div",$e,[h(ge,{"resumen-reservas-data":o.value.resumenReservas,"reservas-data":o.value.reservas},null,8,["resumen-reservas-data","reservas-data"]),h(me,{"dashboard-data":o.value,"format-value-for-mobile":I},null,8,["dashboard-data"])])])),h(fe,{"show-reservas-pendientes-modal":C.value,"show-productos-stock-bajo-modal":j.value,"dashboard-data":o.value,onCloseReservasModal:t[2]||(t[2]=n=>C.value=!1),onCloseStockModal:t[3]||(t[3]=n=>j.value=!1)},null,8,["show-reservas-pendientes-modal","show-productos-stock-bajo-modal","dashboard-data"])]),_:1})],64)}}};export{Ze as default};
