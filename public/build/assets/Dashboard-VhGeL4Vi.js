import{A as ae}from"./AuthenticatedLayout-C-PdHe-p.js";import{a3 as se,E as L,r,o as W,w as oe,k as le,c as F,d as h,p as y,$ as D,a0 as re,x as ne,h as P,j as ie,e as l,y as de,t as ue,F as ce,N as w}from"./vendor-gbh1WW5n.js";import{s as q}from"./app-rqswYq81.js";import"./ui-BrU4k96Z.js";import ve from"./LoadingState-AWTz1OIu.js";import pe from"./MetricasCard-CYVx9GUl.js";import me from"./WidgetsSecundarios-DpbiYh1q.js";import fe from"./ActividadReciente-DSstu-xJ.js";import ge from"./ModalesInteractivos-B1CD5XOx.js";import be from"./GraficosSection-DsvpDhsK.js";import he from"./FormularioDatosCompletos-DBn92Uyq.js";import"./index-D80U6yN5.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vue-tel-input-nvsKEitw.js";const ye={key:2,class:"px-2 sm:px-4 lg:px-6 py-4 sm:py-6 space-y-4 sm:space-y-6 mt-1 sm:mt-1"},xe={class:"flex justify-between items-center"},_e=["disabled"],ke={class:"grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6"},De={class:"bg-white rounded-lg shadow-sm border border-gray-100 p-4 sm:p-6"},we={class:"h-48 sm:h-64"},Ae={key:1,class:"flex items-center justify-center h-full"},Se={class:"bg-white rounded-lg shadow-sm border border-gray-100 p-4 sm:p-6"},Ce={class:"h-48 sm:h-64"},$e={key:1,class:"flex items-center justify-center h-full"},je={class:"grid grid-cols-1 xl:grid-cols-2 gap-4 sm:gap-6"},Re=5*60*1e3,We={__name:"Dashboard",setup(Be){const n=se().props.user,G=L(()=>n&&n.roles&&n.roles.some(e=>e.name==="Administrador")),j=L(()=>n&&n.empleado?n.empleado:null),R=r(!1),H=L(()=>{if(!n)return!1;const e=j.value;return G.value&&(!e||!e.cargo||!e.telefono)});W(()=>{H.value&&(R.value=!0)}),oe(H,e=>{e&&(R.value=!0)});const I=r(),M=r(),U=r(),Y=r(),x=r(!0),o=r({}),N=r(null),V=r(null),A=r([{label:"Ventas Hoy",value:"0",icon:"pi pi-shopping-cart",color:"from-[#ef233c] to-[#d90429]",text:"text-[#7b1f26]",key:"ventas_hoy",category:"ventas",description:"Ventas del día"},{label:"Ingresos Hoy",value:"$0",icon:"pi pi-dollar",color:"from-[#ffd600] to-[#ffb700]",text:"text-[#a68700]",key:"ingresos_hoy",category:"ventas",description:"Ingresos del día"},{label:"Reservas del Mes",value:"0",icon:"pi pi-calendar-plus",color:"from-[#6c00f9] to-[#480ca8]",text:"text-[#240046]",key:"reservas_mes",category:"reservas",description:"Reservas este mes"},{label:"Tours Activos",value:"0",icon:"pi pi-map-marker",color:"from-[#0077b6] to-[#023e8a]",text:"text-[#03045e]",key:"tours_activos",category:"reservas",description:"Tours disponibles"}]),S=r([{title:"Reservas Pendientes",value:"0",icon:"faClock",color:"bg-[#fff3b0] border-[#ffd600]",iconColor:"text-[#ffd600]",key:"reservas_pendientes"},{title:"Productos Stock Bajo",value:"0",icon:"faExclamationTriangle",color:"bg-[#ffe5e5] border-[#ef233c]",iconColor:"text-[#d90429]",key:"productos_stock_bajo"},{title:"Valor Inventario",value:"$0",icon:"faWallet",color:"bg-[#e5daff] border-[#6c00f9]",iconColor:"text-[#480ca8]",key:"valor_total_inventario"},{title:"Clientes Activos",value:"0",icon:"faUsers",color:"bg-[#d0f1ff] border-[#0077b6]",iconColor:"text-[#023e8a]",key:"clientes_activos"}]),B=r(!1),J=()=>{B.value=!B.value},T=(e,a=null)=>{if(e.includes("$")){let s;return a&&a.valor_total_inventario?s=parseFloat(a.valor_total_inventario):s=parseFloat(e.replace(/[$,.\s]/g,"")),isNaN(s)?"$0":s>=1e6?"$"+(s/1e6).toFixed(1)+"M":s>=1e3?"$"+(s/1e3).toFixed(0)+"k":"$"+s.toFixed(0)}return e},Z=async(e=!1)=>{const a=Date.now();if(!e&&N.value&&V.value&&a<V.value){o.value=N.value,O(o.value.inventario,o.value.ventas,o.value.reservas,o.value.resumenReservas,o.value.tours),z(o.value.inventario,o.value.ventas,o.value.stockBajo,o.value.reservas,o.value.resumenReservas),x.value=!1;return}x.value=!0;try{const s={headers:{Accept:"application/json"},timeout:1e4},[i,_,p,d,m,c]=await Promise.allSettled([w.get("/api/inventario/resumen",s),w.get("/api/ventas?desde="+new Date(Date.now()-30*24*60*60*1e3).toISOString().split("T")[0],s),w.get("/api/inventario/stock-bajo?limit=20",s),w.get("/api/reservas?per_page=100&desde="+new Date(Date.now()-60*24*60*60*1e3).toISOString().split("T")[0],s),w.get("/api/reservas/resumen",s),w.get("/api/tours?estado=activo,disponible&limit=50",s)]),f=i.status==="fulfilled"?i.value.data.data||i.value.data||{}:{},u=_.status==="fulfilled"?_.value.data.data||_.value.data||[]:[],g=p.status==="fulfilled"?p.value.data.data||p.value.data||[]:[],k=d.status==="fulfilled"?d.value.data.data||d.value.data||[]:[],b=m.status==="fulfilled"?m.value.data.data||m.value.data||[]:[],E=c.status==="fulfilled"?c.value.data.data||c.value.data||[]:[];O(f,u,k,b,E),z(f,u,g,k,b),o.value={inventario:f,ventas:u,stockBajo:g,reservas:k,resumenReservas:b,tours:E},N.value={...o.value},V.value=Date.now()+Re}catch{O({},[],[],[],[]),z({},[],[],[])}finally{x.value=!1}},O=(e,a,s,i,_)=>{const p=Array.isArray(a)?a:[],d=Array.isArray(s)?s:[],m=Array.isArray(_)?_:[],c=new Date,f=`${c.getFullYear()}-${String(c.getMonth()+1).padStart(2,"0")}-${String(c.getDate()).padStart(2,"0")}`,u=p.filter(t=>{if(!t.fecha)return!1;const C=t.fecha.split("T")[0]===f,$=t.estado&&t.estado.toLowerCase()==="completada";return C&&$}).length,g=p.filter(t=>{if(!t.fecha)return!1;const C=t.fecha.split("T")[0]===f,$=t.estado&&t.estado.toLowerCase()==="completada";return C&&$}).reduce((t,v)=>t+(parseFloat(v.total)||0),0),k=new Date().getMonth(),b=new Date().getFullYear(),E=d.filter(t=>{if(!t.fecha_reserva&&!t.fecha)return!1;const v=new Date(t.fecha_reserva||t.fecha),C=v.getMonth()===k&&v.getFullYear()===b,$=t.estado&&t.estado.toUpperCase()==="FINALIZADA";return C&&$}).length,X=m.filter(t=>t.estado&&t.estado.toUpperCase()==="DISPONIBLE").length;A.value[0].value=u.toString(),A.value[1].value=`$${g.toLocaleString("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2})}`,A.value[2].value=E.toString(),A.value[3].value=X.toString();const ee=d.filter(t=>t.estado&&t.estado.toUpperCase()==="PENDIENTE").length,te=new Set(d.map(t=>{var v;return(v=t.cliente)==null?void 0:v.id}).filter(t=>t)).size;S.value[0].value=ee.toString(),S.value[1].value=(e.productos_stock_bajo||0).toString(),S.value[2].value=`$${Number(e.valor_total_inventario||0).toLocaleString("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2})}`,S.value[3].value=te.toString()},z=(e,a,s,i,_)=>{const p=e.total_productos||0,d=e.productos_stock_bajo||0,m=e.productos_agotados||0,c=e.productos_disponibles||Math.max(0,p-d-m),f=Array.isArray(i)?i:[];I.value={labels:["Productos Disponibles","Stock Bajo","Agotados"],datasets:[{label:"Estado del Inventario",data:[c,d,m],backgroundColor:["#10b981","#f59e0b","#ef4444"],hoverBackgroundColor:["#34d399","#fbbf24","#f87171"]}]};const u=f.reduce((g,k)=>{const b=k.estado||"Sin estado";return g[b]=(g[b]||0)+1,g},{});Object.keys(u).length===0&&(u["Sin reservas"]=0),M.value={labels:Object.keys(u),datasets:[{label:"Reservas por Estado",data:Object.values(u),backgroundColor:["#f59e0b","#10b981","#ef4444","#3b82f6"]}]}},K=()=>({maintainAspectRatio:!1,plugins:{title:{display:!0,text:"Estado del Inventario",font:{size:18}},legend:{display:!0,position:"bottom",labels:{usePointStyle:!0,color:"#374151"}},tooltip:{callbacks:{label:function(e){return`${e.label}: ${e.parsed} productos`}}}}}),Q=()=>({maintainAspectRatio:!1,plugins:{title:{display:!0,text:"Reservas por Estado",font:{size:18}},legend:{display:!1},tooltip:{callbacks:{label:function(e){return`${e.label}: ${e.parsed.y} reservas`}}}},scales:{x:{ticks:{color:"#374151"},grid:{color:"#e5e7eb"}},y:{beginAtZero:!0,ticks:{color:"#374151"},grid:{color:"#e5e7eb"}}}});return W(()=>{U.value=K(),Y.value=Q(),Z()}),(e,a)=>{const s=le("Toast");return h(),F(ce,null,[y(D(re),{title:"Dashboard"}),y(ae,null,{default:ne(()=>[y(s,{class:"z-[9999]"}),R.value?(h(),P(he,{key:0,empleado:j.value&&j.value.value?j.value.value:{},"user-id":D(n)&&D(n).id?D(n).id:null,onClose:a[0]||(a[0]=i=>R.value=!1)},null,8,["empleado","user-id"])):ie("",!0),x.value?(h(),P(ve,{key:1})):(h(),F("div",ye,[l("div",xe,[a[3]||(a[3]=l("h1",{class:"text-2xl sm:text-3xl font-bold text-blue-600"},"Panel Administrativo",-1)),l("button",{onClick:a[1]||(a[1]=i=>Z(!0)),disabled:x.value,class:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white text-sm font-medium rounded-lg transition-colors duration-200"},[l("i",{class:de(["pi pi-refresh",{"animate-spin":x.value}])},null,2),l("span",null,ue(x.value?"Actualizando...":"Actualizar"),1)],8,_e)]),y(pe,{metrics:A.value,"dashboard-data":o.value,"format-value-for-mobile":T},null,8,["metrics","dashboard-data"]),l("div",ke,[y(me,{widgets:S.value,"dashboard-data":o.value,"format-value-for-mobile":T,onToggleStockModal:J},null,8,["widgets","dashboard-data"]),l("div",De,[a[5]||(a[5]=l("h3",{class:"text-base sm:text-lg font-semibold text-gray-900 mb-3 sm:mb-4"},"Inventario por Estado",-1)),l("div",we,[I.value?(h(),P(D(q),{key:0,type:"pie",data:I.value,options:U.value,class:"w-full h-full"},null,8,["data","options"])):(h(),F("div",Ae,a[4]||(a[4]=[l("p",{class:"text-gray-500 text-xs sm:text-sm"},"No hay datos de inventario",-1)])))])]),l("div",Se,[a[7]||(a[7]=l("h3",{class:"text-base sm:text-lg font-semibold text-gray-900 mb-3 sm:mb-4"},"Reservas por Estado",-1)),l("div",Ce,[M.value?(h(),P(D(q),{key:0,type:"bar",data:M.value,options:Y.value,class:"w-full h-full"},null,8,["data","options"])):(h(),F("div",$e,a[6]||(a[6]=[l("p",{class:"text-gray-500 text-xs sm:text-sm"},"No hay datos de reservas",-1)])))])])]),l("div",je,[y(be,{"resumen-reservas-data":o.value.resumenReservas,"reservas-data":o.value.reservas},null,8,["resumen-reservas-data","reservas-data"]),y(fe,{"dashboard-data":o.value,"format-value-for-mobile":T},null,8,["dashboard-data"])])])),y(ge,{"show-productos-stock-bajo-modal":B.value,"dashboard-data":o.value,onCloseStockModal:a[2]||(a[2]=i=>B.value=!1)},null,8,["show-productos-stock-bajo-modal","dashboard-data"])]),_:1})],64)}}};export{We as default};
