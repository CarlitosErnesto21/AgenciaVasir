import{A as Z}from"./AuthenticatedLayout-1pvH29Bk.js";import{b as ee,r as i,E,o as te,h as L,d as P,x as d,p as o,e as s,$ as a,a0 as se,t as c,j as R,q as ae,a5 as S}from"./vendor-gbh1WW5n.js";import{z as le,a as oe,e as ie,f as w,F as p,h as ne}from"./ui-BrU4k96Z.js";import{x as re,j as de,e as j,k as ue,p as ce}from"./index-I53oXuBL.js";import me from"./Modales-C9HJ-F7i.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-DtyEsSN9.js";const fe={class:"container mx-auto px-4 py-6"},ve={class:"bg-white rounded-lg shadow-md"},pe={class:"bg-blue-50 p-3 rounded-lg shadow-sm border mb-4"},ge={class:"flex flex-col sm:flex-row items-center justify-between mb-3"},be={class:"flex items-center gap-3"},we={class:"bg-blue-50 border border-blue-200 text-blue-700 px-3 py-1 rounded text-sm font-medium"},xe=["disabled"],he=["disabled"],ye={class:"space-y-3"},_e={class:"relative"},Ce={class:"text-blue-600 text-xs font-medium flex items-center gap-1"},ke=["title"],Le={class:"text-sm leading-relaxed"},Pe={class:"text-sm leading-relaxed"},Ve=["title"],De={class:"flex gap-2 justify-center items-center"},Te=["onClick"],Ee=["onClick"],Me={__name:"Clientes",props:{clientes:{type:Array,default:()=>[]}},setup(N){const $=N,m=le(),V=ee({id:null,nombre:"",apellido:"",genero:"",fecha_nacimiento:"",tipo_documento_id:null,numero_identificacion:"",telefono:"",email:"",direccion:""}),n=i(null),F=i(!1),x=i(!1),u=i(!1),D=i(!1),A=i(!0),h=i(!1),f=i(!1),v=i(!1),y=i(!1),_=i(10),M=i([5,10,20,50]),g=i({global:{value:null,matchMode:"contains"}}),U=E(()=>({width:"95vw",maxWidth:"500px",maxHeight:"95vh"})),C=E(()=>{let l=$.clientes;if(g.value.global.value){const t=g.value.global.value.toLowerCase();l=l.filter(e=>e.user&&e.user.name&&e.user.name.toLowerCase().includes(t)||e.numero_identificacion&&e.numero_identificacion.toLowerCase().includes(t)||e.user&&e.user.email&&e.user.email.toLowerCase().includes(t)||e.telefono&&e.telefono.toLowerCase().includes(t))}return l}),B=l=>{n.value=l,f.value=!0},O=l=>{n.value=l,v.value=!0},W=async l=>{var t,e;x.value=!0;try{const r=n.value.id||n.value.user_id,b=await fetch(`/api/clientes/${r}`,{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({deletion_reason:l})}),k=await b.json();if(b.ok)m.add({severity:"success",summary:"Cliente eliminado",detail:`Cliente eliminado correctamente. Se eliminaron ${((t=k.info)==null?void 0:t.reservas_count)||0} reservas y ${((e=k.info)==null?void 0:e.ventas_count)||0} ventas asociadas.`,life:5e3}),S.reload();else throw new Error(k.message||"Error al eliminar el cliente");v.value=!1,n.value=null}catch(r){console.error("Error al eliminar cliente:",r),m.add({severity:"error",summary:"Error",detail:r.message||"Error al eliminar el cliente",life:5e3}),v.value=!1}finally{x.value=!1}},z=()=>{v.value=!1,n.value=null,x.value=!1},T=async()=>{u.value=!0;try{await new Promise(l=>setTimeout(l,300)),g.value.global.value=null,m.add({severity:"success",summary:"Filtros limpiados",life:2e3})}finally{u.value=!1}},q=l=>{n.value=l,h.value=!0,f.value=!1},H=()=>{},G=()=>{},I=l=>{l.originalEvent.target.closest("button")||(n.value=l.data,h.value=!0)},K=l=>{S.visit("/generar-informes"),f.value=!1},J=l=>{m.add({severity:"info",summary:"Función pendiente",detail:"Cambiar estado aún no implementado",life:3e3}),f.value=!1},X=()=>{Object.assign(V,{id:null,nombre:"",apellido:"",genero:"",fecha_nacimiento:"",tipo_documento_id:null,numero_identificacion:"",telefono:"",email:"",direccion:""}),D.value=!1,y.value=!1},Q=()=>{y.value=!1},Y=()=>{m.add({severity:"info",summary:"Cargando clientes...",life:2e3}),setTimeout(()=>{m.add({severity:"success",summary:"Clientes cargados",life:2e3}),A.value=!1},1e3)};return te(()=>{Y()}),(l,t)=>(P(),L(Z,null,{default:d(()=>[o(a(se),{title:"Clientes"}),o(a(oe),{class:"z-[9999]"}),s("div",fe,[s("div",ve,[t[11]||(t[11]=s("div",{class:"flex flex-col sm:flex-row lg:justify-between lg:items-center text-center sm:text-left gap-4 p-4"},[s("div",{class:"w-full"},[s("h1",{class:"text-3xl font-bold text-blue-600 mb-2"},"Gestión de Clientes"),s("p",{class:"text-gray-600"},"Visualización de clientes del sistema")])],-1)),o(a(ie),{value:C.value,dataKey:"id",paginator:!0,rows:_.value,rowsPerPageOptions:M.value,rowsPerPage:_.value,"onUpdate:rowsPerPage":t[1]||(t[1]=e=>_.value=e),paginatorTemplate:"RowsPerPageDropdown FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink",currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} clientes",class:"overflow-x-auto max-w-full",responsiveLayout:"scroll",onRowClick:I,pt:{root:{class:"text-sm"},wrapper:{class:"text-sm"},table:{class:"text-sm"},thead:{class:"text-sm"},headerRow:{class:"text-sm"},headerCell:{class:"text-sm font-medium py-3 px-2"},tbody:{class:"text-sm"},bodyRow:{class:"h-20 text-sm cursor-pointer hover:bg-blue-50 transition-colors duration-200"},bodyCell:{class:"py-3 px-2 text-sm"},paginator:{class:"text-xs sm:text-sm"},paginatorWrapper:{class:"flex flex-wrap justify-center sm:justify-between items-center gap-2 p-2"}}},{header:d(()=>[s("div",pe,[s("div",ge,[s("div",be,[t[6]||(t[6]=s("h3",{class:"text-base font-medium text-gray-800 flex items-center gap-2"},[s("i",{class:"pi pi-filter text-blue-600 text-sm"}),s("span",null,"Filtros")],-1)),s("div",we,c(C.value.length)+" resultado"+c(C.value.length!==1?"s":""),1),s("button",{class:"bg-red-500 hover:bg-red-600 border border-red-500 px-3 py-1 text-sm text-white shadow-md rounded-md flex sm:hidden disabled:opacity-50 disabled:cursor-not-allowed items-center gap-2",onClick:T,disabled:u.value},[u.value?(P(),L(a(p),{key:0,icon:a(j),class:"animate-spin h-3 w-3"},null,8,["icon"])):R("",!0),s("span",null,c(u.value?"Limpia...":"Limpiar"),1)],8,xe)]),s("button",{class:"bg-red-500 hover:bg-red-600 border border-red-500 px-3 py-1 text-sm text-white shadow-md rounded-md hidden sm:flex disabled:opacity-50 disabled:cursor-not-allowed items-center gap-2",onClick:T,disabled:u.value},[u.value?(P(),L(a(p),{key:0,icon:a(j),class:"animate-spin h-3 w-3"},null,8,["icon"])):R("",!0),s("span",null,c(u.value?"Limpiando...":"Limpiar filtros"),1)],8,he)]),s("div",ye,[s("div",_e,[o(a(p),{icon:a(ue),class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"},null,8,["icon"]),o(a(ne),{modelValue:g.value.global.value,"onUpdate:modelValue":t[0]||(t[0]=e=>g.value.global.value=e),placeholder:"Buscar clientes...",class:"w-full h-9 text-sm rounded-md pl-10",style:{"background-color":"white","border-color":"#93c5fd"}},null,8,["modelValue"])]),s("p",Ce,[o(a(p),{icon:a(ce),class:"h-3 w-3 text-yellow-500"},null,8,["icon"]),t[7]||(t[7]=ae(" Haz clic en cualquier fila para ver los detalles del cliente. "))])])])]),default:d(()=>[o(a(w),{field:"user.name",header:"Nombre Completo",sortable:"",class:"w-40"},{body:d(e=>{var r,b;return[s("div",{class:"text-sm font-medium leading-relaxed overflow-hidden",style:{"max-width":"150px","text-overflow":"ellipsis","white-space":"nowrap"},title:((r=e.data.user)==null?void 0:r.name)||"Sin nombre"},c(((b=e.data.user)==null?void 0:b.name)||"Sin nombre"),9,ke)]}),_:1}),o(a(w),{field:"numero_identificacion",header:"Identificación",class:"w-32 hidden md:table-cell"},{body:d(e=>[s("div",Le,c(e.data.numero_identificacion),1)]),_:1}),o(a(w),{field:"telefono",header:"Teléfono",class:"w-32 hidden sm:table-cell"},{body:d(e=>[s("div",Pe,c(e.data.telefono),1)]),_:1}),o(a(w),{field:"email",header:"Email",class:"w-16 hidden sm:table-cell"},{body:d(e=>[s("div",{class:"text-sm font-medium leading-relaxed overflow-hidden",style:{"max-width":"150px","text-overflow":"ellipsis","white-space":"nowrap"},title:e.data.email||e.data.user&&e.data.user.email||"No registrado"},c(e.data.email||e.data.user&&e.data.user.email||"No registrado"),9,Ve)]),_:1}),o(a(w),{exportable:!1,class:"w-52 min-w-36"},{header:d(()=>t[8]||(t[8]=[s("div",{class:"text-center w-full font-bold"}," Acciones ",-1)])),body:d(e=>[s("div",De,[s("button",{class:"flex bg-green-500 border p-1 py-2 sm:p-2 text-sm shadow-md hover:shadow-lg rounded-md hover:-translate-y-1 transition-transform duration-300",onClick:r=>B(e.data)},[o(a(p),{icon:a(re),class:"h-3 w-6 sm:h-4 sm:w-7 text-white"},null,8,["icon"]),t[9]||(t[9]=s("span",{class:"hidden md:block text-white"},"Más",-1))],8,Te),s("button",{class:"flex bg-red-500 border p-1 py-2 sm:p-2 text-sm shadow-md hover:shadow-lg rounded-md hover:-translate-y-1 transition-transform duration-300",onClick:r=>O(e.data)},[o(a(p),{icon:a(de),class:"h-3 w-6 sm:h-4 sm:w-7 text-white"},null,8,["icon"]),t[10]||(t[10]=s("span",{class:"hidden md:block text-white"},"Eliminar",-1))],8,Ee)])]),_:1})]),_:1},8,["value","rows","rowsPerPageOptions","rowsPerPage"]),o(me,{visible:f.value,"onUpdate:visible":t[2]||(t[2]=e=>f.value=e),"delete-visible":v.value,"onUpdate:deleteVisible":t[3]||(t[3]=e=>v.value=e),"unsaved-changes-visible":y.value,"onUpdate:unsavedChangesVisible":t[4]||(t[4]=e=>y.value=e),"detalles-visible":h.value,"onUpdate:detallesVisible":t[5]||(t[5]=e=>h.value=e),cliente:n.value||V,"dialog-style":U.value,"is-deleting":x.value,"is-loading":F.value,submitted:D.value,onViewDetails:q,onViewReservations:H,onViewPurchases:G,onViewReports:K,onToggleStatus:J,onDeleteCliente:W,onCancelDelete:z,onCloseWithoutSaving:X,onContinueEditing:Q},null,8,["visible","delete-visible","unsaved-changes-visible","detalles-visible","cliente","dialog-style","is-deleting","is-loading","submitted"])])])]),_:1}))}};export{Me as default};
