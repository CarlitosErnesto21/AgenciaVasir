import{q as X,r as v,s as Y,E as w,i as Q,c as x,o as b,a as o,u as l,g as ee,w as p,b as s,G as ae,S as se,H as le,p as z,f as P,I as R,t as h,h as c,J as L,K as D,L as q,n as V,A as te}from"./app-WKwrJkJC.js";import{_ as re}from"./AuthenticatedLayout-baeqBx4a.js";import{F as f,f as oe,a as ie,b as ne,c as I,d as de,e as S,g as T}from"./index-Cz7jU3Cp.js";import"./logo-DN1bLr27.js";const ue={class:"py-4 sm:py-6 px-4 sm:px-7 mt-6 sm:mt-10 mx-auto bg-red-50 shadow-md rounded-lg"},me={class:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-2 sm:gap-0"},ce={class:"flex items-center gap-3"},ve={class:"bg-blue-50 p-3 rounded-lg shadow-sm border mb-4"},pe={class:"flex items-center justify-between mb-3"},be={class:"flex items-center gap-3"},fe={class:"text-base font-medium text-gray-800 flex items-center gap-2"},ge={class:"bg-blue-100 border border-blue-200 text-blue-700 px-3 py-1 rounded text-sm font-medium"},xe={class:"flex items-center gap-2"},ye={class:"space-y-3"},we={class:"text-sm font-medium leading-relaxed"},Pe={class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800"},he={class:"flex gap-1 justify-center items-center"},_e=["onClick"],ke=["onClick"],Ee={class:"flex flex-col gap-4"},Ce={class:"w-full flex flex-col"},Ve={key:0,class:"text-red-500 mt-1"},$e={class:"w-full flex flex-col"},Ne={key:0,class:"text-red-500 mt-1"},Ae={key:1,class:"text-orange-500 mt-1"},Le={key:0,class:"w-full flex flex-col"},De={key:0,class:"text-red-500 mt-1"},Ue={class:"flex justify-center gap-4 w-full"},je=["disabled"],ze={class:"flex flex-col gap-4"},Re={key:0,class:"w-full flex flex-col"},qe={key:0,class:"text-red-500 mt-1"},Ie={class:"w-full flex flex-col"},Se={key:0,class:"text-red-500 mt-1"},Fe={key:1,class:"text-orange-500 mt-1"},Te={class:"flex justify-center gap-4 w-full"},Be=["disabled"],Me={class:"flex items-center gap-3 mb-4"},Ge={class:"flex flex-col"},Ke={class:"flex justify-center gap-4 w-full"},Oe=["disabled"],Ye={__name:"ControlPaisesProvincias",setup(He){const n=X(),$=v([]),F=v([]),m=v("País"),_=v(""),E=v(!1),k=v(!1),C=v(!1),U=v(10),B=v([5,10,15,20,30]),t=v({id:null,nombre:"",pais_id:null}),r=v({id:null,nombre:"",pais_id:null}),y=v(null),M=v([{label:"Países",value:"País"},{label:"Provincias",value:"Provincia"}]);Y(()=>{N(),A()});const N=async()=>{try{const i=await w.get("/api/paises");$.value=i.data}catch{n.add({severity:"error",summary:"Error",detail:"No se pudieron cargar los países",life:3e3})}},A=async()=>{try{const i=await w.get("/api/provincias");F.value=i.data}catch{n.add({severity:"error",summary:"Error",detail:"No se pudieron cargar las provincias",life:3e3})}},j=Q(()=>{let i=m.value==="País"?$.value:F.value;return _.value&&(i=i.filter(e=>e.nombre.toLowerCase().includes(_.value.toLowerCase()))),i}),u=v(null);function G(){u.value=null,t.value={id:null,nombre:"",pais_id:null},E.value=!0}async function K(){var i,e;try{if(console.log("Datos a enviar:",{tipoAgregar:u.value,nombre:t.value.nombre,pais_id:t.value.pais_id}),!u.value){n.add({severity:"warn",summary:"Atención",detail:"Debe seleccionar qué desea agregar (País o Provincia)",life:4e3});return}if(!t.value.nombre||t.value.nombre.trim()===""){n.add({severity:"warn",summary:"Campo requerido",detail:"El nombre es obligatorio",life:4e3});return}if(t.value.nombre.trim().length>50){n.add({severity:"warn",summary:"Límite excedido",detail:"El nombre no puede tener más de 50 caracteres",life:4e3});return}if(u.value==="Provincia"&&!t.value.pais_id){n.add({severity:"warn",summary:"Campo requerido",detail:"Debe seleccionar un país para la provincia",life:4e3});return}if(u.value==="País"){const a=await w.post("/api/paises",{nombre:t.value.nombre.trim()});console.log("✅ País guardado exitosamente:",a.data),await N(),n.add({severity:"success",summary:"Guardado",detail:"País agregado correctamente",life:3e3})}else if(u.value==="Provincia"){const a=await w.post("/api/provincias",{nombre:t.value.nombre.trim(),pais_id:t.value.pais_id});console.log("✅ Provincia guardada exitosamente:",a.data),await A(),n.add({severity:"success",summary:"Guardado",detail:"Provincia agregada correctamente",life:3e3})}E.value=!1,t.value={id:null,nombre:"",pais_id:null},u.value=null}catch(a){if(console.error("❌ Error completo:",a),console.error("📋 Respuesta del error:",(i=a.response)==null?void 0:i.data),((e=a.response)==null?void 0:e.status)===422){const d=a.response.data.errors;console.log("⚠️ Errores de validación:",d),d!=null&&d.nombre?n.add({severity:"error",summary:"Ya existe",detail:d.nombre[0],life:5e3}):n.add({severity:"error",summary:"Error de validación",detail:a.response.data.message||"Datos inválidos",life:5e3})}else n.add({severity:"error",summary:"Error",detail:"No se pudo guardar. Intente nuevamente.",life:4e3})}}function O(i){r.value={...i},m.value==="Provincia"&&i.pais&&(r.value.pais_id=i.pais.id),k.value=!0}async function H(){var i,e,a;try{if(!r.value.nombre||r.value.nombre.trim()===""){n.add({severity:"warn",summary:"Campo requerido",detail:"El nombre es obligatorio",life:4e3});return}if(r.value.nombre.trim().length>50){n.add({severity:"warn",summary:"Límite excedido",detail:"El nombre no puede tener más de 50 caracteres",life:4e3});return}if(m.value==="Provincia"&&!r.value.pais_id){n.add({severity:"warn",summary:"Campo requerido",detail:"Debe seleccionar un país para la provincia",life:4e3});return}m.value==="País"?(await w.put(`/api/paises/${r.value.id}`,{nombre:r.value.nombre.trim()}),await N(),n.add({severity:"success",summary:"Actualizado",detail:"País actualizado correctamente",life:3e3}),k.value=!1):(await w.put(`/api/provincias/${r.value.id}`,{nombre:r.value.nombre.trim(),pais_id:r.value.pais_id}),await A(),n.add({severity:"success",summary:"Actualizado",detail:"Provincia actualizada correctamente",life:3e3}),k.value=!1)}catch(d){if(((i=d.response)==null?void 0:i.status)===422){const g=d.response.data.errors;g!=null&&g.nombre?n.add({severity:"error",summary:"Error de validación",detail:g.nombre[0],life:5e3}):n.add({severity:"error",summary:"Error de validación",detail:d.response.data.message||"Datos inválidos",life:5e3})}else{const g=((a=(e=d.response)==null?void 0:e.data)==null?void 0:a.message)||"No se pudo actualizar";n.add({severity:"error",summary:"Error",detail:g,life:4e3})}}}async function Z(){var i,e,a,d;try{if(!((i=y.value)!=null&&i.id)){n.add({severity:"error",summary:"Error",detail:"No se puede eliminar: ID no válido",life:3e3});return}m.value==="País"?(await w.delete(`/api/paises/${y.value.id}`),await N(),n.add({severity:"success",summary:"Eliminado",detail:"País eliminado correctamente",life:3e3})):(await w.delete(`/api/provincias/${y.value.id}`),await A(),n.add({severity:"success",summary:"Eliminado",detail:"Provincia eliminada correctamente",life:3e3})),C.value=!1,y.value=null}catch(g){if(((e=g.response)==null?void 0:e.status)===422)n.add({severity:"warn",summary:"No se puede eliminar",detail:g.response.data.message,life:5e3});else{const W=((d=(a=g.response)==null?void 0:a.data)==null?void 0:d.message)||"No se pudo eliminar";n.add({severity:"error",summary:"Error",detail:W,life:4e3})}}}function J(i){y.value=i,C.value=!0}return(i,e)=>(b(),x(te,null,[o(l(ee),{title:"Países y Provincias"}),o(re,null,{default:p(()=>[o(l(ae)),s("div",ue,[s("div",me,[s("div",ce,[o(l(se),{href:i.route("hoteles"),class:"flex items-center text-blue-600 hover:text-blue-700 transition-colors duration-200 px-4 rounded-lg",title:"Regresar a Hoteles"},{default:p(()=>[o(l(f),{icon:l(oe),class:"h-8"},null,8,["icon"])]),_:1},8,["href"]),e[17]||(e[17]=s("h3",{class:"text-lg sm:text-2xl text-blue-600 font-bold"},"Control de Países y Provincias",-1))]),s("button",{class:"bg-red-500 border border-red-500 p-2 text-sm text-white shadow-md hover:shadow-lg rounded-md hover:-translate-y-1 transition-transform duration-300",onClick:G},[o(l(f),{icon:l(ie),class:"h-4 w-4 text-white"},null,8,["icon"]),e[18]||(e[18]=s("span",null," Agregar",-1))])]),o(l(le),{value:j.value,dataKey:"id",paginator:!0,rows:U.value,rowsPerPageOptions:B.value,rowsPerPage:U.value,"onUpdate:rowsPerPage":e[3]||(e[3]=a=>U.value=a),paginatorTemplate:"RowsPerPageDropdown FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink",currentPageReportTemplate:`Mostrando {first} a {last} de {totalRecords} ${m.value==="País"?"países":"provincias"}`,class:"overflow-x-auto",responsiveLayout:"scroll",pt:{root:{class:"text-sm"},wrapper:{class:"text-sm"},table:{class:"text-sm"},thead:{class:"text-sm"},headerRow:{class:"text-sm"},headerCell:{class:"text-sm font-medium py-3 px-2"},tbody:{class:"text-sm"},bodyRow:{class:"h-16 text-sm"},bodyCell:{class:"py-3 px-2 text-sm"},paginator:{class:"text-xs sm:text-sm"},paginatorWrapper:{class:"flex flex-wrap justify-center sm:justify-between items-center gap-2 p-2"}}},{header:p(()=>[s("div",ve,[s("div",pe,[s("div",be,[s("h3",fe,[o(l(f),{icon:l(de),class:"text-blue-600 text-sm"},null,8,["icon"]),e[19]||(e[19]=s("span",null,"Filtros",-1))]),s("div",ge,h(j.value.length)+" resultado"+h(j.value.length!==1?"s":""),1)]),s("div",xe,[e[20]||(e[20]=s("label",{for:"tipo-estado",class:"text-sm font-medium text-gray-700"},"Mostrar:",-1)),o(l(L),{id:"tipo-estado",modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=a=>m.value=a),options:M.value,optionValue:"value",optionLabel:"label",class:"w-32 h-8 text-sm",style:{"background-color":"white","border-color":"#93c5fd"}},null,8,["modelValue","options"])])]),s("div",ye,[s("div",null,[m.value==="Provincia"?(b(),z(l(D),{key:0,modelValue:_.value,"onUpdate:modelValue":e[1]||(e[1]=a=>_.value=a),placeholder:"🔍 Buscar provincias...",class:"w-full h-9 text-sm",style:{"background-color":"white","border-color":"#93c5fd"}},null,8,["modelValue"])):(b(),z(l(D),{key:1,modelValue:_.value,"onUpdate:modelValue":e[2]||(e[2]=a=>_.value=a),placeholder:"🔍 Buscar países...",class:"w-full h-9 text-sm",style:{"background-color":"white","border-color":"#93c5fd"}},null,8,["modelValue"]))])])])]),default:p(()=>[o(l(R),{field:"nombre",header:"Nombre",sortable:""},{body:p(a=>[s("div",we,h(a.data.nombre),1)]),_:1}),m.value==="Provincia"?(b(),z(l(R),{key:0,field:"pais.nombre",header:"País",sortable:""},{body:p(a=>{var d;return[s("span",Pe,h(((d=a.data.pais)==null?void 0:d.nombre)||"Sin país"),1)]}),_:1})):P("",!0),o(l(R),{exportable:!1},{header:p(()=>e[21]||(e[21]=[s("div",{class:"text-center w-full font-bold"}," Acciones ",-1)])),body:p(a=>[s("div",he,[s("button",{class:"bg-orange-200/30 border py-2 px-3 text-sm shadow-md hover:shadow-lg rounded-md hover:-translate-y-1 transition-transform duration-300",onClick:d=>O(a.data)},[o(l(f),{icon:l(ne),class:"h-4 w-4 text-orange-600"},null,8,["icon"]),e[22]||(e[22]=c("  Editar "))],8,_e),s("button",{class:"bg-red-200/30 border py-2 px-3 text-sm shadow-md hover:shadow-lg rounded-md hover:-translate-y-1 transition-transform duration-300",onClick:d=>J(a.data)},[o(l(f),{icon:l(I),class:"h-4 w-4 text-red-600"},null,8,["icon"]),e[23]||(e[23]=c("  Eliminar "))],8,ke)])]),_:1})]),_:1},8,["value","rows","rowsPerPageOptions","rowsPerPage","currentPageReportTemplate"]),o(l(q),{visible:E.value,"onUpdate:visible":e[9]||(e[9]=a=>E.value=a),header:"Agregar",modal:!0,closable:!1,style:{width:"400px"}},{footer:p(()=>{var a;return[s("div",Ue,[s("button",{type:"button",class:"bg-white hover:bg-green-100 text-green-600 border border-green-600 px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",onClick:e[8]||(e[8]=d=>E.value=!1)},[o(l(f),{icon:l(S),class:"h-5 text-green-600"},null,8,["icon"]),e[27]||(e[27]=c(" Cancelar "))]),s("button",{class:"bg-red-500 hover:bg-red-700 text-white border-none px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",onClick:K,disabled:!((a=t.value.nombre)!=null&&a.trim())||!u.value||t.value.nombre.trim().length>50||u.value==="Provincia"&&!t.value.pais_id},[o(l(f),{icon:l(T),class:"h-5 text-white"},null,8,["icon"]),e[28]||(e[28]=c(" Guardar "))],8,je)])]}),default:p(()=>[s("div",Ee,[s("div",Ce,[e[24]||(e[24]=s("label",{class:"text-sm font-medium text-gray-700 mb-2"},[c(" Tipo: "),s("span",{class:"text-red-500"},"*")],-1)),o(l(L),{modelValue:u.value,"onUpdate:modelValue":e[4]||(e[4]=a=>u.value=a),options:[{label:"País",value:"País"},{label:"Provincia",value:"Provincia"}],optionLabel:"label",optionValue:"value",placeholder:"Seleccione qué desea agregar",class:V(["w-full",{"border-red-300":!u.value}])},null,8,["modelValue","class"]),u.value?P("",!0):(b(),x("small",Ve," ⚠️ Debe seleccionar el tipo "))]),s("div",$e,[e[25]||(e[25]=s("label",{class:"text-sm font-medium text-gray-700 mb-2"},[c(" Nombre: "),s("span",{class:"text-red-500"},"*")],-1)),o(l(D),{modelValue:t.value.nombre,"onUpdate:modelValue":e[5]||(e[5]=a=>t.value.nombre=a),placeholder:"Nombre (máximo 50 caracteres)",class:V(["w-full",{"border-red-300":!t.value.nombre||t.value.nombre.trim()===""}]),disabled:!u.value,maxlength:"50",onKeypress:e[6]||(e[6]=a=>{/[A-Za-zÀ-ÿ\s]/.test(a.key)||a.preventDefault()})},null,8,["modelValue","class","disabled"]),!t.value.nombre||t.value.nombre.trim()===""?(b(),x("small",Ne," ⚠️ El nombre es obligatorio ")):t.value.nombre&&t.value.nombre.length>=40&&t.value.nombre.length<=50?(b(),x("small",Ae," Caracteres restantes: "+h(50-t.value.nombre.length),1)):P("",!0)]),u.value==="Provincia"?(b(),x("div",Le,[e[26]||(e[26]=s("label",{class:"text-sm font-medium text-gray-700 mb-2"},[c(" País: "),s("span",{class:"text-red-500"},"*")],-1)),o(l(L),{modelValue:t.value.pais_id,"onUpdate:modelValue":e[7]||(e[7]=a=>t.value.pais_id=a),options:$.value,optionLabel:"nombre",optionValue:"id",placeholder:"Seleccione un país",class:V(["w-full",{"border-red-300":u.value==="Provincia"&&!t.value.pais_id}])},null,8,["modelValue","options","class"]),u.value==="Provincia"&&!t.value.pais_id?(b(),x("small",De," ⚠️ Debe seleccionar un país ")):P("",!0)])):P("",!0)])]),_:1},8,["visible"]),o(l(q),{visible:k.value,"onUpdate:visible":e[14]||(e[14]=a=>k.value=a),header:`Editar ${m.value}`,modal:!0,closable:!1,style:{width:"400px"}},{footer:p(()=>{var a;return[s("div",Te,[s("button",{type:"button",class:"bg-white hover:bg-green-100 text-green-600 border border-green-600 px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",onClick:e[13]||(e[13]=d=>k.value=!1)},[o(l(f),{icon:l(S),class:"h-5 text-green-600"},null,8,["icon"]),e[31]||(e[31]=c(" Cancelar "))]),s("button",{class:"bg-red-500 hover:bg-red-700 text-white border-none px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",onClick:H,disabled:!((a=r.value.nombre)!=null&&a.trim())||r.value.nombre.trim().length>50||m.value==="Provincia"&&!r.value.pais_id},[o(l(f),{icon:l(T),class:"h-5 text-white"},null,8,["icon"]),e[32]||(e[32]=c(" Actualizar "))],8,Be)])]}),default:p(()=>[s("div",ze,[m.value==="Provincia"?(b(),x("div",Re,[e[29]||(e[29]=s("label",{class:"text-sm font-medium text-gray-700 mb-2"},[c(" País: "),s("span",{class:"text-red-500"},"*")],-1)),o(l(L),{modelValue:r.value.pais_id,"onUpdate:modelValue":e[10]||(e[10]=a=>r.value.pais_id=a),options:$.value,optionLabel:"nombre",optionValue:"id",placeholder:"Seleccione un país",class:V(["w-full",{"border-red-300":m.value==="Provincia"&&!r.value.pais_id}])},null,8,["modelValue","options","class"]),m.value==="Provincia"&&!r.value.pais_id?(b(),x("small",qe," ⚠️ Debe seleccionar un país ")):P("",!0)])):P("",!0),s("div",Ie,[e[30]||(e[30]=s("label",{class:"text-sm font-medium text-gray-700 mb-2"},[c(" Nombre: "),s("span",{class:"text-red-500"},"*")],-1)),o(l(D),{modelValue:r.value.nombre,"onUpdate:modelValue":e[11]||(e[11]=a=>r.value.nombre=a),placeholder:"Nombre (máximo 50 caracteres)",class:V(["w-full",{"border-red-300":!r.value.nombre||r.value.nombre.trim()===""}]),maxlength:"50",onKeypress:e[12]||(e[12]=a=>{/[A-Za-zÀ-ÿ\s]/.test(a.key)||a.preventDefault()})},null,8,["modelValue","class"]),!r.value.nombre||r.value.nombre.trim()===""?(b(),x("small",Se," ⚠️ El nombre es obligatorio ")):r.value.nombre&&r.value.nombre.length>=40&&r.value.nombre.length<=50?(b(),x("small",Fe," Caracteres restantes: "+h(50-r.value.nombre.length),1)):P("",!0)])])]),_:1},8,["visible","header"]),o(l(q),{visible:C.value,"onUpdate:visible":e[16]||(e[16]=a=>C.value=a),header:`Eliminar ${m.value}`,modal:!0,closable:!1,style:{width:"400px"}},{footer:p(()=>[s("div",Ke,[s("button",{type:"button",class:"bg-white hover:bg-green-100 text-green-600 border border-green-600 px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",onClick:e[15]||(e[15]=a=>C.value=!1)},[o(l(f),{icon:l(S),class:"h-5 text-green-600"},null,8,["icon"]),e[36]||(e[36]=c(" Cancelar "))]),s("button",{class:"bg-red-500 hover:bg-red-700 text-white border-none px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",onClick:Z,disabled:!y.value||!y.value.nombre},[o(l(f),{icon:l(I),class:"h-5 text-white"},null,8,["icon"]),e[37]||(e[37]=c(" Eliminar "))],8,Oe)])]),default:p(()=>{var a;return[s("div",Me,[o(l(f),{icon:l(I),class:"h-8 w-8 text-red-500"},null,8,["icon"]),s("div",Ge,[s("span",null,[e[33]||(e[33]=c("¿Estás seguro de eliminar ")),s("b",null,h((a=y.value)==null?void 0:a.nombre),1),e[34]||(e[34]=c("?"))]),e[35]||(e[35]=s("span",{class:"text-red-600 text-sm font-medium mt-1"},"Esta acción es irreversible.",-1))])])]}),_:1},8,["visible","header"])])]),_:1})],64))}};export{Ye as default};
