import{p as qe,r as p,i as R,l as Fe,E as Ge,c as He,o as l,w as We,a as c,b as e,f as a,h as C,e as y,u as r,t as d,j as P,C as D,D as ie,F as E,y as U,n as L,G as Ke,d as Oe,v as Je,W as Qe,B as S}from"./app-DP8tsAem.js";import{_ as Xe}from"./AuthenticatedLayout-BvfF3yw2.js";import{F as v,h as de,j as Ye,o as ye,n as he,p as Ze,q as Q,r as _e,s as ue,t as ee,u as we}from"./index-ClJ1gEnJ.js";import"./logo-DN1bLr27.js";const es={class:"container mx-auto px-4 py-8"},ss={class:"bg-white rounded-lg shadow-lg overflow-hidden"},ts={class:"bg-gradient-to-r from-red-600 to-red-700 px-6 py-4"},os={class:"flex justify-between items-center"},ls={class:"text-2xl font-bold text-white flex items-center"},as={class:"p-6"},rs={class:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6"},ns={class:"bg-red-50 rounded-lg p-4"},is={class:"flex items-center"},ds={class:"ml-4"},us={class:"text-2xl font-bold text-red-900"},cs={class:"bg-blue-50 rounded-lg p-4"},ms={class:"flex items-center"},vs={class:"ml-4"},ps={class:"text-2xl font-bold text-blue-900"},gs={class:"bg-green-50 rounded-lg p-4"},xs={class:"flex items-center"},fs={class:"ml-4"},bs={class:"text-2xl font-bold text-green-900"},ys={class:"mb-6 flex flex-wrap gap-4"},hs={class:"flex-1 min-w-64"},_s={class:"relative"},ws={class:"overflow-x-auto"},ks={class:"min-w-full bg-white border border-gray-200 rounded-lg"},Cs={class:"divide-y divide-gray-200"},Ps={class:"px-6 py-4 whitespace-nowrap"},Es={class:"flex items-center"},Us={class:"flex-shrink-0 h-10 w-10"},Ms=["src","alt"],As={class:"ml-4"},js={class:"text-sm font-medium text-gray-900"},$s={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Rs={class:"px-6 py-4 whitespace-nowrap"},zs={class:"flex flex-wrap gap-1"},Ns={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Vs={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ds={class:"px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2"},Ts=["onClick"],Is=["onClick"],Ls={key:0,class:"mt-6 flex items-center justify-between"},Ss={class:"flex items-center text-sm text-gray-500"},Bs={class:"flex items-center space-x-2"},qs={class:"flex items-center space-x-2"},Fs={class:"relative"},Gs={class:"flex items-center space-x-1"},Hs=["disabled"],Ws=["disabled"],Ks=["onClick"],Os={key:1,class:"px-2 text-gray-500"},Js=["disabled"],Qs=["disabled"],Xs={key:1,class:"text-center py-8"},Ys={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Zs={class:"bg-white rounded-lg p-6 w-[600px] max-w-full mx-4 max-h-[90vh] overflow-y-auto"},et={class:"text-lg font-semibold mb-4 flex items-center"},st={class:"mb-6"},tt={class:"text-gray-600 mb-1"},ot={class:"text-gray-600 mb-3"},lt={class:"mb-4 p-4 bg-gray-50 rounded-lg"},at={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},rt={class:"mb-4 p-3 bg-blue-50 rounded-lg"},nt={class:"flex flex-wrap gap-1"},it={key:0,class:"px-2 py-1 text-xs bg-gray-200 text-gray-600 rounded-full"},dt={class:"space-y-2 mb-4"},ut=["id","value"],ct=["for"],mt={class:"border-t pt-4"},vt={key:0,class:"mb-4"},pt={class:"text-sm font-medium text-green-700 mb-2 flex items-center"},gt={class:"space-y-2 max-h-32 overflow-y-auto"},xt={class:"flex items-center"},ft={class:"text-sm text-green-800 font-medium"},bt=["onClick","disabled","title"],yt={key:0,class:"mt-2 flex items-center text-orange-600 text-xs"},ht={key:1},_t={class:"text-sm font-medium text-blue-700 mb-2 flex items-center"},wt={class:"space-y-2 max-h-32 overflow-y-auto"},kt={class:"text-sm text-gray-700"},Ct=["onClick"],Pt={key:2,class:"text-center py-3 text-gray-500 text-sm"},Et={class:"flex justify-end space-x-3"},Ut=["disabled"],Mt={key:0},At={key:1},jt={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},$t={class:"bg-white rounded-lg p-6 w-96 max-w-full mx-4"},Rt={class:"text-lg font-semibold mb-4 flex items-center"},zt={class:"mb-4"},Nt={class:"text-gray-600 mb-2"},Vt={class:"text-gray-600 mb-4"},Dt={key:0,class:"text-center py-4"},Tt={key:1,class:"space-y-2 max-h-48 overflow-y-auto"},It={class:"text-sm text-gray-700"},Lt={key:2,class:"text-center py-4"},St={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Bt={class:"bg-white rounded-lg p-6 w-[700px] max-w-full mx-4 max-h-[90vh] overflow-y-auto"},qt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ft={class:"border-t pt-4"},Gt={class:"mb-3"},Ht={class:"text-md font-semibold text-gray-800 mb-2 flex items-center"},Wt={class:"mb-4"},Kt={class:"max-h-60 overflow-y-auto border rounded p-3 bg-gray-50"},Ot={key:0,class:"space-y-2"},Jt=["id","value","disabled"],Qt=["for"],Xt={key:1,class:"text-center py-3 text-gray-500"},Yt={class:"mt-3 flex items-center justify-between"},Zt={class:"text-sm"},eo={class:"font-medium text-gray-700"},so={key:0,class:"text-red-600 ml-2"},to={key:1,class:"text-green-600 ml-2"},oo={class:"flex gap-2"},lo=["disabled"],ao={class:"flex justify-end space-x-3 pt-4"},ro=["disabled"],no={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},io={class:"bg-white rounded-lg p-6 w-[600px] max-w-full mx-4 max-h-[90vh] overflow-y-auto"},uo={class:"text-lg font-semibold mb-4 flex items-center"},co={class:"mb-4"},mo={class:"text-gray-600 mb-2"},vo={class:"text-gray-600 mb-4"},po={class:"space-y-6"},go={class:"text-md font-semibold text-gray-800 mb-3 flex items-center"},xo={key:0,class:"space-y-2 max-h-40 overflow-y-auto border rounded p-3"},fo={class:"flex items-center"},bo={class:"text-sm text-gray-700"},yo=["onClick","disabled"],ho={key:1,class:"text-center py-4 text-gray-500 border rounded"},_o={key:2,class:"mt-2 text-xs text-orange-600 flex items-center"},wo={class:"text-md font-semibold text-gray-800 mb-3 flex items-center"},ko={key:0,class:"space-y-2 max-h-40 overflow-y-auto border rounded p-3"},Co={class:"text-sm text-gray-700"},Po=["onClick","disabled"],Eo={key:1,class:"text-center py-4 text-gray-500 border rounded"},Uo={class:"flex justify-end space-x-3 mt-6 pt-4 border-t"},Mo=["disabled"],Ao={key:2,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},jo={class:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4"},$o={class:"p-6"},Ro={class:"flex items-center mb-4"},zo={class:"flex justify-end space-x-3"},Io={__name:"Roles",props:{users:Array,roles:Array,permissions:Array},setup(ke){const se=qe(),te=ke,z=p(te.users||[]);p(te.roles||[]);const B=p(te.permissions||[]),q=p(""),G=p(""),oe=p(!1),le=p(!1),ce=p(!1),ae=p(!1),X=p(!1),m=p(null),i=p([]),A=p([]),x=p(null),j=p(null),Y=p(""),M=p([]),f=p(!1),me=p(!1),_=p(1),T=p(5);p([]);const I=p(""),n=p({name:"",email:"",password:"",role:"empleado",cargo:"",telefono:"",selectedPermissions:[]}),F=R(()=>{let o=z.value;return q.value&&(o=o.filter(s=>s.name.toLowerCase().includes(q.value.toLowerCase())||s.email.toLowerCase().includes(q.value.toLowerCase()))),G.value&&(o=o.filter(s=>s.roles.includes(G.value))),o}),H=R(()=>Math.ceil(F.value.length/T.value)),Ce=R(()=>{const o=(_.value-1)*T.value,s=o+T.value;return F.value.slice(o,s)}),re=R(()=>{const o=(_.value-1)*T.value+1,s=Math.min(_.value*T.value,F.value.length);return{start:o,end:s,total:F.value.length}}),Pe=R(()=>["admin","empleado"]),Ee=R(()=>{if(!m.value||!m.value.roles||m.value.roles.length===0)return"Editar datos del usuario";const o=m.value.roles[0];return o==="admin"?"Editar datos del administrador":o==="empleado"?"Editar datos del empleado":"Editar datos del usuario"}),ve=R(()=>{const o=I.value!==Y.value,s=x.value&&j.value&&(x.value.cargo!==j.value.cargo||x.value.telefono!==j.value.telefono),u=A.value.length>0&&(i.value.length!==A.value.length||!i.value.every(g=>A.value.includes(g))||!A.value.every(g=>i.value.includes(g)));return o||s||u}),Ue=R(()=>"Actualizar"),Me=R(()=>{const o=[],s=H.value,u=_.value;if(s<=7)for(let g=1;g<=s;g++)o.push(g);else u<=4?o.push(1,2,3,4,5,"...",s):u>=s-3?o.push(1,"...",s-4,s-3,s-2,s-1,s):o.push(1,"...",u-1,u,u+1,"...",s);return o}),pe=o=>z.value.filter(s=>s.roles.includes(o)).length,W=o=>{o>=1&&o<=H.value&&(_.value=o)};Fe([q,G],()=>{_.value=1});const Ae=async o=>{m.value={...o},I.value=o.roles[0]||"",Y.value=o.roles[0]||"",i.value=[],A.value=[],x.value={cargo:"",telefono:""},j.value={cargo:"",telefono:""},f.value=!0,oe.value=!0;try{await $e(o),await Re(o)}catch(s){console.error("Error loading user data:",s),b("Error al cargar los datos del usuario")}finally{f.value=!1}},je=()=>{ve.value?X.value=!0:ne()},ne=()=>{oe.value=!1,X.value=!1,m.value=null,I.value="",Y.value="",i.value=[],A.value=[],x.value=null,j.value=null,M.value=[]},$e=async o=>{try{const s=await S.get(`/roles/users/${o.id}/permissions`);s.data.success&&(i.value=[...s.data.permissions],A.value=[...s.data.permissions],M.value=B.value.filter(u=>!i.value.includes(u.name)))}catch(s){throw console.error("Error fetching user permissions:",s),s}},Re=async o=>{try{const s=await S.get(`/roles/users/${o.id}/employee`);if(s.data.success&&s.data.employee){const u={cargo:s.data.employee.cargo||"",telefono:s.data.employee.telefono||""};x.value={...u},j.value={...u}}else{const u={cargo:"",telefono:""};x.value={...u},j.value={...u}}}catch(s){console.error("Error fetching employee data:",s);const u={cargo:"",telefono:""};x.value={...u},j.value={...u}}},ge=async o=>{!m.value||me.value||i.value.includes(o)||(i.value.push(o),M.value=B.value.filter(s=>!i.value.includes(s.name)))},xe=async o=>{if(!m.value||me.value)return;if(i.value.length===1){b("No se puede eliminar el último permiso. El usuario debe tener al menos uno.");return}const s=i.value.indexOf(o);s>-1&&(i.value.splice(s,1),M.value=B.value.filter(u=>!i.value.includes(u.name)))},ze=async o=>{m.value=o,f.value=!0;try{const s=await S.get(`/roles/users/${o.id}/permissions`);s.data.success&&(i.value=s.data.permissions||[],le.value=!0)}catch(s){console.error("Error fetching permissions:",s),b("Error al obtener los permisos del usuario")}finally{f.value=!1}},Ne=()=>{le.value=!1,m.value=null,i.value=[]},Ve=()=>{ce.value=!1,m.value=null,i.value=[],M.value=[]},De=()=>{ae.value=!0,n.value.selectedPermissions=[]},Te=()=>{n.value.selectedPermissions=[]},Ie=()=>{n.value.selectedPermissions=B.value.map(o=>o.name)},Le=async()=>{var g,$,K,O,J;if(!m.value){b("Error: No hay usuario seleccionado");return}const o=I.value!==Y.value,s=x.value&&j.value&&(x.value.cargo!==j.value.cargo||x.value.telefono!==j.value.telefono),u=A.value.length>0&&(i.value.length!==A.value.length||!i.value.every(h=>A.value.includes(h))||!A.value.every(h=>i.value.includes(h)));if(!o&&!s&&!u){b("No hay cambios para guardar");return}f.value=!0;try{let h=[],w=[];if(s){if(!((g=x.value)!=null&&g.cargo)||!(($=x.value)!=null&&$.telefono)){b("Por favor complete todos los campos del empleado"),f.value=!1;return}h.push(S.put(`/roles/users/${m.value.id}/employee`,{cargo:x.value.cargo,telefono:x.value.telefono}).then(()=>{w.push("Datos del empleado actualizados")}))}o&&h.push(S.post(`/roles/users/${m.value.id}/update-roles`,{roles:[I.value]}).then(N=>{if(N.data.success){const V=z.value.findIndex(t=>t.id===m.value.id);V!==-1&&(z.value[V]=N.data.user),w.push("Rol actualizado")}})),u&&h.push(S.put(`/roles/users/${m.value.id}/sync-permissions`,{permissions:i.value}).then(N=>{if(N.data.success){const V=z.value.findIndex(t=>t.id===m.value.id);V!==-1&&(z.value[V]=N.data.user),w.push("Permisos actualizados")}})),await Promise.all(h),be(w.join(" y ")+" correctamente"),ne()}catch(h){if(console.error("Error saving changes:",h),((K=h.response)==null?void 0:K.status)===422){const w=h.response.data.errors;w.cargo?b("Error en el campo cargo: "+w.cargo[0]):w.telefono?b("Error en el campo teléfono: "+w.telefono[0]):w.roles?b("Error en el rol seleccionado"):w.permissions?b("Error en los permisos seleccionados"):b("Por favor revise los datos ingresados")}else b(((J=(O=h.response)==null?void 0:O.data)==null?void 0:J.message)||"Error al guardar los cambios")}finally{f.value=!1}},Se=async()=>{var o,s,u;if(!n.value.name||!n.value.email||!n.value.password||!n.value.cargo||!n.value.telefono){b("Por favor complete todos los campos");return}if(n.value.selectedPermissions.length===0){b("Debe seleccionar al menos un permiso para el usuario");return}f.value=!0;try{const g=await S.post("/roles/create-user",{name:n.value.name,email:n.value.email,password:n.value.password,role:n.value.role,cargo:n.value.cargo,telefono:n.value.telefono,permissions:n.value.selectedPermissions});if(g.data.success){let $=g.data.user;z.value.push($),fe(),be(g.data.message||`Usuario ${n.value.name} creado correctamente`)}}catch(g){if(console.error("Error creating user:",g),((o=g.response)==null?void 0:o.status)===422){const $=g.response.data.errors;$.email?b("Este email ya está registrado"):$.permissions?b("Error en los permisos seleccionados"):b("Por favor revise los datos ingresados")}else b(((u=(s=g.response)==null?void 0:s.data)==null?void 0:u.message)||"Error al crear el usuario")}finally{f.value=!1}},fe=()=>{ae.value=!1,n.value={name:"",email:"",password:"",role:"empleado",cargo:"",telefono:"",selectedPermissions:[]}},Z=o=>({admin:"bg-red-100 text-red-800",empleado:"bg-blue-100 text-blue-800"})[o]||"bg-gray-100 text-gray-800",be=o=>{se.add({severity:"success",summary:"Éxito",detail:o,life:4e3})},b=o=>{se.add({severity:"error",summary:"Error",detail:o,life:5e3})},Be=()=>{se.add({severity:"info",summary:"Actualizando",detail:"Recargando datos de usuarios y roles...",life:2e3}),Qe.reload({only:["users","roles"]})};return(o,s)=>{const u=Ge("Toast");return l(),He(Xe,null,{default:We(()=>{var g,$,K,O,J,h,w,N,V;return[c(u),e("div",es,[e("div",ss,[e("div",ts,[e("div",os,[e("div",null,[e("h1",ls,[c(r(v),{icon:r(de),class:"mr-3"},null,8,["icon"]),s[19]||(s[19]=y(" Gestión de Usuarios Internos "))]),s[20]||(s[20]=e("p",{class:"text-red-100 mt-2"},"Gestione empleados, administradores y sus permisos",-1))]),e("button",{onClick:De,class:"bg-white text-red-600 px-4 py-2 rounded-lg font-semibold hover:bg-red-50 transition-colors duration-200 flex items-center"},[c(r(v),{icon:r(Ye),class:"mr-2"},null,8,["icon"]),s[21]||(s[21]=y(" Nuevo Usuario "))])])]),e("div",as,[e("div",rs,[e("div",ns,[e("div",is,[c(r(v),{icon:r(de),class:"h-8 w-8 text-red-600"},null,8,["icon"]),e("div",ds,[s[22]||(s[22]=e("p",{class:"text-sm font-medium text-red-600"},"Total Usuarios",-1)),e("p",us,d(z.value.length),1)])])]),e("div",cs,[e("div",ms,[c(r(v),{icon:r(ye),class:"h-8 w-8 text-blue-600"},null,8,["icon"]),e("div",vs,[s[23]||(s[23]=e("p",{class:"text-sm font-medium text-blue-600"},"Administradores",-1)),e("p",ps,d(pe("admin")),1)])])]),e("div",gs,[e("div",xs,[c(r(v),{icon:r(de),class:"h-8 w-8 text-green-600"},null,8,["icon"]),e("div",fs,[s[24]||(s[24]=e("p",{class:"text-sm font-medium text-green-600"},"Empleados",-1)),e("p",bs,d(pe("empleado")),1)])])])]),e("div",ys,[e("div",hs,[P(e("input",{"onUpdate:modelValue":s[0]||(s[0]=t=>q.value=t),type:"text",placeholder:"Buscar por nombre o email...",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"},null,512),[[D,q.value]])]),e("div",_s,[P(e("select",{"onUpdate:modelValue":s[1]||(s[1]=t=>G.value=t),class:"px-4 py-2 pr-8 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent bg-white cursor-pointer w-full",style:{appearance:"none","-webkit-appearance":"none","-moz-appearance":"none"}},s[25]||(s[25]=[e("option",{value:""},"Todos los roles",-1),e("option",{value:"admin"},"Administrador",-1),e("option",{value:"empleado"},"Empleado",-1)]),512),[[ie,G.value]]),s[26]||(s[26]=e("div",{class:"absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none"},[e("svg",{class:"w-5 h-5 text-gray-400",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z","clip-rule":"evenodd"})])],-1))]),e("button",{onClick:Be,class:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors"}," Actualizar ")]),e("div",ws,[e("table",ks,[s[27]||(s[27]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Usuario "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Email "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Roles "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Fecha Registro "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Última Actualización "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Acciones ")])],-1)),e("tbody",Cs,[(l(!0),a(E,null,U(Ce.value,t=>(l(),a("tr",{key:t.id,class:"hover:bg-gray-50"},[e("td",Ps,[e("div",Es,[e("div",Us,[e("img",{src:`https://ui-avatars.com/api/?name=${encodeURIComponent(t.name)}&background=ed1c24&color=fff&size=40`,class:"h-10 w-10 rounded-full",alt:t.name},null,8,Ms)]),e("div",As,[e("div",js,d(t.name),1)])])]),e("td",$s,d(t.email),1),e("td",Rs,[e("div",zs,[(l(!0),a(E,null,U(t.roles,k=>(l(),a("span",{key:k,class:L([Z(k),"px-2 py-1 text-xs font-semibold rounded-full"])},d(k),3))),128))])]),e("td",Ns,d(t.created_at),1),e("td",Vs,d(t.updated_at),1),e("td",Ds,[e("button",{onClick:k=>Ae(t),class:"text-orange-600 hover:text-orange-900 transition-colors",title:"Editar Roles y Permisos"},[c(r(v),{icon:r(he),class:"h-5 w-5"},null,8,["icon"])],8,Ts),e("button",{onClick:k=>ze(t),class:"text-blue-600 hover:text-blue-900 transition-colors",title:"Ver Permisos"},[c(r(v),{icon:r(Ze),class:"h-5 w-5"},null,8,["icon"])],8,Is)])]))),128))])])]),F.value.length>0?(l(),a("div",Ls,[e("div",Ss,[e("span",null,"Mostrando "+d(re.value.start)+" - "+d(re.value.end)+" de "+d(re.value.total)+" usuarios",1)]),e("div",Bs,[e("div",qs,[s[30]||(s[30]=e("span",{class:"text-sm text-gray-500"},"Mostrar:",-1)),e("div",Fs,[P(e("select",{"onUpdate:modelValue":s[2]||(s[2]=t=>T.value=t),onChange:s[3]||(s[3]=t=>_.value=1),class:"appearance-none border border-gray-300 rounded px-2 py-1 pr-6 text-sm bg-white focus:outline-none focus:ring-1 focus:ring-red-500 focus:border-red-500"},s[28]||(s[28]=[e("option",{value:5},"5",-1),e("option",{value:10},"10",-1),e("option",{value:15},"15",-1),e("option",{value:20},"20",-1)]),544),[[ie,T.value]]),s[29]||(s[29]=e("div",{class:"absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none"},[e("svg",{class:"w-3 h-3 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})])],-1))])]),e("div",Gs,[e("button",{onClick:s[4]||(s[4]=t=>W(1)),disabled:_.value===1,class:"px-2 py-1 text-sm border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"}," ⟪ ",8,Hs),e("button",{onClick:s[5]||(s[5]=t=>W(_.value-1)),disabled:_.value===1,class:"px-2 py-1 text-sm border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"}," ⟨ ",8,Ws),(l(!0),a(E,null,U(Me.value,t=>(l(),a("span",{key:t},[t!=="..."?(l(),a("button",{key:0,onClick:k=>W(t),class:L([t===_.value?"bg-red-600 text-white":"text-gray-700 hover:bg-gray-50","px-3 py-1 text-sm border border-gray-300 rounded"])},d(t),11,Ks)):(l(),a("span",Os,"..."))]))),128)),e("button",{onClick:s[6]||(s[6]=t=>W(_.value+1)),disabled:_.value===H.value,class:"px-2 py-1 text-sm border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"}," ⟩ ",8,Js),e("button",{onClick:s[7]||(s[7]=t=>W(H.value)),disabled:_.value===H.value,class:"px-2 py-1 text-sm border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"}," ⟫ ",8,Qs)])])])):C("",!0),F.value.length===0?(l(),a("div",Xs,s[31]||(s[31]=[e("p",{class:"text-gray-500"},"No se encontraron usuarios con los filtros aplicados.",-1)]))):C("",!0)])]),oe.value?(l(),a("div",Ys,[e("div",Zs,[e("h3",et,[c(r(v),{icon:r(he),class:"mr-2 text-red-600"},null,8,["icon"]),y(" "+d(Ee.value),1)]),e("div",st,[e("p",tt,[s[32]||(s[32]=y("Usuario: ")),e("strong",null,d((g=m.value)==null?void 0:g.name),1)]),e("p",ot,[s[33]||(s[33]=y("Email: ")),e("strong",null,d(($=m.value)==null?void 0:$.email),1)]),e("div",lt,[s[36]||(s[36]=e("h4",{class:"text-sm font-medium text-gray-800 mb-3"},"Información del Empleado",-1)),e("div",at,[e("div",null,[s[34]||(s[34]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Cargo",-1)),P(e("input",{"onUpdate:modelValue":s[8]||(s[8]=t=>x.value.cargo=t),type:"text",maxlength:"25",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent text-sm",placeholder:"Ej: Ejecutivo de ventas, Administrador, etc."},null,512),[[D,x.value.cargo]])]),e("div",null,[s[35]||(s[35]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Teléfono",-1)),P(e("input",{"onUpdate:modelValue":s[9]||(s[9]=t=>x.value.telefono=t),type:"tel",maxlength:"8",pattern:"[0-9]{8}",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent text-sm",placeholder:"12345678"},null,512),[[D,x.value.telefono]])])])]),e("div",rt,[s[37]||(s[37]=e("p",{class:"text-sm font-medium text-blue-800 mb-2"},"Rol Actual:",-1)),e("div",nt,[(l(!0),a(E,null,U((K=m.value)==null?void 0:K.roles,t=>(l(),a("span",{key:t,class:L([Z(t),"px-2 py-1 text-xs font-semibold rounded-full"])},d(t),3))),128)),(J=(O=m.value)==null?void 0:O.roles)!=null&&J.length?C("",!0):(l(),a("span",it," Sin rol asignado "))])]),s[40]||(s[40]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Cambiar Rol:",-1)),e("div",dt,[(l(!0),a(E,null,U(Pe.value,t=>(l(),a("div",{key:t,class:"flex items-center"},[P(e("input",{id:`role-${t}`,type:"radio",value:t,"onUpdate:modelValue":s[10]||(s[10]=k=>I.value=k),name:"userRole",class:"h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300"},null,8,ut),[[Ke,I.value]]),e("label",{for:`role-${t}`,class:"ml-2 text-sm text-gray-700 capitalize"},d(t),9,ct)]))),128))]),e("div",mt,[s[39]||(s[39]=e("p",{class:"text-sm text-gray-600 mb-3"},"Los roles son organizacionales. Los permisos se gestionan manualmente.",-1)),i.value.length>0?(l(),a("div",vt,[e("h4",pt,[c(r(v),{icon:r(Q),class:"mr-2"},null,8,["icon"]),y(" Permisos Asignados ("+d(i.value.length)+") ",1)]),e("div",gt,[(l(!0),a(E,null,U(i.value,t=>(l(),a("div",{key:t,class:"flex items-center justify-between p-2 bg-green-50 border border-green-200 rounded"},[e("div",xt,[c(r(v),{icon:r(Q),class:"text-green-600 mr-2"},null,8,["icon"]),e("span",ft,d(t),1)]),e("button",{onClick:k=>xe(t),class:"text-red-600 hover:text-red-800 transition-colors",disabled:i.value.length===1,title:i.value.length===1?"No se puede eliminar el último permiso":"Eliminar permiso"},[c(r(v),{icon:r(_e)},null,8,["icon"])],8,bt)]))),128))]),i.value.length===1?(l(),a("div",yt,[c(r(v),{icon:r(ue),class:"mr-1"},null,8,["icon"]),s[38]||(s[38]=y(" No se puede eliminar el último permiso. El usuario debe tener al menos uno. "))])):C("",!0)])):C("",!0),M.value.length>0?(l(),a("div",ht,[e("h4",_t,[c(r(v),{icon:r(ee),class:"mr-2"},null,8,["icon"]),y(" Asignar Nuevos Permisos ("+d(M.value.length)+") ",1)]),e("div",wt,[(l(!0),a(E,null,U(M.value,t=>(l(),a("div",{key:t.name,class:"flex items-center justify-between p-2 bg-white border border-gray-200 rounded hover:bg-blue-50 transition-colors"},[e("span",kt,d(t.name),1),e("button",{onClick:k=>ge(t.name),class:"text-blue-600 hover:text-blue-800 transition-colors",title:"Asignar permiso"},[c(r(v),{icon:r(ee)},null,8,["icon"])],8,Ct)]))),128))])])):C("",!0),M.value.length===0&&i.value.length>0?(l(),a("div",Pt," ✅ El usuario tiene todos los permisos disponibles ")):C("",!0)])]),e("div",Et,[e("button",{onClick:je,class:"px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors"}," Cerrar "),e("button",{onClick:Le,class:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:f.value||!ve.value},[f.value?(l(),a("span",Mt,"Guardando...")):(l(),a("span",At,d(Ue.value),1))],8,Ut)])])])):C("",!0),le.value?(l(),a("div",jt,[e("div",$t,[e("h3",Rt,[c(r(v),{icon:r(ye),class:"mr-2 text-blue-600"},null,8,["icon"]),s[41]||(s[41]=y(" Permisos del Usuario "))]),e("div",zt,[e("p",Nt,[s[42]||(s[42]=y("Usuario: ")),e("strong",null,d((h=m.value)==null?void 0:h.name),1)]),e("p",Vt,[s[43]||(s[43]=y("Roles: ")),(l(!0),a(E,null,U((w=m.value)==null?void 0:w.roles,t=>(l(),a("span",{key:t,class:L([Z(t),"px-2 py-1 text-xs font-semibold rounded-full ml-1"])},d(t),3))),128))]),s[46]||(s[46]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Permisos:",-1)),f.value?(l(),a("div",Dt,s[44]||(s[44]=[e("p",{class:"text-gray-500"},"Cargando permisos...",-1)]))):i.value.length>0?(l(),a("div",Tt,[(l(!0),a(E,null,U(i.value,t=>(l(),a("div",{key:t,class:"flex items-center p-2 bg-gray-50 rounded"},[c(r(v),{icon:r(Q),class:"text-green-600 mr-2"},null,8,["icon"]),e("span",It,d(t),1)]))),128))])):(l(),a("div",Lt,s[45]||(s[45]=[e("p",{class:"text-gray-500"},"No se encontraron permisos para este usuario.",-1)])))]),e("div",{class:"flex justify-end"},[e("button",{onClick:Ne,class:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors"}," Cerrar ")])])])):C("",!0)]),ae.value?(l(),a("div",St,[e("div",Bt,[s[57]||(s[57]=e("h3",{class:"text-lg font-semibold mb-4 text-gray-800"},"Crear Nuevo Usuario Interno",-1)),e("form",{onSubmit:Oe(Se,["prevent"]),class:"space-y-4"},[e("div",null,[s[47]||(s[47]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Nombre Completo",-1)),P(e("input",{"onUpdate:modelValue":s[11]||(s[11]=t=>n.value.name=t),type:"text",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent",placeholder:"Ingrese el nombre completo"},null,512),[[D,n.value.name]])]),e("div",null,[s[48]||(s[48]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Email",-1)),P(e("input",{"onUpdate:modelValue":s[12]||(s[12]=t=>n.value.email=t),type:"email",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent",placeholder:"usuario@ejemplo.com"},null,512),[[D,n.value.email]])]),e("div",null,[s[49]||(s[49]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Contraseña",-1)),P(e("input",{"onUpdate:modelValue":s[13]||(s[13]=t=>n.value.password=t),type:"password",required:"",minlength:"8",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent",placeholder:"Mínimo 8 caracteres"},null,512),[[D,n.value.password]])]),e("div",null,[s[51]||(s[51]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Rol",-1)),P(e("select",{"onUpdate:modelValue":s[14]||(s[14]=t=>n.value.role=t),required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"},s[50]||(s[50]=[e("option",{value:"empleado"},"Empleado",-1),e("option",{value:"admin"},"Administrador",-1)]),512),[[ie,n.value.role]])]),e("div",qt,[e("div",null,[s[52]||(s[52]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Cargo",-1)),P(e("input",{"onUpdate:modelValue":s[15]||(s[15]=t=>n.value.cargo=t),type:"text",required:"",maxlength:"25",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent",placeholder:"Ej: Ejecutivo de ventas, Administrador, etc."},null,512),[[D,n.value.cargo]])]),e("div",null,[s[53]||(s[53]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Teléfono",-1)),P(e("input",{"onUpdate:modelValue":s[16]||(s[16]=t=>n.value.telefono=t),type:"tel",required:"",maxlength:"8",pattern:"[0-9]{8}",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent",placeholder:"12345678"},null,512),[[D,n.value.telefono]])])]),e("div",Ft,[e("div",Gt,[e("h4",Ht,[c(r(v),{icon:r(we),class:"mr-2 text-green-600"},null,8,["icon"]),s[54]||(s[54]=y(" Asignar Permisos al Usuario "))]),s[55]||(s[55]=e("p",{class:"text-sm text-gray-600"}," Seleccione exactamente qué permisos tendrá este usuario. El rol es solo organizacional. ",-1))]),e("div",Wt,[s[56]||(s[56]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Permisos Disponibles: ",-1)),e("div",Kt,[B.value.length>0?(l(),a("div",Ot,[(l(!0),a(E,null,U(B.value,t=>(l(),a("div",{key:t.id,class:L(["flex items-center p-2 rounded border hover:bg-gray-100 transition-colors",n.value.selectedPermissions.includes(t.name)?"bg-green-50 border-green-200":"bg-white border-gray-200"])},[P(e("input",{id:`permission-${t.id}`,type:"checkbox",value:t.name,"onUpdate:modelValue":s[17]||(s[17]=k=>n.value.selectedPermissions=k),disabled:n.value.selectedPermissions.length===1&&n.value.selectedPermissions.includes(t.name),class:"h-4 w-4 text-green-600 focus:ring-green-500 border-gray-300 rounded"},null,8,Jt),[[Je,n.value.selectedPermissions]]),e("label",{for:`permission-${t.id}`,class:L(["ml-3 text-sm cursor-pointer",n.value.selectedPermissions.includes(t.name)?"text-green-800 font-medium":"text-gray-700"])},d(t.name),11,Qt)],2))),128))])):(l(),a("div",Xt," No hay permisos disponibles "))]),e("div",Yt,[e("div",Zt,[e("span",eo," Permisos seleccionados: "+d(n.value.selectedPermissions.length),1),n.value.selectedPermissions.length===0?(l(),a("span",so," ⚠️ Debe seleccionar al menos un permiso ")):(l(),a("span",to," ✅ Configuración válida "))]),e("div",oo,[e("button",{type:"button",onClick:Te,class:"px-2 py-1 text-xs bg-red-100 text-red-700 rounded hover:bg-red-200 transition-colors",disabled:n.value.selectedPermissions.length===0}," Limpiar ",8,lo),e("button",{type:"button",onClick:Ie,class:"px-2 py-1 text-xs bg-green-100 text-green-700 rounded hover:bg-green-200 transition-colors"}," Seleccionar todos ")])])])]),e("div",ao,[e("button",{type:"button",onClick:fe,class:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors"}," Cancelar "),e("button",{type:"submit",disabled:f.value||n.value.selectedPermissions.length===0,class:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},d(f.value?"Creando...":"Crear Usuario"),9,ro)])],32)])])):C("",!0),ce.value?(l(),a("div",no,[e("div",io,[e("h3",uo,[c(r(v),{icon:r(we),class:"mr-2 text-green-600"},null,8,["icon"]),s[58]||(s[58]=y(" Gestionar Permisos de Usuario "))]),e("div",co,[e("p",mo,[s[59]||(s[59]=y("Usuario: ")),e("strong",null,d((N=m.value)==null?void 0:N.name),1)]),e("p",vo,[s[60]||(s[60]=y("Rol: ")),(l(!0),a(E,null,U((V=m.value)==null?void 0:V.roles,t=>(l(),a("span",{key:t,class:L([Z(t),"px-2 py-1 text-xs font-semibold rounded-full ml-1"])},d(t),3))),128))]),s[61]||(s[61]=e("p",{class:"text-sm text-gray-500"}," Los roles son organizacionales. Los permisos se gestionan manualmente. ",-1))]),e("div",po,[e("div",null,[e("h4",go,[c(r(v),{icon:r(Q),class:"mr-2 text-green-600"},null,8,["icon"]),y(" Permisos Asignados ("+d(i.value.length)+") ",1)]),i.value.length>0?(l(),a("div",xo,[(l(!0),a(E,null,U(i.value,t=>(l(),a("div",{key:t,class:"flex items-center justify-between p-2 bg-green-50 rounded border"},[e("div",fo,[c(r(v),{icon:r(Q),class:"text-green-600 mr-2"},null,8,["icon"]),e("span",bo,d(t),1)]),e("button",{onClick:k=>xe(t),disabled:f.value||i.value.length===1,class:"text-red-600 hover:text-red-800 transition-colors disabled:opacity-50",title:"Remover permiso"},[c(r(v),{icon:r(_e)},null,8,["icon"])],8,yo)]))),128))])):(l(),a("div",ho," No tiene permisos asignados ")),i.value.length===1?(l(),a("div",_o,[c(r(v),{icon:r(ue),class:"mr-1"},null,8,["icon"]),s[62]||(s[62]=y(" No se puede eliminar el último permiso. El usuario debe tener al menos uno. "))])):C("",!0)]),e("div",null,[e("h4",wo,[c(r(v),{icon:r(ee),class:"mr-2 text-blue-600"},null,8,["icon"]),y(" Asignar Nuevos Permisos ("+d(M.value.length)+") ",1)]),M.value.length>0?(l(),a("div",ko,[(l(!0),a(E,null,U(M.value,t=>(l(),a("div",{key:t.id,class:"flex items-center justify-between p-2 bg-gray-50 rounded border hover:bg-gray-100 transition-colors"},[e("span",Co,d(t.name),1),e("button",{onClick:k=>ge(t),disabled:f.value,class:"text-blue-600 hover:text-blue-800 transition-colors disabled:opacity-50",title:"Asignar permiso"},[c(r(v),{icon:r(ee)},null,8,["icon"])],8,Po)]))),128))])):(l(),a("div",Eo," No hay permisos adicionales disponibles "))])]),e("div",Uo,[e("button",{onClick:Ve,class:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",disabled:f.value},d(f.value?"Procesando...":"Cerrar"),9,Mo)])])])):C("",!0),X.value?(l(),a("div",Ao,[e("div",jo,[e("div",$o,[e("div",Ro,[c(r(v),{icon:r(ue),class:"h-6 w-6 text-amber-500 mr-3"},null,8,["icon"]),s[63]||(s[63]=e("h3",{class:"text-lg font-semibold text-gray-900"},"Cambios sin guardar",-1))]),s[64]||(s[64]=e("p",{class:"text-gray-600 mb-6"}," Hay cambios sin guardar. ¿Deseas salir? Se perderán los datos que modificaste. ",-1)),e("div",zo,[e("button",{onClick:s[18]||(s[18]=t=>X.value=!1),class:"px-4 py-2 text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300 transition-colors"}," Seguir Editando "),e("button",{onClick:ne,class:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors"}," Salir sin Guardar ")])])])])):C("",!0)]}),_:1})}}};export{Io as default};
