import{r as m,E as $,w as G,h as H,d as n,x as F,c as v,j as g,e,t as u,y as D,p as y,q as x,$ as r,v as X,a6 as J,A as K,N as Q}from"./vendor-BntMrX60.js";import{z as W,n as T,A as k,p as _,g as Y}from"./ui-BJqxeYA1.js";import{p as Z,g as ee,d as ae,k as le,e as se}from"./index-Dk7fAEKz.js";import{_ as te}from"./_plugin-vue_export-helper-DlAUqK2U.js";const oe={key:0,class:"space-y-6"},re={class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},ie={class:"text-lg font-semibold text-blue-800 mb-2"},de={class:"grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm"},ne={class:"ml-2"},ue={class:"ml-2"},ce={class:"ml-2"},me={class:"space-y-3"},ve={class:"flex flex-col py-2"},pe={class:"text-xs text-gray-500 mt-1"},be={key:0,class:"text-red-500"},fe={key:0,class:"bg-purple-50 border border-purple-200 rounded-lg p-4 space-y-4"},ge={class:"flex items-center gap-2 mb-4"},ye={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},xe={key:0,class:"text-red-500"},he={key:0,class:"text-red-500"},Ee={key:0,class:"text-red-500"},we={class:"text-gray-500"},De={key:1,class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},Re={class:"flex items-start gap-3"},Ae={class:"text-sm text-yellow-700 mt-1"},Oe={key:0},Ce={class:"flex justify-center gap-4 w-full mt-6"},ke=["disabled"],Se=["disabled"],Ve={key:0},Fe={key:1},Me={__name:"CambiarEstado",props:{visible:{type:Boolean,default:!1},tour:{type:Object,default:()=>({})},dialogStyle:{type:Object,default:()=>({})}},emits:["update:visible","estadoActualizado"],setup(i,{emit:U}){const h=i,S=U,b=W(),R=m([{label:"Disponible",value:"DISPONIBLE",descripcion:"El tour está disponible para reservas",color:"text-green-600",disponible:!0},{label:"Agotado",value:"AGOTADO",descripcion:"No hay cupos disponibles",color:"text-red-600",disponible:!0},{label:"En Curso",value:"EN_CURSO",descripcion:"El tour está en desarrollo",color:"text-blue-600",disponible:!0},{label:"Completado",value:"COMPLETADO",descripcion:"El tour ha finalizado exitosamente",color:"text-gray-600",disponible:!0},{label:"Cancelado",value:"CANCELADO",descripcion:"El tour ha sido cancelado",color:"text-red-600",disponible:!0},{label:"Suspendido",value:"SUSPENDIDO",descripcion:"El tour está temporalmente suspendido",color:"text-orange-600",disponible:!0},{label:"Reprogramado",value:"REPROGRAMADO",descripcion:"El tour ha sido reprogramado a una nueva fecha",color:"text-purple-600",disponible:!0}]),t=m(null),V=m(!1),d=m(null),p=m(null),f=m(""),A=m(""),E=m(!1),c=m(!1),M=$({get:()=>h.visible,set:s=>S("update:visible",s)});G([()=>h.visible,()=>h.tour],()=>{h.visible&&h.tour&&N()}),G(t,s=>{V.value=s==="REPROGRAMADO",s!=="REPROGRAMADO"&&(d.value=null,p.value=null,f.value="",A.value="")});const j=m(["Condiciones climáticas adversas","Problemas de transporte","Falta de cupo mínimo","Solicitud de clientes","Mantenimiento de instalaciones","Emergencia sanitaria","Otro motivo"]),N=()=>{var s;t.value=((s=h.tour)==null?void 0:s.estado)||null,V.value=!1,d.value=null,p.value=null,f.value="",A.value="",c.value=!1},L=()=>{N(),S("update:visible",!1)},I=()=>{if(!t.value)return b.add({severity:"warn",summary:"Campos requeridos",detail:"Debes seleccionar un estado.",life:4e3}),!1;if(t.value==="REPROGRAMADO"){if(!d.value)return b.add({severity:"warn",summary:"Campos requeridos",detail:"Debes seleccionar una nueva fecha de salida.",life:4e3}),!1;if(!p.value)return b.add({severity:"warn",summary:"Campos requeridos",detail:"Debes seleccionar una nueva fecha de regreso.",life:4e3}),!1;if(!f.value.trim())return b.add({severity:"warn",summary:"Campos requeridos",detail:"Debes especificar el motivo de la reprogramación.",life:4e3}),!1;const s=new Date;if(d.value<s)return b.add({severity:"warn",summary:"Fecha inválida",detail:"La nueva fecha de salida debe ser futura.",life:4e3}),!1;if(p.value<=d.value)return b.add({severity:"warn",summary:"Fecha inválida",detail:"La fecha de regreso debe ser posterior a la fecha de salida.",life:4e3}),!1}return!0},q=async()=>{var s,a,w,O,C;if(c.value=!0,!!I()){E.value=!0;try{const o={estado:t.value};t.value==="REPROGRAMADO"&&(o.fecha_salida=d.value,o.fecha_regreso=p.value,o.motivo_reprogramacion=f.value,o.observaciones=A.value);const l=await Q.put(`/api/tours/${h.tour.id}/cambiar-estado`,o);b.add({severity:"success",summary:"¡Estado actualizado!",detail:t.value==="REPROGRAMADO"?"El tour ha sido reprogramado correctamente.":`El estado del tour ha sido cambiado a ${(s=R.value.find(z=>z.value===t.value))==null?void 0:s.label}.`,life:4e3}),S("estadoActualizado",l.data.tour),L()}catch(o){console.error("Error al cambiar estado:",o);let l="No se pudo cambiar el estado del tour.";(w=(a=o.response)==null?void 0:a.data)!=null&&w.message?l=o.response.data.message:(C=(O=o.response)==null?void 0:O.data)!=null&&C.errors&&(l=Object.values(o.response.data.errors).flat().join(", ")),b.add({severity:"error",summary:"Error",detail:l,life:4e3})}finally{E.value=!1}}},P=()=>{const s=new Date;return s.setHours(s.getHours()+1),s},B=()=>{if(!d.value)return P();const s=new Date(d.value);return s.setHours(s.getHours()+1),s};return(s,a)=>(n(),H(r(Y),{visible:M.value,"onUpdate:visible":a[5]||(a[5]=w=>M.value=w),header:"Cambiar Estado del Tour",modal:!0,style:K(i.dialogStyle),closable:!1,draggable:!1},{footer:F(()=>[e("div",Ce,[e("button",{type:"button",class:"bg-blue-500 hover:bg-blue-700 text-white px-9 sm:px-12 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",onClick:L,disabled:E.value},[y(r(k),{icon:r(ae),class:"h-5 text-white"},null,8,["icon"]),a[20]||(a[20]=x(" Cancelar "))],8,ke),e("button",{class:"bg-red-500 hover:bg-red-700 text-white border-none px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",onClick:q,disabled:E.value||!t.value},[y(r(k),{icon:E.value?r(le):r(se),class:D(["h-5 text-white",{"animate-spin":E.value}])},null,8,["icon","class"]),E.value?(n(),v("span",Fe,u(t.value==="REPROGRAMADO"?"Reprogramando...":"Actualizando..."),1)):(n(),v("span",Ve,"Cambiar Estado"))],8,Se)])]),default:F(()=>{var w,O,C,o;return[i.tour?(n(),v("div",oe,[e("div",re,[e("h4",ie,u(i.tour.nombre),1),e("div",de,[e("div",null,[a[6]||(a[6]=e("span",{class:"font-medium text-gray-700"},"Estado actual:",-1)),e("span",{class:D([((w=R.value.find(l=>l.value===i.tour.estado))==null?void 0:w.color)||"text-gray-600","ml-2 font-semibold"])},u(((O=R.value.find(l=>l.value===i.tour.estado))==null?void 0:O.label)||i.tour.estado),3)]),e("div",null,[a[7]||(a[7]=e("span",{class:"font-medium text-gray-700"},"Categoría:",-1)),e("span",ne,u(i.tour.categoria),1)]),e("div",null,[a[8]||(a[8]=e("span",{class:"font-medium text-gray-700"},"Fecha de salida:",-1)),e("span",ue,u(new Date(i.tour.fecha_salida).toLocaleDateString("es-ES")),1)]),e("div",null,[a[9]||(a[9]=e("span",{class:"font-medium text-gray-700"},"Fecha de regreso:",-1)),e("span",ce,u(new Date(i.tour.fecha_regreso).toLocaleDateString("es-ES")),1)])])]),e("div",me,[a[10]||(a[10]=e("label",{class:"block text-sm font-semibold text-gray-700"},[x(" Nuevo Estado "),e("span",{class:"text-red-500"},"*")],-1)),y(r(T),{modelValue:t.value,"onUpdate:modelValue":a[0]||(a[0]=l=>t.value=l),options:R.value,optionLabel:"label",optionValue:"value",placeholder:"Selecciona un estado",class:D(["w-full",{"p-invalid":c.value&&!t.value}])},{option:F(l=>[e("div",ve,[e("span",{class:D([l.option.color,"font-medium"])},u(l.option.label),3),e("span",pe,u(l.option.descripcion),1)])]),_:1},8,["modelValue","options","class"]),c.value&&!t.value?(n(),v("small",be," El estado es obligatorio. ")):g("",!0)]),V.value?(n(),v("div",fe,[e("div",ge,[y(r(k),{icon:r(Z),class:"text-purple-600"},null,8,["icon"]),a[11]||(a[11]=e("h5",{class:"text-lg font-semibold text-purple-800"},"Datos de Reprogramación",-1))]),e("div",ye,[e("div",null,[a[12]||(a[12]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[x(" Nueva Fecha de Salida "),e("span",{class:"text-red-500"},"*")],-1)),y(r(_),{modelValue:d.value,"onUpdate:modelValue":a[1]||(a[1]=l=>d.value=l),showTime:"",showIcon:"",dateFormat:"dd/mm/yy",minDate:P(),placeholder:"Selecciona fecha y hora",class:D(["w-full",{"p-invalid":c.value&&!d.value}])},null,8,["modelValue","minDate","class"]),c.value&&!d.value?(n(),v("small",xe," La nueva fecha de salida es obligatoria. ")):g("",!0)]),e("div",null,[a[13]||(a[13]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[x(" Nueva Fecha de Regreso "),e("span",{class:"text-red-500"},"*")],-1)),y(r(_),{modelValue:p.value,"onUpdate:modelValue":a[2]||(a[2]=l=>p.value=l),showTime:"",showIcon:"",dateFormat:"dd/mm/yy",minDate:B(),placeholder:"Selecciona fecha y hora",class:D(["w-full",{"p-invalid":c.value&&!p.value}])},null,8,["modelValue","minDate","class"]),c.value&&!p.value?(n(),v("small",he," La nueva fecha de regreso es obligatoria. ")):g("",!0)])]),e("div",null,[a[14]||(a[14]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[x(" Motivo de la Reprogramación "),e("span",{class:"text-red-500"},"*")],-1)),y(r(T),{modelValue:f.value,"onUpdate:modelValue":a[3]||(a[3]=l=>f.value=l),options:j.value,placeholder:"Selecciona o escribe un motivo",editable:"",class:D(["w-full",{"p-invalid":c.value&&!f.value.trim()}])},null,8,["modelValue","options","class"]),c.value&&!f.value.trim()?(n(),v("small",Ee," El motivo es obligatorio. ")):g("",!0)]),e("div",null,[a[15]||(a[15]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Observaciones Adicionales ",-1)),X(e("textarea",{"onUpdate:modelValue":a[4]||(a[4]=l=>A.value=l),rows:"3",placeholder:"Agrega cualquier observación adicional...",class:"w-full p-2 border border-gray-300 rounded-md text-sm focus:ring-purple-500 focus:border-purple-500",maxlength:"500"},null,512),[[J,A.value]]),e("small",we,u(A.value.length)+"/500 caracteres ",1)])])):g("",!0),t.value&&t.value!==i.tour.estado?(n(),v("div",De,[e("div",Re,[y(r(k),{icon:r(ee),class:"text-yellow-600 mt-1"},null,8,["icon"]),e("div",null,[a[19]||(a[19]=e("h5",{class:"font-medium text-yellow-800"},"Confirmación de cambio",-1)),e("p",Ae,[a[16]||(a[16]=x(" Estás a punto de cambiar el estado del tour de ")),e("strong",null,u((C=R.value.find(l=>l.value===i.tour.estado))==null?void 0:C.label),1),a[17]||(a[17]=x(" a ")),e("strong",null,u((o=R.value.find(l=>l.value===t.value))==null?void 0:o.label),1),a[18]||(a[18]=x(". ")),t.value==="REPROGRAMADO"?(n(),v("span",Oe," Esto actualizará las fechas del tour y notificará a los clientes con reservas. ")):g("",!0)])])])])):g("",!0)])):g("",!0)]}),_:1},8,["visible","style"]))}},Ge=te(Me,[["__scopeId","data-v-3ac14a94"]]);export{Ge as default};
