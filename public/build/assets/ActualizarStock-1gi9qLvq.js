import{r as b,E,w as M,k as X,h as N,d as v,x as T,e as t,c as f,j as S,t as i,q as j,F as G,l as H,y as h,v as J,aa as Q,p as m,$ as l,A as Y,N as Z}from"./vendor-gbh1WW5n.js";import{z as ee,F as x,g as te}from"./ui-BrU4k96Z.js";import{B as ae,k as se,f as oe,C as U,c as le,a as re,o as ne}from"./index-CZ1H-pGg.js";import{_ as ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";const de={class:"space-y-6"},ue={class:"bg-gray-50 p-4 rounded-lg"},ce={class:"font-semibold text-gray-800 mb-2"},ve={class:"grid grid-cols-2 gap-4 text-sm"},me={class:"font-semibold ml-2"},pe={class:"font-semibold ml-2"},be={class:"space-y-3"},fe={class:"grid grid-cols-1 gap-2"},ge=["value"],ye={class:"flex-1"},xe={class:"font-medium"},ke={class:"text-xs opacity-75"},_e={class:"space-y-2"},he={class:"block text-sm font-semibold text-gray-700"},we={class:"flex items-center gap-2"},Ce=["disabled"],Se=["disabled"],je={key:0,class:"text-red-500"},Ve={key:0,class:"bg-blue-50 border border-blue-200 p-4 rounded-lg"},Ae={class:"flex items-center gap-2 mb-2"},Ee={class:"text-sm space-y-1"},Ie={class:"flex justify-between"},ze={class:"font-medium"},De={class:"flex justify-between"},Me={class:"flex justify-between items-center"},Ne={class:"flex items-center gap-2"},Te={key:0,class:"text-xs text-red-600 mt-2 flex items-center gap-1"},Ue={class:"space-y-2"},Be={key:0,class:"text-red-500"},Fe={class:"space-y-2 border-t pt-4"},Pe={class:"text-gray-500 text-xs"},Ke={class:"flex justify-center gap-4 w-full mt-6"},Re=["disabled"],$e={key:0},qe={key:1},Le=["disabled"],Oe={__name:"ActualizarStock",props:{visible:{type:Boolean,default:!1},producto:{type:Object,default:()=>({})},dialogStyle:{type:Object,default:()=>({})}},emits:["update:visible","stockUpdated"],setup(p,{emit:B}){const w=ee(),d=p,V=B,g=b(!1),r=b("entrada"),s=b(null),c=b(""),y=b(!1),F=b(null),k=b(null),I=E({get:()=>d.visible,set:a=>V("update:visible",a)}),C=E(()=>{var n;if(!d.producto||s.value===null||s.value==="")return parseInt(((n=d.producto)==null?void 0:n.stock_actual)||0);const a=parseInt(d.producto.stock_actual||0),e=parseInt(s.value||0);switch(r.value){case"entrada":return a+e;case"salida":return Math.max(0,a-e);case"ajuste":return e;default:return a}}),A=E(()=>{var e;const a=((e=d.producto)==null?void 0:e.stock_minimo)||1;return C.value<=a}),P=b([{label:"Entrada de stock",value:"entrada",descripcion:"Aumentar el inventario"},{label:"Salida de stock",value:"salida",descripcion:"Reducir el inventario"},{label:"Ajuste de inventario",value:"ajuste",descripcion:"Establecer cantidad exacta"}]);M(()=>d.visible,a=>{a&&K()}),M(r,()=>{s.value=null,c.value="",y.value=!1});const K=()=>{var a,e;r.value="entrada",s.value=null,c.value="",y.value=!1,F.value=((a=d.producto)==null?void 0:a.stock_actual)||null,k.value=((e=d.producto)==null?void 0:e.stock_minimo)||null},z=a=>{const e=a.target.value,n=a.key;if([8,9,27,13,46,35,36,37,38,39,40].includes(a.keyCode)||a.ctrlKey&&[65,67,86,88].includes(a.keyCode))return;if(!/[0-9]/.test(n)){a.preventDefault();return}const o=e+n,u=parseInt(o);if(o.length>4||u>9999){a.preventDefault();return}},D=a=>{a.preventDefault();const n=(a.clipboardData||window.clipboardData).getData("text").replace(/[^0-9]/g,"");if(n){let o=parseInt(n);o>9999&&(o=9999),a.target.value=o.toString(),a.target.dispatchEvent(new Event("input",{bubbles:!0}))}},R=()=>{const a=s.value||0;a<9999&&(s.value=a+1)},$=()=>{const a=s.value||0;a>0&&(s.value=a-1)},q=async()=>{var a,e,n,o;if(y.value=!0,!s.value||s.value<=0||s.value>9999){w.add({severity:"warn",summary:"Campo requerido",detail:"Debes ingresar una cantidad válida entre 1 y 9999.",life:4e3});return}if(!c.value.trim()||c.value.trim().length<3||c.value.trim().length>100){w.add({severity:"warn",summary:"Campo requerido",detail:"El motivo debe tener entre 3 y 100 caracteres.",life:4e3});return}if(C.value<0||C.value>9999){w.add({severity:"warn",summary:"Stock inválido",detail:"El stock resultante debe estar entre 0 y 9999.",life:4e3});return}if(r.value==="salida"&&s.value>d.producto.stock_actual){w.add({severity:"warn",summary:"Stock insuficiente",detail:`No puedes retirar ${s.value} unidades. Stock disponible: ${d.producto.stock_actual}`,life:4e3});return}g.value=!0;try{const u={tipo_movimiento:r.value,cantidad:parseInt(s.value),motivo:c.value.trim(),stock_resultante:parseInt(C.value)};k.value!==null&&k.value!==d.producto.stock_minimo&&(u.nuevo_stock_minimo=parseInt(k.value));const _=await Z.patch(`/api/productos/${d.producto.id}/actualizar-stock`,u,{headers:{"Content-Type":"application/json",Accept:"application/json"}});V("stockUpdated",_.data),V("update:visible",!1)}catch(u){let _="Error al actualizar el stock";if(((a=u.response)==null?void 0:a.status)===422){const W=u.response.data.errors||{};_=((e=Object.values(W)[0])==null?void 0:e[0])||u.response.data.message||"Error de validación"}else _=((o=(n=u.response)==null?void 0:n.data)==null?void 0:o.message)||_;w.add({severity:"error",summary:"Error",detail:_,life:6e3})}finally{g.value=!1}},L=()=>{V("update:visible",!1)},O=a=>{switch(a){case"entrada":return"text-green-600 bg-green-50 border-green-200";case"salida":return"text-red-600 bg-red-50 border-red-200";case"ajuste":return"text-blue-600 bg-blue-50 border-blue-200";default:return"text-gray-600 bg-gray-50 border-gray-200"}};return(a,e)=>{const n=X("InputText");return v(),N(l(te),{visible:I.value,"onUpdate:visible":e[4]||(e[4]=o=>I.value=o),header:"Actualizar Stock",modal:!0,style:Y(p.dialogStyle),closable:!1,draggable:!1},{footer:T(()=>[t("div",Ke,[t("button",{class:"bg-red-500 hover:bg-red-700 text-white border-none px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",onClick:q,disabled:g.value},[m(l(x),{icon:g.value?l(le):l(re),class:h(["h-5 text-white",{"animate-spin":g.value}])},null,8,["icon","class"]),g.value?(v(),f("span",qe,"Actualizando...")):(v(),f("span",$e,"Actualizar Stock"))],8,Re),t("button",{type:"button",class:"bg-blue-500 hover:bg-blue-700 text-white px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",onClick:L,disabled:g.value},[m(l(x),{icon:l(ne),class:"h-5"},null,8,["icon"]),e[16]||(e[16]=j(" Cancelar "))],8,Le)])]),default:T(()=>[t("div",de,[t("div",ue,[t("h4",ce,i(p.producto.nombre),1),t("div",ve,[t("div",null,[e[5]||(e[5]=t("span",{class:"text-gray-600"},"Stock actual:",-1)),t("span",me,i(p.producto.stock_actual||0)+" unidades",1)]),t("div",null,[e[6]||(e[6]=t("span",{class:"text-gray-600"},"Stock mínimo:",-1)),t("span",pe,i(p.producto.stock_minimo||1)+" unidades",1)])])]),t("div",be,[e[7]||(e[7]=t("label",{class:"block text-sm font-semibold text-gray-700"},[j(" Tipo de movimiento: "),t("span",{class:"text-red-500"},"*")],-1)),t("div",fe,[(v(!0),f(G,null,H(P.value,o=>(v(),f("label",{key:o.value,class:h(["flex items-center p-3 border rounded-lg cursor-pointer transition-all hover:bg-gray-50",r.value===o.value?O(o.value):"border-gray-200"])},[J(t("input",{type:"radio","onUpdate:modelValue":e[0]||(e[0]=u=>r.value=u),value:o.value,class:"mr-3"},null,8,ge),[[Q,r.value]]),t("div",ye,[t("div",xe,i(o.label),1),t("div",ke,i(o.descripcion),1)])],2))),128))])]),t("div",_e,[t("label",he,[j(i(r.value==="ajuste"?"Nuevo stock:":"Cantidad:")+" ",1),e[8]||(e[8]=t("span",{class:"text-red-500"},"*",-1))]),t("div",we,[t("button",{type:"button",onClick:$,disabled:!s.value||s.value<=0,class:"bg-gray-500 hover:bg-gray-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-white p-2 rounded-lg transition-all"},[m(l(x),{icon:l(ae),class:"h-4 w-4"},null,8,["icon"])],8,Ce),m(n,{modelValue:s.value,"onUpdate:modelValue":e[1]||(e[1]=o=>s.value=o),type:"number",min:"0",max:"9999",class:h(["flex-1 text-center border-2 border-gray-400 hover:border-gray-500 focus:border-gray-500 focus:ring-0 focus:shadow-none rounded-md",{"p-invalid":y.value&&(!s.value||s.value<=0)}]),placeholder:"0",onKeydown:z,onPaste:D},null,8,["modelValue","class"]),t("button",{type:"button",onClick:R,disabled:s.value>=9999,class:"bg-gray-500 hover:bg-gray-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-white p-2 rounded-lg transition-all"},[m(l(x),{icon:l(se),class:"h-4 w-4"},null,8,["icon"])],8,Se)]),y.value&&(!s.value||s.value<=0)?(v(),f("small",je," La cantidad es obligatoria y debe ser mayor a 0. ")):S("",!0)]),s.value&&s.value>0?(v(),f("div",Ve,[t("div",Ae,[m(l(x),{icon:l(oe),class:"h-4 w-4 text-blue-600"},null,8,["icon"]),e[9]||(e[9]=t("span",{class:"font-semibold text-blue-800"},"Resultado del movimiento:",-1))]),t("div",Ee,[t("div",Ie,[e[10]||(e[10]=t("span",null,"Stock actual:",-1)),t("span",ze,i(p.producto.stock_actual||0)+" unidades",1)]),t("div",De,[t("span",null,i(r.value==="entrada"?"Cantidad a agregar:":r.value==="salida"?"Cantidad a retirar:":"Nuevo stock:"),1),t("span",{class:h(["font-medium",r.value==="entrada"?"text-green-600":r.value==="salida"?"text-red-600":"text-blue-600"])},i(r.value==="ajuste"?"":r.value==="entrada"?"+":"-")+i(s.value)+" unidades ",3)]),e[12]||(e[12]=t("hr",{class:"border-blue-200"},null,-1)),t("div",Me,[e[11]||(e[11]=t("span",{class:"font-semibold"},"Stock resultante:",-1)),t("div",Ne,[t("span",{class:h(["font-semibold text-lg",A.value?"text-red-600":"text-green-600"])},i(C.value)+" unidades ",3),A.value?(v(),N(l(x),{key:0,icon:l(U),class:"h-4 w-4 text-red-500",title:"Stock por debajo del mínimo"},null,8,["icon"])):S("",!0)])]),A.value?(v(),f("div",Te,[m(l(x),{icon:l(U),class:"h-3 w-3"},null,8,["icon"]),j(" El stock resultante está por debajo del mínimo recomendado ("+i(p.producto.stock_minimo||1)+" unidades) ",1)])):S("",!0)])])):S("",!0),t("div",Ue,[e[13]||(e[13]=t("label",{class:"block text-sm font-semibold text-gray-700"},[j(" Motivo del movimiento: "),t("span",{class:"text-red-500"},"*")],-1)),m(n,{modelValue:c.value,"onUpdate:modelValue":e[2]||(e[2]=o=>c.value=o),type:"text",maxlength:"100",class:h(["w-full border-2 border-gray-400 hover:border-gray-500 focus:border-gray-500 focus:ring-0 focus:shadow-none rounded-md",{"p-invalid":y.value&&!c.value.trim()}]),placeholder:"Ejemplo: Compra de mercancía, Producto dañado, Inventario físico, etc."},null,8,["modelValue","class"]),e[14]||(e[14]=t("small",{class:"text-gray-500 text-xs"}," Describe brevemente la razón de este movimiento de stock (máximo 100 caracteres) ",-1)),y.value&&!c.value.trim()?(v(),f("small",Be," El motivo es obligatorio. ")):S("",!0)]),t("div",Fe,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-600"}," Ajustar stock mínimo (opcional): ",-1)),m(n,{modelValue:k.value,"onUpdate:modelValue":e[3]||(e[3]=o=>k.value=o),type:"number",min:"1",max:"100",class:"w-full border-2 border-gray-300 hover:border-gray-400 focus:border-gray-400 focus:ring-0 focus:shadow-none rounded-md",placeholder:"Nuevo stock mínimo",onKeydown:z,onPaste:D},null,8,["modelValue"]),t("small",Pe," Actual: "+i(p.producto.stock_minimo||1)+" unidades ",1)])])]),_:1},8,["visible","style"])}}},Qe=ie(Oe,[["__scopeId","data-v-6537e328"]]);export{Qe as default};
