import{p as ue,r,U as ce,s as ve,B as y,E as I,f as c,o as v,a as s,u as x,g as pe,w as d,b as t,z as me,e as g,t as h,h as w,n as k,j as G,C as O,a0 as S,a1 as fe,F as R,y as ge,L as be}from"./app-DP8tsAem.js";import{_ as ye}from"./AuthenticatedLayout-BvfF3yw2.js";import"./logo-DN1bLr27.js";import"./index-ClJ1gEnJ.js";const xe={class:"py-6 px-7 mt-10 mx-auto bg-red-100 shadow-md rounded-lg"},he={class:"flex justify-between items-center mb-4"},we={class:"flex gap-2"},_e={class:"space-y-4"},Ce={class:"w-full flex flex-col"},ke={class:"flex items-center gap-4"},Ve={key:0,class:"text-red-500 ml-28"},De={class:"w-full flex flex-col"},Ie={class:"flex items-center gap-4"},Ne={key:0,class:"text-red-500 ml-28"},Ee={class:"w-full flex flex-col"},Ue={class:"flex items-center gap-4"},He={key:0,class:"text-red-500 ml-28"},$e={class:"w-full flex flex-col"},Te={class:"flex items-center gap-4"},Ae={key:0,class:"text-red-500 ml-28"},Fe={class:"w-full flex flex-col"},Le={class:"flex items-center gap-4"},Se={key:0,class:"text-red-500 ml-28"},Be={class:"w-full flex flex-col"},je={class:"flex items-center gap-4"},Me={key:0,class:"text-red-500 ml-28"},Pe={class:"w-full flex flex-col"},ze={class:"flex items-center gap-4"},Ge={key:0,class:"text-red-500 ml-28"},Oe={class:"flex gap-4 flex-wrap mt-4 ml-28"},Re=["src"],We=["onClick"],Ke={class:"flex justify-center gap-4 w-full"},Ze={key:0,class:"flex flex-col items-center justify-center"},qe={class:"flex justify-center items-center w-full h-96"},Je=["src"],Qe={key:1,class:"text-center text-gray-500 py-8"},H="/api/hoteles",W="/images/hoteles/",oa={__name:"Hoteles",setup(Xe){const m=ue(),B=r([]),o=r({id:null,nombre:"",direccion:"",descripcion:"",estado:"",provincia:null,categoria:null,imagenes:[]}),p=r([]),b=r([]),_=r([]),j=r(),C=r(!1),V=r(!1),n=r(!1),$=r({global:{value:null,matchMode:ce.CONTAINS}}),N=r("Guardar"),K=r([]),M=r([]),T=r([]),P=r([{label:"Activo",value:"activo"},{label:"Inactivo",value:"inactivo"}]),E=r(!1),D=r([]);ve(()=>{A(),Z(),q(),J()});const A=async()=>{try{const a=await y.get(H);B.value=a.data.map(e=>({...e,imagenes:(e.imagenes||[]).map(i=>typeof i=="string"?i:i.nombre)}))}catch{m.add({severity:"error",summary:"Error",detail:"No se pudieron cargar los hoteles",life:4e3})}},Z=async()=>{try{const a=await y.get("/api/paises");K.value=a.data}catch{m.add({severity:"error",summary:"Error",detail:"No se pudieron cargar los países",life:4e3})}},q=async()=>{try{const a=await y.get("/api/provincias");M.value=a.data}catch{m.add({severity:"error",summary:"Error",detail:"No se pudieron cargar las provincias",life:4e3})}},J=async()=>{try{const a=await y.get("/api/categorias-hoteles");T.value=a.data,console.log("categoriasHoteles cargadas:",T.value)}catch{m.add({severity:"error",summary:"Error",detail:"No se pudieron cargar las categorías",life:4e3})}},Q=()=>{o.value={id:null,nombre:"",direccion:"",descripcion:"",estado:"",provincia:null,categoria:null,imagenes:[]},p.value=[],b.value=[],_.value=[],n.value=!1,N.value="Guardar",C.value=!0},X=a=>{o.value={...a},o.value.categoria=a.categoria_hotel?a.categoria_hotel.id:null,o.value.provincia=a.provincia?a.provincia.id:null,p.value=Array.isArray(a.imagenes)?a.imagenes.map(e=>typeof e=="string"?e:e.nombre):[],b.value=[],_.value=[],N.value="Actualizar",C.value=!0},Y=async()=>{if(n.value=!0,!(!o.value.nombre||!o.value.direccion||!o.value.descripcion||!o.value.estado||!o.value.provincia||!o.value.categoria)){if(p.value.length===0){m.add({severity:"error",summary:"Error",detail:"Debes subir al menos una imagen.",life:4e3});return}try{const a=new FormData;a.append("nombre",o.value.nombre),a.append("direccion",o.value.direccion),a.append("descripcion",o.value.descripcion),a.append("estado",o.value.estado),a.append("provincia_id",o.value.provincia),a.append("categoria_id",o.value.categoria),b.value.forEach(i=>{i instanceof File&&a.append("imagenes[]",i)}),_.value.forEach(i=>{a.append("removed_images[]",i.split("/").pop())});let e;o.value.id?(a.append("_method","PUT"),e=await y.post(`${H}/${o.value.id}`,a,{headers:{"Content-Type":"multipart/form-data"}}),m.add({severity:"info",summary:"Hotel actualizado",life:3e3})):(e=await y.post(H,a,{headers:{"Content-Type":"multipart/form-data"}}),m.add({severity:"success",summary:"Hotel agregado",life:3e3})),await A(),C.value=!1,o.value={id:null,nombre:"",direccion:"",descripcion:"",estado:"",provincia:null,categoria:null,imagenes:[]},p.value=[],b.value=[],_.value=[],n.value=!1}catch{m.add({severity:"error",summary:"Error",detail:"No se pudo guardar el hotel.",life:4e3})}console.log("Hotel enviado:",o.value)}},ee=a=>{o.value={...a},V.value=!0},ae=async()=>{try{await y.delete(`${H}/${o.value.id}`),A(),V.value=!1,m.add({severity:"warn",summary:"Hotel eliminado",life:3e3})}catch{m.add({severity:"error",summary:"Error",detail:"No se pudo eliminar el hotel.",life:4e3})}},le=()=>{C.value=!1,p.value=[],b.value=[],_.value=[],n.value=!1},oe=a=>{for(const e of a.files)if(e instanceof File){b.value.push(e);const i=new FileReader;i.onload=U=>{p.value.push(U.target.result)},i.readAsDataURL(e)}},te=a=>{const e=p.value[a];typeof e=="string"&&e.startsWith("data:image")?(p.value.splice(a,1),b.value.splice(a,1)):(_.value.push(e),p.value.splice(a,1))};function se(a){const e=P.value.find(i=>i.value===a);return e?e.label:""}function z(a){return a.replace(/^\s+/,"").replace(/[^A-Za-zÁÉÍÓÚáéíóúÑñÜü\s]/g,"")}function ie(a,e){typeof e=="string"&&(o.value[a]=z(e))}function ne(a,e){e&&e.value&&(e.value=z(e.value))}const re=a=>{D.value=(a||[]).map(e=>W+(typeof e=="string"?e:e.nombre)),E.value=!0};return(a,e)=>{const i=I("Button"),U=I("InputText"),f=I("Column"),de=I("DataTable"),F=I("Dialog");return v(),c(R,null,[s(x(pe),{title:"Hoteles"}),s(ye,null,{default:d(()=>[s(x(me)),t("div",xe,[t("div",he,[e[16]||(e[16]=t("h3",{class:"text-xl font-bold"},"Catálogo hoteles",-1)),s(i,{label:"Agregar hotel",icon:"pi pi-plus",class:"p-button-sm p-button-danger",onClick:Q})]),s(de,{value:B.value,selection:j.value,"onUpdate:selection":e[1]||(e[1]=l=>j.value=l),dataKey:"id",filters:$.value,paginator:!0,rows:10,class:"overflow-x-auto max-w-full",style:{display:"block","max-width":"84vw"}},{header:d(()=>[s(U,{modelValue:$.value.global.value,"onUpdate:modelValue":e[0]||(e[0]=l=>$.value.global.value=l),placeholder:"Buscar...",class:"w-full"},null,8,["modelValue"])]),default:d(()=>[s(f,{field:"nombre",header:"Nombre",sortable:""}),s(f,{field:"direccion",header:"Dirección"},{body:d(l=>[g(h(l.data.direccion),1)]),_:1}),s(f,{field:"descripcion",header:"Descripción"},{body:d(l=>[g(h(l.data.descripcion||""),1)]),_:1}),s(f,{field:"estado",header:"Estado"},{body:d(l=>[g(h(se(l.data.estado)),1)]),_:1}),s(f,{header:"Categoría"},{body:d(l=>{var u;return[g(h(((u=l.data.categoria_hotel)==null?void 0:u.nombre)||""),1)]}),_:1}),s(f,{field:"pais",header:"País"},{body:d(l=>{var u,L;return[g(h(((L=(u=l.data.provincia)==null?void 0:u.pais)==null?void 0:L.nombre)||""),1)]}),_:1}),s(f,{header:"Provincia"},{body:d(l=>{var u;return[g(h(((u=l.data.provincia)==null?void 0:u.nombre)||""),1)]}),_:1}),s(f,{header:"Acciones",exportable:!1},{body:d(l=>[t("div",we,[s(i,{icon:"pi pi-eye",class:"p-button-rounded p-button-info p-button-md",onClick:u=>re(l.data.imagenes)},null,8,["onClick"]),s(i,{icon:"pi pi-pencil",class:"p-button-rounded p-button-warn p-button-md",onClick:u=>X(l.data)},null,8,["onClick"]),s(i,{icon:"pi pi-trash",class:"p-button-rounded p-button-danger p-button-md",onClick:u=>ee(l.data)},null,8,["onClick"])])]),_:1})]),_:1},8,["value","selection","filters"]),s(F,{visible:C.value,"onUpdate:visible":e[10]||(e[10]=l=>C.value=l),header:N.value+" Hotel",modal:!0,style:{width:"500px"}},{footer:d(()=>[t("div",Ke,[s(i,{label:"Cancelar",icon:"pi pi-times",class:"p-button-rounded p-button-danger p-button-md mr-2",text:"",onClick:le}),s(i,{label:N.value,icon:"pi pi-check",class:"p-button-rounded p-button-warn p-button-md mr-2",onClick:Y},null,8,["label"])])]),default:d(()=>[t("div",_e,[t("div",Ce,[t("div",ke,[e[17]||(e[17]=t("label",{for:"nombre",class:"w-24"},"Nombre:",-1)),s(U,{modelValue:o.value.nombre,"onUpdate:modelValue":e[2]||(e[2]=l=>o.value.nombre=l),modelModifiers:{trim:!0},id:"nombre",class:k([{"p-invalid":n.value&&!o.value.nombre},"flex-1"])},null,8,["modelValue","class"])]),n.value&&!o.value.nombre?(v(),c("small",Ve,"El nombre es obligatorio.")):w("",!0)]),t("div",De,[t("div",Ie,[e[18]||(e[18]=t("label",{for:"direccion",class:"w-24"},"Dirección:",-1)),G(t("textarea",{"onUpdate:modelValue":e[3]||(e[3]=l=>o.value.direccion=l),id:"direccion",class:k([{"p-invalid":n.value&&!o.value.direccion},"flex-1"])},null,2),[[O,o.value.direccion,void 0,{trim:!0}]])]),n.value&&!o.value.direccion?(v(),c("small",Ne,"La dirección es obligatoria.")):w("",!0)]),t("div",Ee,[t("div",Ue,[e[19]||(e[19]=t("label",{for:"descripcion",class:"w-24"},"Descripción:",-1)),G(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=l=>o.value.descripcion=l),id:"descripcion",class:k([{"p-invalid":n.value&&!o.value.descripcion},"flex-1"])},null,2),[[O,o.value.descripcion,void 0,{trim:!0}]])]),n.value&&!o.value.descripcion?(v(),c("small",He,"La descripción es obligatoria.")):w("",!0)]),t("div",$e,[t("div",Te,[e[20]||(e[20]=t("label",{for:"estado",class:"w-24"},"Estado:",-1)),s(x(S),{modelValue:o.value.estado,"onUpdate:modelValue":e[5]||(e[5]=l=>o.value.estado=l),options:P.value,"option-label":"label","option-value":"value",id:"estado",class:k(["flex-1",{"p-invalid":n.value&&!o.value.estado}]),placeholder:"Selecciona un estado"},null,8,["modelValue","options","class"])]),n.value&&!o.value.estado?(v(),c("small",Ae,"El estado es obligatorio.")):w("",!0)]),t("div",Fe,[t("div",Le,[e[21]||(e[21]=t("label",{for:"categoria",class:"w-24"},"Categoría:",-1)),s(x(S),{modelValue:o.value.categoria,"onUpdate:modelValue":e[6]||(e[6]=l=>o.value.categoria=l),options:T.value,"option-label":"nombre","option-value":"id",id:"categoria",class:k(["flex-1",{"p-invalid":n.value&&!o.value.categoria}]),placeholder:"Selecciona una categoría"},null,8,["modelValue","options","class"])]),n.value&&!o.value.categoria?(v(),c("small",Se,"La categoría es obligatoria.")):w("",!0)]),t("div",Be,[t("div",je,[e[22]||(e[22]=t("label",{for:"provincia",class:"w-24"},"Provincia:",-1)),s(x(S),{modelValue:o.value.provincia,"onUpdate:modelValue":e[7]||(e[7]=l=>o.value.provincia=l),options:M.value,"option-label":"nombre","option-value":"id",id:"provincia",filter:!0,filterPlaceholder:"Buscar provincia...",showClear:!0,class:k([{"p-invalid":n.value&&!o.value.provincia},"flex-1"]),placeholder:"Selecciona una provincia",onInput:e[8]||(e[8]=l=>ie("provincia",l)),onFilter:e[9]||(e[9]=l=>ne("provincia",l))},null,8,["modelValue","options","class"])]),n.value&&!o.value.provincia?(v(),c("small",Me,"La provincia es obligatoria.")):w("",!0)]),t("div",Pe,[t("div",ze,[e[23]||(e[23]=t("label",{for:"imagen",class:"w-24"},"Imágenes:",-1)),s(x(fe),{mode:"basic",name:"imagenes[]",accept:"image/*",auto:!0,chooseLabel:"Seleccionar imágenes",onSelect:oe,customUpload:!0,multiple:!0,class:"flex-1 p-button-rounded p-button-warn p-button-md mr-2"})]),n.value&&p.value.length===0?(v(),c("small",Ge,"Al menos una imagen es obligatoria.")):w("",!0)]),t("div",Oe,[(v(!0),c(R,null,ge(p.value,(l,u)=>(v(),c("div",{key:u,class:"relative w-32 h-32"},[t("img",{src:l.startsWith("data:image")?l:W+l,alt:"Vista previa",class:"w-full h-full object-cover rounded border"},null,8,Re),t("button",{onClick:L=>te(u),class:"absolute top-0 right-0 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 shadow",style:{transform:"translate(50%, -50%)"}},e[24]||(e[24]=[t("i",{class:"pi pi-times text-xs"},null,-1)]),8,We)]))),128))])])]),_:1},8,["visible","header"]),s(F,{visible:V.value,"onUpdate:visible":e[12]||(e[12]=l=>V.value=l),header:"Confirmar",modal:!0,style:{width:"350px"}},{footer:d(()=>[s(i,{label:"No",icon:"pi pi-times",text:"",onClick:e[11]||(e[11]=l=>V.value=!1),class:"p-button-rounded p-button-warn p-button-md mr-2"}),s(i,{label:"Sí",icon:"pi pi-check",severity:"danger",onClick:ae})]),default:d(()=>[t("span",null,[e[25]||(e[25]=g("¿Eliminar el hotel ")),t("b",null,h(o.value.nombre),1),e[26]||(e[26]=g("?"))])]),_:1},8,["visible"]),s(F,{visible:E.value,"onUpdate:visible":e[15]||(e[15]=l=>E.value=l),header:"Imágenes del hotel",modal:!0,style:{width:"700px"}},{footer:d(()=>[s(i,{label:"Cerrar",icon:"pi pi-times",class:"p-button-rounded-md p-button-danger",onClick:e[14]||(e[14]=l=>E.value=!1)})]),default:d(()=>[D.value.length?(v(),c("div",Ze,[s(x(be),{value:D.value,numVisible:1,numScroll:1,circular:!0,page:a.carouselIndex,"onUpdate:page":e[13]||(e[13]=l=>a.carouselIndex=l),class:"w-full",showIndicators:D.value.length>1,showNavigators:D.value.length>1,style:{"max-width":"610px"}},{item:d(l=>[t("div",qe,[t("img",{src:l.data,alt:"Imagen hotel",class:"w-auto h-full max-h-96 object-contain rounded shadow"},null,8,Je)])]),_:1},8,["value","page","showIndicators","showNavigators"])])):(v(),c("div",Qe," No hay imágenes para este hotel. "))]),_:1},8,["visible"])])]),_:1})],64)}}};export{oa as default};
