import{A as O}from"./AuthenticatedLayout-CSuYxj7F.js";import{c as d,d as i,e as t,p as n,x as R,$ as o,a2 as P,f as X,t as h,E as F,r as $,o as U,h as H,a0 as W,y,j as I,F as _,q as S,z as Y}from"./vendor-gbh1WW5n.js";import{F as v,a as J,z as K}from"./ui-BrU4k96Z.js";import{e as Q,U as j,g as Z,b as q,i as ee,aw as te}from"./index-B6nVaz6S.js";import{_ as L}from"./_plugin-vue_export-helper-DlAUqK2U.js";import se from"./DeleteUserForm-Cco1VQq_.js";import oe from"./UpdatePasswordForm-DnR9uYQa.js";import re from"./UpdateProfileInformationForm-C8IW_rEx.js";import"./TextInput-D8O_0gxS.js";import"./PrimaryButton-DDUzFEMx.js";import"./vue-tel-input-nvsKEitw.js";const ae={class:"min-h-screen bg-gray-50 flex flex-col"},le={class:"bg-white shadow-sm border-b border-gray-200 sticky top-0 z-40"},ne={class:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-4"},ie={class:"flex items-center justify-between"},de={class:"flex-grow py-8"},ce={class:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8"},ue={class:"bg-red-600 border-t border-gray-200"},me={class:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-6"},pe={class:"text-center text-white text-sm"},fe={__name:"ClientLayout",setup(k){return(g,l)=>(i(),d("div",ae,[t("header",le,[t("div",ne,[t("div",ie,[n(o(P),{href:g.route("inicio"),class:"flex items-center space-x-2 px-3 py-2 rounded-lg text-gray-600 hover:text-red-600 hover:bg-red-50 transition-all duration-200 group"},{default:R(()=>[n(o(v),{icon:o(Q),class:"w-5 h-5 group-hover:transform group-hover:-translate-x-1 transition-transform duration-200"},null,8,["icon"]),l[0]||(l[0]=t("span",{class:"font-medium"},"Volver al Inicio",-1))]),_:1,__:[0]},8,["href"]),n(o(P),{href:g.route("inicio"),class:"flex items-center",title:"Volver a inicio"},{default:R(()=>l[1]||(l[1]=[t("img",{src:"/images/logo.png",class:"h-8",alt:"VASIR"},null,-1)])),_:1,__:[1]},8,["href"])])])]),t("main",de,[t("div",ce,[X(g.$slots,"default",{},void 0,!0)])]),t("footer",ue,[t("div",me,[t("div",pe,[t("p",null,"漏 "+h(new Date().getFullYear())+" VASIR. Todos los derechos reservados.",1)])])]),n(o(J))]))}},ve=L(fe,[["__scopeId","data-v-7edb21b2"]]),xe={key:0,class:"bg-white shadow-lg border-b border-gray-200 mb-5 md:mb-10"},ge={class:"max-w-4xl mx-auto px-4 sm:px-8 py-6 sm:py-8 flex flex-col sm:flex-row items-center gap-4 sm:gap-6"},ye={class:"bg-red-600 rounded-xl p-4 shadow flex items-center justify-center border-4 border-white mb-3 sm:mb-0"},be={key:1,class:"mb-5 md:mb-10"},he={class:"flex flex-col items-center justify-center"},we={class:"bg-gradient-to-br from-red-600 via-red-500 to-red-400 rounded-full p-4 sm:p-5 w-20 h-20 sm:w-24 sm:h-24 flex items-center justify-center mb-3 sm:mb-4 shadow-2xl border-4 border-white"},_e={class:"py-2 sm:py-4"},ke={key:0,class:"grid grid-cols-1 md:grid-cols-3 gap-6"},Ee={class:"bg-red-100 rounded-full p-4 mb-4"},Ce={class:"bg-red-100 rounded-full p-4 mb-4"},$e={class:"bg-blue-100 rounded-full p-4 mb-4"},Se={class:"text-lg text-center font-bold text-blue-900 mb-1"},Ae={class:"text-blue-700 text-sm text-center"},De={class:"bg-green-100 rounded-full p-4 mb-4"},Ie={class:"text-lg text-center font-bold text-green-900 mb-1"},je={class:"text-green-700 text-sm text-center"},Re={class:"bg-red-200 rounded-full p-4 mb-4"},Ve={class:"text-lg font-bold text-red-900 mb-1"},Pe={class:"text-red-700 text-sm text-center"},Fe={key:0},qe={key:1},Le={key:2},Te={__name:"Edit",props:{mustVerifyEmail:{type:Boolean},status:{type:String},user:{type:Object,default:null},cliente:{type:Object,default:null},empleado:{type:Object,default:null},debugEmpleado:{type:Object,default:null}},setup(k){const g=k,l=g.user||null,u=K(),x=F(()=>!(l!=null&&l.roles)||!Array.isArray(l.roles)?!1:l.roles.some(s=>s.name==="Administrador"||s.name==="Empleado")),T=F(()=>x.value?O:ve),b=$(null),r=$(!1),m=$(0),p=$(0),A=s=>{const e=`report_cooldown_${s}`,a=localStorage.getItem(e);if(a){const w=3e5-(Date.now()-parseInt(a));return w>0?Math.ceil(w/1e3):(localStorage.removeItem(e),0)}return 0},V=s=>{const e=`report_cooldown_${s}`;localStorage.setItem(e,Date.now().toString())},E=s=>{const e=Math.floor(s/60),a=s%60;return`${e}:${a.toString().padStart(2,"0")}`};U(()=>{m.value=0,p.value=0;const s=A("reservaciones"),e=A("compras");s>0&&(m.value=s,C("reservaciones")),e>0&&(p.value=e,C("compras"))});const C=s=>{const e=setInterval(()=>{const a=A(s);s==="reservaciones"?m.value=a:p.value=a,a<=0&&clearInterval(e)},1e3)},D=(s,e=null)=>{e&&e.preventDefault(),b.value=s},M=()=>{b.value=null},B=s=>{s.preventDefault(),!(r.value||m.value>0)&&N()},G=s=>{s.preventDefault(),!(r.value||p.value>0)&&z()},N=async()=>{if(!r.value){if(m.value>0){u.add({severity:"warn",summary:"Espera un momento",detail:`Debes esperar ${E(m.value)} antes de solicitar otro informe de reservaciones.`,life:5e3});return}r.value=!0,u.add({severity:"info",summary:"Preparando env铆o",detail:"Generando y preparando el env铆o de tu informe de reservaciones por correo...",life:4e3});try{const s=await fetch("/mi-perfil/descargar-reservaciones",{method:"GET",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(s.ok){const e=await s.json();if(e.success)V("reservaciones"),m.value=300,C("reservaciones"),u.add({severity:"success",summary:"Solicitud enviada",detail:e.message||"El informe de reservaciones ser谩 enviado a tu correo electr贸nico.",life:6e3});else{let a,c;e.type==="info"?(a="info",c="Sin reservaciones"):e.type==="warning"?(a="warn",c="Configuraci贸n requerida"):(a="warn",c="Aviso"),u.add({severity:a,summary:c,detail:e.message||"No se pudo procesar la solicitud del informe.",life:8e3})}}else{const e=await s.json().catch(()=>({message:"Error desconocido"}));u.add({severity:"error",summary:`Error del servidor (${s.status})`,detail:e.message||`Error ${s.status}: ${s.statusText}`,life:8e3})}}catch(s){console.error(" Error de conexi贸n completo:",{name:s.name,message:s.message,stack:s.stack,cause:s.cause}),u.add({severity:"error",summary:"Error de conexi贸n",detail:`Error: ${s.message}. Por favor, intenta nuevamente.`,life:6e3})}finally{r.value=!1}}},z=async()=>{if(!r.value){if(p.value>0){u.add({severity:"warn",summary:"Espera un momento",detail:`Debes esperar ${E(p.value)} antes de solicitar otro informe de compras.`,life:5e3});return}r.value=!0,u.add({severity:"info",summary:"Preparando env铆o",detail:"Generando y preparando el env铆o de tu informe de compras por correo...",life:4e3});try{const s=await fetch("/mi-perfil/descargar-compras",{method:"GET",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(s.ok){const e=await s.json();if(e.success)V("compras"),p.value=300,C("compras"),u.add({severity:"success",summary:"Solicitud enviada",detail:e.message||"El informe de compras ser谩 enviado a tu correo electr贸nico.",life:6e3});else{let a,c;e.type==="info"?(a="info",c="Sin compras"):e.type==="warning"?(a="warn",c="Configuraci贸n requerida"):(a="warn",c="Aviso"),u.add({severity:a,summary:c,detail:e.message||"No se pudo procesar la solicitud del informe.",life:8e3})}}else{const e=await s.json().catch(()=>({message:"Error desconocido"}));u.add({severity:"error",summary:"Error del servidor",detail:e.message||"Error interno del servidor.",life:6e3})}}catch(s){u.add({severity:"error",summary:"Error de conexi贸n",detail:`Error: ${s.message}. Por favor, intenta nuevamente.`,life:6e3})}finally{r.value=!1}}};return(s,e)=>(i(),d(_,null,[n(o(W),{title:"Mi Perfil"}),(i(),H(Y(T.value),null,{default:R(()=>{var a,c,w;return[t("div",{class:y(["bg-gray-50",x.value?"pt-4 md:pt-6":""])},[x.value?(i(),d("div",xe,[t("div",ge,[t("div",ye,[n(o(v),{icon:o(j),class:"w-10 h-10 text-white"},null,8,["icon"])]),e[3]||(e[3]=t("div",{class:"text-center sm:text-left"},[t("h1",{class:"text-3xl sm:text-4xl font-extrabold text-gray-900 tracking-tight"},"Mi Perfil"),t("p",{class:"text-gray-700 text-base sm:text-lg mt-1 font-medium"},"Gestiona tu informaci贸n personal y configuraci贸n de cuenta")],-1))])])):(i(),d("div",be,[t("div",he,[t("div",we,[n(o(v),{icon:o(j),class:"w-12 h-12 sm:w-14 sm:h-14 text-white"},null,8,["icon"])]),e[4]||(e[4]=t("h1",{class:"text-3xl sm:text-4xl font-extrabold text-gray-900 mb-1 tracking-tight"},"Mi Perfil",-1)),e[5]||(e[5]=t("p",{class:"text-gray-700 text-base sm:text-lg font-medium"},"Gestiona tu informaci贸n personal y configuraci贸n de cuenta",-1))])])),t("div",_e,[t("div",{class:y([(x.value,"max-w-4xl"),"mx-auto px-2 sm:px-4 md:px-6 lg:px-8"])},[b.value?(i(),d(_,{key:1},[t("button",{onClick:M,class:"mb-6 flex items-center text-red-600 hover:text-red-800 font-semibold text-base"},[n(o(v),{icon:o(te),class:"w-5 h-5 mr-2"},null,8,["icon"]),e[10]||(e[10]=S("Volver"))]),b.value==="profile"?(i(),d("div",Fe,[n(re,{"must-verify-email":k.mustVerifyEmail,status:k.status,cliente:g.cliente,empleado:g.empleado},null,8,["must-verify-email","status","cliente","empleado"])])):b.value==="password"?(i(),d("div",qe,[n(oe)])):b.value==="delete"?(i(),d("div",Le,[n(se,{disabled:((c=o(l))==null?void 0:c.roles)&&o(l).roles.some(f=>["Administrador","Empleado"].includes(f.name)),rol:(w=o(l))!=null&&w.roles&&o(l).roles.length>0?o(l).roles[0].name:""},null,8,["disabled","rol"])])):I("",!0)],64)):(i(),d("div",ke,[t("div",{onClick:e[0]||(e[0]=f=>!r.value&&D("profile",f)),class:y([{"cursor-pointer bg-white hover:shadow-2xl":!r.value,"cursor-not-allowed bg-gray-50 opacity-50":r.value},"rounded-2xl shadow-lg border border-gray-100 p-6 flex flex-col items-center transition-all group"])},[t("div",Ee,[n(o(v),{icon:o(j),class:"w-8 h-8 text-red-600"},null,8,["icon"])]),e[6]||(e[6]=t("h3",{class:"text-lg font-bold text-gray-900 mb-1"},"Informaci贸n Personal",-1)),e[7]||(e[7]=t("p",{class:"text-gray-600 text-sm text-center"},"Actualiza tu informaci贸n de perfil y correo electr贸nico",-1))],2),t("div",{onClick:e[1]||(e[1]=f=>!r.value&&D("password",f)),class:y([{"cursor-pointer bg-white hover:shadow-2xl":!r.value,"cursor-not-allowed bg-gray-50 opacity-50":r.value},"rounded-2xl shadow-lg border border-gray-100 p-6 flex flex-col items-center transition-all group"])},[t("div",Ce,[n(o(v),{icon:o(Z),class:"w-8 h-8 text-red-600"},null,8,["icon"])]),e[8]||(e[8]=t("h3",{class:"text-lg font-bold text-gray-900 mb-1"},"Seguridad",-1)),e[9]||(e[9]=t("p",{class:"text-gray-600 text-sm text-center"},"Cambia tu contrase帽a y mant茅n tu cuenta segura",-1))],2),x.value?I("",!0):(i(),d("div",{key:0,onClick:B,class:y([{"cursor-pointer bg-white hover:shadow-2xl":!r.value&&m.value===0,"cursor-not-allowed bg-gray-50 opacity-50":r.value||m.value>0},"rounded-2xl shadow-lg border border-blue-200 p-6 flex flex-col items-center transition-all group"])},[t("div",$e,[n(o(v),{icon:o(q),class:"w-8 h-8 text-blue-600"},null,8,["icon"])]),t("h3",Se,h(m.value>0?"Disponible en":"Reservaciones"),1),t("p",Ae,h(m.value>0?`${E(m.value)} - Evita spam de correos`:"Solicitar informe PDF de los detalles de tus reservaciones"),1)],2)),x.value?I("",!0):(i(),d("div",{key:1,onClick:G,class:y([{"cursor-pointer bg-white hover:shadow-2xl":!r.value&&p.value===0,"cursor-not-allowed bg-gray-50 opacity-50":r.value||p.value>0},"rounded-2xl shadow-lg border border-green-200 p-6 flex flex-col items-center transition-all group"])},[t("div",De,[n(o(v),{icon:o(q),class:"w-8 h-8 text-green-600"},null,8,["icon"])]),t("h3",Ie,h(p.value>0?"Disponible en":"Compras"),1),t("p",je,h(p.value>0?`${E(p.value)} - Evita spam de correos`:"Solicitar informe PDF de los detalles de tus compras"),1)],2)),t("div",{onClick:e[2]||(e[2]=f=>!r.value&&D("delete",f)),class:y([{"cursor-pointer bg-white hover:shadow-2xl":!r.value,"cursor-not-allowed bg-gray-50 opacity-50":r.value},"rounded-2xl shadow-lg border border-red-200 p-6 flex flex-col items-center transition-all group"])},[t("div",Re,[n(o(v),{icon:o(ee),class:"w-8 h-8 text-red-700"},null,8,["icon"])]),t("h3",Ve,h(x.value?"Eliminar Cuenta":"Solicitar Eliminaci贸n"),1),t("p",Pe,[x.value?(a=o(l))!=null&&a.roles&&o(l).roles.some(f=>f.name==="Empleado")?(i(),d(_,{key:1},[S(" Debes contactar al Administrador para eliminar tu cuenta ")],64)):(i(),d(_,{key:2},[S(" Debes contactar a soporte para eliminar tu cuenta ")],64)):(i(),d(_,{key:0},[S(" Enviar una solicitud al equipo de la Agencia VASIR ")],64))])],2)]))],2)])],2)]}),_:1}))],64))}},Je=L(Te,[["__scopeId","data-v-9db7aa92"]]);export{Je as default};
