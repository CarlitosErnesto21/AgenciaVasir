import{a4 as G,r as b,E as R,o as $,N as S,h as j,d as i,x as k,e as o,q as p,t as d,I as H,v as N,c as u,j as g,y as x,a9 as U,F,l as X,a7 as q,p as y,$ as m}from"./vendor-DcS5GX9S.js";import{A as Z,r as J,D as V,g as K}from"./ui-DN6aYgk-.js";import{f as Q,ah as W,g as Y,F as O}from"./index-DObSwni0.js";import{z as ee}from"./vue-tel-input-D_h7FK_m.js";import{_ as oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ae={class:"text-xl font-bold text-red-700 flex items-center gap-2"},te={class:"py-4"},le={class:"bg-blue-50 rounded-lg p-4 mb-6"},re={class:"text-sm text-blue-700"},se={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},ie={key:0,class:"text-red-500 text-xs"},ne=["disabled"],de={key:0,value:"",disabled:""},ue={key:1,value:"",disabled:""},ce=["value"],me={key:0,class:"text-red-500 text-xs"},fe={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},ve={key:0,class:"text-red-500 text-xs"},pe={key:0,class:"text-red-500 text-xs"},ge={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},be={class:"mr-1"},xe={key:1,class:"text-red-500 text-xs"},ye={class:"sm:col-span-1"},_e={key:0,class:"text-red-500 text-xs"},we={class:"flex justify-center gap-4 w-full mt-6"},Ne=["disabled"],he=["disabled"],ke={__name:"ModalDatosCliente",props:{visible:{type:Boolean,default:!1}},emits:["update:visible","cliente-guardado"],setup(M,{emit:T}){const h=T,A=G(),_=Z(),v=b(!1),f=b([]),w=b(!0),C=R(()=>{var r;return(r=A.props.auth)==null?void 0:r.user}),l=b({numero_identificacion:"",fecha_nacimiento:null,genero:"",direccion:"",telefono:"",tipo_documento_id:null}),t=b({}),n=b({isValid:!1,country:null,formattedNumber:"",mensaje:""});$(async()=>{await B()});const B=async()=>{var r,e,c;try{w.value=!0;const s=await S.get("/api/tipo-documentos"),a=s.data.tipos||s.data.data||s.data||[];f.value=a.map(I=>({nombre:I.nombre,id:I.id})),f.value.length===0&&console.warn("No se encontraron tipos de documento"),f.value.length>0&&(l.value.tipo_documento_id=f.value[0].id)}catch(s){console.error("Error al cargar tipos de documento:",s),console.error("Response data:",(r=s.response)==null?void 0:r.data),f.value=[{id:1,nombre:"DUI"},{id:2,nombre:"CÉDULA"},{id:3,nombre:"PASAPORTE"}];let a="No se pudieron cargar los tipos de documento. Usando valores por defecto.";((e=s.response)==null?void 0:e.status)===401?a="No estás autorizado para acceder a esta información":((c=s.response)==null?void 0:c.status)===404&&(a="Servicio no encontrado"),_.add({severity:"error",summary:"Error",detail:a,life:3e3})}finally{w.value=!1}},D=()=>{h("update:visible",!1),L()},L=()=>{l.value={numero_identificacion:"",fecha_nacimiento:null,genero:"",direccion:"",telefono:"",tipo_documento_id:f.value.length>0?f.value[0].id:null},t.value={}},P=r=>{try{r&&typeof r=="object"&&(n.value.isValid=r.valid===!0,n.value.country={name:r.country,code:r.countryCode},n.value.formattedNumber=r.formatted||"",l.value.telefono&&r.valid===!1?n.value.mensaje="Número de teléfono inválido para "+r.country:r.valid===!0?n.value.mensaje="Número válido para "+r.country:n.value.mensaje="")}catch{n.value.mensaje="Error en validación"}},z=()=>(t.value={},l.value.numero_identificacion.trim()||(t.value.numero_identificacion="El número de identificación es requerido"),l.value.fecha_nacimiento||(t.value.fecha_nacimiento="La fecha de nacimiento es requerida"),l.value.genero||(t.value.genero="El género es requerido"),l.value.direccion.trim()||(t.value.direccion="La dirección es requerida"),l.value.telefono?n.value.isValid===!1&&(t.value.telefono="Por favor, ingrese un número de teléfono válido"):t.value.telefono="El número de teléfono es requerido",l.value.tipo_documento_id||(t.value.tipo_documento_id="El tipo de documento es requerido"),Object.keys(t.value).length===0),E=async()=>{var r,e,c,s;if(!z()){_.add({severity:"error",summary:"Formulario incompleto",detail:"Por favor completa todos los campos requeridos",life:4e3});return}try{v.value=!0;const a=await S.post("/api/registro-cliente",l.value);_.add({severity:"success",summary:"Información guardada",detail:"Tus datos han sido guardados correctamente",life:3e3}),h("cliente-guardado",a.data.data||a.data),D()}catch(a){console.error("Error al guardar cliente:",a),(e=(r=a.response)==null?void 0:r.data)!=null&&e.errors&&(t.value=a.response.data.errors),_.add({severity:"error",summary:"Error al guardar",detail:((s=(c=a.response)==null?void 0:c.data)==null?void 0:s.message)||"No se pudo guardar la información",life:5e3})}finally{v.value=!1}};return(r,e)=>(i(),j(m(K),{visible:M.visible,"onUpdate:visible":e[6]||(e[6]=c=>h("update:visible",c)),modal:"",closable:!1,class:"max-w-2xl w-full mx-4",draggable:!1},{header:k(()=>[o("h3",ae,[y(m(V),{icon:m(O)},null,8,["icon"]),e[7]||(e[7]=p(" Completar información de cliente "))])]),footer:k(()=>[o("div",we,[o("button",{type:"button",class:"bg-red-600 hover:bg-red-700 text-white px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",onClick:E,disabled:v.value},[y(m(V),{icon:v.value?m(Q):m(W),class:x(["h-5",{"animate-spin":v.value}])},null,8,["icon","class"]),p(" "+d(v.value?"Guardando...":"Guardar y Continuar"),1)],8,Ne),o("button",{type:"button",class:"bg-blue-500 hover:bg-blue-700 text-white px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",onClick:D,disabled:v.value},[y(m(V),{icon:m(Y),class:"h-5"},null,8,["icon"]),e[20]||(e[20]=p(" Cancelar "))],8,he)])]),default:k(()=>{var c,s;return[o("div",te,[o("div",le,[e[10]||(e[10]=o("h4",{class:"font-semibold text-blue-800 mb-2"},"Información de tu cuenta:",-1)),o("div",re,[o("p",null,[e[8]||(e[8]=o("strong",null,"Nombre:",-1)),p(" "+d((c=C.value)==null?void 0:c.name),1)]),o("p",null,[e[9]||(e[9]=o("strong",null,"Email:",-1)),p(" "+d((s=C.value)==null?void 0:s.email),1)])])]),o("form",{onSubmit:H(E,["prevent"]),class:"space-y-4"},[o("div",se,[o("div",null,[e[11]||(e[11]=o("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Número de Identificación",-1)),N(o("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>l.value.numero_identificacion=a),type:"text",required:"",maxlength:"25",class:x(["w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",{"border-red-500":t.value.numero_identificacion}]),placeholder:"Ingrese su DUI o documento"},null,2),[[U,l.value.numero_identificacion]]),t.value.numero_identificacion?(i(),u("small",ie,d(t.value.numero_identificacion),1)):g("",!0)]),o("div",null,[e[13]||(e[13]=o("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Tipo de Documento",-1)),N(o("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>l.value.tipo_documento_id=a),required:"",disabled:w.value,class:x(["w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100",{"border-red-500":t.value.tipo_documento_id}])},[w.value?(i(),u("option",de,"Cargando tipos...")):f.value.length===0?(i(),u("option",ue,"No hay tipos disponibles")):(i(),u(F,{key:2},[e[12]||(e[12]=o("option",{value:"",disabled:""},"Seleccione un tipo",-1)),(i(!0),u(F,null,X(f.value,a=>(i(),u("option",{key:a.id,value:a.id},d(a.nombre),9,ce))),128))],64))],10,ne),[[q,l.value.tipo_documento_id]]),t.value.tipo_documento_id?(i(),u("small",me,d(t.value.tipo_documento_id),1)):g("",!0)])]),o("div",fe,[o("div",null,[e[14]||(e[14]=o("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Fecha de Nacimiento",-1)),y(m(J),{modelValue:l.value.fecha_nacimiento,"onUpdate:modelValue":e[2]||(e[2]=a=>l.value.fecha_nacimiento=a),maxDate:new Date,dateFormat:"dd/mm/yy",placeholder:"Seleccionar fecha de nacimiento",showIcon:"",showOnFocus:!1,touchUI:"",yearNavigator:"",yearRange:"1920:2010",class:"w-full",inputClass:`w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 ${t.value.fecha_nacimiento?"border-red-500":""}`},null,8,["modelValue","maxDate","inputClass"]),t.value.fecha_nacimiento?(i(),u("small",ve,d(t.value.fecha_nacimiento),1)):g("",!0)]),o("div",null,[e[16]||(e[16]=o("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Género",-1)),N(o("select",{"onUpdate:modelValue":e[3]||(e[3]=a=>l.value.genero=a),required:"",class:x(["w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",{"border-red-500":t.value.genero}])},e[15]||(e[15]=[o("option",{value:""},"Seleccione",-1),o("option",{value:"MASCULINO"},"Masculino",-1),o("option",{value:"FEMENINO"},"Femenino",-1)]),2),[[q,l.value.genero]]),t.value.genero?(i(),u("small",pe,d(t.value.genero),1)):g("",!0)])]),o("div",ge,[o("div",null,[e[17]||(e[17]=o("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Teléfono",-1)),y(m(ee),{modelValue:l.value.telefono,"onUpdate:modelValue":e[4]||(e[4]=a=>l.value.telefono=a),defaultCountry:"SV",preferredCountries:["SV","GT","HN","CR","NI","PA","BZ"],validCharactersOnly:!0,dropdownOptions:{showDialCodeInSelection:!0,showFlags:!0,showSearchBox:!0,showDialCodeInList:!0},inputOptions:{placeholder:"Número de teléfono"},mode:"international",class:"w-full border border-gray-300 rounded-lg",onValidate:P},null,8,["modelValue"]),n.value.mensaje?(i(),u("p",{key:0,class:x(["text-xs mt-1 flex items-center",n.value.isValid?"text-green-600":"text-red-600"])},[o("span",be,d(n.value.isValid?"✓":"⚠️"),1),p(" "+d(n.value.mensaje),1)],2)):g("",!0),t.value.telefono?(i(),u("small",xe,d(t.value.telefono),1)):g("",!0)]),o("div",ye,[e[18]||(e[18]=o("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Dirección",-1)),N(o("input",{"onUpdate:modelValue":e[5]||(e[5]=a=>l.value.direccion=a),type:"text",required:"",maxlength:"200",class:x(["w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",{"border-red-500":t.value.direccion}]),placeholder:"Dirección completa"},null,2),[[U,l.value.direccion]]),t.value.direccion?(i(),u("small",_e,d(t.value.direccion),1)):g("",!0)])]),e[19]||(e[19]=o("div",{class:"bg-blue-50 border border-blue-200 rounded-lg p-4 mt-4"},[o("p",{class:"text-sm text-blue-800"},[o("strong",null,"Nota:"),p(" Esta información es necesaria para procesar tu compra. ")])],-1))],32)])]}),_:1},8,["visible"]))}},Se=oe(ke,[["__scopeId","data-v-991333b9"]]);export{Se as default};
