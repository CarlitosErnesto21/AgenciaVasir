import{A as O}from"./AuthenticatedLayout-Brf7D3Fu.js";import{c as i,d as n,e as t,p as l,x as R,$ as s,a2 as P,f as X,t as b,E as F,r as C,o as H,h as U,a0 as W,y as g,j as I,F as w,q as $,z as K}from"./vendor-gbh1WW5n.js";import{F as f,a as Y,z as J}from"./ui-BrU4k96Z.js";import{e as Q,K as j,g as Z,b as L,i as ee,am as te}from"./index-BWaQysKE.js";import{_ as M}from"./_plugin-vue_export-helper-DlAUqK2U.js";import oe from"./DeleteUserForm-D1b-rK_t.js";import se from"./UpdatePasswordForm-DnR9uYQa.js";import re from"./UpdateProfileInformationForm-C8IW_rEx.js";import"./TextInput-D8O_0gxS.js";import"./PrimaryButton-DDUzFEMx.js";import"./vue-tel-input-nvsKEitw.js";const ae={class:"min-h-screen bg-gray-50 flex flex-col"},le={class:"bg-white shadow-sm border-b border-gray-200 sticky top-0 z-40"},ne={class:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-4"},ie={class:"flex items-center justify-between"},de={class:"flex-grow py-8"},ce={class:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8"},ue={class:"bg-red-600 border-t border-gray-200"},me={class:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-6"},pe={class:"text-center text-white text-sm"},fe={__name:"ClientLayout",setup(_){return(x,a)=>(n(),i("div",ae,[t("header",le,[t("div",ne,[t("div",ie,[l(s(P),{href:x.route("inicio"),class:"flex items-center space-x-2 px-3 py-2 rounded-lg text-gray-600 hover:text-red-600 hover:bg-red-50 transition-all duration-200 group"},{default:R(()=>[l(s(f),{icon:s(Q),class:"w-5 h-5 group-hover:transform group-hover:-translate-x-1 transition-transform duration-200"},null,8,["icon"]),a[0]||(a[0]=t("span",{class:"font-medium"},"Volver al Inicio",-1))]),_:1,__:[0]},8,["href"]),l(s(P),{href:x.route("inicio"),class:"flex items-center",title:"Volver a inicio"},{default:R(()=>a[1]||(a[1]=[t("img",{src:"/images/logo.png",class:"h-8",alt:"VASIR"},null,-1)])),_:1,__:[1]},8,["href"])])])]),t("main",de,[t("div",ce,[X(x.$slots,"default",{},void 0,!0)])]),t("footer",ue,[t("div",me,[t("div",pe,[t("p",null,"© "+b(new Date().getFullYear())+" VASIR. Todos los derechos reservados.",1)])])]),l(s(Y))]))}},ve=M(fe,[["__scopeId","data-v-7edb21b2"]]),xe={key:0,class:"bg-white shadow-lg border-b border-gray-200 mb-5 md:mb-10"},ge={class:"max-w-4xl mx-auto px-4 sm:px-8 py-6 sm:py-8 flex flex-col sm:flex-row items-center gap-4 sm:gap-6"},ye={class:"bg-red-600 rounded-xl p-4 shadow flex items-center justify-center border-4 border-white mb-3 sm:mb-0"},be={key:1,class:"mb-5 md:mb-10"},he={class:"flex flex-col items-center justify-center"},we={class:"bg-gradient-to-br from-red-600 via-red-500 to-red-400 rounded-full p-4 sm:p-5 w-20 h-20 sm:w-24 sm:h-24 flex items-center justify-center mb-3 sm:mb-4 shadow-2xl border-4 border-white"},_e={class:"py-2 sm:py-4"},Ee={key:0,class:"grid grid-cols-1 md:grid-cols-3 gap-6"},ke={class:"bg-red-100 rounded-full p-4 mb-4"},Ce={class:"bg-red-100 rounded-full p-4 mb-4"},$e={class:"bg-blue-100 rounded-full p-4 mb-4"},Se={class:"text-lg text-center font-bold text-blue-900 mb-1"},De={class:"text-blue-700 text-sm text-center"},Ae={class:"bg-green-100 rounded-full p-4 mb-4"},Ie={class:"text-lg text-center font-bold text-green-900 mb-1"},je={class:"text-green-700 text-sm text-center"},Re={class:"bg-red-200 rounded-full p-4 mb-4"},Ve={class:"text-lg font-bold text-red-900 mb-1"},Pe={class:"text-red-700 text-sm text-center"},Fe={key:0},Le={key:1},Me={key:2},Te={__name:"Edit",props:{mustVerifyEmail:{type:Boolean},status:{type:String},user:{type:Object,default:null},cliente:{type:Object,default:null},empleado:{type:Object,default:null},debugEmpleado:{type:Object,default:null}},setup(_){const x=_,a=x.user||null,d=J(),v=F(()=>!(a!=null&&a.roles)||!Array.isArray(a.roles)?!1:a.roles.some(o=>o.name==="Administrador"||o.name==="Empleado")),T=F(()=>v.value?O:ve),y=C(null),r=C(!1),c=C(0),u=C(0),S=o=>{const e=`report_cooldown_${o}`,m=localStorage.getItem(e);if(m){const h=3e5-(Date.now()-parseInt(m));return h>0?Math.ceil(h/1e3):(localStorage.removeItem(e),0)}return 0},V=o=>{const e=`report_cooldown_${o}`;localStorage.setItem(e,Date.now().toString())},E=o=>{const e=Math.floor(o/60),m=o%60;return`${e}:${m.toString().padStart(2,"0")}`};H(()=>{c.value=0,u.value=0;const o=S("reservaciones"),e=S("compras");o>0&&(c.value=o,k("reservaciones")),e>0&&(u.value=e,k("compras"))});const k=o=>{const e=setInterval(()=>{const m=S(o);o==="reservaciones"?c.value=m:u.value=m,m<=0&&clearInterval(e)},1e3)},D=(o,e=null)=>{e&&e.preventDefault(),y.value=o},q=()=>{y.value=null},B=o=>{o.preventDefault(),!(r.value||c.value>0)&&N()},G=o=>{o.preventDefault(),!(r.value||u.value>0)&&z()},N=async()=>{if(!r.value){if(c.value>0){d.add({severity:"warn",summary:"Espera un momento",detail:`Debes esperar ${E(c.value)} antes de solicitar otro informe de reservaciones.`,life:5e3});return}r.value=!0,d.add({severity:"info",summary:"Preparando envío",detail:"Generando y preparando el envío de tu informe de reservaciones por correo...",life:4e3});try{const o=await fetch("/mi-perfil/descargar-reservaciones",{method:"GET",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(o.ok){const e=await o.json();e.success?(V("reservaciones"),c.value=300,k("reservaciones"),d.add({severity:"success",summary:"Solicitud enviada",detail:e.message||"El informe de reservaciones será enviado a tu correo electrónico.",life:6e3})):d.add({severity:"error",summary:"Error en la solicitud",detail:e.message||"No se pudo procesar la solicitud del informe.",life:6e3})}else{const e=await o.json().catch(()=>({message:"Error desconocido"}));d.add({severity:"error",summary:"Error del servidor",detail:e.message||"Error interno del servidor.",life:6e3})}}catch(o){d.add({severity:"error",summary:"Error de conexión",detail:`Error: ${o.message}. Por favor, intenta nuevamente.`,life:6e3})}finally{r.value=!1}}},z=async()=>{if(!r.value){if(u.value>0){d.add({severity:"warn",summary:"Espera un momento",detail:`Debes esperar ${E(u.value)} antes de solicitar otro informe de compras.`,life:5e3});return}r.value=!0,d.add({severity:"info",summary:"Preparando envío",detail:"Generando y preparando el envío de tu informe de compras por correo...",life:4e3});try{const o=await fetch("/mi-perfil/descargar-compras",{method:"GET",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(o.ok){const e=await o.json();e.success?(V("compras"),u.value=300,k("compras"),d.add({severity:"success",summary:"Solicitud enviada",detail:e.message||"El informe de compras será enviado a tu correo electrónico.",life:6e3})):d.add({severity:"error",summary:"Error en la solicitud",detail:e.message||"No se pudo procesar la solicitud del informe.",life:6e3})}else{const e=await o.json().catch(()=>({message:"Error desconocido"}));d.add({severity:"error",summary:"Error del servidor",detail:e.message||"Error interno del servidor.",life:6e3})}}catch(o){d.add({severity:"error",summary:"Error de conexión",detail:`Error: ${o.message}. Por favor, intenta nuevamente.`,life:6e3})}finally{r.value=!1}}};return(o,e)=>(n(),i(w,null,[l(s(W),{title:"Mi Perfil"}),(n(),U(K(T.value),null,{default:R(()=>{var m,A,h;return[t("div",{class:g(["bg-gray-50",v.value?"pt-4 md:pt-6":""])},[v.value?(n(),i("div",xe,[t("div",ge,[t("div",ye,[l(s(f),{icon:s(j),class:"w-10 h-10 text-white"},null,8,["icon"])]),e[3]||(e[3]=t("div",{class:"text-center sm:text-left"},[t("h1",{class:"text-3xl sm:text-4xl font-extrabold text-gray-900 tracking-tight"},"Mi Perfil"),t("p",{class:"text-gray-700 text-base sm:text-lg mt-1 font-medium"},"Gestiona tu información personal y configuración de cuenta")],-1))])])):(n(),i("div",be,[t("div",he,[t("div",we,[l(s(f),{icon:s(j),class:"w-12 h-12 sm:w-14 sm:h-14 text-white"},null,8,["icon"])]),e[4]||(e[4]=t("h1",{class:"text-3xl sm:text-4xl font-extrabold text-gray-900 mb-1 tracking-tight"},"Mi Perfil",-1)),e[5]||(e[5]=t("p",{class:"text-gray-700 text-base sm:text-lg font-medium"},"Gestiona tu información personal y configuración de cuenta",-1))])])),t("div",_e,[t("div",{class:g([(v.value,"max-w-4xl"),"mx-auto px-2 sm:px-4 md:px-6 lg:px-8"])},[y.value?(n(),i(w,{key:1},[t("button",{onClick:q,class:"mb-6 flex items-center text-red-600 hover:text-red-800 font-semibold text-base"},[l(s(f),{icon:s(te),class:"w-5 h-5 mr-2"},null,8,["icon"]),e[10]||(e[10]=$("Volver"))]),y.value==="profile"?(n(),i("div",Fe,[l(re,{"must-verify-email":_.mustVerifyEmail,status:_.status,cliente:x.cliente,empleado:x.empleado},null,8,["must-verify-email","status","cliente","empleado"])])):y.value==="password"?(n(),i("div",Le,[l(se)])):y.value==="delete"?(n(),i("div",Me,[l(oe,{disabled:((A=s(a))==null?void 0:A.roles)&&s(a).roles.some(p=>["Administrador","Empleado"].includes(p.name)),rol:(h=s(a))!=null&&h.roles&&s(a).roles.length>0?s(a).roles[0].name:""},null,8,["disabled","rol"])])):I("",!0)],64)):(n(),i("div",Ee,[t("div",{onClick:e[0]||(e[0]=p=>!r.value&&D("profile",p)),class:g([{"cursor-pointer bg-white hover:shadow-2xl":!r.value,"cursor-not-allowed bg-gray-50 opacity-50":r.value},"rounded-2xl shadow-lg border border-gray-100 p-6 flex flex-col items-center transition-all group"])},[t("div",ke,[l(s(f),{icon:s(j),class:"w-8 h-8 text-red-600"},null,8,["icon"])]),e[6]||(e[6]=t("h3",{class:"text-lg font-bold text-gray-900 mb-1"},"Información Personal",-1)),e[7]||(e[7]=t("p",{class:"text-gray-600 text-sm text-center"},"Actualiza tu información de perfil y correo electrónico",-1))],2),t("div",{onClick:e[1]||(e[1]=p=>!r.value&&D("password",p)),class:g([{"cursor-pointer bg-white hover:shadow-2xl":!r.value,"cursor-not-allowed bg-gray-50 opacity-50":r.value},"rounded-2xl shadow-lg border border-gray-100 p-6 flex flex-col items-center transition-all group"])},[t("div",Ce,[l(s(f),{icon:s(Z),class:"w-8 h-8 text-red-600"},null,8,["icon"])]),e[8]||(e[8]=t("h3",{class:"text-lg font-bold text-gray-900 mb-1"},"Seguridad",-1)),e[9]||(e[9]=t("p",{class:"text-gray-600 text-sm text-center"},"Cambia tu contraseña y mantén tu cuenta segura",-1))],2),v.value?I("",!0):(n(),i("div",{key:0,onClick:B,class:g([{"cursor-pointer bg-white hover:shadow-2xl":!r.value&&c.value===0,"cursor-not-allowed bg-gray-50 opacity-50":r.value||c.value>0},"rounded-2xl shadow-lg border border-blue-200 p-6 flex flex-col items-center transition-all group"])},[t("div",$e,[l(s(f),{icon:s(L),class:"w-8 h-8 text-blue-600"},null,8,["icon"])]),t("h3",Se,b(c.value>0?"Disponible en":"Reservaciones"),1),t("p",De,b(c.value>0?`${E(c.value)} - Evita spam de correos`:"Solicitar informe PDF de los detalles de tus reservaciones"),1)],2)),v.value?I("",!0):(n(),i("div",{key:1,onClick:G,class:g([{"cursor-pointer bg-white hover:shadow-2xl":!r.value&&u.value===0,"cursor-not-allowed bg-gray-50 opacity-50":r.value||u.value>0},"rounded-2xl shadow-lg border border-green-200 p-6 flex flex-col items-center transition-all group"])},[t("div",Ae,[l(s(f),{icon:s(L),class:"w-8 h-8 text-green-600"},null,8,["icon"])]),t("h3",Ie,b(u.value>0?"Disponible en":"Compras"),1),t("p",je,b(u.value>0?`${E(u.value)} - Evita spam de correos`:"Solicitar informe PDF de los detalles de tus compras"),1)],2)),t("div",{onClick:e[2]||(e[2]=p=>!r.value&&D("delete",p)),class:g([{"cursor-pointer bg-white hover:shadow-2xl":!r.value,"cursor-not-allowed bg-gray-50 opacity-50":r.value},"rounded-2xl shadow-lg border border-red-200 p-6 flex flex-col items-center transition-all group"])},[t("div",Re,[l(s(f),{icon:s(ee),class:"w-8 h-8 text-red-700"},null,8,["icon"])]),t("h3",Ve,b(v.value?"Eliminar Cuenta":"Solicitar Eliminación"),1),t("p",Pe,[v.value?(m=s(a))!=null&&m.roles&&s(a).roles.some(p=>p.name==="Empleado")?(n(),i(w,{key:1},[$(" Debes contactar al Administrador para eliminar tu cuenta ")],64)):(n(),i(w,{key:2},[$(" Debes contactar a soporte para eliminar tu cuenta ")],64)):(n(),i(w,{key:0},[$(" Enviar una solicitud al equipo de la Agencia VASIR ")],64))])],2)]))],2)])],2)]}),_:1}))],64))}},Ye=M(Te,[["__scopeId","data-v-0509c858"]]);export{Ye as default};
