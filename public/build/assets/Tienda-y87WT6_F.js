import{_ as I}from"./Catalogo-BBRBX9dV.js";import O from"./FiltrosPanel-Choh83YF.js";import R from"./SearchBar-B1cC1rFA.js";import q from"./ProductGrid-jNc9KiOM.js";import H from"./PaginationControls-B9-5Ed4W.js";import J from"./EmptyState-Y6M_M7Nm.js";import K from"./ModalAuthRequerido-A1U_YImL.js";import Q from"./CarritoCompras-DYmuzma9.js";import W from"./CarritoButton-ChjZyCzz.js";import{a4 as X,r as o,o as Y,N,E as f,w as S,k as Z,h as ee,d as ae,x as te,p as i,e as n}from"./vendor-DcS5GX9S.js";import{A as oe}from"./ui-DN6aYgk-.js";import{u as re}from"./carrito-CxHiss44.js";import"./index-DObSwni0.js";import"./ImageWithFallback-_VPuFh5t.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ModalDatosCliente-CT9RT75j.js";import"./vue-tel-input-D_h7FK_m.js";import"./app-DTYFVDvX.js";const se={class:"bg-gradient-to-br from-gray-50 via-blue-50/30 to-red-50/30 w-full pt-20 md:pt-28 lg:pt-32 xl:pt-36"},le={class:"w-full mb-4 -mt-0 md:-mt-3"},ie={class:"bg-gradient-to-r from-red-600 via-red-500 to-blue-600 text-white text-center py-4 sm:py-6 relative shadow-xl"},ne={class:"absolute top-4 right-4"},ue={class:"w-full px-2 sm:px-4 pb-4 sm:pb-4 lg:pb-4"},ce={class:"flex flex-col lg:flex-row gap-4 lg:gap-8"},de={class:"flex-1"},Se={__name:"Tienda",setup(me){const d=oe(),E=X(),x=re(),m=o([]),w=o([]),P=o(!0),b=o(!0),C=o(!1),h=o(null),l=o([]),u=o(""),c=o(""),v=o(""),F=o(!1),r=o(1),g=o(8);o(0),Y(async()=>{await Promise.all([T(),$()]),x.verificarEstadoAutenticacion()});const T=async()=>{try{P.value=!0;const a=await N.get("/api/productos");m.value=(a.data.data||a.data||[]).map(e=>{var s;return{id:e.id,nombre:e.nombre,descripcion:e.descripcion,precio:parseFloat(e.precio),stock_actual:e.stock_actual,categoria:((s=e.categoria)==null?void 0:s.nombre)||"Sin categorÃ­a",categoria_id:e.categoria_id,imagen:e.imagenes&&e.imagenes.length>0?typeof e.imagenes[0]=="string"?e.imagenes[0]:e.imagenes[0].nombre:null,imagenes:e.imagenes||[]}}).filter(e=>e.stock_actual>0)}catch(a){console.error("Error al cargar productos:",a),d.add({severity:"error",summary:"Error",detail:"No se pudieron cargar los productos",life:3e3})}finally{P.value=!1}},$=async()=>{try{b.value=!0;const a=await N.get("/api/categorias-productos");w.value=(a.data.data||a.data||[]).map(e=>({id:e.id,nombre:e.nombre,cantidad:0}))}catch(a){console.error("Error al cargar categorÃ­as:",a),d.add({severity:"error",summary:"Error",detail:"No se pudieron cargar las categorÃ­as",life:3e3})}finally{b.value=!1}},U=f(()=>w.value.map(a=>({...a,cantidad:m.value.filter(e=>e.categoria===a.nombre).length})).filter(a=>a.cantidad>0)),p=f(()=>{let a=[...m.value];if(v.value){const e=v.value.toLowerCase();a=a.filter(s=>s.nombre.toLowerCase().includes(e)||s.descripcion.toLowerCase().includes(e)||s.categoria.toLowerCase().includes(e))}return l.value.length>0&&(a=a.filter(e=>l.value.includes(e.categoria))),u.value&&!isNaN(u.value)&&(a=a.filter(e=>e.precio>=parseFloat(u.value))),c.value&&!isNaN(c.value)&&(a=a.filter(e=>e.precio<=parseFloat(c.value))),a}),y=f(()=>Math.ceil(p.value.length/g.value)),k=f(()=>{const a=(r.value-1)*g.value,e=a+g.value;return p.value.slice(a,e)}),D=f(()=>{if(m.value.length===0)return{min:0,max:0,promedio:0};const a=m.value.map(e=>e.precio);return{min:Math.min(...a),max:Math.max(...a),promedio:a.reduce((e,s)=>e+s,0)/a.length}}),L=a=>{const e=l.value.indexOf(a);e>-1?l.value.splice(e,1):l.value.push(a),r.value=1},M=()=>{l.value=[],u.value="",c.value="",v.value="",r.value=1,d.add({severity:"info",summary:"Filtros limpiados",detail:"Se han removido todos los filtros",life:2e3})},A=()=>{r.value=1,d.add({severity:"success",summary:"Filtros aplicados",detail:`Mostrando ${p.value.length} productos`,life:2e3})},_=a=>{a>=1&&a<=y.value&&(r.value=a)},B=()=>{r.value>1&&_(r.value-1)},z=()=>{r.value<y.value&&_(r.value+1)};S(v,()=>{r.value=1}),S([u,c],()=>{r.value=1});const G=a=>{var s;if(a.stock_actual<=0){d.add({severity:"warn",summary:"Sin stock",detail:`El producto "${a.nombre}" no estÃ¡ disponible`,life:3e3});return}if(!((s=E.props.auth)==null?void 0:s.user)){h.value=a,C.value=!0;return}x.agregarProducto(a),setTimeout(()=>{x.mostrarCarrito()},500)},V=a=>{d.add({severity:"info",summary:"Detalles del producto",detail:`${a.nombre} - $${a.precio.toFixed(2)} - ${a.categoria} - Stock: ${a.stock_actual}`,life:5e3})},j=async()=>{await Promise.all([T(),$()]),d.add({severity:"success",summary:"Datos actualizados",detail:"La informaciÃ³n se ha actualizado correctamente",life:2e3})};return(a,e)=>{const s=Z("Toast");return ae(),ee(I,null,{default:te(()=>[i(s,{class:"z-[9999]"}),n("div",se,[n("div",le,[n("div",ie,[n("div",ne,[i(W)]),e[8]||(e[8]=n("h1",{class:"text-2xl sm:text-3xl md:text-4xl font-bold mb-2"},"ðŸ›ï¸ Productos",-1)),e[9]||(e[9]=n("p",{class:"text-base sm:text-lg text-red-100 px-4"},"Encuentra los mejores productos para tu viaje",-1))])]),n("div",ue,[n("div",ce,[i(O,{categories:U.value,selectedCategories:l.value,minPrice:u.value,maxPrice:c.value,showMobileFilters:F.value,loadingCategories:b.value,preciosStats:D.value,"onUpdate:selectedCategories":e[0]||(e[0]=t=>l.value=t),"onUpdate:minPrice":e[1]||(e[1]=t=>u.value=t),"onUpdate:maxPrice":e[2]||(e[2]=t=>c.value=t),"onUpdate:showMobileFilters":e[3]||(e[3]=t=>F.value=t),onToggleCategory:L,onClearFilters:M,onApplyPriceFilter:A},null,8,["categories","selectedCategories","minPrice","maxPrice","showMobileFilters","loadingCategories","preciosStats"]),n("div",de,[i(R,{searchTerm:v.value,allFilteredProducts:p.value,selectedCategories:l.value,minPrice:u.value,maxPrice:c.value,"onUpdate:searchTerm":e[4]||(e[4]=t=>v.value=t)},null,8,["searchTerm","allFilteredProducts","selectedCategories","minPrice","maxPrice"]),i(q,{loading:P.value,filteredProducts:k.value,onComprarProducto:G,onVerDetalles:V},null,8,["loading","filteredProducts"]),i(H,{currentPage:r.value,totalPagesComputed:y.value,allFilteredProducts:p.value,itemsPerPage:g.value,"onUpdate:currentPage":e[5]||(e[5]=t=>r.value=t),"onUpdate:itemsPerPage":e[6]||(e[6]=t=>g.value=t),onGoToPage:_,onGoToPreviousPage:B,onGoToNextPage:z},null,8,["currentPage","totalPagesComputed","allFilteredProducts","itemsPerPage"]),i(J,{loading:P.value,filteredProducts:k.value,products:m.value,onClearFilters:M,onRecargarDatos:j},null,8,["loading","filteredProducts","products"])])])])]),i(K,{visible:C.value,"onUpdate:visible":e[7]||(e[7]=t=>C.value=t),productoInfo:h.value},null,8,["visible","productoInfo"]),i(Q)]),_:1})}}};export{Se as default};
