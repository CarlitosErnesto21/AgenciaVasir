import{r as i,E as R,w as me,n as O,o as ve,a6 as ge,N as P,k as E,h as fe,d as g,x as d,p as r,e as a,$ as o,a0 as pe,a1 as be,y as D,t as C,A as W,c as w,j as M,q as S}from"./vendor-DcS5GX9S.js";import{A as we}from"./AuthenticatedLayout-qWHYYKIA.js";import{A as he,F as xe,D as m}from"./ui-DN6aYgk-.js";import{f as F,a as ye,b as Ce,c as Z,d as _e,e as q,g as J,h as K,i as ke}from"./index-DObSwni0.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Pe={class:"container mx-auto px-4 py-6"},Ee={class:"bg-white rounded-lg shadow-md"},De={class:"flex flex-col sm:flex-row lg:justify-between lg:items-center mb-4 gap-4 p-6"},Ne={class:"flex items-center gap-3"},Le={class:"flex items-center gap-2 w-full justify-center lg:w-auto lg:justify-end"},Te={class:"bg-blue-50 p-3 rounded-lg shadow-sm border mb-4"},Se={class:"text-sm font-medium leading-relaxed"},Ae={class:"flex gap-2 justify-center items-center"},Ue=["onClick"],ze=["onClick"],Ve={class:"space-y-4"},je={class:"w-full flex flex-col"},Oe={class:"flex items-center gap-4"},We={key:0,class:"text-red-500 ml-28"},Me={key:1,class:"text-orange-500 ml-28"},Fe={key:2,class:"text-red-500 ml-28"},Ie={class:"flex justify-center gap-4 w-full mt-6"},$e=["disabled"],Be={key:0},Ge={key:1},Re=["disabled"],Ze={class:"flex items-center gap-3"},qe={class:"flex flex-col"},Je={class:"flex justify-center gap-4 w-full"},Ke=["disabled"],Xe={key:0},He={key:1},Qe=["disabled"],Ye={class:"flex items-center gap-3"},ea={class:"flex justify-center gap-3 w-full"},na={__name:"CategoriaProductos",setup(aa){const u=he(),A=i([]),t=i({id:null,nombre:""}),v=i(!1),f=i(!1),N=i(!1),U=i(typeof window<"u"?window.innerWidth:1024),z=R(()=>U.value<640?{width:"95vw",maxWidth:"380px"}:U.value<768?{width:"400px"}:{width:"450px"}),p=i(!1),h=i(!1),_=i(!1),x=i(!1),y=i(!1),b=i(null),L=i({global:{value:null,matchMode:xe.CONTAINS}}),V=i(10),X=i([5,10,20,50]),k=i("Guardar"),H=R(()=>{let s=A.value;if(L.value.global.value){const e=L.value.global.value.toLowerCase();s=s.filter(l=>l.nombre.toLowerCase().includes(e))}return s});me([t],()=>{b.value&&p.value&&O(()=>{const s={...t.value},e=JSON.stringify(s)!==JSON.stringify(b.value),l=!b.value.id,c=t.value.nombre;y.value=e||l&&c})},{deep:!0,flush:"post"});function T(){t.value={id:null,nombre:""},x.value=!1}const I=()=>{typeof window<"u"&&(U.value=window.innerWidth)},Q=()=>{N.value=!0};ve(()=>{Y(),typeof window<"u"&&window.addEventListener("resize",I)}),ge(()=>{typeof window<"u"&&window.removeEventListener("resize",I)});const $=async()=>{try{const s=await P.get("/api/categorias-productos");A.value=(s.data.data||s.data||[]).map(e=>({...e,categoria_id:e.id})).sort((e,l)=>new Date(l.created_at)-new Date(e.created_at))}catch{u.add({severity:"error",summary:"Error",detail:"No se pudieron cargar las categorÃ­as de productos.",life:4e3})}},Y=async()=>{u.add({severity:"info",summary:"Cargando categorÃ­as...",life:2e3});try{const s=await P.get("/api/categorias-productos");A.value=(s.data.data||s.data||[]).map(e=>({...e,categoria_id:e.id})).sort((e,l)=>new Date(l.created_at)-new Date(e.created_at)),u.add({severity:"success",summary:"CategorÃ­as cargadas",life:2e3})}catch{u.add({severity:"error",summary:"Error",detail:"No se pudieron cargar las categorÃ­as de productos.",life:4e3})}},ee=()=>{T(),k.value="Guardar",x.value=!1,p.value=!0,O(()=>{b.value={...t.value},y.value=!1})},ae=s=>{T(),x.value=!1,t.value={...s},k.value="Actualizar",p.value=!0,O(()=>{b.value={...t.value},y.value=!1})},te=async()=>{var s,e;if(x.value=!0,v.value=!0,!t.value.nombre||t.value.nombre.length<3||t.value.nombre.length>50){u.add({severity:"warn",summary:"Campos requeridos",detail:"El nombre debe tener entre 3 y 50 caracteres.",life:4e3}),v.value=!1;return}try{t.value.id?(await P.put(`/api/categorias-productos/${t.value.id}`,{nombre:t.value.nombre}),u.add({severity:"success",summary:"Â¡Ã‰xito!",detail:"La categorÃ­a ha sido actualizada correctamente.",life:5e3})):(await P.post("/api/categorias-productos",{nombre:t.value.nombre}),u.add({severity:"success",summary:"Â¡Ã‰xito!",detail:"La categorÃ­a ha sido creada correctamente.",life:5e3})),await $(),p.value=!1,y.value=!1,b.value=null,T()}catch(l){console.error("Error al procesar categorÃ­a:",l),u.add({severity:"error",summary:"Error",detail:((e=(s=l.response)==null?void 0:s.data)==null?void 0:e.message)||"Error al procesar la categorÃ­a",life:3e3})}finally{v.value=!1}},se=s=>{t.value={...s},h.value=!0},oe=async()=>{var s,e;f.value=!0;try{await P.delete(`/api/categorias-productos/${t.value.id}`),await $(),h.value=!1,u.add({severity:"success",summary:"Â¡Eliminada!",detail:"La categorÃ­a ha sido eliminada correctamente.",life:5e3})}catch(l){h.value=!1;const c=((e=(s=l.response)==null?void 0:s.data)==null?void 0:e.message)||l.message||"Error desconocido al eliminar la categorÃ­a";u.add({severity:"error",summary:"Error",detail:c,life:6e3})}finally{f.value=!1}},le=()=>{y.value?_.value=!0:B()},B=()=>{p.value=!1,_.value=!1,y.value=!1,b.value=null,T()},re=()=>{_.value=!1},ne=()=>{t.value.nombre&&t.value.nombre.length>50&&(t.value.nombre=t.value.nombre.substring(0,50))},ie=s=>{const e=s.target.value,l=e.match(/[^a-zA-ZÃ¡Ã©Ã­Ã³ÃºÃÃ‰ÃÃ“ÃšÃ±Ã‘\s]/g);l&&l.length>0&&u.add({severity:"warn",summary:"Caracteres no permitidos",detail:"Solo se permiten letras, espacios y acentos. Se han removido los caracteres no vÃ¡lidos.",life:3e3});const c=e.replace(/[^a-zA-ZÃ¡Ã©Ã­Ã³ÃºÃÃ‰ÃÃ“ÃšÃ±Ã‘\s]/g,"").toLocaleUpperCase("es-ES");s.target.value=c,t.value.nombre=c,ne()},de=s=>{s.preventDefault();const e=(s.clipboardData||window.clipboardData).getData("text"),l=e.replace(/[^a-zA-ZÃ¡Ã©Ã­Ã³ÃºÃÃ‰ÃÃ“ÃšÃ±Ã‘\s]/g,"").replace(/\s+/g," ").trim().toLocaleUpperCase("es-ES");l!==e.toLocaleUpperCase("es-ES")&&u.add({severity:"info",summary:"Texto limpiado",detail:"Se han removido nÃºmeros y caracteres especiales del texto pegado y convertido a mayÃºsculas.",life:3e3});const c=l.length>50?l.substring(0,50):l;t.value.nombre=c,s.target.value=c};return(s,e)=>{const l=E("Toast"),c=E("InputText"),G=E("Column"),ue=E("DataTable"),j=E("Dialog");return g(),fe(we,null,{default:d(()=>[r(o(pe),{title:"Control de CategorÃ­as de Productos"}),r(l,{class:"z-[9999]"}),a("div",Pe,[e[21]||(e[21]=a("div",{class:"mb-6"},[a("h1",{class:"text-3xl font-bold text-blue-600 mb-2"},"Control de CategorÃ­as"),a("p",{class:"text-gray-600"},"GestiÃ³n de categorÃ­as de productos")],-1)),a("div",Ee,[a("div",De,[a("div",Ne,[r(o(be),{href:s.route("productos"),onClick:Q,class:D([{"opacity-50 cursor-not-allowed":N.value},"flex items-center text-blue-600 hover:text-blue-700 transition-colors duration-200 px-3 py-2 rounded-lg"]),title:"Regresar a Productos"},{default:d(()=>[r(o(m),{icon:N.value?o(F):o(ye),class:D({"animate-spin":N.value,"h-5 w-5":!0})},null,8,["icon","class"])]),_:1},8,["href","class"]),e[7]||(e[7]=a("h3",{class:"text-2xl sm:text-3xl text-blue-600 font-bold text-center sm:text-start"},"Lista de CategorÃ­as",-1))]),a("div",Le,[a("button",{class:"bg-red-500 border border-red-500 p-2 text-sm text-white shadow-md hover:shadow-lg rounded-md hover:-translate-y-1 transition-transform duration-300 flex items-center gap-2",onClick:ee},[r(o(m),{icon:o(Ce),class:"h-4 w-4"},null,8,["icon"]),e[8]||(e[8]=a("span",null,"Agregar categorÃ­a",-1))])])]),r(ue,{value:H.value,dataKey:"id",paginator:!0,rows:V.value,rowsPerPageOptions:X.value,rowsPerPage:V.value,"onUpdate:rowsPerPage":e[1]||(e[1]=n=>V.value=n),paginatorTemplate:"RowsPerPageDropdown FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink",currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} categorÃ­as",class:"overflow-x-auto max-w-full",responsiveLayout:"scroll"},{header:d(()=>[a("div",Te,[r(c,{modelValue:L.value.global.value,"onUpdate:modelValue":e[0]||(e[0]=n=>L.value.global.value=n),placeholder:"ðŸ” Buscar categorÃ­as...",class:"w-full h-9 text-sm rounded-md",style:{"background-color":"white","border-color":"#93c5fd"}},null,8,["modelValue"])])]),default:d(()=>[r(G,{field:"nombre",header:"Nombre",sortable:"",class:"w-96 min-w-52"},{body:d(n=>[a("div",Se,C(n.data.nombre),1)]),_:1}),r(G,{exportable:!1,class:"w-52 min-w-28"},{header:d(()=>e[9]||(e[9]=[a("div",{class:"text-center w-full font-bold"}," Acciones ",-1)])),body:d(n=>[a("div",Ae,[a("button",{class:"flex bg-blue-500 border p-1 py-2 sm:p-2 text-sm shadow-md hover:shadow-lg rounded-md hover:-translate-y-1 transition-transform duration-300",onClick:ce=>ae(n.data)},[r(o(m),{icon:o(Z),class:"h-3 w-6 sm:h-4 sm:w-7 text-white"},null,8,["icon"]),e[10]||(e[10]=a("span",{class:"hidden md:block text-white"},"Editar",-1))],8,Ue),a("button",{class:"flex bg-red-500 border p-1 py-2 sm:p-2 text-sm shadow-md hover:shadow-lg rounded-md hover:-translate-y-1 transition-transform duration-300",onClick:ce=>se(n.data)},[r(o(m),{icon:o(_e),class:"h-3 w-6 sm:h-4 sm:w-7 text-white"},null,8,["icon"]),e[11]||(e[11]=a("span",{class:"hidden md:block text-white"},"Eliminar",-1))],8,ze)])]),_:1})]),_:1},8,["value","rows","rowsPerPageOptions","rowsPerPage"]),r(j,{visible:p.value,"onUpdate:visible":e[3]||(e[3]=n=>p.value=n),header:k.value+" CategorÃ­a",modal:!0,style:W(z.value),closable:!1,draggable:!1},{footer:d(()=>[a("div",Ie,[a("button",{class:"bg-red-500 hover:bg-red-700 text-white border-none px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",onClick:te,disabled:v.value},[r(o(m),{icon:v.value?o(F):o(q),class:D(["h-5 text-white",{"animate-spin":v.value}])},null,8,["icon","class"]),v.value?(g(),w("span",Ge,C(k.value==="Guardar"?"Guardando...":"Actualizando..."),1)):(g(),w("span",Be,C(k.value),1))],8,$e),a("button",{type:"button",class:"bg-blue-500 hover:bg-blue-700 text-white px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",onClick:le,disabled:v.value},[r(o(m),{icon:o(J),class:"h-5"},null,8,["icon"]),e[13]||(e[13]=S("Cancelar "))],8,Re)])]),default:d(()=>[a("div",Ve,[a("div",je,[a("div",Oe,[e[12]||(e[12]=a("label",{for:"nombre",class:"w-24 flex items-center gap-1"},[S(" Nombre: "),a("span",{class:"text-red-500 font-bold"},"*")],-1)),r(c,{modelValue:t.value.nombre,"onUpdate:modelValue":e[2]||(e[2]=n=>t.value.nombre=n),modelModifiers:{trim:!0},id:"nombre",name:"nombre",maxlength:50,class:D([{"p-invalid":x.value&&(!t.value.nombre||t.value.nombre.length<3||t.value.nombre.length>50)},"flex-1 border-2 border-gray-400 hover:border-gray-500 focus:border-gray-500 focus:ring-0 focus:shadow-none rounded-md"]),onInput:ie,onPaste:de,placeholder:"Nombre de la categorÃ­a"},null,8,["modelValue","class"])]),t.value.nombre&&t.value.nombre.length<3?(g(),w("small",We," El nombre debe tener al menos 3 caracteres. Actual: "+C(t.value.nombre.length)+"/3 ",1)):M("",!0),t.value.nombre&&t.value.nombre.length>=45&&t.value.nombre.length<=50?(g(),w("small",Me," Caracteres restantes: "+C(50-t.value.nombre.length),1)):M("",!0),x.value&&!t.value.nombre?(g(),w("small",Fe," El nombre es obligatorio. ")):M("",!0)])])]),_:1},8,["visible","header","style"]),r(j,{visible:h.value,"onUpdate:visible":e[5]||(e[5]=n=>h.value=n),header:"Eliminar categorÃ­a",modal:!0,style:W(z.value),closable:!1,draggable:!1},{footer:d(()=>[a("div",Je,[a("button",{type:"button",class:"bg-red-500 hover:bg-red-700 text-white border-none px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",onClick:oe,disabled:f.value},[r(o(m),{icon:f.value?o(F):o(q),class:D(["h-5",{"animate-spin":f.value}])},null,8,["icon","class"]),f.value?(g(),w("span",He,"Eliminando...")):(g(),w("span",Xe,"Eliminar"))],8,Ke),a("button",{type:"button",class:"bg-blue-500 hover:bg-blue-700 text-white px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",onClick:e[4]||(e[4]=n=>h.value=!1),disabled:f.value},[r(o(m),{icon:o(J),class:"h-5"},null,8,["icon"]),e[17]||(e[17]=a("span",null,"Cancelar",-1))],8,Qe)])]),default:d(()=>[a("div",Ze,[r(o(m),{icon:o(K),class:"h-8 w-8 text-red-500"},null,8,["icon"]),a("div",qe,[a("span",null,[e[14]||(e[14]=S("Â¿EstÃ¡s seguro de eliminar la categorÃ­a: ")),a("b",null,C(t.value.nombre),1),e[15]||(e[15]=S("?"))]),e[16]||(e[16]=a("span",{class:"text-red-600 text-sm font-medium mt-1"},"Esta acciÃ³n es irreversible.",-1))])])]),_:1},8,["visible","style"]),r(j,{visible:_.value,"onUpdate:visible":e[6]||(e[6]=n=>_.value=n),header:"Cambios sin guardar",modal:!0,style:W(z.value),closable:!1,draggable:!1},{footer:d(()=>[a("div",ea,[a("button",{type:"button",class:"bg-red-500 hover:bg-red-700 text-white border-none px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",onClick:B},[r(o(m),{icon:o(ke),class:"h-4"},null,8,["icon"]),e[19]||(e[19]=a("span",null,"Salir sin guardar",-1))]),a("button",{type:"button",class:"bg-blue-500 hover:bg-blue-700 text-white px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",onClick:re},[r(o(m),{icon:o(Z),class:"h-4"},null,8,["icon"]),e[20]||(e[20]=a("span",null,"Continuar",-1))])])]),default:d(()=>[a("div",Ye,[r(o(m),{icon:o(K),class:"h-8 w-8 text-red-500"},null,8,["icon"]),e[18]||(e[18]=a("div",{class:"flex flex-col"},[a("span",null,"Â¡Tienes informaciÃ³n sin guardar!"),a("span",{class:"text-red-600 text-sm font-medium mt-1"},"Â¿Deseas salir sin guardar?")],-1))])]),_:1},8,["visible","style"])])])]),_:1})}}};export{na as default};
