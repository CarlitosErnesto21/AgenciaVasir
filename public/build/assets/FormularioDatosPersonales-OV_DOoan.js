import{r as v,E as q,o as j,w as g,c as d,d as m,j as y,e as a,q as p,t as c,y as s,v as b,a7 as E,p as P,$ as w,a9 as F}from"./vendor-CaDzpwPW.js";import{z as k}from"./vue-tel-input-AlIeehSu.js";import{q as B}from"./ui-BjYE_i4I.js";const M={class:"space-y-6"},z={key:0,class:"bg-gradient-to-r from-blue-50 to-purple-50 p-4 rounded-lg"},L={class:"text-sm text-gray-600 mb-1"},h={class:"text-sm text-gray-600"},$={key:1,class:"flex items-center justify-between mb-3"},O={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},X=["value","maxlength","disabled","placeholder"],Z=["disabled"],G={class:"grid grid-cols-1 sm:grid-cols-2 gap-4 mt-4"},H=["disabled"],J={class:"grid grid-cols-1 sm:grid-cols-2 gap-4 mt-4"},K={class:"mr-1"},W={class:"sm:col-span-1"},Q=["disabled"],oe={__name:"FormularioDatosPersonales",props:{formulario:{type:Object,required:!0},tieneClienteExistente:{type:Boolean,default:!1},user:{type:Object,default:null}},emits:["update:formulario","mostrar-toast"],setup(i,{expose:D,emit:N}){const u=i,n=N,V=v([{id:"DUI",nombre:"DUI"},{id:"PASAPORTE",nombre:"PASAPORTE"}]);v(!1);const r=v({isValid:!1,country:null,formattedNumber:"",mensaje:""}),o=q({get(){return u.formulario},set(t){n("update:formulario",t)}}),A=async t=>{try{t&&typeof t=="object"&&(r.value.isValid=t.valid===!0,r.value.country={name:t.country,code:t.countryCode},r.value.formattedNumber=t.formatted||"",t.valid===!0&&t.formatted&&(o.value.telefono=t.formatted),u.tieneClienteExistente?t.valid===!0?r.value.mensaje="Número válido (guardado previamente)":o.value.telefono&&t.valid===!1?r.value.mensaje="Número de teléfono inválido para "+t.country:r.value.mensaje="":o.value.telefono&&t.valid===!1?r.value.mensaje="Número de teléfono inválido para "+t.country:t.valid===!0?await I(o.value.telefono):r.value.mensaje="")}catch(e){console.error("[FormularioDatosPersonales] Error en validación:",e),r.value.mensaje="Error en validación"}},I=async t=>{var e,l;if(!(!t||t.length<8))try{const C=await(await fetch("/api/clientes/validar-telefono",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")||""}`,"X-CSRF-TOKEN":((e=document.querySelector('meta[name="csrf-token"]'))==null?void 0:e.getAttribute("content"))||"","X-Requested-With":"XMLHttpRequest"},credentials:"same-origin",body:JSON.stringify({telefono:t})})).json();C.disponible?r.value.mensaje="Número válido para "+((l=r.value.country)==null?void 0:l.name):(r.value.isValid=!1,r.value.mensaje=C.message||"Este teléfono ya está registrado")}catch(x){console.error("[FormularioDatosPersonales] Error validando teléfono:",x),r.value.mensaje="Error al validar teléfono"}},S=()=>{const t=new Date;return t.setDate(t.getDate()-1),t};D({tiposDocumentos:V,validateForm:()=>o.value.tipo_documento?o.value.numero_identificacion?f()?o.value.fecha_nacimiento?o.value.direccion?o.value.genero?o.value.telefono?o.value.telefono&&r.value.isValid===!1&&r.value.mensaje!=="Número válido (guardado previamente)"?(r.value.mensaje&&(r.value.mensaje.includes("registrado")||r.value.mensaje.includes("diferente"))?n("mostrar-toast",{severity:"warn",summary:"Teléfono ya registrado",detail:r.value.mensaje,life:5e3}):n("mostrar-toast",{severity:"error",summary:"Teléfono inválido",detail:"Por favor, ingrese un número de teléfono válido.",life:4e3}),!1):!0:(n("mostrar-toast",{severity:"error",summary:"Campo requerido",detail:"Por favor, ingrese su número de teléfono.",life:4e3}),!1):(n("mostrar-toast",{severity:"error",summary:"Campo requerido",detail:"Por favor, seleccione su género.",life:4e3}),!1):(n("mostrar-toast",{severity:"error",summary:"Campo requerido",detail:"Por favor, ingrese su dirección.",life:4e3}),!1):(n("mostrar-toast",{severity:"error",summary:"Campo requerido",detail:"Por favor, seleccione su fecha de nacimiento.",life:4e3}),!1):!1:(n("mostrar-toast",{severity:"error",summary:"Campo requerido",detail:"Por favor, ingrese su número de identificación.",life:4e3}),!1):(n("mostrar-toast",{severity:"error",summary:"Campo requerido",detail:"Por favor, seleccione un tipo de documento.",life:4e3}),!1)});const U=t=>{const l=t.replace(/[^0-9]/g,"").substring(0,9);return l.length>8?l.substring(0,8)+"-"+l.substring(8):l},R=t=>t.toUpperCase().replace(/[^A-Z0-9]/g,"").substring(0,9),T=t=>{const e=t.target.value;let l="";o.value.tipo_documento==="DUI"?(l=U(e),o.value.numero_identificacion=l,t.target.value=l):o.value.tipo_documento==="PASAPORTE"&&(l=R(e),o.value.numero_identificacion=l,t.target.value=l),f()},f=()=>{if(!o.value.numero_identificacion)return!0;if(o.value.tipo_documento==="DUI"){if(!/^\d{8}-\d{1}$/.test(o.value.numero_identificacion))return n("mostrar-toast",{severity:"error",summary:"Formato incorrecto",detail:"El DUI debe tener 9 dígitos (formato: 12345678-9)",life:4e3}),!1}else if(o.value.tipo_documento==="PASAPORTE"&&!/^[A-Z0-9]{6,9}$/.test(o.value.numero_identificacion))return n("mostrar-toast",{severity:"error",summary:"Formato incorrecto",detail:"El PASAPORTE debe tener entre 6 y 9 caracteres (solo letras mayúsculas y números)",life:4e3}),!1;return!0};return j(()=>{}),g(()=>o.value.numero_identificacion,()=>{o.value.numero_identificacion&&o.value.tipo_documento&&f()}),g(()=>o.value.tipo_documento,()=>{o.value.numero_identificacion=""}),g(()=>u.formulario.telefono,(t,e)=>{t&&t!==e&&u.tieneClienteExistente&&(r.value={isValid:!0,country:{name:"Válido",code:""},formattedNumber:t,mensaje:"Número válido (guardado previamente)"})},{immediate:!0}),(t,e)=>(m(),d("div",M,[i.user?(m(),d("div",z,[e[7]||(e[7]=a("h3",{class:"font-bold text-lg text-gray-800 mb-2"},"Información de tu cuenta:",-1)),a("p",L,[e[5]||(e[5]=a("strong",null,"Nombre:",-1)),p(" "+c(i.user.name),1)]),a("p",h,[e[6]||(e[6]=a("strong",null,"Email:",-1)),p(" "+c(i.user.email),1)])])):y("",!0),i.tieneClienteExistente?(m(),d("div",$,e[8]||(e[8]=[a("h4",{class:"font-semibold text-gray-800"},"Información Personal",-1),a("div",{class:"flex items-center text-green-600 text-sm"},[a("svg",{class:"w-4 h-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20"},[a("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})]),a("span",null,"Datos precargados")],-1)]))):y("",!0),a("div",O,[a("div",null,[e[9]||(e[9]=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Número de Identificación",-1)),a("input",{value:o.value.numero_identificacion,onInput:T,type:"text",required:"",maxlength:o.value.tipo_documento==="DUI"?10:9,disabled:i.tieneClienteExistente,class:s(["w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",{"bg-gray-100 cursor-not-allowed":i.tieneClienteExistente}]),placeholder:o.value.tipo_documento==="DUI"?"Ingrese 9 dígitos (ej: 123456789)":"Ingrese su PASAPORTE (ej: A1B2C3D4)"},null,42,X)]),a("div",null,[e[11]||(e[11]=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Tipo de Documento",-1)),b(a("select",{"onUpdate:modelValue":e[0]||(e[0]=l=>o.value.tipo_documento=l),required:"",disabled:i.tieneClienteExistente,class:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100"},e[10]||(e[10]=[a("option",{value:"",disabled:""},"Seleccione un tipo",-1),a("option",{value:"DUI"},"DUI",-1),a("option",{value:"PASAPORTE"},"PASAPORTE",-1)]),8,Z),[[E,o.value.tipo_documento]])])]),a("div",G,[a("div",null,[e[12]||(e[12]=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Fecha de Nacimiento",-1)),P(w(B),{modelValue:o.value.fecha_nacimiento,"onUpdate:modelValue":e[1]||(e[1]=l=>o.value.fecha_nacimiento=l),maxDate:S(),"date-format":"dd/mm/yy",placeholder:"Seleccionar fecha de nacimiento",showIcon:"",yearNavigator:"",yearRange:"1920:2010",disabled:i.tieneClienteExistente,class:"w-full",inputClass:`w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 ${i.tieneClienteExistente?"bg-gray-100 cursor-not-allowed":""}`},null,8,["modelValue","maxDate","disabled","inputClass"])]),a("div",null,[e[14]||(e[14]=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Género",-1)),b(a("select",{"onUpdate:modelValue":e[2]||(e[2]=l=>o.value.genero=l),required:"",disabled:i.tieneClienteExistente,class:s(["w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",{"bg-gray-100 cursor-not-allowed":i.tieneClienteExistente}])},e[13]||(e[13]=[a("option",{value:""},"Seleccione",-1),a("option",{value:"MASCULINO"},"Masculino",-1),a("option",{value:"FEMENINO"},"Femenino",-1)]),10,H),[[E,o.value.genero]])])]),a("div",J,[a("div",null,[e[15]||(e[15]=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Teléfono",-1)),P(w(k),{modelValue:o.value.telefono,"onUpdate:modelValue":e[3]||(e[3]=l=>o.value.telefono=l),defaultCountry:"SV",preferredCountries:["SV","GT","HN","CR","NI","PA","BZ"],validCharactersOnly:!0,disabled:i.tieneClienteExistente,dropdownOptions:{showDialCodeInSelection:!0,showFlags:!0,showSearchBox:!0,showDialCodeInList:!0},inputOptions:{placeholder:"Número de teléfono"},mode:"international",class:s(["w-full border border-gray-300 rounded-lg",{"bg-gray-100 cursor-not-allowed":i.tieneClienteExistente}]),onValidate:A},null,8,["modelValue","disabled","class"]),r.value.mensaje?(m(),d("p",{key:0,class:s(["text-xs mt-1 flex items-center",r.value.isValid?"text-green-600":"text-red-600"])},[a("span",K,c(r.value.isValid?"✓":"⚠️"),1),p(" "+c(r.value.mensaje),1)],2)):y("",!0)]),a("div",W,[e[16]||(e[16]=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Dirección",-1)),b(a("input",{"onUpdate:modelValue":e[4]||(e[4]=l=>o.value.direccion=l),type:"text",required:"",maxlength:"200",disabled:i.tieneClienteExistente,class:s(["w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",{"bg-gray-100 cursor-not-allowed":i.tieneClienteExistente}]),placeholder:"Dirección completa"},null,10,Q),[[F,o.value.direccion]])])])]))}};export{oe as default};
