import{r as u,E as _,w as me,o as Je,a5 as Ke,a6 as Qe,h as ve,d as h,x as y,p as n,e as s,$ as r,a0 as ea,A as pe,t as m,a2 as aa,y as E,c as C,j as A,q as j,v as Re,a9 as De,N as O,n as sa}from"./vendor-gbh1WW5n.js";import{A as ta}from"./AuthenticatedLayout-BLpeBUyv.js";import{z as ra,D as la,a as oa,r as na,F as p,h as ia,q as te,o as da,e as ua,f as V,g as _e}from"./ui-BrU4k96Z.js";import{c as re,e as N,g as ca,A as G,C as le,D as Ne,m as fe,k as ma,p as va,E as Te,F as pa,l as fa,x as ga}from"./index-qi39o-TK.js";import ba from"./Modales-D4vbctLL.js";import xa from"./CambiarEstado-C3JELAs6.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-DtyEsSN9.js";const ya={class:"flex items-center gap-3"},ha={class:"flex flex-col"},wa={class:"text-red-600 text-sm font-medium mt-1"},Aa={class:"container mx-auto px-4 py-6"},Ea={class:"mb-6"},Ca={class:"bg-white rounded-lg shadow-md"},Ra={key:0,class:"p-6 border-b border-gray-200"},Da={class:"text-lg font-semibold text-blue-600 mb-2",style:{"word-break":"break-all","overflow-wrap":"break-word","max-width":"100%","white-space":"pre-wrap"}},_a={class:"mb-4 space-y-2"},Na={class:"text-sm text-blue-600 flex items-center gap-2"},Ta={key:0,class:"text-sm text-amber-600 flex items-center gap-2 bg-amber-50 p-2 rounded-md"},Sa={key:1,class:"text-sm text-blue-600 flex items-center gap-2 bg-blue-50 p-3 rounded-md border border-blue-200"},Oa={key:2,class:"text-sm text-purple-600 flex items-center gap-2 bg-purple-50 p-3 rounded-md border border-purple-200"},Ia={key:3,class:"text-sm text-gray-600 flex items-center gap-2 bg-gray-50 p-2 rounded-md"},La={class:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:flex lg:flex-wrap gap-2 md:gap-3"},Ma={class:"bg-gray-100 border-2 border-gray-300 rounded-lg px-2 py-2 md:px-4 md:py-3 flex-1 min-w-0"},ka={class:"text-xs md:text-sm font-bold text-gray-800"},Pa={class:"flex items-center gap-2 text-white"},Fa={class:"flex items-center gap-2 text-white"},Va={class:"flex items-center gap-2 text-white"},$a=["title"],za={class:"flex items-center gap-2 text-white"},Ua={class:"flex-1"},qa={key:0,class:"text-xs opacity-70"},Ha={class:"bg-blue-50 p-3 rounded-lg shadow-sm border mb-4 mx-4"},ja={class:"flex flex-wrap items-center justify-between gap-2 mb-3"},Ga={class:"flex items-center gap-2 flex-wrap"},Ba={class:"bg-blue-50 border border-blue-200 text-blue-700 px-2 py-1 rounded text-xs font-medium"},Za=["disabled"],Wa={class:"space-y-3"},Xa={class:"relative"},Ya={class:"grid grid-cols-1 md:grid-cols-3 gap-3"},Ja={class:"px-1 mt-3"},Ka={class:"text-blue-600 text-xs font-medium flex items-center gap-1"},Qa={class:"text-center py-12"},es={class:"font-medium text-xs sm:text-sm"},as={class:"flex items-center gap-1 sm:gap-3"},ss={class:"w-6 h-6 sm:w-8 sm:h-8 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0"},ts={class:"min-w-0 flex-1"},rs=["title"],ls=["title"],os={class:"text-xs sm:text-sm"},ns={class:"font-medium"},is={class:"text-xs text-gray-500"},ds={class:"font-medium text-green-600 text-xs sm:text-sm"},us={class:"hidden xl:inline"},cs={class:"xl:hidden"},ms=["onClick"],vs={class:"space-y-4"},ps={class:"bg-orange-50 p-4 rounded-lg border border-orange-200 mb-4"},fs={class:"flex items-start gap-3"},gs={class:"bg-red-50 p-4 rounded-lg border border-red-200"},bs={class:"flex items-center gap-2 mb-2"},xs={class:"font-semibold text-red-800"},ys={class:"text-xs text-red-600 mt-2"},hs={class:"text-gray-500"},ws={class:"flex justify-end gap-3 pt-4"},As=["disabled"],Es={class:"space-y-4"},Cs={class:"bg-blue-50 p-4 rounded-lg border border-blue-200"},Rs={class:"font-semibold text-blue-800 mb-2"},Ds={class:"text-sm text-blue-600"},_s={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ns={class:"flex justify-center items-center gap-3 pt-4"},Ts=["disabled"],Ss=["disabled"],zs={__name:"Reservas",setup(Os){const f=ra(),Se=la(),g=u([]),Oe=u([]),ge=u(!1);u(!1);const $=u(null),l=u(null),be=u(!1),B=u(!1),x=u({cambiarEstado:!1}),Z=u(!1),I=u(!1),b=u({fechaSalida:null,fechaRegreso:null,motivo:""}),v=u({busqueda:"",fechaDesde:null,fechaHasta:null,estado:null}),L=u(!1),W=u(!1),z=u(!1),X=u(!1),Y=u(null),oe=u(null),Ie=u(""),D=u("");u(null),u(""),u("");const xe=u(typeof window<"u"?window.innerWidth:1024),U=u(!1),ne=u(!1),ie=u(!1),de=u(!1),T=u(!1),J=[{label:"Pendiente",value:"PENDIENTE",severity:"warn",color:"bg-yellow-100 text-yellow-800",icon:pa},{label:"Confirmada",value:"CONFIRMADA",severity:"success",color:"bg-green-100 text-green-800",icon:fa},{label:"En Curso",value:"EN_CURSO",severity:"info",color:"bg-blue-100 text-blue-800",icon:le},{label:"Finalizada",value:"FINALIZADA",severity:"secondary",color:"bg-gray-100 text-gray-800",icon:Ne},{label:"Rechazada",value:"CANCELADA",severity:"danger",color:"bg-red-100 text-red-800",icon:fe},{label:"Reprogramada",value:"REPROGRAMADA",severity:"info",color:"bg-purple-100 text-purple-800",icon:le}],ye=[{label:"Disponible",value:"DISPONIBLE",color:"bg-green-100 text-green-800"},{label:"Completo",value:"COMPLETO",color:"bg-orange-100 text-orange-800"},{label:"En Curso",value:"EN_CURSO",color:"bg-blue-100 text-blue-800"},{label:"Finalizado",value:"FINALIZADO",color:"bg-gray-100 text-gray-800"},{label:"Cancelada",value:"CANCELADA",color:"bg-red-100 text-red-800"},{label:"Reprogramada",value:"REPROGRAMADA",color:"bg-purple-100 text-purple-800"}],M=_(()=>{if(!l.value)return!1;const t=q.value.filter(a=>["CONFIRMADA","REPROGRAMADA"].includes(a.estado)).reduce((a,o)=>{const d=o.mayores_edad||0,i=o.menores_edad||0;return a+d+i},0),e=l.value.cupo_min||0;return t>=e}),k=_(()=>!l.value||!g.value?!1:g.value.some(t=>["PENDIENTE","CONFIRMADA","EN_CURSO","REPROGRAMADA"].includes(t.estado))),K=_(()=>{if(!l.value||!g.value||g.value.length===0)return!1;const t=g.value.some(a=>a.estado==="PENDIENTE"),e=g.value.some(a=>a.estado==="CONFIRMADA");return!t&&e}),ue=_(()=>!l.value||!g.value||g.value.length===0?!1:l.value.estado==="REPROGRAMADA"?!g.value.some(e=>e.estado==="PENDIENTE")&&M.value:l.value.estado==="DISPONIBLE"?M.value:l.value.estado==="COMPLETO"?K.value&&M.value:!1),q=_(()=>{let t=g.value;if(v.value.busqueda){const a=v.value.busqueda.toLowerCase();t=t.filter(o=>{var d,i,c,w,R,S;return(((i=(d=o.cliente)==null?void 0:d.user)==null?void 0:i.name)||((c=o.cliente)==null?void 0:c.nombres)||"").toLowerCase().includes(a)||(((R=(w=o.cliente)==null?void 0:w.user)==null?void 0:R.email)||((S=o.cliente)==null?void 0:S.correo)||"").toLowerCase().includes(a)})}return v.value.fechaDesde&&(t=t.filter(a=>new Date(a.fecha_reserva)>=new Date(v.value.fechaDesde))),v.value.fechaHasta&&(t=t.filter(a=>new Date(a.fecha_reserva)<=new Date(v.value.fechaHasta))),v.value.estado&&(t=t.filter(a=>a.estado===v.value.estado)),t.sort((a,o)=>{const d={PENDIENTE:1,CONFIRMADA:2,EN_CURSO:3,REPROGRAMADA:4,COMPLETADA:5,SUSPENDIDA:6,CANCELADA:7},i=d[a.estado]||6,c=d[o.estado]||6;return i!==c?i-c:new Date(o.fecha_reserva)-new Date(a.fecha_reserva)})});_(()=>({pendientes:g.value.filter(t=>t.estado==="PENDIENTE").length,confirmadas:g.value.filter(t=>t.estado==="CONFIRMADA").length}));const Le=async t=>{be.value=!0;try{const e=await O.get(`/api/tours/${t}`);l.value=e.data}catch(e){console.error("Error cargando tour:",e),f.add({severity:"error",summary:"Error",detail:"No se pudo cargar la informaci√≥n del tour",life:4e3})}finally{be.value=!1}},Me=()=>new URLSearchParams(window.location.search).get("tour"),Q=async t=>{if(!l.value)return;if(t==="REPROGRAMADA"){P(),b.value={fechaSalida:l.value.fecha_salida?new Date(l.value.fecha_salida):null,fechaRegreso:l.value.fecha_regreso?new Date(l.value.fecha_regreso):null,motivo:""},I.value=!0;return}if(t==="CANCELADA"){$e();return}const a={EN_CURSO:{header:"Cambio de Estado del Tour",message:"¬°Tienes un cambio de estado pendiente!",detail:'¬øDeseas marcar este tour como "En Curso"?'},FINALIZADO:{header:"Finalizar Tour",message:"¬°Tienes un cambio de estado pendiente!",detail:"¬øDeseas finalizar este tour permanentemente?"}}[t];a&&Se.require({message:{header:a.message,content:a.detail},header:a.header,icon:"pi pi-exclamation-triangle",position:"center",rejectClass:"bg-blue-500 hover:bg-blue-700 text-white border-none px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",acceptClass:"bg-red-500 hover:bg-red-700 text-white border-none px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2 ml-3",rejectLabel:"‚úì Continuar",acceptLabel:"‚úï Cancelar",accept:()=>{},reject:async()=>{await ke(t)}})},ke=async t=>{var e,a,o,d;x.value.cambiarEstado=!0;try{const i=await O.put(`/api/tours/${l.value.id}/cambiar-estado`,{estado:t});l.value.estado=t,f.add({severity:"success",summary:"Estado actualizado",detail:`El tour ahora est√° ${t.toLowerCase()}`,life:3e3}),await F()}catch(i){console.error("Error actualizando estado:",i),console.error("Respuesta del servidor:",(e=i.response)==null?void 0:e.data),((a=i.response)==null?void 0:a.status)===422?f.add({severity:"warn",summary:"Validaci√≥n fallida",detail:i.response.data.message||"No se pudo actualizar el estado",life:8e3}):f.add({severity:"error",summary:"Error",detail:((d=(o=i.response)==null?void 0:o.data)==null?void 0:d.message)||"No se pudo actualizar el estado",life:4e3})}finally{x.value.cambiarEstado=!1}},Pe=async t=>{l.value=t,Z.value=!1;const e={CANCELADA:{severity:"warn",summary:"Tour cancelado",detail:`El tour ha sido cancelado. Se enviaron notificaciones de cancelaci√≥n a ${t.reservas_canceladas||0} cliente(s) con reservas.`},FINALIZADO:{severity:"success",summary:"Tour finalizado",detail:`El tour ha sido finalizado correctamente. Se enviaron notificaciones a ${t.reservas_finalizadas||0} cliente(s).`},default:{severity:"success",summary:"Estado actualizado",detail:"El estado del tour se ha actualizado correctamente"}},a=e[t.estado]||e.default;f.add({severity:a.severity,summary:a.summary,detail:a.detail,life:5e3}),await F()},ce=()=>{document.body.style.overflow="",document.body.style.paddingRight=""},P=()=>{L.value=!1,W.value=!1,z.value=!1,X.value=!1,Z.value=!1,I.value=!1,Y.value=null,oe.value=null,Ie.value="",D.value="",T.value=!1,ce()},Fe=async()=>{var e,a;if(!b.value.fechaSalida||!b.value.fechaRegreso){f.add({severity:"warn",summary:"Campos requeridos",detail:"Debe seleccionar las nuevas fechas de salida y regreso",life:4e3});return}if(!b.value.motivo.trim()){f.add({severity:"warn",summary:"Motivo requerido",detail:"Debe ingresar un motivo para la reprogramaci√≥n",life:4e3});return}if((b.value.fechaRegreso-b.value.fechaSalida)/(1e3*60*60)<1){f.add({severity:"warn",summary:"Fechas inv√°lidas",detail:"La fecha y hora de regreso debe ser al menos 1 hora despu√©s de la salida",life:4e3});return}x.value.cambiarEstado=!0;try{const o=c=>{if(c instanceof Date){const w=c.getFullYear(),R=String(c.getMonth()+1).padStart(2,"0"),S=String(c.getDate()).padStart(2,"0"),ee=String(c.getHours()).padStart(2,"0"),ae=String(c.getMinutes()).padStart(2,"0"),se=String(c.getSeconds()).padStart(2,"0");return`${w}-${R}-${S} ${ee}:${ae}:${se}`}return c},d=await O.put(`/api/tours/${l.value.id}/cambiar-estado`,{estado:"REPROGRAMADA",fecha_salida:o(b.value.fechaSalida),fecha_regreso:o(b.value.fechaRegreso),motivo_reprogramacion:b.value.motivo,reprogramar_reservas:!0});l.value={...l.value,...d.data},P();const i=d.data.reservas_reprogramadas||0;f.add({severity:"success",summary:"Tour y reservas reprogramados",detail:`El tour ha sido reprogramado correctamente. ${i} reserva(s) fueron reprogramada(s) y se enviaron notificaciones por correo.`,life:5e3}),await F()}catch(o){console.error("Error reprogramando tour:",o),f.add({severity:"error",summary:"Error",detail:((a=(e=o.response)==null?void 0:e.data)==null?void 0:a.message)||"No se pudo reprogramar el tour",life:4e3})}finally{x.value.cambiarEstado=!1}},Ve=()=>{B.value=!0},H=_(()=>xe.value<640?{width:"95vw",maxWidth:"380px"}:xe.value<768?{width:"400px"}:{width:"450px"}),F=async()=>{if($.value){ge.value=!0;try{const t={busqueda:v.value.busqueda||void 0,fecha_inicio:v.value.fechaDesde||void 0,fecha_fin:v.value.fechaHasta||void 0,tour_id:$.value},e=await O.get("/api/reservas",{params:t,withCredentials:!0});g.value=Array.isArray(e.data)?e.data:e.data.data||[]}catch(t){console.error("Error cargando reservas:",t),f.add({severity:"error",summary:"Error",detail:"No se pudieron cargar las reservas del tour",life:4e3}),g.value=[]}finally{ge.value=!1}}},$e=()=>{P(),D.value="",z.value=!0},ze=async()=>{var t,e;if(!D.value.trim()){f.add({severity:"warn",summary:"Campo requerido",detail:"Debe ingresar un motivo para cancelar el tour",life:4e3});return}T.value=!0;try{const a=await O.put(`/api/tours/${l.value.id}/cambiar-estado`,{estado:"CANCELADA",motivo_cancelacion:D.value,cancelar_reservas:!0});l.value.estado="CANCELADA",await F(),P();const o=a.data.reservas_canceladas||0;f.add({severity:"warn",summary:"¬°Tour Cancelado!",detail:`El tour ha sido cancelado. Se cancelaron ${o} reserva(s) y se enviaron notificaciones por correo.`,life:5e3})}catch(a){console.error("Error cancelando tour:",a),f.add({severity:"error",summary:"Error",detail:((e=(t=a.response)==null?void 0:t.data)==null?void 0:e.message)||"No se pudo cancelar el tour",life:4e3})}finally{T.value=!1}},he=t=>{P(),Y.value=t,X.value=!0},Ue=t=>{P(),Y.value=t;const e=Oe.value.find(a=>{var o;return((o=t.detallesTours)==null?void 0:o.some(d=>d.tour_id===a.id))||t.entidad_nombre===a.nombre});oe.value=e,L.value=!0},qe=t=>{t.originalEvent.target.closest("button")||he(t.data)},He=t=>{const e=J.find(a=>a.value===t);return(e==null?void 0:e.color)||"bg-gray-100 text-gray-800"},je=t=>{const e=ye.find(a=>a.value===t);return(e==null?void 0:e.label)||t},Ge=t=>{if(!t)return"N/A";const e=new Date(t);return e.getHours()===0&&e.getMinutes()===0?e.toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"}):e.toLocaleString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})},we=t=>{if(!t)return"N/A";const e=new Date(t);return e.getHours()===0&&e.getMinutes()===0?e.toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"})+" (Sin hora especificada)":e.toLocaleString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})},Be=async()=>{U.value=!0;try{v.value={busqueda:"",fechaDesde:null,fechaHasta:null,estado:null},f.add({severity:"success",summary:"Filtros limpiados",life:1500})}finally{U.value=!1}},Ze=_(()=>{if(b.value.fechaSalida instanceof Date){const t=new Date(b.value.fechaSalida);return t.setHours(t.getHours()+1),t}return new Date}),We=async t=>{var e,a,o,d,i;ie.value=!0;try{await O.put(`/api/reservas/${t.id}/confirmar`);const c=g.value.findIndex(w=>w.id===t.id);c!==-1&&(g.value[c].estado="CONFIRMADA"),L.value=!1,f.add({severity:"success",summary:"¬°Confirmada!",detail:`Reserva de ${((a=(e=t.cliente)==null?void 0:e.user)==null?void 0:a.name)||((o=t.cliente)==null?void 0:o.nombres)} confirmada correctamente`,life:4e3})}catch(c){console.error("Error confirmando reserva:",c),f.add({severity:"error",summary:"Error",detail:((i=(d=c.response)==null?void 0:d.data)==null?void 0:i.message)||"No se pudo confirmar la reserva",life:4e3})}finally{ie.value=!1}},Xe=async t=>{var e,a,o,d,i;de.value=!0,ne.value=!0;try{const c=await O.put(`/api/reservas/${t.reserva.id}/rechazar`,{motivo:t.motivo}),w=g.value.findIndex(R=>R.id===t.reserva.id);w!==-1&&g.value.splice(w,1),W.value=!1,L.value=!1,f.add({severity:"success",summary:"¬°Eliminada!",detail:`Reserva de ${((a=(e=t.reserva.cliente)==null?void 0:e.user)==null?void 0:a.name)||((o=t.reserva.cliente)==null?void 0:o.nombres)} eliminada correctamente`,life:4e3})}catch(c){console.error("Error rechazando reserva:",c),f.add({severity:"error",summary:"Error",detail:((i=(d=c.response)==null?void 0:d.data)==null?void 0:i.message)||"No se pudo rechazar la reserva",life:4e3})}finally{ne.value=!1,de.value=!1}},Ye=t=>{he(t)};me(()=>[v.value.busqueda,v.value.fechaDesde,v.value.fechaHasta,v.value.estado],()=>{clearTimeout(window.searchTimeout),window.searchTimeout=setTimeout(()=>{F()},500)},{deep:!0}),me(I,t=>{t?(document.body.style.overflow="hidden",document.body.style.paddingRight="15px"):(document.body.style.overflow="",document.body.style.paddingRight="")});const Ae=()=>{sa(()=>{setTimeout(()=>{document.querySelectorAll(".p-select").forEach(e=>{const a=e.querySelector(".p-select-label, .p-placeholder");a&&(a.style.overflow="hidden",a.style.textOverflow="ellipsis",a.style.whiteSpace="nowrap",a.style.maxWidth="calc(100% - 2.5rem)",a.style.display="block")})},100)})};return me([v],()=>{Ae()},{deep:!0}),Je(async()=>{try{if($.value=Me(),!$.value){f.add({severity:"warn",summary:"Tour no especificado",detail:"Redirigiendo a la lista de tours...",life:3e3}),setTimeout(()=>{Ke.visit("/tours")},2e3);return}await Promise.all([Le($.value),F()]),Ae()}catch(t){console.error("Error cargando datos iniciales:",t)}}),Qe(()=>{ce()}),(t,e)=>(h(),ve(ta,null,{default:y(()=>[n(r(ea),{title:"Gesti√≥n de Reservas"}),n(r(oa),{class:"z-[9999]"}),n(r(na),{class:"z-[9999]",style:pe(H.value),draggable:!1,closable:!1},{message:y(a=>[s("div",ya,[n(r(p),{icon:r(re),class:"h-8 w-8 text-red-500"},null,8,["icon"]),s("div",ha,[s("span",null,m(a.message.header),1),s("span",wa,m(a.message.content),1)])])]),_:1},8,["style"]),s("div",Aa,[s("div",Ea,[n(r(aa),{href:t.route("tours"),onClick:Ve,class:E([{"opacity-50 cursor-not-allowed":B.value},"flex items-center text-blue-600 hover:text-blue-700 transition-colors duration-200 px-3 py-2 rounded-lg"]),title:"Regresar a Tours"},{default:y(()=>[n(r(p),{icon:B.value?r(N):r(ca),class:E([{"animate-spin":B.value},"h-5 w-5 mr-2"])},null,8,["icon","class"]),e[20]||(e[20]=s("span",{class:"font-medium"},"Volver a Tours",-1))]),_:1,__:[20]},8,["href","class"])]),s("div",Ca,[l.value?(h(),C("div",Ra,[s("h3",Da,m(l.value.nombre),1),s("div",_a,[s("p",Na,[n(r(p),{icon:r(G),class:"h-4 w-4 text-blue-500"},null,8,["icon"]),e[21]||(e[21]=j(" Haz clic en cualquier tarjeta para cambiar el estado del tour "))]),!M.value&&l.value.estado==="DISPONIBLE"&&k.value?(h(),C("p",Ta,[n(r(p),{icon:r(re),class:"h-4 w-4 text-amber-500"},null,8,["icon"]),s("span",null," Cupo m√≠nimo no cumplido ("+m(l.value.cupo_min)+" personas requeridas). Actualmente hay "+m(q.value.filter(a=>a.estado==="CONFIRMADA").reduce((a,o)=>a+(o.mayores_edad||0)+(o.menores_edad||0),0))+" personas confirmadas. Solo se puede cancelar el tour. ",1)])):A("",!0),l.value.estado==="COMPLETO"&&!K.value?(h(),C("p",Sa,[n(r(p),{icon:r(G),class:"h-4 w-4 text-blue-500"},null,8,["icon"]),e[22]||(e[22]=s("span",{class:"font-medium"}," Tour completo - Debe confirmar TODAS las reservas pendientes para poder poner el tour en curso ",-1))])):A("",!0),l.value.estado==="REPROGRAMADA"&&!ue.value?(h(),C("p",Oa,[n(r(p),{icon:r(G),class:"h-4 w-4 text-purple-500"},null,8,["icon"]),e[23]||(e[23]=s("span",{class:"font-medium"}," Tour reprogramado - Confirme las reservas pendientes para habilitarlo en curso ",-1))])):A("",!0),!k.value&&(l.value.estado==="DISPONIBLE"||l.value.estado==="REPROGRAMADA")?(h(),C("p",Ia,[n(r(p),{icon:r(G),class:"h-4 w-4 text-gray-500"},null,8,["icon"]),e[24]||(e[24]=s("span",null," Este tour no tiene reservas activas. ",-1))])):A("",!0)]),s("div",La,[s("div",Ma,[e[25]||(e[25]=s("p",{class:"text-xs md:text-sm text-gray-600 mb-1"},"Estado Actual",-1)),s("p",ka,m(je(l.value.estado)),1)]),l.value.estado!=="EN_CURSO"&&l.value.estado!=="FINALIZADO"&&l.value.estado!=="CANCELADA"?(h(),C("div",{key:0,class:E(["rounded-lg px-2 py-2 md:px-4 md:py-3 flex-1 min-w-0 transition-all duration-200",ue.value?"bg-gradient-to-r from-blue-500 to-blue-600 cursor-pointer hover:shadow-lg hover:scale-105":"bg-gray-400 cursor-not-allowed opacity-60"]),onClick:e[0]||(e[0]=a=>ue.value?Q("EN_CURSO"):null)},[s("div",Pa,[e[26]||(e[26]=s("div",{class:"flex-1"},[s("p",{class:"text-xs md:text-sm opacity-90"},"En Curso")],-1)),n(r(p),{icon:x.value.cambiarEstado?r(N):r(le),class:E([{"animate-spin":x.value.cambiarEstado},"text-xs md:text-sm opacity-75"])},null,8,["icon","class"])])],2)):A("",!0),l.value.estado!=="FINALIZADO"&&l.value.estado!=="CANCELADA"&&l.value.estado==="EN_CURSO"?(h(),C("div",{key:1,class:"bg-gradient-to-r from-gray-500 to-gray-600 cursor-pointer hover:shadow-lg transition-all duration-200 hover:scale-105 rounded-lg px-2 py-2 md:px-4 md:py-3 flex-1 min-w-0",onClick:e[1]||(e[1]=a=>Q("FINALIZADO"))},[s("div",Fa,[e[27]||(e[27]=s("div",{class:"flex-1"},[s("p",{class:"text-xs md:text-sm opacity-90"},"Finalizar")],-1)),n(r(p),{icon:x.value.cambiarEstado?r(N):r(Ne),class:E([{"animate-spin":x.value.cambiarEstado},"text-xs md:text-sm opacity-75"])},null,8,["icon","class"])])])):A("",!0),l.value.estado!=="REPROGRAMADA"&&l.value.estado!=="FINALIZADO"&&l.value.estado!=="CANCELADA"&&l.value.estado!=="EN_CURSO"?(h(),C("div",{key:2,class:E(["rounded-lg px-2 py-2 md:px-4 md:py-3 flex-1 min-w-0 transition-all duration-200",l.value.estado==="DISPONIBLE"&&M.value||l.value.estado==="COMPLETO"&&K.value?"bg-gradient-to-r from-purple-500 to-purple-600 cursor-pointer hover:shadow-lg hover:scale-105":"bg-gray-400 cursor-not-allowed opacity-60"]),onClick:e[2]||(e[2]=a=>l.value.estado==="DISPONIBLE"&&M.value||l.value.estado==="COMPLETO"&&K.value?Q("REPROGRAMADA"):null)},[s("div",Va,[e[28]||(e[28]=s("div",{class:"flex-1"},[s("p",{class:"text-xs md:text-sm opacity-90"},"Reprogramar")],-1)),n(r(p),{icon:x.value.cambiarEstado?r(N):r(le),class:E([{"animate-spin":x.value.cambiarEstado},"text-xs md:text-sm opacity-75"])},null,8,["icon","class"])])],2)):A("",!0),l.value.estado!=="CANCELADA"&&l.value.estado!=="FINALIZADO"&&l.value.estado!=="EN_CURSO"?(h(),C("div",{key:3,class:E(["rounded-lg px-2 py-2 md:px-4 md:py-3 flex-1 min-w-0 transition-all duration-200",k.value||l.value.estado==="COMPLETO"||l.value.estado==="REPROGRAMADA"?"bg-gradient-to-r from-red-500 to-red-600 cursor-pointer hover:shadow-lg hover:scale-105":"bg-gray-400 cursor-not-allowed opacity-60"]),onClick:e[3]||(e[3]=a=>k.value||l.value.estado==="COMPLETO"||l.value.estado==="REPROGRAMADA"?Q("CANCELADA"):null),title:!k.value&&l.value.estado!=="COMPLETO"?"No se puede cancelar un tour sin reservas activas":"Cancelar tour y todas sus reservas"},[s("div",za,[s("div",Ua,[e[29]||(e[29]=s("p",{class:"text-xs md:text-sm opacity-90"},"Cancelar",-1)),k.value?A("",!0):(h(),C("p",qa,"Sin reservas"))]),n(r(p),{icon:x.value.cambiarEstado?r(N):r(fe),class:E([{"animate-spin":x.value.cambiarEstado},"text-xs md:text-sm opacity-75"])},null,8,["icon","class"])])],10,$a)):A("",!0)])])):A("",!0),s("div",Ha,[s("div",ja,[s("div",Ga,[e[30]||(e[30]=s("h3",{class:"text-base font-medium text-gray-800 flex items-center gap-2"},[s("i",{class:"pi pi-filter text-blue-600 text-sm"}),s("span",null,"Filtros")],-1)),s("div",Ba,m(q.value.length)+" resultado"+m(q.value.length!==1?"s":""),1)]),s("button",{onClick:Be,disabled:U.value,class:"bg-red-500 hover:bg-red-600 border border-red-500 px-2 py-1 text-xs text-white shadow-md rounded-md disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-1 shrink-0"},[U.value?(h(),ve(r(p),{key:0,icon:r(N),class:"animate-spin h-3 w-3"},null,8,["icon"])):A("",!0),s("span",null,m(U.value?"Limpiando...":"Limpiar"),1)],8,Za)]),s("div",Wa,[s("div",Xa,[n(r(p),{icon:r(ma),class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"},null,8,["icon"]),n(r(ia),{modelValue:v.value.busqueda,"onUpdate:modelValue":e[4]||(e[4]=a=>v.value.busqueda=a),placeholder:"Buscar por cliente...",class:"w-full h-9 text-sm rounded-md pl-10",style:{"background-color":"white","border-color":"#93c5fd"}},null,8,["modelValue"])]),s("div",Ya,[n(r(te),{modelValue:v.value.fechaDesde,"onUpdate:modelValue":e[5]||(e[5]=a=>v.value.fechaDesde=a),placeholder:"Fecha desde",dateFormat:"dd/mm/yy",class:"w-full h-9 text-sm",style:{"background-color":"white","border-color":"#93c5fd"},showIcon:""},null,8,["modelValue"]),n(r(te),{modelValue:v.value.fechaHasta,"onUpdate:modelValue":e[6]||(e[6]=a=>v.value.fechaHasta=a),placeholder:"Fecha hasta",dateFormat:"dd/mm/yy",class:"w-full h-9 text-sm",style:{"background-color":"white","border-color":"#93c5fd"},showIcon:""},null,8,["modelValue"]),n(r(da),{modelValue:v.value.estado,"onUpdate:modelValue":e[7]||(e[7]=a=>v.value.estado=a),options:[{label:"Todos los estados",value:null},{label:"Pendientes",value:"PENDIENTE"},{label:"Confirmadas",value:"CONFIRMADA"}],optionLabel:"label",optionValue:"value",placeholder:"Filtrar por estado",class:"w-full h-9 text-sm",style:{"background-color":"white","border-color":"#93c5fd"}},null,8,["modelValue"])]),s("div",Ja,[s("p",Ka,[n(r(p),{icon:r(va),class:"h-3 w-3 text-yellow-500"},null,8,["icon"]),e[31]||(e[31]=j(" Haz clic en cualquier fila para ver los detalles. "))])])])]),n(r(ua),{value:q.value,paginator:"",rows:10,rowsPerPageOptions:[5,10,20,50],paginatorTemplate:"RowsPerPageDropdown FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink",currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} reservas",responsiveLayout:"scroll",class:"mt-2 sm:mt-4 overflow-x-auto",onRowClick:qe,pt:{root:{class:"text-xs sm:text-sm"},wrapper:{class:"text-xs sm:text-sm overflow-x-auto"},table:{class:"text-xs sm:text-sm min-w-full"},thead:{class:"text-xs sm:text-sm"},headerRow:{class:"text-xs sm:text-sm"},headerCell:{class:"text-xs sm:text-sm font-medium py-2 sm:py-3 px-1 sm:px-2"},tbody:{class:"text-xs sm:text-sm"},bodyRow:{class:"text-xs sm:text-sm cursor-pointer hover:bg-blue-50 transition-colors duration-200"},bodyCell:{class:"py-2 sm:py-3 px-1 sm:px-2 text-xs sm:text-sm"}}},{empty:y(()=>[s("div",Qa,[n(r(p),{icon:r(G),class:"text-4xl text-gray-400 mb-4"},null,8,["icon"]),e[32]||(e[32]=s("p",{class:"text-gray-500 text-lg"},"No se encontraron reservas",-1)),e[33]||(e[33]=s("p",{class:"text-gray-400 text-sm mt-2"}," Ajusta los filtros para encontrar las reservas que buscas ",-1))])]),loading:y(()=>e[34]||(e[34]=[s("div",{class:"text-center py-12"},[s("i",{class:"pi pi-spin pi-spinner text-3xl text-blue-500 mb-4"}),s("p",{class:"text-gray-500 text-lg"},"Cargando reservas...")],-1)])),default:y(()=>[n(r(V),{field:"fecha_reserva",header:"Fecha",class:"w-28 min-w-16"},{body:y(a=>[s("span",es,m(Ge(a.data.fecha_reserva)),1)]),_:1}),n(r(V),{field:"cliente.nombres",header:"Cliente",class:"w-16 hidden sm:table-cell"},{body:y(a=>{var o,d,i,c,w,R,S,ee,ae,se,Ee,Ce;return[s("div",as,[s("div",ss,[n(r(p),{icon:r(Te),class:"text-blue-600 text-xs sm:text-sm"},null,8,["icon"])]),s("div",ts,[s("div",{class:"font-medium text-gray-900 text-xs sm:text-sm truncate",title:((d=(o=a.data.cliente)==null?void 0:o.user)==null?void 0:d.name)||((i=a.data.cliente)==null?void 0:i.nombres)||"N/A"},m(((w=(c=a.data.cliente)==null?void 0:c.user)==null?void 0:w.name)||((R=a.data.cliente)==null?void 0:R.nombres)||"N/A"),9,rs),s("div",{class:"text-xs text-gray-500 truncate hidden sm:block",title:((ee=(S=a.data.cliente)==null?void 0:S.user)==null?void 0:ee.email)||((ae=a.data.cliente)==null?void 0:ae.correo)||"N/A"},m(((Ee=(se=a.data.cliente)==null?void 0:se.user)==null?void 0:Ee.email)||((Ce=a.data.cliente)==null?void 0:Ce.correo)||"N/A"),9,ls)])])]}),_:1}),n(r(V),{header:"Personas",class:"w-20 sm:w-24 lg:w-28 min-w-16 hidden md:table-cell"},{body:y(a=>[s("div",null,[s("div",os,[n(r(p),{icon:r(Te),class:"text-gray-400 text-xs mr-1"},null,8,["icon"]),s("span",ns,m((a.data.mayores_edad||0)+(a.data.menores_edad||0)),1)]),s("div",is,m(a.data.mayores_edad||0)+"A ‚Ä¢ "+m(a.data.menores_edad||0)+"N ",1)])]),_:1}),n(r(V),{field:"total",header:"Total",class:"w-12 min-w-12"},{body:y(a=>[s("span",ds," $"+m(Number(a.data.total||0).toFixed(2)),1)]),_:1}),n(r(V),{field:"estado",header:"Estado",class:"w-24 sm:w-28 lg:w-36 min-w-20 hidden lg:table-cell"},{body:y(a=>{var o,d;return[s("span",{class:E([He(a.data.estado),"px-2 py-1 rounded-full text-xs font-medium"])},[s("span",us,m(((o=J.find(i=>i.value===a.data.estado))==null?void 0:o.label)||a.data.estado),1),s("span",cs,m((((d=J.find(i=>i.value===a.data.estado))==null?void 0:d.label)||a.data.estado).substring(0,4)),1)],2)]}),_:1}),n(r(V),{header:"Acciones",class:"w-24 sm:w-28 lg:w-32 min-w-20"},{body:y(a=>[s("button",{class:"bg-green-500 hover:bg-green-600 text-white px-2 py-2 rounded-md transition-all duration-200 ease-in-out inline-flex items-center gap-1 text-xs shadow-md hover:shadow-lg hover:-translate-y-1",onClick:o=>Ue(a.data),title:"M√°s acciones"},[n(r(p),{icon:r(ga),class:"h-3 w-4 sm:h-4 sm:w-5"},null,8,["icon"]),e[35]||(e[35]=s("span",{class:"hidden md:inline"},"M√°s",-1))],8,ms)]),_:1})]),_:1},8,["value"]),n(ba,{visible:L.value,"onUpdate:visible":e[8]||(e[8]=a=>L.value=a),"detalles-visible":X.value,"onUpdate:detallesVisible":e[9]||(e[9]=a=>X.value=a),"rechazar-visible":W.value,"onUpdate:rechazarVisible":e[10]||(e[10]=a=>W.value=a),reserva:Y.value,tour:oe.value,"dialog-style":H.value,procesando:ne.value,"confirmando-reserva":ie.value,"rechazando-reserva":de.value,"estados-reservas":J,"estados-tours":ye,onConfirmar:We,onRechazar:Xe,onVerDetalles:Ye},null,8,["visible","detalles-visible","rechazar-visible","reserva","tour","dialog-style","procesando","confirmando-reserva","rechazando-reserva"]),n(xa,{visible:Z.value,"onUpdate:visible":e[11]||(e[11]=a=>Z.value=a),tour:l.value,"dialog-style":H.value,onEstadoActualizado:Pe},null,8,["visible","tour","dialog-style"]),n(r(_e),{visible:z.value,"onUpdate:visible":e[14]||(e[14]=a=>z.value=a),modal:"",header:"Cancelar Tour Completo",style:pe(H.value),closable:!1,draggable:!1},{default:y(()=>{var a;return[s("div",vs,[s("div",ps,[s("div",fs,[n(r(p),{icon:r(re),class:"text-orange-600 text-lg mt-1 flex-shrink-0"},null,8,["icon"]),e[36]||(e[36]=s("div",null,[s("h4",{class:"font-bold text-orange-800 mb-2"},"¬°ADVERTENCIA - ELIMINACI√ìN MASIVA PERMANENTE!"),s("div",{class:"text-sm text-orange-700 space-y-2"},[s("p",null,[s("strong",null,"‚Ä¢ Esta acci√≥n NO se puede deshacer bajo ninguna circunstancia")]),s("p",null,"‚Ä¢ Se eliminar√°n TODAS las reservas del tour de forma PERMANENTE"),s("p",null,"‚Ä¢ Se eliminar√°n TODOS los detalles asociados a cada reserva"),s("p",null,"‚Ä¢ Los cupos del tour ser√°n liberados autom√°ticamente"),s("p",null,"‚Ä¢ Se enviar√°n emails de cancelaci√≥n a TODOS los clientes"),s("p",null,"‚Ä¢ No ser√° posible recuperar ninguna informaci√≥n posteriormente"),s("div",{class:"mt-3 p-2 bg-orange-100 rounded border border-orange-300"},[s("p",{class:"font-semibold text-orange-900 text-xs"}," Aseg√∫rese de que realmente desea eliminar toda la informaci√≥n antes de continuar ")])])],-1))])]),s("div",gs,[s("div",bs,[n(r(p),{icon:r(re),class:"text-red-600"},null,8,["icon"]),s("h4",xs,"Cancelar Tour: "+m((a=l.value)==null?void 0:a.nombre),1)]),e[37]||(e[37]=s("p",{class:"text-sm text-red-700"}," Esta acci√≥n cancelar√° el tour completo y TODAS las reservas asociadas. Se enviar√°n notificaciones por correo a todos los clientes. ",-1)),s("p",ys,[s("strong",null,"Reservas que ser√°n ELIMINADAS PERMANENTEMENTE: "+m(g.value.length),1)])]),s("div",null,[e[38]||(e[38]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[j(" Motivo de la Cancelaci√≥n del Tour "),s("span",{class:"text-red-500"},"*")],-1)),Re(s("textarea",{"onUpdate:modelValue":e[12]||(e[12]=o=>D.value=o),placeholder:"Explique por qu√© se cancela el tour completo...",class:"w-full p-3 border border-gray-300 rounded-md focus:ring-red-500 focus:border-red-500",rows:"4",maxlength:"500"},null,512),[[De,D.value]]),s("small",hs,m(D.value.length)+"/500 caracteres",1)]),s("div",ws,[s("button",{onClick:e[13]||(e[13]=o=>z.value=!1),class:"px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50"}," Cancelar "),s("button",{onClick:ze,disabled:!D.value.trim()||T.value,class:"px-4 py-2 bg-red-700 text-white rounded-md hover:bg-red-800 disabled:bg-red-300 flex items-center gap-2"},[n(r(p),{icon:T.value?r(N):r(fe),class:E({"animate-spin":T.value})},null,8,["icon","class"]),j(" "+m(T.value?"Eliminando Todo...":"Eliminar Tour y Reservas Definitivamente"),1)],8,As)])])]}),_:1},8,["visible","style"]),n(r(_e),{visible:I.value,"onUpdate:visible":e[19]||(e[19]=a=>I.value=a),modal:"",header:"Reprogramar Tour",style:pe(H.value),closable:!1,draggable:!1},{default:y(()=>{var a,o,d;return[s("div",Es,[s("div",Cs,[s("h4",Rs,m((a=l.value)==null?void 0:a.nombre),1),s("p",Ds," Fechas actuales: "+m(we((o=l.value)==null?void 0:o.fecha_salida))+" - "+m(we((d=l.value)==null?void 0:d.fecha_regreso)),1)]),s("div",_s,[s("div",null,[e[39]||(e[39]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Salida:",-1)),n(r(te),{modelValue:b.value.fechaSalida,"onUpdate:modelValue":e[15]||(e[15]=i=>b.value.fechaSalida=i),showTime:"",hourFormat:"12",dateFormat:"dd/mm/yy",showIcon:"",placeholder:"Seleccionar fecha y hora",class:"w-full",minDate:new Date},null,8,["modelValue","minDate"])]),s("div",null,[e[40]||(e[40]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Regreso:",-1)),n(r(te),{modelValue:b.value.fechaRegreso,"onUpdate:modelValue":e[16]||(e[16]=i=>b.value.fechaRegreso=i),showTime:"",hourFormat:"12",dateFormat:"dd/mm/yy",showIcon:"",placeholder:"Seleccionar fecha y hora",class:"w-full",minDate:Ze.value},null,8,["modelValue","minDate"])])]),s("div",null,[e[41]||(e[41]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Motivo de la Reprogramaci√≥n",-1)),Re(s("textarea",{"onUpdate:modelValue":e[17]||(e[17]=i=>b.value.motivo=i),placeholder:"Ingrese el motivo de la reprogramaci√≥n...",class:"w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",rows:"3"},null,512),[[De,b.value.motivo]]),e[42]||(e[42]=s("p",{class:"text-xs text-gray-500 mt-2"}," üí° Al reprogramar el tour, todas las reservas asociadas ser√°n reprogramadas autom√°ticamente y se enviar√°n correos de notificaci√≥n a los clientes. ",-1))]),s("div",Ns,[s("button",{onClick:Fe,disabled:x.value.cambiarEstado,class:"px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"},[x.value.cambiarEstado?(h(),ve(r(p),{key:0,icon:r(N),class:"animate-spin"},null,8,["icon"])):A("",!0),j(" "+m(x.value.cambiarEstado?"Reprogramando...":"Reprogramar Tour"),1)],8,Ts),s("button",{onClick:e[18]||(e[18]=i=>{I.value=!1,ce()}),class:"border rounded-md bg-blue-500 hover:bg-blue-700 text-white px-6 py-2",disabled:x.value.cambiarEstado}," Cancelar ",8,Ss)])])]}),_:1},8,["visible","style"])])])]),_:1}))}};export{zs as default};
