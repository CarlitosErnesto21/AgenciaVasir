import{r as p,E as V,w as M,k as O,h as N,d as u,x as I,e as t,c as b,j as _,t as i,q as h,F as H,l as W,y as k,v as X,a7 as G,p as c,$ as n,A as J,N as Q}from"./vendor-DbRibEpp.js";import{z as Y,A as y,g as Z}from"./ui-CrZM8ROW.js";import{z as ee,b as te,A as ae,B as T,f as se,e as oe,g as le}from"./index-DWkcdlMl.js";import{_ as ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";const re={class:"space-y-6"},ie={class:"bg-gray-50 p-4 rounded-lg"},de={class:"font-semibold text-gray-800 mb-2"},ue={class:"grid grid-cols-2 gap-4 text-sm"},ce={class:"font-semibold ml-2"},me={class:"font-semibold ml-2"},ve={class:"space-y-3"},pe={class:"grid grid-cols-1 gap-2"},be=["value"],fe={class:"flex-1"},ge={class:"font-medium"},ye={class:"text-xs opacity-75"},xe={class:"space-y-2"},ke={class:"block text-sm font-semibold text-gray-700"},_e={class:"flex items-center gap-2"},he=["disabled"],we=["disabled"],Ce={key:0,class:"text-red-500"},Se={key:0,class:"bg-blue-50 border border-blue-200 p-4 rounded-lg"},je={class:"flex items-center gap-2 mb-2"},Ae={class:"text-sm space-y-1"},Ve={class:"flex justify-between"},De={class:"font-medium"},ze={class:"flex justify-between"},Ee={class:"flex justify-between items-center"},Me={class:"flex items-center gap-2"},Ne={key:0,class:"text-xs text-red-600 mt-2 flex items-center gap-1"},Ie={class:"space-y-2"},Te={key:0,class:"text-red-500"},Ue={class:"space-y-2 border-t pt-4"},Be={class:"text-gray-500 text-xs"},Pe={class:"flex justify-center gap-4 w-full mt-6"},Fe=["disabled"],Ke={key:0},Re={key:1},$e=["disabled"],qe={__name:"ActualizarStock",props:{visible:{type:Boolean,default:!1},producto:{type:Object,default:()=>({})},dialogStyle:{type:Object,default:()=>({})}},emits:["update:visible","stockUpdated"],setup(m,{emit:U}){const w=Y(),d=m,C=U,f=p(!1),r=p("ajuste"),s=p(null),v=p(""),g=p(!1),B=p(null),x=p(null),D=V({get:()=>d.visible,set:a=>C("update:visible",a)}),S=V(()=>{var l;if(!d.producto||s.value===null||s.value==="")return((l=d.producto)==null?void 0:l.stock_actual)||0;const a=d.producto.stock_actual||0,e=Number(s.value);switch(r.value){case"entrada":return a+e;case"salida":return Math.max(0,a-e);case"ajuste":return e;default:return a}}),j=V(()=>{var e;const a=((e=d.producto)==null?void 0:e.stock_minimo)||1;return S.value<=a}),P=p([{label:"Entrada de stock",value:"entrada",descripcion:"Aumentar el inventario"},{label:"Salida de stock",value:"salida",descripcion:"Reducir el inventario"},{label:"Ajuste de inventario",value:"ajuste",descripcion:"Establecer cantidad exacta"}]);M(()=>d.visible,a=>{a&&F()}),M(r,()=>{s.value=null,v.value="",g.value=!1});const F=()=>{var a,e;r.value="ajuste",s.value=null,v.value="",g.value=!1,B.value=((a=d.producto)==null?void 0:a.stock_actual)||null,x.value=((e=d.producto)==null?void 0:e.stock_minimo)||null},z=a=>{const e=a.target.value,l=a.key;if([8,9,27,13,46,35,36,37,38,39,40].includes(a.keyCode)||a.ctrlKey&&[65,67,86,88].includes(a.keyCode))return;if(!/[0-9]/.test(l)){a.preventDefault();return}const o=e+l,A=parseInt(o);if(o.length>4||A>9999){a.preventDefault();return}},E=a=>{a.preventDefault();const l=(a.clipboardData||window.clipboardData).getData("text").replace(/[^0-9]/g,"");if(l){let o=parseInt(l);o>9999&&(o=9999),a.target.value=o.toString(),a.target.dispatchEvent(new Event("input",{bubbles:!0}))}},K=()=>{const a=s.value||0;a<9999&&(s.value=a+1)},R=()=>{const a=s.value||0;a>0&&(s.value=a-1)},$=async()=>{var a,e;if(g.value=!0,!s.value||s.value<=0){w.add({severity:"warn",summary:"Campo requerido",detail:"Debes ingresar una cantidad válida.",life:4e3});return}if(!v.value.trim()){w.add({severity:"warn",summary:"Campo requerido",detail:"Debes especificar el motivo del movimiento.",life:4e3});return}if(r.value==="salida"&&s.value>d.producto.stock_actual){w.add({severity:"warn",summary:"Stock insuficiente",detail:`No puedes retirar ${s.value} unidades. Stock disponible: ${d.producto.stock_actual}`,life:4e3});return}f.value=!0;try{const l=new FormData;l.append("tipo_movimiento",r.value),l.append("cantidad",s.value),l.append("motivo",v.value.trim()),l.append("stock_resultante",S.value),x.value!==null&&x.value!==d.producto.stock_minimo&&l.append("nuevo_stock_minimo",x.value),l.append("_method","PATCH");const o=await Q.post(`/api/productos/${d.producto.id}/actualizar-stock`,l,{headers:{"Content-Type":"multipart/form-data"}});C("stockUpdated",o.data),C("update:visible",!1)}catch(l){const o=((e=(a=l.response)==null?void 0:a.data)==null?void 0:e.message)||"Error al actualizar el stock";w.add({severity:"error",summary:"Error",detail:o,life:6e3})}finally{f.value=!1}},q=()=>{C("update:visible",!1)},L=a=>{switch(a){case"entrada":return"text-green-600 bg-green-50 border-green-200";case"salida":return"text-red-600 bg-red-50 border-red-200";case"ajuste":return"text-blue-600 bg-blue-50 border-blue-200";default:return"text-gray-600 bg-gray-50 border-gray-200"}};return(a,e)=>{const l=O("InputText");return u(),N(n(Z),{visible:D.value,"onUpdate:visible":e[4]||(e[4]=o=>D.value=o),header:"Actualizar Stock",modal:!0,style:J(m.dialogStyle),closable:!1,draggable:!1},{footer:I(()=>[t("div",Pe,[t("button",{class:"bg-red-500 hover:bg-red-700 text-white border-none px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",onClick:$,disabled:f.value},[c(n(y),{icon:f.value?n(se):n(oe),class:k(["h-5 text-white",{"animate-spin":f.value}])},null,8,["icon","class"]),f.value?(u(),b("span",Re,"Actualizando...")):(u(),b("span",Ke,"Actualizar Stock"))],8,Fe),t("button",{type:"button",class:"bg-blue-500 hover:bg-blue-700 text-white px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",onClick:q,disabled:f.value},[c(n(y),{icon:n(le),class:"h-5"},null,8,["icon"]),e[16]||(e[16]=h(" Cancelar "))],8,$e)])]),default:I(()=>[t("div",re,[t("div",ie,[t("h4",de,i(m.producto.nombre),1),t("div",ue,[t("div",null,[e[5]||(e[5]=t("span",{class:"text-gray-600"},"Stock actual:",-1)),t("span",ce,i(m.producto.stock_actual||0)+" unidades",1)]),t("div",null,[e[6]||(e[6]=t("span",{class:"text-gray-600"},"Stock mínimo:",-1)),t("span",me,i(m.producto.stock_minimo||1)+" unidades",1)])])]),t("div",ve,[e[7]||(e[7]=t("label",{class:"block text-sm font-semibold text-gray-700"},[h(" Tipo de movimiento: "),t("span",{class:"text-red-500"},"*")],-1)),t("div",pe,[(u(!0),b(H,null,W(P.value,o=>(u(),b("label",{key:o.value,class:k(["flex items-center p-3 border rounded-lg cursor-pointer transition-all hover:bg-gray-50",r.value===o.value?L(o.value):"border-gray-200"])},[X(t("input",{type:"radio","onUpdate:modelValue":e[0]||(e[0]=A=>r.value=A),value:o.value,class:"mr-3"},null,8,be),[[G,r.value]]),t("div",fe,[t("div",ge,i(o.label),1),t("div",ye,i(o.descripcion),1)])],2))),128))])]),t("div",xe,[t("label",ke,[h(i(r.value==="ajuste"?"Nuevo stock:":"Cantidad:")+" ",1),e[8]||(e[8]=t("span",{class:"text-red-500"},"*",-1))]),t("div",_e,[t("button",{type:"button",onClick:R,disabled:!s.value||s.value<=0,class:"bg-gray-500 hover:bg-gray-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-white p-2 rounded-lg transition-all"},[c(n(y),{icon:n(ee),class:"h-4 w-4"},null,8,["icon"])],8,he),c(l,{modelValue:s.value,"onUpdate:modelValue":e[1]||(e[1]=o=>s.value=o),type:"number",min:"0",max:"9999",class:k(["flex-1 text-center border-2 border-gray-400 hover:border-gray-500 focus:border-gray-500 focus:ring-0 focus:shadow-none rounded-md",{"p-invalid":g.value&&(!s.value||s.value<=0)}]),placeholder:"0",onKeydown:z,onPaste:E},null,8,["modelValue","class"]),t("button",{type:"button",onClick:K,disabled:s.value>=9999,class:"bg-gray-500 hover:bg-gray-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-white p-2 rounded-lg transition-all"},[c(n(y),{icon:n(te),class:"h-4 w-4"},null,8,["icon"])],8,we)]),g.value&&(!s.value||s.value<=0)?(u(),b("small",Ce," La cantidad es obligatoria y debe ser mayor a 0. ")):_("",!0)]),s.value&&s.value>0?(u(),b("div",Se,[t("div",je,[c(n(y),{icon:n(ae),class:"h-4 w-4 text-blue-600"},null,8,["icon"]),e[9]||(e[9]=t("span",{class:"font-semibold text-blue-800"},"Resultado del movimiento:",-1))]),t("div",Ae,[t("div",Ve,[e[10]||(e[10]=t("span",null,"Stock actual:",-1)),t("span",De,i(m.producto.stock_actual||0)+" unidades",1)]),t("div",ze,[t("span",null,i(r.value==="entrada"?"Cantidad a agregar:":r.value==="salida"?"Cantidad a retirar:":"Nuevo stock:"),1),t("span",{class:k(["font-medium",r.value==="entrada"?"text-green-600":r.value==="salida"?"text-red-600":"text-blue-600"])},i(r.value==="ajuste"?"":r.value==="entrada"?"+":"-")+i(s.value)+" unidades ",3)]),e[12]||(e[12]=t("hr",{class:"border-blue-200"},null,-1)),t("div",Ee,[e[11]||(e[11]=t("span",{class:"font-semibold"},"Stock resultante:",-1)),t("div",Me,[t("span",{class:k(["font-semibold text-lg",j.value?"text-red-600":"text-green-600"])},i(S.value)+" unidades ",3),j.value?(u(),N(n(y),{key:0,icon:n(T),class:"h-4 w-4 text-red-500",title:"Stock por debajo del mínimo"},null,8,["icon"])):_("",!0)])]),j.value?(u(),b("div",Ne,[c(n(y),{icon:n(T),class:"h-3 w-3"},null,8,["icon"]),h(" El stock resultante está por debajo del mínimo recomendado ("+i(m.producto.stock_minimo||1)+" unidades) ",1)])):_("",!0)])])):_("",!0),t("div",Ie,[e[13]||(e[13]=t("label",{class:"block text-sm font-semibold text-gray-700"},[h(" Motivo del movimiento: "),t("span",{class:"text-red-500"},"*")],-1)),c(l,{modelValue:v.value,"onUpdate:modelValue":e[2]||(e[2]=o=>v.value=o),type:"text",maxlength:"100",class:k(["w-full border-2 border-gray-400 hover:border-gray-500 focus:border-gray-500 focus:ring-0 focus:shadow-none rounded-md",{"p-invalid":g.value&&!v.value.trim()}]),placeholder:"Ejemplo: Compra de mercancía, Producto dañado, Inventario físico, etc."},null,8,["modelValue","class"]),e[14]||(e[14]=t("small",{class:"text-gray-500 text-xs"}," Describe brevemente la razón de este movimiento de stock (máximo 100 caracteres) ",-1)),g.value&&!v.value.trim()?(u(),b("small",Te," El motivo es obligatorio. ")):_("",!0)]),t("div",Ue,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-600"}," Ajustar stock mínimo (opcional): ",-1)),c(l,{modelValue:x.value,"onUpdate:modelValue":e[3]||(e[3]=o=>x.value=o),type:"number",min:"1",max:"100",class:"w-full border-2 border-gray-300 hover:border-gray-400 focus:border-gray-400 focus:ring-0 focus:shadow-none rounded-md",placeholder:"Nuevo stock mínimo",onKeydown:z,onPaste:E},null,8,["modelValue"]),t("small",Be," Actual: "+i(m.producto.stock_minimo||1)+" unidades ",1)])])]),_:1},8,["visible","style"])}}},Xe=ne(qe,[["__scopeId","data-v-d0db32e3"]]);export{Xe as default};
