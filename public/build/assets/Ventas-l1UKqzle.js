import{A as X,c as f,o as Y,q as B,h as T,b as v,e as U,f as u,z as w,g as Z,a as ee}from"./ui-DPmvhuIJ.js";import{A as te}from"./AuthenticatedLayout-C17532f3.js";import{r as b,E as A,o as se,s as ae,h as _,d as x,x as o,e as t,p as n,$ as a,t as c,v as g,j as V,c as le,q as k,N as E}from"./vendor-CLNWHdEK.js";import{_ as ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-D3qnJ-6K.js";const oe={class:"flex items-center justify-between"},ie={class:"flex gap-2"},re={class:"py-6"},de={class:"max-w-full mx-auto sm:px-6 lg:px-8"},ce={class:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6"},ue={class:"flex items-center justify-between"},pe={class:"text-2xl font-bold"},me={class:"flex items-center justify-between"},ve={class:"text-2xl font-bold"},fe={class:"flex items-center justify-between"},be={class:"text-2xl font-bold"},xe={class:"flex items-center justify-between"},ge={class:"text-2xl font-bold"},ye={class:"grid grid-cols-1 md:grid-cols-5 gap-4"},he={class:"flex items-end"},we={class:"flex justify-between items-center"},_e={class:"text-lg font-semibold text-gray-800"},Ve={class:"p-input-icon-left"},ke={class:"text-gray-700"},Ce={class:"flex items-center gap-2"},De={class:"font-medium"},$e={class:"font-bold text-green-600"},Ee={class:"flex gap-1"},Fe={key:0,class:"space-y-6"},Se={class:"flex items-center justify-between"},Ie={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Le={class:"space-y-3"},He={class:"flex items-center gap-2"},Ne={class:"flex items-center gap-2"},Pe={class:"flex items-center gap-2"},je={class:"space-y-3"},Be={class:"flex items-center gap-2"},Te={class:"text-green-600 font-bold text-lg"},Ue={class:"flex items-center gap-2"},Ae={class:"font-medium"},qe={class:"font-medium"},Re={class:"font-bold text-green-600"},Ge={__name:"Ventas",setup(Me){const p=X(),F=b([]),S=b(!1),I=b(!1),m=b(null),y=b(""),d=b({estado:null,fechaDesde:null,fechaHasta:null,cliente:""}),q=[{name:"Todos",value:null},{name:"Pendiente",value:"pendiente"},{name:"Completada",value:"completada"},{name:"Cancelada",value:"cancelada"}],L=A(()=>{let l=F.value;if(d.value.estado&&(l=l.filter(e=>e.estado===d.value.estado)),d.value.fechaDesde){const e=new Date(d.value.fechaDesde);l=l.filter(i=>new Date(i.fecha)>=e)}if(d.value.fechaHasta){const e=new Date(d.value.fechaHasta);l=l.filter(i=>new Date(i.fecha)<=e)}if(d.value.cliente){const e=d.value.cliente.toLowerCase();l=l.filter(i=>{var s,r;return(r=(s=i.cliente)==null?void 0:s.nombre)==null?void 0:r.toLowerCase().includes(e)})}if(y.value){const e=y.value.toLowerCase();l=l.filter(i=>{var s,r;return((r=(s=i.cliente)==null?void 0:s.nombre)==null?void 0:r.toLowerCase().includes(e))||i.id.toString().includes(e)})}return l}),C=A(()=>{const l={completadas:0,pendientes:0,canceladas:0,totalVendido:0};return F.value.forEach(e=>{switch(e.estado){case"completada":l.completadas++,l.totalVendido+=parseFloat(e.total||0);break;case"pendiente":l.pendientes++;break;case"cancelada":l.canceladas++;break}}),l}),D=async()=>{try{S.value=!0;const l=await E.get("/api/ventas");F.value=l.data}catch(l){console.error("Error cargando ventas:",l),p.add({severity:"error",summary:"Error",detail:"No se pudieron cargar las ventas",life:3e3})}finally{S.value=!1}},R=l=>{m.value=l,I.value=!0},G=async l=>{var e,i;try{await E.post(`/api/ventas/${l.id}/procesar`),p.add({severity:"success",summary:"Éxito",detail:"Venta procesada correctamente",life:3e3}),await D()}catch(s){p.add({severity:"error",summary:"Error",detail:((i=(e=s.response)==null?void 0:e.data)==null?void 0:i.message)||"Error al procesar la venta",life:3e3})}},M=async l=>{var e,i;try{await E.post(`/api/ventas/${l.id}/cancelar`),p.add({severity:"success",summary:"Éxito",detail:"Venta cancelada correctamente",life:3e3}),await D()}catch(s){p.add({severity:"error",summary:"Error",detail:((i=(e=s.response)==null?void 0:e.data)==null?void 0:i.message)||"Error al cancelar la venta",life:3e3})}},O=async l=>{var e,i;if(confirm("¿Está seguro de eliminar esta venta?"))try{await E.delete(`/api/ventas/${l.id}`),p.add({severity:"success",summary:"Éxito",detail:"Venta eliminada correctamente",life:3e3}),await D()}catch(s){p.add({severity:"error",summary:"Error",detail:((i=(e=s.response)==null?void 0:e.data)==null?void 0:i.message)||"Error al eliminar la venta",life:3e3})}},$=()=>{},z=()=>{d.value={estado:null,fechaDesde:null,fechaHasta:null,cliente:""},y.value=""},J=()=>{p.add({severity:"info",summary:"Información",detail:"Función de crear venta pendiente de implementar",life:3e3})},K=l=>{p.add({severity:"info",summary:"Información",detail:"Función de editar venta pendiente de implementar",life:3e3})},Q=()=>{p.add({severity:"info",summary:"Información",detail:"Función de exportar pendiente de implementar",life:3e3})},W=l=>{p.add({severity:"info",summary:"Información",detail:"Función de imprimir pendiente de implementar",life:3e3})},H=l=>l?new Date(l).toLocaleDateString("es-ES",{year:"numeric",month:"2-digit",day:"2-digit"}):"N/A",h=l=>l?parseFloat(l).toLocaleString("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00",N=l=>{switch(l){case"completada":return"success";case"pendiente":return"warning";case"cancelada":return"danger";default:return"info"}},P=l=>{switch(l){case"completada":return"pi pi-check";case"pendiente":return"pi pi-clock";case"cancelada":return"pi pi-times";default:return"pi pi-question"}};return se(()=>{D()}),(l,e)=>{const i=ae("tooltip");return x(),_(te,null,{header:o(()=>[t("div",oe,[e[6]||(e[6]=t("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},[t("i",{class:"pi pi-shopping-cart mr-2 text-blue-600"}),k(" Gestión de Ventas ")],-1)),t("div",ie,[n(a(v),{label:"Nueva Venta",icon:"pi pi-plus",class:"p-button-success p-button-sm",onClick:J}),n(a(v),{label:"Exportar",icon:"pi pi-download",class:"p-button-info p-button-sm p-button-outlined",onClick:Q})])])]),default:o(()=>[t("div",re,[t("div",de,[t("div",ce,[n(a(f),{class:"bg-gradient-to-r from-green-400 to-green-600 text-white"},{content:o(()=>[t("div",ue,[t("div",null,[e[7]||(e[7]=t("div",{class:"text-green-100 text-sm"},"Ventas Completadas",-1)),t("div",pe,c(C.value.completadas),1)]),e[8]||(e[8]=t("i",{class:"pi pi-check-circle text-3xl text-green-200"},null,-1))])]),_:1}),n(a(f),{class:"bg-gradient-to-r from-yellow-400 to-yellow-600 text-white"},{content:o(()=>[t("div",me,[t("div",null,[e[9]||(e[9]=t("div",{class:"text-yellow-100 text-sm"},"Ventas Pendientes",-1)),t("div",ve,c(C.value.pendientes),1)]),e[10]||(e[10]=t("i",{class:"pi pi-clock text-3xl text-yellow-200"},null,-1))])]),_:1}),n(a(f),{class:"bg-gradient-to-r from-red-400 to-red-600 text-white"},{content:o(()=>[t("div",fe,[t("div",null,[e[11]||(e[11]=t("div",{class:"text-red-100 text-sm"},"Ventas Canceladas",-1)),t("div",be,c(C.value.canceladas),1)]),e[12]||(e[12]=t("i",{class:"pi pi-times-circle text-3xl text-red-200"},null,-1))])]),_:1}),n(a(f),{class:"bg-gradient-to-r from-blue-400 to-blue-600 text-white"},{content:o(()=>[t("div",xe,[t("div",null,[e[13]||(e[13]=t("div",{class:"text-blue-100 text-sm"},"Total Vendido",-1)),t("div",ge,"$"+c(h(C.value.totalVendido)),1)]),e[14]||(e[14]=t("i",{class:"pi pi-dollar text-3xl text-blue-200"},null,-1))])]),_:1})]),n(a(f),{class:"mb-6"},{content:o(()=>[t("div",ye,[t("div",null,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Estado",-1)),n(a(Y),{modelValue:d.value.estado,"onUpdate:modelValue":e[0]||(e[0]=s=>d.value.estado=s),options:q,optionLabel:"name",optionValue:"value",placeholder:"Todos los estados",class:"w-full",onChange:$},null,8,["modelValue"])]),t("div",null,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Fecha Desde",-1)),n(a(B),{modelValue:d.value.fechaDesde,"onUpdate:modelValue":e[1]||(e[1]=s=>d.value.fechaDesde=s),placeholder:"Seleccionar fecha",class:"w-full",onDateSelect:$},null,8,["modelValue"])]),t("div",null,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Fecha Hasta",-1)),n(a(B),{modelValue:d.value.fechaHasta,"onUpdate:modelValue":e[2]||(e[2]=s=>d.value.fechaHasta=s),placeholder:"Seleccionar fecha",class:"w-full",onDateSelect:$},null,8,["modelValue"])]),t("div",null,[e[18]||(e[18]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Cliente",-1)),n(a(T),{modelValue:d.value.cliente,"onUpdate:modelValue":e[3]||(e[3]=s=>d.value.cliente=s),placeholder:"Buscar cliente",class:"w-full",onInput:$},null,8,["modelValue"])]),t("div",he,[n(a(v),{label:"Limpiar Filtros",icon:"pi pi-times",class:"p-button-outlined w-full",onClick:z})])])]),_:1}),n(a(f),null,{content:o(()=>[n(a(U),{value:L.value,paginator:!0,rows:10,loading:S.value,rowsPerPageOptions:[5,10,20,50],totalRecords:L.value.length,globalFilterFields:["cliente.nombre"],scrollable:"",scrollHeight:"60vh",class:"p-datatable-sm",stripedRows:"",responsiveLayout:"scroll"},{header:o(()=>[t("div",we,[t("h5",_e," Lista de Ventas ("+c(L.value.length)+") ",1),t("span",Ve,[e[19]||(e[19]=t("i",{class:"pi pi-search"},null,-1)),n(a(T),{modelValue:y.value,"onUpdate:modelValue":e[4]||(e[4]=s=>y.value=s),placeholder:"Buscar ventas...",class:"p-inputtext-sm"},null,8,["modelValue"])])])]),default:o(()=>[n(a(u),{field:"id",header:"ID",sortable:"",style:{width:"80px"}},{body:o(({data:s})=>[n(a(w),{value:`#${s.id}`,severity:"info"},null,8,["value"])]),_:1}),n(a(u),{field:"fecha",header:"Fecha",sortable:"",style:{width:"120px"}},{body:o(({data:s})=>[t("span",ke,c(H(s.fecha)),1)]),_:1}),n(a(u),{field:"cliente.nombre",header:"Cliente",sortable:""},{body:o(({data:s})=>{var r;return[t("div",Ce,[e[20]||(e[20]=t("i",{class:"pi pi-user text-gray-500"},null,-1)),t("span",De,c(((r=s.cliente)==null?void 0:r.nombre)||"N/A"),1)])]}),_:1}),n(a(u),{field:"total",header:"Total",sortable:"",style:{width:"120px"}},{body:o(({data:s})=>[t("span",$e,"$"+c(h(s.total)),1)]),_:1}),n(a(u),{field:"estado",header:"Estado",sortable:"",style:{width:"120px"}},{body:o(({data:s})=>[n(a(w),{value:s.estado,severity:N(s.estado),icon:P(s.estado)},null,8,["value","severity","icon"])]),_:1}),n(a(u),{header:"Productos",style:{width:"100px"}},{body:o(({data:s})=>{var r;return[n(a(w),{value:`${((r=s.detalle_ventas)==null?void 0:r.length)||0} items`,severity:"info",class:"text-xs"},null,8,["value"])]}),_:1}),n(a(u),{header:"Acciones",style:{width:"200px"}},{body:o(({data:s})=>[t("div",Ee,[g(n(a(v),{icon:"pi pi-eye",class:"p-button-sm p-button-info p-button-text",onClick:r=>R(s)},null,8,["onClick"]),[[i,"Ver detalles"]]),s.estado==="pendiente"?g((x(),_(a(v),{key:0,icon:"pi pi-pencil",class:"p-button-sm p-button-warning p-button-text",onClick:r=>K(s)},null,8,["onClick"])),[[i,"Editar venta"]]):V("",!0),s.estado==="pendiente"?g((x(),_(a(v),{key:1,icon:"pi pi-check",class:"p-button-sm p-button-success p-button-text",onClick:r=>G(s)},null,8,["onClick"])),[[i,"Procesar venta"]]):V("",!0),s.estado==="completada"?g((x(),_(a(v),{key:2,icon:"pi pi-times",class:"p-button-sm p-button-danger p-button-text",onClick:r=>M(s)},null,8,["onClick"])),[[i,"Cancelar venta"]]):V("",!0),s.estado!=="completada"?g((x(),_(a(v),{key:3,icon:"pi pi-trash",class:"p-button-sm p-button-danger p-button-text",onClick:r=>O(s)},null,8,["onClick"])),[[i,"Eliminar venta"]]):V("",!0),g(n(a(v),{icon:"pi pi-print",class:"p-button-sm p-button-info p-button-text",onClick:r=>W(s)},null,8,["onClick"]),[[i,"Imprimir"]])])]),_:1})]),_:1},8,["value","loading","totalRecords"])]),_:1})])]),n(a(Z),{visible:I.value,"onUpdate:visible":e[5]||(e[5]=s=>I.value=s),style:{width:"80vw"},header:"Detalles de la Venta",modal:!0,closable:!0},{default:o(()=>[m.value?(x(),le("div",Fe,[n(a(f),null,{title:o(()=>[t("div",Se,[e[21]||(e[21]=t("span",null,"Información General",-1)),n(a(w),{value:m.value.estado,severity:N(m.value.estado),icon:P(m.value.estado)},null,8,["value","severity","icon"])])]),content:o(()=>{var s;return[t("div",Ie,[t("div",Le,[t("div",He,[e[22]||(e[22]=t("i",{class:"pi pi-hashtag text-gray-500"},null,-1)),e[23]||(e[23]=t("strong",null,"ID:",-1)),k(" #"+c(m.value.id),1)]),t("div",Ne,[e[24]||(e[24]=t("i",{class:"pi pi-calendar text-gray-500"},null,-1)),e[25]||(e[25]=t("strong",null,"Fecha:",-1)),k(" "+c(H(m.value.fecha)),1)]),t("div",Pe,[e[26]||(e[26]=t("i",{class:"pi pi-user text-gray-500"},null,-1)),e[27]||(e[27]=t("strong",null,"Cliente:",-1)),k(" "+c((s=m.value.cliente)==null?void 0:s.nombre),1)])]),t("div",je,[t("div",Be,[e[28]||(e[28]=t("i",{class:"pi pi-dollar text-gray-500"},null,-1)),e[29]||(e[29]=t("strong",null,"Total:",-1)),t("span",Te," $"+c(h(m.value.total)),1)])])])]}),_:1}),n(a(f),null,{title:o(()=>{var s;return[k(" Productos Vendidos ("+c(((s=m.value.detalle_ventas)==null?void 0:s.length)||0)+") ",1)]}),content:o(()=>[n(a(U),{value:m.value.detalle_ventas,class:"p-datatable-sm",stripedRows:""},{default:o(()=>[n(a(u),{field:"producto.nombre",header:"Producto"},{body:o(({data:s})=>{var r;return[t("div",Ue,[e[30]||(e[30]=t("i",{class:"pi pi-box text-blue-500"},null,-1)),t("span",Ae,c((r=s.producto)==null?void 0:r.nombre),1)])]}),_:1}),n(a(u),{field:"producto.categoria.nombre",header:"Categoría"},{body:o(({data:s})=>{var r,j;return[n(a(w),{value:((j=(r=s.producto)==null?void 0:r.categoria)==null?void 0:j.nombre)||"Sin categoría"},null,8,["value"])]}),_:1}),n(a(u),{field:"cantidad",header:"Cantidad",style:{width:"100px"}},{body:o(({data:s})=>[t("span",qe,c(s.cantidad),1)]),_:1}),n(a(u),{field:"precio_unitario",header:"Precio Unit.",style:{width:"120px"}},{body:o(({data:s})=>[t("span",null,"$"+c(h(s.precio_unitario)),1)]),_:1}),n(a(u),{field:"subtotal",header:"Subtotal",style:{width:"120px"}},{body:o(({data:s})=>[t("span",Re," $"+c(h(s.subtotal)),1)]),_:1})]),_:1},8,["value"])]),_:1})])):V("",!0)]),_:1},8,["visible"]),n(a(ee))]),_:1})}}},We=ne(Ge,[["__scopeId","data-v-34b9c7bc"]]);export{We as default};
