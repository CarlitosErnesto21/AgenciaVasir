import{A as ae}from"./AuthenticatedLayout-1pvH29Bk.js";import{a3 as se,E as L,r as n,o as W,w as oe,k as re,c as M,d as x,p as h,$,a0 as le,x as ne,h as E,j as ie,e as s,y as de,t as ue,F as ce,N as A}from"./vendor-gbh1WW5n.js";import{s as q}from"./app-Cj2H5JH9.js";import"./ui-BrU4k96Z.js";import pe from"./LoadingState-AWTz1OIu.js";import me from"./MetricasCard-DwvYTZpx.js";import ve from"./WidgetsSecundarios-D99tL6dT.js";import fe from"./ActividadReciente-BcSfWNyJ.js";import ge from"./ModalesInteractivos-DnniL1WF.js";import be from"./GraficosSection-oHs4GKaI.js";import xe from"./FormularioDatosCompletos-lhbOGTE4.js";import"./index-I53oXuBL.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vue-tel-input-nvsKEitw.js";const he={key:2,class:"px-2 sm:px-4 lg:px-6 py-4 sm:py-6 space-y-4 sm:space-y-6 mt-1 sm:mt-1"},ye={class:"flex justify-between items-center"},ke=["disabled"],_e={class:"grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6"},we={class:"bg-white rounded-lg shadow-sm border border-gray-100 p-4 sm:p-6"},De={class:"h-48 sm:h-64"},$e={key:1,class:"flex items-center justify-center h-full"},Ae={class:"bg-white rounded-lg shadow-sm border border-gray-100 p-4 sm:p-6"},Se={class:"h-48 sm:h-64"},Ce={key:1,class:"flex items-center justify-center h-full"},je={class:"grid grid-cols-1 xl:grid-cols-2 gap-4 sm:gap-6"},Re=5*60*1e3,We={__name:"Dashboard",setup(Fe){const i=se().props.user,G=L(()=>i&&i.roles&&i.roles.some(e=>e.name==="Administrador")),j=L(()=>i&&i.empleado?i.empleado:null),R=n(!1),H=L(()=>{if(!i)return!1;const e=j.value;return G.value&&(!e||!e.cargo||!e.telefono)});W(()=>{H.value&&(R.value=!0)}),oe(H,e=>{e&&(R.value=!0)});const P=n(),V=n(),U=n(),Y=n(),y=n(!0),r=n({}),I=n(null),N=n(null),w=n([{label:"Ventas Hoy",value:"0",icon:"pi pi-shopping-cart",color:"from-[#ef233c] to-[#d90429]",text:"text-[#7b1f26]",key:"ventas_hoy",category:"ventas",description:"Ventas del día"},{label:"Ingresos Hoy",value:"$0",icon:"pi pi-dollar",color:"from-[#ffd600] to-[#ffb700]",text:"text-[#a68700]",key:"ingresos_hoy",category:"ventas",description:"Ingresos del día"},{label:"Reservas del Mes",value:"0",icon:"pi pi-calendar-plus",color:"from-[#6c00f9] to-[#480ca8]",text:"text-[#240046]",key:"reservas_mes",category:"reservas",description:"Reservas este mes"},{label:"Tours Activos",value:"0",icon:"pi pi-map-marker",color:"from-[#0077b6] to-[#023e8a]",text:"text-[#03045e]",key:"tours_activos",category:"reservas",description:"Tours disponibles"}]),D=n([{title:"Reservas Pendientes",value:"0",icon:"faClock",color:"bg-[#fff3b0] border-[#ffd600]",iconColor:"text-[#ffd600]",key:"reservas_pendientes"},{title:"Productos Stock Bajo",value:"0",icon:"faExclamationTriangle",color:"bg-[#ffe5e5] border-[#ef233c]",iconColor:"text-[#d90429]",key:"productos_stock_bajo"},{title:"Valor Inventario",value:"$0",icon:"faWallet",color:"bg-[#e5daff] border-[#6c00f9]",iconColor:"text-[#480ca8]",key:"valor_total_inventario"},{title:"Clientes Activos",value:"0",icon:"faUsers",color:"bg-[#d0f1ff] border-[#0077b6]",iconColor:"text-[#023e8a]",key:"clientes_activos"}]),F=n(!1),J=()=>{F.value=!F.value},T=(e,t=null)=>{if(typeof e=="number")return e>=1e6?"$"+(e/1e6).toFixed(1)+"M":e>=1e3?"$"+(e/1e3).toFixed(1)+"k":e>=100?"$"+Math.round(e):"$"+e.toFixed(2);if(typeof e=="string"&&e.includes("$")){let o;if(t&&t.valor_total_inventario)o=parseFloat(t.valor_total_inventario);else{const l=e.replace(/[$\s]/g,"").replace(/,/g,".");o=parseFloat(l)}return isNaN(o)?"$0":o>=1e6?"$"+(o/1e6).toFixed(1)+"M":o>=1e3?"$"+(o/1e3).toFixed(1)+"k":o>=100?"$"+Math.round(o):"$"+o.toFixed(2)}return e},Z=async(e=!1)=>{const t=Date.now();if(!e&&I.value&&N.value&&t<N.value){r.value=I.value,O(r.value.inventario,r.value.ventas,r.value.reservas,r.value.resumenReservas,r.value.tours),z(r.value.inventario,r.value.ventas,r.value.stockBajo,r.value.reservas,r.value.resumenReservas),y.value=!1;return}y.value=!0;try{const o={headers:{Accept:"application/json"},timeout:1e4},[l,k,v,d,f,c]=await Promise.allSettled([A.get("/api/inventario/resumen",o),A.get("/api/ventas?desde="+new Date(Date.now()-30*24*60*60*1e3).toISOString().split("T")[0],o),A.get("/api/inventario/stock-bajo?limit=20",o),A.get("/api/reservas?per_page=100&desde="+new Date(Date.now()-60*24*60*60*1e3).toISOString().split("T")[0],o),A.get("/api/reservas/resumen",o),A.get("/api/tours?estado=activo,disponible&limit=50",o)]),g=l.status==="fulfilled"?l.value.data.data||l.value.data||{}:{},u=k.status==="fulfilled"?k.value.data.data||k.value.data||[]:[],p=v.status==="fulfilled"?v.value.data.data||v.value.data||[]:[],_=d.status==="fulfilled"?d.value.data.data||d.value.data||[]:[],b=f.status==="fulfilled"?f.value.data.data||f.value.data||[]:[],B=c.status==="fulfilled"?c.value.data.data||c.value.data||[]:[];O(g,u,_,b,B),z(g,u,p,_,b),r.value={inventario:g,ventas:u,stockBajo:p,reservas:_,resumenReservas:b,tours:B},I.value={...r.value},N.value=Date.now()+Re}catch{O({},[],[],[],[]),z({},[],[],[])}finally{y.value=!1}},O=(e,t,o,l,k)=>{const v=Array.isArray(t)?t:[],d=Array.isArray(o)?o:[],f=Array.isArray(k)?k:[],c=new Date,g=`${c.getFullYear()}-${String(c.getMonth()+1).padStart(2,"0")}-${String(c.getDate()).padStart(2,"0")}`,u=v.filter(a=>{if(!a.fecha)return!1;const S=a.fecha.split("T")[0]===g,C=a.estado&&a.estado.toLowerCase()==="completada";return S&&C}).length,p=v.filter(a=>{if(!a.fecha)return!1;const S=a.fecha.split("T")[0]===g,C=a.estado&&a.estado.toLowerCase()==="completada";return S&&C}).reduce((a,m)=>a+(parseFloat(m.total)||0),0),_=new Date().getMonth(),b=new Date().getFullYear(),B=d.filter(a=>{if(!a.fecha_reserva&&!a.fecha)return!1;const m=new Date(a.fecha_reserva||a.fecha),S=m.getMonth()===_&&m.getFullYear()===b,C=a.estado&&a.estado.toUpperCase()==="FINALIZADA";return S&&C}).length,X=f.filter(a=>a.estado&&a.estado.toUpperCase()==="DISPONIBLE").length;w.value[0].value=u.toString(),w.value[1].value=`$${p.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`,w.value[1].rawValue=p,w.value[2].value=B.toString(),w.value[3].value=X.toString();const ee=d.filter(a=>a.estado&&a.estado.toUpperCase()==="PENDIENTE").length,te=new Set(d.map(a=>{var m;return(m=a.cliente)==null?void 0:m.id}).filter(a=>a)).size;D.value[0].value=ee.toString(),D.value[1].value=(e.productos_stock_bajo||0).toString(),D.value[2].value=`$${Number(e.valor_total_inventario||0).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`,D.value[2].rawValue=Number(e.valor_total_inventario||0),D.value[3].value=te.toString()},z=(e,t,o,l,k)=>{const v=e.total_productos||0,d=e.productos_stock_bajo||0,f=e.productos_agotados||0,c=e.productos_disponibles||Math.max(0,v-d-f),g=Array.isArray(l)?l:[];P.value={labels:["Productos Disponibles","Stock Bajo","Agotados"],datasets:[{label:"Estado del Inventario",data:[c,d,f],backgroundColor:["#10b981","#f59e0b","#ef4444"],hoverBackgroundColor:["#34d399","#fbbf24","#f87171"]}]};const u=g.reduce((p,_)=>{const b=_.estado||"Sin estado";return p[b]=(p[b]||0)+1,p},{});Object.keys(u).length===0&&(u["Sin reservas"]=0),V.value={labels:Object.keys(u),datasets:[{label:"Reservas por Estado",data:Object.values(u),backgroundColor:["#f59e0b","#10b981","#ef4444","#3b82f6"]}]}},K=()=>({maintainAspectRatio:!1,plugins:{title:{display:!0,text:"Estado del Inventario",font:{size:18}},legend:{display:!0,position:"bottom",labels:{usePointStyle:!0,color:"#374151"}},tooltip:{callbacks:{label:function(e){return`${e.label}: ${e.parsed} productos`}}}}}),Q=()=>({maintainAspectRatio:!1,plugins:{title:{display:!0,text:"Reservas por Estado",font:{size:18}},legend:{display:!1},tooltip:{callbacks:{label:function(e){return`${e.label}: ${e.parsed.y} reservas`}}}},scales:{x:{ticks:{color:"#374151"},grid:{color:"#e5e7eb"}},y:{beginAtZero:!0,ticks:{color:"#374151"},grid:{color:"#e5e7eb"}}}});return W(()=>{U.value=K(),Y.value=Q(),Z()}),(e,t)=>{const o=re("Toast");return x(),M(ce,null,[h($(le),{title:"Dashboard"}),h(ae,null,{default:ne(()=>[h(o,{class:"z-[9999]"}),R.value?(x(),E(xe,{key:0,empleado:j.value&&j.value.value?j.value.value:{},"user-id":$(i)&&$(i).id?$(i).id:null,onClose:t[0]||(t[0]=l=>R.value=!1)},null,8,["empleado","user-id"])):ie("",!0),y.value?(x(),E(pe,{key:1})):(x(),M("div",he,[s("div",ye,[t[3]||(t[3]=s("h1",{class:"text-2xl sm:text-3xl font-bold text-blue-600"},"Panel Administrativo",-1)),s("button",{onClick:t[1]||(t[1]=l=>Z(!0)),disabled:y.value,class:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white text-sm font-medium rounded-lg transition-colors duration-200"},[s("i",{class:de(["pi pi-refresh",{"animate-spin":y.value}])},null,2),s("span",null,ue(y.value?"Actualizando...":"Actualizar"),1)],8,ke)]),h(me,{metrics:w.value,"dashboard-data":r.value,"format-value-for-mobile":T},null,8,["metrics","dashboard-data"]),s("div",_e,[h(ve,{widgets:D.value,"dashboard-data":r.value,"format-value-for-mobile":T,onToggleStockModal:J},null,8,["widgets","dashboard-data"]),s("div",we,[t[5]||(t[5]=s("h3",{class:"text-base sm:text-lg font-semibold text-gray-900 mb-2 sm:mb-3"},"Inventario por Estado",-1)),t[6]||(t[6]=s("div",{class:"bg-purple-50 border border-purple-200 rounded-lg p-3 mb-3 sm:mb-4"},[s("div",{class:"flex items-start space-x-2"},[s("i",{class:"pi pi-chart-pie text-purple-500 text-sm mt-0.5 flex-shrink-0"}),s("div",{class:"text-xs sm:text-sm text-purple-700"},[s("p",{class:"font-medium mb-1"},"Estado actual del inventario"),s("p",{class:"text-purple-600"},"Productos disponibles (stock > mínimo), stock bajo (stock ≤ mínimo) y agotados (stock = 0).")])])],-1)),s("div",De,[P.value?(x(),E($(q),{key:0,type:"pie",data:P.value,options:U.value,class:"w-full h-full"},null,8,["data","options"])):(x(),M("div",$e,t[4]||(t[4]=[s("p",{class:"text-gray-500 text-xs sm:text-sm"},"No hay datos de inventario",-1)])))])]),s("div",Ae,[t[8]||(t[8]=s("h3",{class:"text-base sm:text-lg font-semibold text-gray-900 mb-2 sm:mb-3"},"Reservas por Estado",-1)),t[9]||(t[9]=s("div",{class:"bg-orange-50 border border-orange-200 rounded-lg p-3 mb-3 sm:mb-4"},[s("div",{class:"flex items-start space-x-2"},[s("i",{class:"pi pi-chart-bar text-orange-500 text-sm mt-0.5 flex-shrink-0"}),s("div",{class:"text-xs sm:text-sm text-orange-700"},[s("p",{class:"font-medium mb-1"},"Distribución de reservas por estado"),s("p",{class:"text-orange-600"},"Muestra todas las reservas registradas agrupadas por su estado actual en el sistema.")])])],-1)),s("div",Se,[V.value?(x(),E($(q),{key:0,type:"bar",data:V.value,options:Y.value,class:"w-full h-full"},null,8,["data","options"])):(x(),M("div",Ce,t[7]||(t[7]=[s("p",{class:"text-gray-500 text-xs sm:text-sm"},"No hay datos de reservas",-1)])))])])]),s("div",je,[h(be,{"resumen-reservas-data":r.value.resumenReservas,"reservas-data":r.value.reservas},null,8,["resumen-reservas-data","reservas-data"]),h(fe,{"dashboard-data":r.value,"format-value-for-mobile":T},null,8,["dashboard-data"])])])),h(ge,{"show-productos-stock-bajo-modal":F.value,"dashboard-data":r.value,onCloseStockModal:t[2]||(t[2]=l=>F.value=!1)},null,8,["show-productos-stock-bajo-modal","dashboard-data"])]),_:1})],64)}}};export{We as default};
