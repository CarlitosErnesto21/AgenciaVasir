import{r as y,E as X,o as H,w as E,c as v,d as g,j as b,e as o,q as j,t as p,v as C,a7 as S,y as f,p as h,$ as k,a9 as Y,a3 as Z}from"./vendor-CqKcGHPa.js";import{z as W}from"./vue-tel-input-J95PmLrS.js";import{q as G}from"./ui-DrLUz167.js";const J={class:"space-y-6"},K={key:0,class:"bg-gradient-to-r from-blue-50 to-purple-50 p-4 rounded-lg"},Q={class:"text-sm text-blue-500 mb-1"},_={class:"text-sm text-blue-500"},ee={key:1,class:"flex items-center justify-between mb-3"},te={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},ae=["disabled"],oe=["value","maxlength","disabled","placeholder"],ie={class:"grid grid-cols-1 sm:grid-cols-2 gap-4 mt-4"},le=["disabled"],re={class:"grid grid-cols-1 sm:grid-cols-2 gap-4 mt-4"},ne={class:"mr-1"},se={class:"sm:col-span-1"},ue=["disabled"],fe={__name:"FormularioDatosPersonales",props:{formulario:{type:Object,required:!0},tieneClienteExistente:{type:Boolean,default:!1},user:{type:Object,default:null}},emits:["update:formulario","mostrar-toast"],setup(n,{expose:R,emit:I}){const m=n,u=I,T=y([{id:"DUI",nombre:"DUI"},{id:"PASAPORTE",nombre:"PASAPORTE"}]);y(!1);const l=y({isValid:!1,country:null,formattedNumber:"",mensaje:"",mostrarMensaje:!1}),r=y({isValid:!1,mensaje:"",mostrarMensaje:!1}),s=y({isValid:!0,mensaje:"",mostrarMensaje:!1}),a=X({get(){return m.formulario},set(t){u("update:formulario",t)}}),U=async t=>{if(!(!t||typeof t!="object"))try{l.value.isValid=t.valid===!0,l.value.country={name:t.country,code:t.countryCode},l.value.formattedNumber=t.formatted||"",m.tieneClienteExistente?l.value.mensaje=t.valid?"Número válido (guardado previamente)":"":t.valid===!0?await q(t.formatted):l.value.mensaje=""}catch(e){console.error("Error en validación:",e),l.value.mensaje="Error en validación"}},q=async t=>{var e,i;if(!(!t||t.length<8))try{const d=await(await fetch("/api/clientes/validar-telefono",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")||""}`,"X-CSRF-TOKEN":((e=document.querySelector('meta[name="csrf-token"]'))==null?void 0:e.getAttribute("content"))||"","X-Requested-With":"XMLHttpRequest"},credentials:"same-origin",body:JSON.stringify({telefono:t})})).json();d.disponible?l.value.mensaje="Número válido para "+((i=l.value.country)==null?void 0:i.name):(l.value.isValid=!1,l.value.mensaje=d.message||"Este teléfono ya está registrado")}catch(c){console.error("[FormularioDatosPersonales] Error validando teléfono:",c),l.value.mensaje="Error al validar teléfono"}},w=(t,e)=>{if(!t||!e){s.value.mensaje="",s.value.isValid=!0;return}e==="DUI"?/^\d{8}-\d{1}$/.test(t)?(s.value.mensaje="",s.value.isValid=!0):(s.value.mensaje="El DUI debe tener 9 dígitos (formato: 12345678-9)",s.value.isValid=!1):e==="PASAPORTE"&&(/^[A-Z0-9]{6,9}$/.test(t)?(s.value.mensaje="",s.value.isValid=!0):(s.value.mensaje="El PASAPORTE debe tener entre 6 y 9 caracteres (solo letras mayúsculas y números)",s.value.isValid=!1))},D=async t=>{var e,i,c;if(!(!t||t.length<3))try{const x=await(await fetch("/api/clientes/validar-documento",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")||""}`,"X-CSRF-TOKEN":((e=document.querySelector('meta[name="csrf-token"]'))==null?void 0:e.getAttribute("content"))||"","X-Requested-With":"XMLHttpRequest"},credentials:"same-origin",body:JSON.stringify({numero_identificacion:t})})).json();x.disponible?(r.value.mensaje="✓ Número de identificación disponible",r.value.isValid=!0):(r.value.isValid=!1,r.value.mensaje=x.message||"Este número de identificación ya está registrado")}catch(d){console.error("[FormularioDatosPersonales] Error validando documento:",d),r.value.isValid=!1,((i=d.response)==null?void 0:i.status)===403?r.value.mensaje="No tienes permisos para validar este documento":((c=d.response)==null?void 0:c.status)===401?r.value.mensaje="Error de autenticación":r.value.mensaje="Error al validar documento"}},F=()=>{const t=new Date;return t.setFullYear(t.getFullYear()-18),t},P=t=>{if(!t)return{esValido:!0,mensaje:""};const e=new Date,i=new Date(t),c=e.getFullYear()-i.getFullYear(),d=i.getMonth(),x=i.getDate(),A=e.getMonth(),L=e.getDate(),N=c-(A<d||A===d&&L<x?1:0);return N<18?{esValido:!1,mensaje:`Debe ser mayor de edad (18 años). Edad actual: ${N} años`}:{esValido:!0,mensaje:""}},M=()=>{if(!a.value.tipo_documento)return u("mostrar-toast",{severity:"error",summary:"Campo requerido",detail:"Por favor, seleccione un tipo de documento.",life:4e3}),!1;if(!a.value.numero_identificacion)return u("mostrar-toast",{severity:"error",summary:"Campo requerido",detail:"Por favor, ingrese su número de identificación.",life:4e3}),!1;if(!V())return!1;if(a.value.fecha_nacimiento){const t=P(a.value.fecha_nacimiento);if(!t.esValido)return u("mostrar-toast",{severity:"error",summary:"Edad insuficiente",detail:t.mensaje,life:4e3}),!1}else return u("mostrar-toast",{severity:"error",summary:"Campo requerido",detail:"Por favor, seleccione su fecha de nacimiento.",life:4e3}),!1;return a.value.direccion?a.value.genero?a.value.telefono?a.value.telefono&&l.value.isValid===!1&&l.value.mensaje!=="Número válido (guardado previamente)"?(l.value.mensaje&&(l.value.mensaje.includes("registrado")||l.value.mensaje.includes("diferente"))?u("mostrar-toast",{severity:"warn",summary:"Teléfono ya registrado",detail:l.value.mensaje,life:5e3}):u("mostrar-toast",{severity:"error",summary:"Teléfono inválido",detail:"Por favor, ingrese un número de teléfono válido.",life:4e3}),!1):!m.tieneClienteExistente&&a.value.numero_identificacion&&!r.value.isValid?(u("mostrar-toast",{severity:"warn",summary:"Documento no disponible",detail:r.value.mensaje||"Este número de identificación no está disponible.",life:5e3}),!1):!0:(u("mostrar-toast",{severity:"error",summary:"Campo requerido",detail:"Por favor, ingrese su número de teléfono.",life:4e3}),!1):(u("mostrar-toast",{severity:"error",summary:"Campo requerido",detail:"Por favor, seleccione su género.",life:4e3}),!1):(u("mostrar-toast",{severity:"error",summary:"Campo requerido",detail:"Por favor, ingrese su dirección.",life:4e3}),!1)},O=()=>{Z.visit("/profile")};R({tiposDocumentos:T,validateForm:M});const B=t=>{const i=t.replace(/[^0-9]/g,"").substring(0,9);return i.length>8?i.substring(0,8)+"-"+i.substring(8):i},$=t=>t.toUpperCase().replace(/[^A-Z0-9]/g,"").substring(0,9),z=t=>{const e=t.target.value;let i="";a.value.tipo_documento==="DUI"?(i=B(e),a.value.numero_identificacion=i,t.target.value=i):a.value.tipo_documento==="PASAPORTE"&&(i=$(e),a.value.numero_identificacion=i,t.target.value=i),V(),a.value.numero_identificacion&&a.value.numero_identificacion.length>=3&&((a.value.tipo_documento==="DUI"&&/^\d{8}-\d{1}$/.test(a.value.numero_identificacion)||a.value.tipo_documento==="PASAPORTE"&&/^[A-Z0-9]{6,9}$/.test(a.value.numero_identificacion))&&!m.tieneClienteExistente?D(a.value.numero_identificacion):(r.value.mensaje="",r.value.isValid=!0))},V=()=>a.value.numero_identificacion?(w(a.value.numero_identificacion,a.value.tipo_documento),s.value.isValid):!0;return H(()=>{}),E(()=>a.value.numero_identificacion,t=>{t&&a.value.tipo_documento?(V(),w(t,a.value.tipo_documento),t.length>=3&&s.value.isValid&&(m.tieneClienteExistente?(r.value.mensaje="",r.value.isValid=!0):D(t))):(r.value.mensaje="",r.value.isValid=!0)}),E(()=>a.value.tipo_documento,()=>{m.tieneClienteExistente||(a.value.numero_identificacion=""),r.value.mensaje="",r.value.isValid=!0,s.value.mensaje="",s.value.isValid=!0}),E(()=>a.value.fecha_nacimiento,t=>{if(t){const e=P(t);e.esValido||u("mostrar-toast",{severity:"error",summary:"Edad insuficiente",detail:e.mensaje,life:4e3})}}),E(()=>m.formulario.telefono,(t,e)=>{t&&t!==e&&m.tieneClienteExistente&&(l.value={isValid:!0,country:{name:"Válido",code:""},formattedNumber:t,mensaje:"Número válido (guardado previamente)"})},{immediate:!0}),(t,e)=>(g(),v("div",J,[n.user?(g(),v("div",K,[e[7]||(e[7]=o("h3",{class:"font-bold text-lg text-blue-500 mb-2"},"Información de tu cuenta:",-1)),o("p",Q,[e[5]||(e[5]=o("strong",null,"Nombre:",-1)),j(" "+p(n.user.name),1)]),o("p",_,[e[6]||(e[6]=o("strong",null,"Email:",-1)),j(" "+p(n.user.email),1)])])):b("",!0),n.tieneClienteExistente?(g(),v("div",ee,[e[10]||(e[10]=o("h4",{class:"font-semibold text-gray-800"},"Información Personal",-1)),o("div",{class:"flex items-center gap-3"},[e[9]||(e[9]=o("div",{class:"flex items-center text-green-600 text-sm"},[o("svg",{class:"w-4 h-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20"},[o("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})]),o("span",null,"Datos precargados")],-1)),o("button",{onClick:O,type:"button",class:"inline-flex items-center px-3 py-1.5 border border-blue-300 text-xs font-medium rounded-md text-blue-700 bg-blue-50 hover:bg-blue-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200",title:"Editar mis datos personales"},e[8]||(e[8]=[o("svg",{class:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1),j(" Editar datos ")]))])])):b("",!0),o("div",te,[o("div",null,[e[12]||(e[12]=o("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Documento de identidad",-1)),C(o("select",{"onUpdate:modelValue":e[0]||(e[0]=i=>a.value.tipo_documento=i),required:"",disabled:n.tieneClienteExistente,class:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100"},e[11]||(e[11]=[o("option",{value:"",disabled:""},"Seleccione un tipo",-1),o("option",{value:"DUI"},"DUI",-1),o("option",{value:"PASAPORTE"},"PASAPORTE",-1)]),8,ae),[[S,a.value.tipo_documento]])]),o("div",null,[e[13]||(e[13]=o("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Número de identificación",-1)),o("input",{value:a.value.numero_identificacion,onInput:z,type:"text",required:"",maxlength:a.value.tipo_documento==="DUI"?10:9,disabled:n.tieneClienteExistente,class:f(["w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",{"bg-gray-100 cursor-not-allowed":n.tieneClienteExistente}]),placeholder:a.value.tipo_documento==="DUI"?"Ingrese 9 dígitos (ej: 123456789)":"Ingrese su PASAPORTE (ej: A1B2C3D4)"},null,42,oe),s.value.mensaje&&!n.tieneClienteExistente?(g(),v("small",{key:0,class:f(["block mt-1",s.value.isValid?"text-green-600":"text-red-500"])},p(s.value.mensaje),3)):b("",!0),r.value.mensaje&&!n.tieneClienteExistente?(g(),v("small",{key:1,class:f(["block mt-1",r.value.isValid?"text-green-600":"text-red-500"])},p(r.value.mensaje),3)):b("",!0)])]),o("div",ie,[o("div",null,[e[14]||(e[14]=o("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Fecha de nacimiento",-1)),h(k(G),{modelValue:a.value.fecha_nacimiento,"onUpdate:modelValue":e[1]||(e[1]=i=>a.value.fecha_nacimiento=i),maxDate:F(),"date-format":"dd/mm/yy",placeholder:"Seleccionar fecha de nacimiento (debe ser mayor de 18 años)",showIcon:"",yearNavigator:"",yearRange:"1920:2006",disabled:n.tieneClienteExistente,class:"w-full",inputClass:`w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 ${n.tieneClienteExistente?"bg-gray-100 cursor-not-allowed":""}`},null,8,["modelValue","maxDate","disabled","inputClass"])]),o("div",null,[e[16]||(e[16]=o("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Género",-1)),C(o("select",{"onUpdate:modelValue":e[2]||(e[2]=i=>a.value.genero=i),required:"",disabled:n.tieneClienteExistente,class:f(["w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",{"bg-gray-100 cursor-not-allowed":n.tieneClienteExistente}])},e[15]||(e[15]=[o("option",{value:""},"Seleccione",-1),o("option",{value:"MASCULINO"},"Masculino",-1),o("option",{value:"FEMENINO"},"Femenino",-1)]),10,le),[[S,a.value.genero]])])]),o("div",re,[o("div",null,[e[17]||(e[17]=o("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Teléfono",-1)),h(k(W),{modelValue:a.value.telefono,"onUpdate:modelValue":e[3]||(e[3]=i=>a.value.telefono=i),defaultCountry:"SV",preferredCountries:["SV","GT","HN","CR","NI","PA","BZ"],validCharactersOnly:!0,disabled:n.tieneClienteExistente,dropdownOptions:{showDialCodeInSelection:!0,showFlags:!0,showSearchBox:!0,showDialCodeInList:!0},inputOptions:{placeholder:"Número de teléfono"},mode:"international",class:f(["w-full border border-gray-300 rounded-lg",{"bg-gray-100 cursor-not-allowed":n.tieneClienteExistente}]),onValidate:U},null,8,["modelValue","disabled","class"]),l.value.mensaje?(g(),v("p",{key:0,class:f(["text-xs mt-1 flex items-center",l.value.isValid?"text-green-600":"text-red-600"])},[o("span",ne,p(l.value.isValid?"✓":"⚠️"),1),j(" "+p(l.value.mensaje),1)],2)):b("",!0)]),o("div",se,[e[18]||(e[18]=o("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Dirección de residencia",-1)),C(o("input",{"onUpdate:modelValue":e[4]||(e[4]=i=>a.value.direccion=i),type:"text",required:"",maxlength:"200",disabled:n.tieneClienteExistente,class:f(["w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",{"bg-gray-100 cursor-not-allowed":n.tieneClienteExistente}]),placeholder:"Dirección completa"},null,10,ue),[[Y,a.value.direccion]])])])]))}};export{fe as default};
