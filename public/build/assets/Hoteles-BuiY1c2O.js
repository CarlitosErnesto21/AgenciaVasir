import{q as ce,r as n,F as ve,s as pe,E as y,y as I,c as v,o as p,a as s,u as d,g as me,w as i,b as l,G as fe,S as ge,h as g,t as h,f as w,n as k,j as O,M as R,J as L,N as be,A as W,B as xe,C as ye}from"./app-WKwrJkJC.js";import{_ as he}from"./AuthenticatedLayout-baeqBx4a.js";import{F as U,j as we,k as _e,l as Ce,c as ke}from"./index-Cz7jU3Cp.js";import"./logo-DN1bLr27.js";const Ve={class:"py-6 px-7 mt-10 mx-auto bg-red-100 shadow-md rounded-lg"},Ee={class:"flex flex-col lg:flex-row lg:justify-between lg:items-center mb-4 gap-4"},Ie={class:"flex flex-col sm:flex-row items-center gap-4 w-full lg:w-auto lg:justify-end"},De={class:"flex gap-2"},Ne=["onClick"],He=["onClick"],Ue=["onClick"],Ae={class:"space-y-4"},Te={class:"w-full flex flex-col"},$e={class:"flex items-center gap-4"},Fe={key:0,class:"text-red-500 ml-28"},Se={class:"w-full flex flex-col"},je={class:"flex items-center gap-4"},Le={key:0,class:"text-red-500 ml-28"},Pe={class:"w-full flex flex-col"},Be={class:"flex items-center gap-4"},Me={key:0,class:"text-red-500 ml-28"},ze={class:"w-full flex flex-col"},Ge={class:"flex items-center gap-4"},Oe={key:0,class:"text-red-500 ml-28"},Re={class:"w-full flex flex-col"},We={class:"flex items-center gap-4"},qe={key:0,class:"text-red-500 ml-28"},Je={class:"w-full flex flex-col"},Ke={class:"flex items-center gap-4"},Ze={key:0,class:"text-red-500 ml-28"},Qe={class:"w-full flex flex-col"},Xe={class:"flex items-center gap-4"},Ye={key:0,class:"text-red-500 ml-28"},ea={class:"flex gap-4 flex-wrap mt-4 ml-28"},aa=["src"],la=["onClick"],oa={class:"flex justify-center gap-4 w-full"},ta=["label"],sa={class:"flex items-center gap-3"},ia={key:0,class:"flex flex-col items-center justify-center"},ra={class:"flex justify-center items-center w-full h-96"},na=["src"],da={key:1,class:"text-center text-gray-500 py-8"},ua={class:"flex justify-center w-full"},A="/api/hoteles",q="/images/hoteles/",ga={__name:"Hoteles",setup(ca){const f=ce(),P=n([]),t=n({id:null,nombre:"",direccion:"",descripcion:"",estado:"",provincia:null,categoria:null,imagenes:[]}),m=n([]),x=n([]),_=n([]),B=n(),C=n(!1),V=n(!1),r=n(!1),T=n({global:{value:null,matchMode:ve.CONTAINS}}),D=n("Guardar"),J=n([]),M=n([]),$=n([]),z=n([{label:"Activo",value:"activo"},{label:"Inactivo",value:"inactivo"}]),N=n(!1),E=n([]);pe(()=>{F(),K(),Z(),Q()});const F=async()=>{try{const a=await y.get(A);P.value=a.data.map(e=>({...e,imagenes:(e.imagenes||[]).map(u=>typeof u=="string"?u:u.nombre)}))}catch{f.add({severity:"error",summary:"Error",detail:"No se pudieron cargar los hoteles",life:4e3})}},K=async()=>{try{const a=await y.get("/api/paises");J.value=a.data}catch{f.add({severity:"error",summary:"Error",detail:"No se pudieron cargar los países",life:4e3})}},Z=async()=>{try{const a=await y.get("/api/provincias");M.value=a.data}catch{f.add({severity:"error",summary:"Error",detail:"No se pudieron cargar las provincias",life:4e3})}},Q=async()=>{try{const a=await y.get("/api/categorias-hoteles");$.value=a.data,console.log("categoriasHoteles cargadas:",$.value)}catch{f.add({severity:"error",summary:"Error",detail:"No se pudieron cargar las categorías",life:4e3})}},X=()=>{t.value={id:null,nombre:"",direccion:"",descripcion:"",estado:"",provincia:null,categoria:null,imagenes:[]},m.value=[],x.value=[],_.value=[],r.value=!1,D.value="Guardar",C.value=!0},Y=a=>{t.value={...a},t.value.categoria=a.categoria_hotel?a.categoria_hotel.id:null,t.value.provincia=a.provincia?a.provincia.id:null,m.value=Array.isArray(a.imagenes)?a.imagenes.map(e=>typeof e=="string"?e:e.nombre):[],x.value=[],_.value=[],D.value="Actualizar",C.value=!0},ee=async()=>{if(r.value=!0,!(!t.value.nombre||!t.value.direccion||!t.value.descripcion||!t.value.estado||!t.value.provincia||!t.value.categoria)){if(m.value.length===0){f.add({severity:"error",summary:"Error",detail:"Debes subir al menos una imagen.",life:4e3});return}try{const a=new FormData;a.append("nombre",t.value.nombre),a.append("direccion",t.value.direccion),a.append("descripcion",t.value.descripcion),a.append("estado",t.value.estado),a.append("provincia_id",t.value.provincia),a.append("categoria_id",t.value.categoria),x.value.forEach(u=>{u instanceof File&&a.append("imagenes[]",u)}),_.value.forEach(u=>{a.append("removed_images[]",u.split("/").pop())});let e;t.value.id?(a.append("_method","PUT"),e=await y.post(`${A}/${t.value.id}`,a,{headers:{"Content-Type":"multipart/form-data"}}),f.add({severity:"info",summary:"Hotel actualizado",life:3e3})):(e=await y.post(A,a,{headers:{"Content-Type":"multipart/form-data"}}),f.add({severity:"success",summary:"Hotel agregado",life:3e3})),await F(),C.value=!1,t.value={id:null,nombre:"",direccion:"",descripcion:"",estado:"",provincia:null,categoria:null,imagenes:[]},m.value=[],x.value=[],_.value=[],r.value=!1}catch{f.add({severity:"error",summary:"Error",detail:"No se pudo guardar el hotel.",life:4e3})}console.log("Hotel enviado:",t.value)}},ae=a=>{t.value={...a},V.value=!0},le=async()=>{try{await y.delete(`${A}/${t.value.id}`),F(),V.value=!1,f.add({severity:"warn",summary:"Hotel eliminado",life:3e3})}catch{f.add({severity:"error",summary:"Error",detail:"No se pudo eliminar el hotel.",life:4e3})}},oe=()=>{C.value=!1,m.value=[],x.value=[],_.value=[],r.value=!1},te=a=>{for(const e of a.files)if(e instanceof File){x.value.push(e);const u=new FileReader;u.onload=H=>{m.value.push(H.target.result)},u.readAsDataURL(e)}},se=a=>{const e=m.value[a];typeof e=="string"&&e.startsWith("data:image")?(m.value.splice(a,1),x.value.splice(a,1)):(_.value.push(e),m.value.splice(a,1))};function ie(a){const e=z.value.find(u=>u.value===a);return e?e.label:""}function G(a){return a.replace(/^\s+/,"").replace(/[^A-Za-zÁÉÍÓÚáéíóúÑñÜü\s]/g,"")}function re(a,e){typeof e=="string"&&(t.value[a]=G(e))}function ne(a,e){e&&e.value&&(e.value=G(e.value))}const de=a=>{E.value=(a||[]).map(e=>q+(typeof e=="string"?e:e.nombre)),N.value=!0};return(a,e)=>{const u=I("Button"),H=I("InputText"),b=I("Column"),ue=I("DataTable"),S=I("Dialog");return p(),v(W,null,[s(d(me),{title:"Hoteles"}),s(he,null,{default:i(()=>[s(d(fe)),l("div",Ve,[l("div",Ee,[e[17]||(e[17]=l("h3",{class:"text-xl font-bold"},"Catálogo hoteles",-1)),l("div",Ie,[s(d(ge),{href:a.route("controlPaisesProvincias"),class:"p-button-sm p-button-info w-full sm:w-auto rounded-lg"},{default:i(()=>[s(d(U),{icon:d(we),size:"lg",class:"drop-shadow-md"},null,8,["icon"]),e[16]||(e[16]=l("span",{class:"ml-2 whitespace-nowrap"},"Control paises",-1))]),_:1,__:[16]},8,["href"]),s(u,{label:"Agregar hotel",icon:"pi pi-plus",class:"p-button-sm p-button-danger w-full sm:w-auto",onClick:X})])]),s(ue,{value:P.value,selection:B.value,"onUpdate:selection":e[1]||(e[1]=o=>B.value=o),dataKey:"id",filters:T.value,paginator:!0,rows:10,class:"overflow-x-auto max-w-full",style:{display:"block","max-width":"84vw"}},{header:i(()=>[s(H,{modelValue:T.value.global.value,"onUpdate:modelValue":e[0]||(e[0]=o=>T.value.global.value=o),placeholder:"Buscar...",class:"w-full"},null,8,["modelValue"])]),default:i(()=>[s(b,{field:"nombre",header:"Nombre",sortable:""}),s(b,{field:"direccion",header:"Dirección"},{body:i(o=>[g(h(o.data.direccion),1)]),_:1}),s(b,{field:"descripcion",header:"Descripción"},{body:i(o=>[g(h(o.data.descripcion||""),1)]),_:1}),s(b,{field:"estado",header:"Estado"},{body:i(o=>[g(h(ie(o.data.estado)),1)]),_:1}),s(b,{header:"Categoría"},{body:i(o=>{var c;return[g(h(((c=o.data.categoria_hotel)==null?void 0:c.nombre)||""),1)]}),_:1}),s(b,{field:"pais",header:"País"},{body:i(o=>{var c,j;return[g(h(((j=(c=o.data.provincia)==null?void 0:c.pais)==null?void 0:j.nombre)||""),1)]}),_:1}),s(b,{header:"Provincia"},{body:i(o=>{var c;return[g(h(((c=o.data.provincia)==null?void 0:c.nombre)||""),1)]}),_:1}),s(b,{header:"Acciones",exportable:!1},{body:i(o=>[l("div",De,[l("button",{class:"text-orange-600 hover:text-orange-900 transition-colors",onClick:c=>Y(o.data),title:"Editar"},[s(d(U),{icon:d(_e),class:"h-5 w-5"},null,8,["icon"])],8,Ne),l("button",{class:"text-blue-600 hover:text-blue-900 transition-colors",onClick:c=>de(o.data.imagenes)},[s(d(U),{icon:d(Ce),class:"h-5 w-5"},null,8,["icon"])],8,He),l("button",{class:"text-red-600 hover:text-red-900 transition-colors",onClick:c=>ae(o.data),title:"Eliminar"},[s(d(U),{icon:d(ke),class:"h-5 w-5"},null,8,["icon"])],8,Ue)])]),_:1})]),_:1},8,["value","selection","filters"]),s(S,{visible:C.value,"onUpdate:visible":e[10]||(e[10]=o=>C.value=o),header:D.value+" Hotel",modal:!0,style:{width:"500px"}},{footer:i(()=>[l("div",oa,[l("button",{onClick:oe,class:"flex items-center border border-green-600 text-green-600 hover:bg-green-50 disabled:border-gray-400 disabled:text-gray-400 font-semibold py-2 px-6 rounded-lg transition-colors duration-200"},e[26]||(e[26]=[l("i",{class:"pi pi-times mr-2"},null,-1),g(" Cancelar ")])),l("button",{label:D.value,onClick:ee,class:"bg-red-600 text-white hover:bg-red-700 disabled:bg-gray-400 disabled:text-gray-200 font-semibold py-2 px-6 rounded-lg transition-colors duration-200"},e[27]||(e[27]=[l("i",{class:"pi pi-check mr-2"},null,-1),g(" Guardar ")]),8,ta)])]),default:i(()=>[l("div",Ae,[l("div",Te,[l("div",$e,[e[18]||(e[18]=l("label",{for:"nombre",class:"w-24"},"Nombre:",-1)),s(H,{modelValue:t.value.nombre,"onUpdate:modelValue":e[2]||(e[2]=o=>t.value.nombre=o),modelModifiers:{trim:!0},id:"nombre",class:k([{"p-invalid":r.value&&!t.value.nombre},"flex-1"])},null,8,["modelValue","class"])]),r.value&&!t.value.nombre?(p(),v("small",Fe,"El nombre es obligatorio.")):w("",!0)]),l("div",Se,[l("div",je,[e[19]||(e[19]=l("label",{for:"direccion",class:"w-24"},"Dirección:",-1)),O(l("textarea",{"onUpdate:modelValue":e[3]||(e[3]=o=>t.value.direccion=o),id:"direccion",class:k([{"p-invalid":r.value&&!t.value.direccion},"flex-1"])},null,2),[[R,t.value.direccion,void 0,{trim:!0}]])]),r.value&&!t.value.direccion?(p(),v("small",Le,"La dirección es obligatoria.")):w("",!0)]),l("div",Pe,[l("div",Be,[e[20]||(e[20]=l("label",{for:"descripcion",class:"w-24"},"Descripción:",-1)),O(l("textarea",{"onUpdate:modelValue":e[4]||(e[4]=o=>t.value.descripcion=o),id:"descripcion",class:k([{"p-invalid":r.value&&!t.value.descripcion},"flex-1"])},null,2),[[R,t.value.descripcion,void 0,{trim:!0}]])]),r.value&&!t.value.descripcion?(p(),v("small",Me,"La descripción es obligatoria.")):w("",!0)]),l("div",ze,[l("div",Ge,[e[21]||(e[21]=l("label",{for:"estado",class:"w-24"},"Estado:",-1)),s(d(L),{modelValue:t.value.estado,"onUpdate:modelValue":e[5]||(e[5]=o=>t.value.estado=o),options:z.value,"option-label":"label","option-value":"value",id:"estado",class:k(["flex-1",{"p-invalid":r.value&&!t.value.estado}]),placeholder:"Selecciona un estado"},null,8,["modelValue","options","class"])]),r.value&&!t.value.estado?(p(),v("small",Oe,"El estado es obligatorio.")):w("",!0)]),l("div",Re,[l("div",We,[e[22]||(e[22]=l("label",{for:"categoria",class:"w-24"},"Categoría:",-1)),s(d(L),{modelValue:t.value.categoria,"onUpdate:modelValue":e[6]||(e[6]=o=>t.value.categoria=o),options:$.value,"option-label":"nombre","option-value":"id",id:"categoria",class:k(["flex-1",{"p-invalid":r.value&&!t.value.categoria}]),placeholder:"Selecciona una categoría"},null,8,["modelValue","options","class"])]),r.value&&!t.value.categoria?(p(),v("small",qe,"La categoría es obligatoria.")):w("",!0)]),l("div",Je,[l("div",Ke,[e[23]||(e[23]=l("label",{for:"provincia",class:"w-24"},"Provincia:",-1)),s(d(L),{modelValue:t.value.provincia,"onUpdate:modelValue":e[7]||(e[7]=o=>t.value.provincia=o),options:M.value,"option-label":"nombre","option-value":"id",id:"provincia",filter:!0,filterPlaceholder:"Buscar provincia...",showClear:!0,class:k([{"p-invalid":r.value&&!t.value.provincia},"flex-1"]),placeholder:"Selecciona una provincia",onInput:e[8]||(e[8]=o=>re("provincia",o)),onFilter:e[9]||(e[9]=o=>ne("provincia",o))},null,8,["modelValue","options","class"])]),r.value&&!t.value.provincia?(p(),v("small",Ze,"La provincia es obligatoria.")):w("",!0)]),l("div",Qe,[l("div",Xe,[e[24]||(e[24]=l("label",{for:"imagen",class:"w-24"},"Imágenes:",-1)),s(d(be),{mode:"basic",name:"imagenes[]",accept:"image/*",auto:!0,chooseLabel:"Seleccionar imágenes",onSelect:te,customUpload:!0,multiple:!0,class:"flex-1 p-button-rounded p-button-warn p-button-md mr-2"})]),r.value&&m.value.length===0?(p(),v("small",Ye,"Al menos una imagen es obligatoria.")):w("",!0)]),l("div",ea,[(p(!0),v(W,null,xe(m.value,(o,c)=>(p(),v("div",{key:c,class:"relative w-32 h-32"},[l("img",{src:o.startsWith("data:image")?o:q+o,alt:"Vista previa",class:"w-full h-full object-cover rounded border"},null,8,aa),l("button",{onClick:j=>se(c),class:"absolute top-0 right-0 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 shadow",style:{transform:"translate(50%, -50%)"}},e[25]||(e[25]=[l("i",{class:"pi pi-times text-xs"},null,-1)]),8,la)]))),128))])])]),_:1},8,["visible","header"]),s(S,{visible:V.value,"onUpdate:visible":e[12]||(e[12]=o=>V.value=o),header:"Confirmar",modal:!0,style:{width:"350px"}},{footer:i(()=>[l("button",{onClick:e[11]||(e[11]=o=>V.value=!1),class:"border border-green-600 text-green-600 hover:bg-green-50 disabled:border-gray-400 disabled:text-gray-400 font-semibold py-2 px-6 rounded-lg transition-colors duration-200"}," No "),l("button",{onClick:le,class:"bg-red-600 text-white hover:bg-red-700 disabled:bg-gray-400 disabled:text-gray-200 font-semibold py-2 px-6 rounded-lg transition-colors duration-200"}," Sí ")]),default:i(()=>[l("div",sa,[e[30]||(e[30]=l("i",{class:"pi pi-exclamation-triangle text-black-500",style:{"font-size":"1.50rem"}},null,-1)),l("span",null,[e[28]||(e[28]=g("¿Eliminar el hotel ")),l("b",null,h(t.value.nombre),1),e[29]||(e[29]=g("?"))])])]),_:1},8,["visible"]),s(S,{visible:N.value,"onUpdate:visible":e[15]||(e[15]=o=>N.value=o),header:"Imágenes del hotel",modal:!0,style:{width:"700px"}},{footer:i(()=>[l("div",ua,[l("button",{onClick:e[14]||(e[14]=o=>N.value=!1),class:"border border-green-600 text-green-600 hover:bg-green-50 disabled:border-gray-400 disabled:text-gray-400 font-semibold py-2 px-6 rounded-lg transition-colors duration-200"}," Cerrar ")])]),default:i(()=>[E.value.length?(p(),v("div",ia,[s(d(ye),{value:E.value,numVisible:1,numScroll:1,circular:!0,page:a.carouselIndex,"onUpdate:page":e[13]||(e[13]=o=>a.carouselIndex=o),class:"w-full",showIndicators:E.value.length>1,showNavigators:E.value.length>1,style:{"max-width":"610px"}},{item:i(o=>[l("div",ra,[l("img",{src:o.data,alt:"Imagen hotel",class:"w-auto h-full max-h-96 object-contain rounded shadow"},null,8,na)])]),_:1},8,["value","page","showIndicators","showNavigators"])])):(p(),v("div",da," No hay imágenes para este hotel. "))]),_:1},8,["visible"])])]),_:1})],64)}}};export{ga as default};
