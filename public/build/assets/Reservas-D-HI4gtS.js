import{r as u,E as _,w as be,o as oa,a5 as Se,a6 as la,h as xe,d as h,x as w,p as n,e as s,$ as r,a0 as na,A as ye,t as c,a2 as ia,y as R,c as E,j as A,q as z,v as Te,a9 as Oe,N as O,n as da}from"./vendor-gbh1WW5n.js";import{A as ua}from"./AuthenticatedLayout-Brf7D3Fu.js";import{z as ca,D as ma,a as va,r as pa,F as p,h as fa,q as ne,o as ga,e as ba,f as V,g as Ie}from"./ui-BrU4k96Z.js";import{i as ie,c as N,e as xa,f as W,D as Y,E as Le,o as he,n as ya,r as ha,F as Me,G as wa,a as Aa,z as Ea}from"./index-BWaQysKE.js";import Ra from"./Modales-DkV2XY49.js";import Ca from"./CambiarEstado-BuvDa7VX.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-DtyEsSN9.js";const Da={class:"flex items-center gap-3"},_a={class:"flex flex-col"},Na={class:"text-red-600 text-sm font-medium mt-1"},Sa={class:"container mx-auto px-4 py-6"},Ta={class:"mb-6"},Oa={class:"bg-white rounded-lg shadow-md"},Ia={key:0,class:"p-6 border-b border-gray-200"},La={class:"text-lg font-semibold text-blue-600 mb-2",style:{"word-break":"break-all","overflow-wrap":"break-word","max-width":"100%","white-space":"pre-wrap"}},Ma={class:"mb-4 space-y-2"},ka={class:"text-sm text-blue-600 flex items-center gap-2"},Fa={key:0,class:"bg-amber-50 p-3 rounded-md border border-amber-200"},Pa={class:"flex items-start gap-2"},za={class:"flex-1"},Va={class:"text-sm text-amber-600 mb-2"},$a={class:"flex flex-col sm:flex-row gap-2 items-start sm:items-center"},Ua={key:1,class:"text-sm text-blue-600 flex items-center gap-2 bg-blue-50 p-3 rounded-md border border-blue-200"},qa={key:2,class:"text-sm text-purple-600 flex items-center gap-2 bg-purple-50 p-3 rounded-md border border-purple-200"},Ha={key:3,class:"text-sm text-gray-600 flex items-center gap-2 bg-gray-50 p-2 rounded-md"},Ga={class:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:flex lg:flex-wrap gap-2 md:gap-3"},ja={class:"bg-gray-100 border-2 border-gray-300 rounded-lg px-2 py-2 md:px-4 md:py-3 flex-1 min-w-0"},Ba={class:"text-xs md:text-sm font-bold text-gray-800"},Za={class:"flex items-center gap-2 text-white"},Wa={class:"flex items-center gap-2 text-white"},Ya={class:"flex items-center gap-2 text-white"},Xa=["title"],Ja={class:"flex items-center gap-2 text-white"},Ka={class:"flex-1"},Qa={key:0,class:"text-xs opacity-70"},es={class:"bg-blue-50 p-3 rounded-lg shadow-sm border mb-4 mx-4"},as={class:"flex flex-wrap items-center justify-between gap-2 mb-3"},ss={class:"flex items-center gap-2 flex-wrap"},ts={class:"bg-blue-50 border border-blue-200 text-blue-700 px-2 py-1 rounded text-xs font-medium"},rs=["disabled"],os={class:"space-y-3"},ls={class:"relative"},ns={class:"grid grid-cols-1 md:grid-cols-3 gap-3"},is={class:"px-1 mt-3"},ds={class:"text-blue-600 text-xs font-medium flex items-center gap-1"},us={class:"text-center py-12"},cs={class:"font-medium text-xs sm:text-sm"},ms={class:"flex items-center gap-1 sm:gap-3"},vs={class:"w-6 h-6 sm:w-8 sm:h-8 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0"},ps={class:"min-w-0 flex-1"},fs=["title"],gs=["title"],bs={class:"text-xs sm:text-sm"},xs={class:"font-medium"},ys={class:"text-xs text-gray-500"},hs={class:"font-medium text-green-600 text-xs sm:text-sm"},ws={class:"hidden xl:inline"},As={class:"xl:hidden"},Es=["onClick"],Rs={class:"space-y-4"},Cs={class:"bg-orange-50 p-4 rounded-lg border border-orange-200 mb-4"},Ds={class:"flex items-start gap-3"},_s={class:"bg-red-50 p-4 rounded-lg border border-red-200"},Ns={class:"flex items-center gap-2 mb-2"},Ss={class:"font-semibold text-red-800"},Ts={class:"text-xs text-red-600 mt-2"},Os={class:"text-gray-500"},Is={class:"flex justify-end gap-3 pt-4"},Ls=["disabled"],Ms={class:"space-y-4"},ks={class:"bg-blue-50 p-4 rounded-lg border border-blue-200"},Fs={class:"font-semibold text-blue-800 mb-2"},Ps={class:"text-sm text-blue-600"},zs={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Vs={key:0,class:"text-red-500 text-xs mt-1"},$s={key:0,class:"text-red-500 text-xs mt-1"},Us={class:"flex justify-center items-center gap-3 pt-4"},qs=["disabled"],Hs=["disabled"],Qs={__name:"Reservas",setup(Gs){const f=ca(),ke=ma(),b=u([]),Fe=u([]),we=u(!1);u(!1);const $=u(null),o=u(null),Ae=u(!1),X=u(!1),y=u({cambiarEstado:!1}),J=u(!1),I=u(!1),v=u({fechaSalida:null,fechaRegreso:null,motivo:""}),m=u({busqueda:"",fechaDesde:null,fechaHasta:null,estado:null}),L=u(!1),K=u(!1),U=u(!1),Q=u(!1),q=u(null),de=u(null),Pe=u(""),D=u("");u(null),u(""),u("");const H=u(""),G=u(""),Ee=u(typeof window<"u"?window.innerWidth:1024),j=u(!1),ue=u(!1),ce=u(!1),me=u(!1),S=u(!1),ee=[{label:"Pendiente",value:"PENDIENTE",severity:"warn",color:"bg-yellow-100 text-yellow-800",icon:wa},{label:"Confirmada",value:"CONFIRMADA",severity:"success",color:"bg-green-100 text-green-800",icon:Aa},{label:"En Curso",value:"EN_CURSO",severity:"info",color:"bg-blue-100 text-blue-800",icon:Y},{label:"Finalizada",value:"FINALIZADA",severity:"secondary",color:"bg-gray-100 text-gray-800",icon:Le},{label:"Rechazada",value:"CANCELADA",severity:"danger",color:"bg-red-100 text-red-800",icon:he},{label:"Reprogramada",value:"REPROGRAMADA",severity:"info",color:"bg-purple-100 text-purple-800",icon:Y}],Re=[{label:"Disponible",value:"DISPONIBLE",color:"bg-green-100 text-green-800"},{label:"Completo",value:"COMPLETO",color:"bg-orange-100 text-orange-800"},{label:"En Curso",value:"EN_CURSO",color:"bg-blue-100 text-blue-800"},{label:"Finalizado",value:"FINALIZADO",color:"bg-gray-100 text-gray-800"},{label:"Cancelada",value:"CANCELADA",color:"bg-red-100 text-red-800"},{label:"Reprogramada",value:"REPROGRAMADA",color:"bg-purple-100 text-purple-800"}],M=_(()=>{if(!o.value)return!1;const t=B.value.filter(a=>["CONFIRMADA","REPROGRAMADA"].includes(a.estado)).reduce((a,l)=>{const d=l.mayores_edad||0,i=l.menores_edad||0;return a+d+i},0),e=o.value.cupo_min||0;return t>=e}),k=_(()=>!o.value||!b.value?!1:b.value.some(t=>["PENDIENTE","CONFIRMADA","EN_CURSO","REPROGRAMADA"].includes(t.estado))),ae=_(()=>{if(!o.value||!b.value||b.value.length===0)return!1;const t=b.value.some(a=>a.estado==="PENDIENTE"),e=b.value.some(a=>a.estado==="CONFIRMADA");return!t&&e}),ve=_(()=>!o.value||!b.value||b.value.length===0?!1:o.value.estado==="REPROGRAMADA"?!b.value.some(e=>e.estado==="PENDIENTE")&&M.value:o.value.estado==="DISPONIBLE"?M.value:o.value.estado==="COMPLETO"?ae.value&&M.value:!1),B=_(()=>{let t=b.value;if(m.value.busqueda){const a=m.value.busqueda.toLowerCase();t=t.filter(l=>{var d,i,g,x,C,T;return(((i=(d=l.cliente)==null?void 0:d.user)==null?void 0:i.name)||((g=l.cliente)==null?void 0:g.nombres)||"").toLowerCase().includes(a)||(((C=(x=l.cliente)==null?void 0:x.user)==null?void 0:C.email)||((T=l.cliente)==null?void 0:T.correo)||"").toLowerCase().includes(a)})}return m.value.fechaDesde&&(t=t.filter(a=>new Date(a.fecha_reserva)>=new Date(m.value.fechaDesde))),m.value.fechaHasta&&(t=t.filter(a=>new Date(a.fecha_reserva)<=new Date(m.value.fechaHasta))),m.value.estado&&(t=t.filter(a=>a.estado===m.value.estado)),t.sort((a,l)=>{const d={PENDIENTE:1,CONFIRMADA:2,EN_CURSO:3,REPROGRAMADA:4,COMPLETADA:5,SUSPENDIDA:6,CANCELADA:7},i=d[a.estado]||6,g=d[l.estado]||6;return i!==g?i-g:new Date(l.fecha_reserva)-new Date(a.fecha_reserva)})});_(()=>({pendientes:b.value.filter(t=>t.estado==="PENDIENTE").length,confirmadas:b.value.filter(t=>t.estado==="CONFIRMADA").length}));const ze=async t=>{Ae.value=!0;try{const e=await O.get(`/api/tours/${t}`);o.value=e.data}catch(e){console.error("Error cargando tour:",e),f.add({severity:"error",summary:"Error",detail:"No se pudo cargar la informaciÃ³n del tour",life:4e3})}finally{Ae.value=!1}},Ve=()=>new URLSearchParams(window.location.search).get("tour"),se=async t=>{if(!o.value)return;if(t==="REPROGRAMADA"){F(),v.value={fechaSalida:o.value.fecha_salida?new Date(o.value.fecha_salida):null,fechaRegreso:o.value.fecha_regreso?new Date(o.value.fecha_regreso):null,motivo:""},H.value="",G.value="",I.value=!0;return}if(t==="CANCELADA"){Ze();return}const a={EN_CURSO:{header:"Cambio de Estado del Tour",message:"Â¡Tienes un cambio de estado pendiente!",detail:'Â¿Deseas marcar este tour como "En Curso"?'},FINALIZADO:{header:"Finalizar Tour",message:"Â¡Tienes un cambio de estado pendiente!",detail:"Â¿Deseas finalizar este tour permanentemente?"}}[t];a&&ke.require({message:{header:a.message,content:a.detail},header:a.header,icon:"pi pi-exclamation-triangle",position:"center",rejectClass:"bg-blue-500 hover:bg-blue-700 text-white border-none px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",acceptClass:"bg-red-500 hover:bg-red-700 text-white border-none px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2 ml-3",rejectLabel:"âœ“ Continuar",acceptLabel:"âœ• Cancelar",accept:()=>{},reject:async()=>{await $e(t)}})},$e=async t=>{var e,a,l,d;y.value.cambiarEstado=!0;try{const i=await O.put(`/api/tours/${o.value.id}/cambiar-estado`,{estado:t});o.value.estado=t,f.add({severity:"success",summary:"Estado actualizado",detail:`El tour ahora estÃ¡ ${t.toLowerCase()}`,life:3e3}),await P()}catch(i){console.error("Error actualizando estado:",i),console.error("Respuesta del servidor:",(e=i.response)==null?void 0:e.data),((a=i.response)==null?void 0:a.status)===422?f.add({severity:"warn",summary:"ValidaciÃ³n fallida",detail:i.response.data.message||"No se pudo actualizar el estado",life:8e3}):f.add({severity:"error",summary:"Error",detail:((d=(l=i.response)==null?void 0:l.data)==null?void 0:d.message)||"No se pudo actualizar el estado",life:4e3})}finally{y.value.cambiarEstado=!1}},Ue=async t=>{o.value=t,J.value=!1;const e={CANCELADA:{severity:"warn",summary:"Tour cancelado",detail:`El tour ha sido cancelado. Se enviaron notificaciones de cancelaciÃ³n a ${t.reservas_canceladas||0} cliente(s) con reservas.`},FINALIZADO:{severity:"success",summary:"Tour finalizado",detail:`El tour ha sido finalizado correctamente. Se enviaron notificaciones a ${t.reservas_finalizadas||0} cliente(s).`},default:{severity:"success",summary:"Estado actualizado",detail:"El estado del tour se ha actualizado correctamente"}},a=e[t.estado]||e.default;f.add({severity:a.severity,summary:a.summary,detail:a.detail,life:5e3}),await P()},pe=()=>{document.body.style.overflow="",document.body.style.paddingRight=""},F=()=>{L.value=!1,K.value=!1,U.value=!1,Q.value=!1,J.value=!1,I.value=!1,q.value=null,de.value=null,Pe.value="",D.value="",S.value=!1,pe()},qe=()=>{const t=new Date;return t.setFullYear(t.getFullYear()+1),t},He=()=>{if(!v.value.fechaSalida)return new Date;const t=new Date(v.value.fechaSalida);return t.setHours(t.getHours()+1),t},fe=()=>{if(H.value="",!v.value.fechaSalida)return!1;const t=new Date;return new Date(v.value.fechaSalida)<=t?(H.value="La fecha de salida debe ser futura",!1):!0},ge=()=>{if(G.value="",!v.value.fechaRegreso||!v.value.fechaSalida)return!1;const t=new Date(v.value.fechaSalida);return(new Date(v.value.fechaRegreso)-t)/(1e3*60*60)<1?(G.value="La fecha de regreso debe ser al menos 1 hora despuÃ©s de la salida",!1):!0},Ge=async()=>{var a,l;if(!v.value.fechaSalida||!v.value.fechaRegreso){f.add({severity:"warn",summary:"Campos requeridos",detail:"Debe seleccionar las nuevas fechas de salida y regreso",life:4e3});return}const t=fe(),e=ge();if(!t||!e){f.add({severity:"error",summary:"Fechas invÃ¡lidas",detail:"Por favor corrige los errores en las fechas antes de continuar",life:4e3});return}if(!v.value.motivo.trim()){f.add({severity:"warn",summary:"Motivo requerido",detail:"Debe ingresar un motivo para la reprogramaciÃ³n",life:4e3});return}y.value.cambiarEstado=!0;try{const d=x=>{if(x instanceof Date){const C=x.getFullYear(),T=String(x.getMonth()+1).padStart(2,"0"),te=String(x.getDate()).padStart(2,"0"),re=String(x.getHours()).padStart(2,"0"),oe=String(x.getMinutes()).padStart(2,"0"),le=String(x.getSeconds()).padStart(2,"0");return`${C}-${T}-${te} ${re}:${oe}:${le}`}return x},i=await O.put(`/api/tours/${o.value.id}/cambiar-estado`,{estado:"REPROGRAMADA",fecha_salida:d(v.value.fechaSalida),fecha_regreso:d(v.value.fechaRegreso),motivo_reprogramacion:v.value.motivo,reprogramar_reservas:!0});o.value={...o.value,...i.data},F();const g=i.data.reservas_reprogramadas||0;f.add({severity:"success",summary:"Tour y reservas reprogramados",detail:`El tour ha sido reprogramado correctamente. ${g} reserva(s) fueron reprogramada(s) y se enviaron notificaciones por correo.`,life:5e3}),await P()}catch(d){console.error("Error reprogramando tour:",d),f.add({severity:"error",summary:"Error",detail:((l=(a=d.response)==null?void 0:a.data)==null?void 0:l.message)||"No se pudo reprogramar el tour",life:4e3})}finally{y.value.cambiarEstado=!1}},je=()=>{X.value=!0},Be=()=>{o.value&&Se.visit("/tours",{data:{editTour:o.value.id},preserveState:!0,onSuccess:()=>{f.add({severity:"info",summary:"Redirigiendo...",detail:"Abriendo editor de tours",life:2e3})}})},Z=_(()=>Ee.value<640?{width:"95vw",maxWidth:"380px"}:Ee.value<768?{width:"400px"}:{width:"450px"}),P=async()=>{if($.value){we.value=!0;try{const t={busqueda:m.value.busqueda||void 0,fecha_inicio:m.value.fechaDesde||void 0,fecha_fin:m.value.fechaHasta||void 0,tour_id:$.value},e=await O.get("/api/reservas",{params:t,withCredentials:!0});b.value=Array.isArray(e.data)?e.data:e.data.data||[]}catch(t){console.error("Error cargando reservas:",t),f.add({severity:"error",summary:"Error",detail:"No se pudieron cargar las reservas del tour",life:4e3}),b.value=[]}finally{we.value=!1}}},Ze=()=>{F(),D.value="",U.value=!0},We=async()=>{var t,e;if(!D.value.trim()){f.add({severity:"warn",summary:"Campo requerido",detail:"Debe ingresar un motivo para cancelar el tour",life:4e3});return}S.value=!0;try{const a=await O.put(`/api/tours/${o.value.id}/cambiar-estado`,{estado:"CANCELADA",motivo_cancelacion:D.value,cancelar_reservas:!0});o.value.estado="CANCELADA",await P(),F();const l=a.data.reservas_canceladas||0;f.add({severity:"warn",summary:"Â¡Tour Cancelado!",detail:`El tour ha sido cancelado. Se cancelaron ${l} reserva(s) y se enviaron notificaciones por correo.`,life:5e3})}catch(a){console.error("Error cancelando tour:",a),f.add({severity:"error",summary:"Error",detail:((e=(t=a.response)==null?void 0:t.data)==null?void 0:e.message)||"No se pudo cancelar el tour",life:4e3})}finally{S.value=!1}},Ce=t=>{F(),q.value=t,Q.value=!0},Ye=t=>{F(),q.value=t;const e=Fe.value.find(a=>{var l;return((l=t.detallesTours)==null?void 0:l.some(d=>d.tour_id===a.id))||t.entidad_nombre===a.nombre});de.value=e,L.value=!0},Xe=t=>{t.originalEvent.target.closest("button")||Ce(t.data)},Je=t=>{const e=ee.find(a=>a.value===t);return(e==null?void 0:e.color)||"bg-gray-100 text-gray-800"},Ke=t=>{const e=Re.find(a=>a.value===t);return(e==null?void 0:e.label)||t},Qe=t=>{if(!t)return"N/A";const e=new Date(t);return e.getHours()===0&&e.getMinutes()===0?e.toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"}):e.toLocaleString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})},De=t=>{if(!t)return"N/A";const e=new Date(t);return e.getHours()===0&&e.getMinutes()===0?e.toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"})+" (Sin hora especificada)":e.toLocaleString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})},ea=async()=>{j.value=!0;try{m.value={busqueda:"",fechaDesde:null,fechaHasta:null,estado:null},f.add({severity:"success",summary:"Filtros limpiados",life:1500})}finally{j.value=!1}};_(()=>{if(v.value.fechaSalida instanceof Date){const t=new Date(v.value.fechaSalida);return t.setHours(t.getHours()+1),t}return new Date});const aa=async t=>{var e,a,l,d,i;ce.value=!0;try{await O.put(`/api/reservas/${t.id}/confirmar`);const g=b.value.findIndex(x=>x.id===t.id);g!==-1&&(b.value[g].estado="CONFIRMADA"),L.value=!1,f.add({severity:"success",summary:"Â¡Confirmada!",detail:`Reserva de ${((a=(e=t.cliente)==null?void 0:e.user)==null?void 0:a.name)||((l=t.cliente)==null?void 0:l.nombres)} confirmada correctamente`,life:4e3})}catch(g){console.error("Error confirmando reserva:",g),f.add({severity:"error",summary:"Error",detail:((i=(d=g.response)==null?void 0:d.data)==null?void 0:i.message)||"No se pudo confirmar la reserva",life:4e3})}finally{ce.value=!1}},sa=async t=>{var e,a,l,d,i;me.value=!0,ue.value=!0;try{const g=await O.put(`/api/reservas/${t.reserva.id}/rechazar`,{motivo:t.motivo}),x=b.value.findIndex(C=>C.id===t.reserva.id);x!==-1&&b.value.splice(x,1),K.value=!1,L.value=!1,f.add({severity:"success",summary:"Â¡Eliminada!",detail:`Reserva de ${((a=(e=t.reserva.cliente)==null?void 0:e.user)==null?void 0:a.name)||((l=t.reserva.cliente)==null?void 0:l.nombres)} eliminada correctamente`,life:4e3})}catch(g){console.error("Error rechazando reserva:",g),f.add({severity:"error",summary:"Error",detail:((i=(d=g.response)==null?void 0:d.data)==null?void 0:i.message)||"No se pudo rechazar la reserva",life:4e3})}finally{ue.value=!1,me.value=!1}},ta=t=>{Ce(t)},ra=t=>{q.value=t};be(()=>[m.value.busqueda,m.value.fechaDesde,m.value.fechaHasta,m.value.estado],()=>{clearTimeout(window.searchTimeout),window.searchTimeout=setTimeout(()=>{P()},500)},{deep:!0}),be(I,t=>{t?(document.body.style.overflow="hidden",document.body.style.paddingRight="15px"):(document.body.style.overflow="",document.body.style.paddingRight="")});const _e=()=>{da(()=>{setTimeout(()=>{document.querySelectorAll(".p-select").forEach(e=>{const a=e.querySelector(".p-select-label, .p-placeholder");a&&(a.style.overflow="hidden",a.style.textOverflow="ellipsis",a.style.whiteSpace="nowrap",a.style.maxWidth="calc(100% - 2.5rem)",a.style.display="block")})},100)})};return be([m],()=>{_e()},{deep:!0}),oa(async()=>{try{if($.value=Ve(),!$.value){f.add({severity:"warn",summary:"Tour no especificado",detail:"Redirigiendo a la lista de tours...",life:3e3}),setTimeout(()=>{Se.visit("/tours")},2e3);return}await Promise.all([ze($.value),P()]),_e()}catch(t){console.error("Error cargando datos iniciales:",t)}}),la(()=>{pe()}),(t,e)=>(h(),xe(ua,null,{default:w(()=>[n(r(na),{title:"GestiÃ³n de Reservas"}),n(r(va),{class:"z-[9999]"}),n(r(pa),{class:"z-[9999]",style:ye(Z.value),draggable:!1,closable:!1},{message:w(a=>[s("div",Da,[n(r(p),{icon:r(ie),class:"h-8 w-8 text-red-500"},null,8,["icon"]),s("div",_a,[s("span",null,c(a.message.header),1),s("span",Na,c(a.message.content),1)])])]),_:1},8,["style"]),s("div",Sa,[s("div",Ta,[n(r(ia),{href:t.route("tours"),onClick:je,class:R([{"opacity-50 cursor-not-allowed":X.value},"inline-flex p-2 items-center bg-blue-500 hover:bg-blue-600 text-white hover:text-gray-200 rounded-md transition-colors duration-200"]),title:"Regresar a Tours"},{default:w(()=>[n(r(p),{icon:X.value?r(N):r(xa),class:R([{"animate-spin":X.value},"h-5 w-5 mr-2"])},null,8,["icon","class"]),e[20]||(e[20]=s("span",{class:"font-medium"},"Volver a Tours",-1))]),_:1,__:[20]},8,["href","class"])]),s("div",Oa,[o.value?(h(),E("div",Ia,[s("h3",La,c(o.value.nombre),1),s("div",Ma,[s("p",ka,[n(r(p),{icon:r(W),class:"h-4 w-4 text-blue-500"},null,8,["icon"]),e[21]||(e[21]=z(" Haz clic en cualquier tarjeta para cambiar el estado del tour "))]),!M.value&&o.value.estado==="DISPONIBLE"&&k.value?(h(),E("div",Fa,[s("div",Pa,[n(r(p),{icon:r(ie),class:"h-4 w-4 text-amber-500 mt-0.5 flex-shrink-0"},null,8,["icon"]),s("div",za,[s("p",Va," Cupo mÃ­nimo no cumplido ("+c(o.value.cupo_min)+" personas requeridas). Actualmente hay "+c(B.value.filter(a=>a.estado==="CONFIRMADA").reduce((a,l)=>a+(l.mayores_edad||0)+(l.menores_edad||0),0))+" personas confirmadas. ",1),s("div",$a,[e[23]||(e[23]=s("span",{class:"text-xs text-amber-700"},"Opciones: Esperar mÃ¡s confirmaciones o",-1)),s("button",{onClick:Be,class:"inline-flex items-center gap-1 px-3 py-1 bg-amber-500 hover:bg-amber-600 text-white text-xs font-medium rounded-md transition-colors duration-200 shadow-sm hover:shadow-md"},[n(r(p),{icon:r(Y),class:"h-3 w-3"},null,8,["icon"]),e[22]||(e[22]=z(" Actualizar cupo "))])])])])])):A("",!0),o.value.estado==="COMPLETO"&&!ae.value?(h(),E("p",Ua,[n(r(p),{icon:r(W),class:"h-4 w-4 text-blue-500"},null,8,["icon"]),e[24]||(e[24]=s("span",{class:"font-medium"}," Tour completo - Debe confirmar TODAS las reservas pendientes para poder poner el tour en curso ",-1))])):A("",!0),o.value.estado==="REPROGRAMADA"&&!ve.value?(h(),E("p",qa,[n(r(p),{icon:r(W),class:"h-4 w-4 text-purple-500"},null,8,["icon"]),e[25]||(e[25]=s("span",{class:"font-medium"}," Tour reprogramado - Confirme las reservas pendientes para habilitarlo en curso ",-1))])):A("",!0),!k.value&&(o.value.estado==="DISPONIBLE"||o.value.estado==="REPROGRAMADA")?(h(),E("p",Ha,[n(r(p),{icon:r(W),class:"h-4 w-4 text-gray-500"},null,8,["icon"]),e[26]||(e[26]=s("span",null," Este tour no tiene reservas activas. ",-1))])):A("",!0)]),s("div",Ga,[s("div",ja,[e[27]||(e[27]=s("p",{class:"text-xs md:text-sm text-gray-600 mb-1"},"Estado Actual",-1)),s("p",Ba,c(Ke(o.value.estado)),1)]),o.value.estado!=="EN_CURSO"&&o.value.estado!=="FINALIZADO"&&o.value.estado!=="CANCELADA"?(h(),E("div",{key:0,class:R(["rounded-lg px-2 py-2 md:px-4 md:py-3 flex-1 min-w-0 transition-all duration-200",ve.value?"bg-gradient-to-r from-blue-500 to-blue-600 cursor-pointer hover:shadow-lg hover:scale-105":"bg-gray-400 cursor-not-allowed opacity-60"]),onClick:e[0]||(e[0]=a=>ve.value?se("EN_CURSO"):null)},[s("div",Za,[e[28]||(e[28]=s("div",{class:"flex-1"},[s("p",{class:"text-xs md:text-sm opacity-90"},"En Curso")],-1)),n(r(p),{icon:y.value.cambiarEstado?r(N):r(Y),class:R([{"animate-spin":y.value.cambiarEstado},"text-xs md:text-sm opacity-75"])},null,8,["icon","class"])])],2)):A("",!0),o.value.estado!=="FINALIZADO"&&o.value.estado!=="CANCELADA"&&o.value.estado==="EN_CURSO"?(h(),E("div",{key:1,class:"bg-gradient-to-r from-gray-500 to-gray-600 cursor-pointer hover:shadow-lg transition-all duration-200 hover:scale-105 rounded-lg px-2 py-2 md:px-4 md:py-3 flex-1 min-w-0",onClick:e[1]||(e[1]=a=>se("FINALIZADO"))},[s("div",Wa,[e[29]||(e[29]=s("div",{class:"flex-1"},[s("p",{class:"text-xs md:text-sm opacity-90"},"Finalizar")],-1)),n(r(p),{icon:y.value.cambiarEstado?r(N):r(Le),class:R([{"animate-spin":y.value.cambiarEstado},"text-xs md:text-sm opacity-75"])},null,8,["icon","class"])])])):A("",!0),o.value.estado!=="REPROGRAMADA"&&o.value.estado!=="FINALIZADO"&&o.value.estado!=="CANCELADA"&&o.value.estado!=="EN_CURSO"?(h(),E("div",{key:2,class:R(["rounded-lg px-2 py-2 md:px-4 md:py-3 flex-1 min-w-0 transition-all duration-200",o.value.estado==="DISPONIBLE"&&M.value||o.value.estado==="COMPLETO"&&ae.value?"bg-gradient-to-r from-purple-500 to-purple-600 cursor-pointer hover:shadow-lg hover:scale-105":"bg-gray-400 cursor-not-allowed opacity-60"]),onClick:e[2]||(e[2]=a=>o.value.estado==="DISPONIBLE"&&M.value||o.value.estado==="COMPLETO"&&ae.value?se("REPROGRAMADA"):null)},[s("div",Ya,[e[30]||(e[30]=s("div",{class:"flex-1"},[s("p",{class:"text-xs md:text-sm opacity-90"},"Reprogramar")],-1)),n(r(p),{icon:y.value.cambiarEstado?r(N):r(Y),class:R([{"animate-spin":y.value.cambiarEstado},"text-xs md:text-sm opacity-75"])},null,8,["icon","class"])])],2)):A("",!0),o.value.estado!=="CANCELADA"&&o.value.estado!=="FINALIZADO"&&o.value.estado!=="EN_CURSO"?(h(),E("div",{key:3,class:R(["rounded-lg px-2 py-2 md:px-4 md:py-3 flex-1 min-w-0 transition-all duration-200",k.value||o.value.estado==="COMPLETO"||o.value.estado==="REPROGRAMADA"?"bg-gradient-to-r from-red-500 to-red-600 cursor-pointer hover:shadow-lg hover:scale-105":"bg-gray-400 cursor-not-allowed opacity-60"]),onClick:e[3]||(e[3]=a=>k.value||o.value.estado==="COMPLETO"||o.value.estado==="REPROGRAMADA"?se("CANCELADA"):null),title:!k.value&&o.value.estado!=="COMPLETO"?"No se puede cancelar un tour sin reservas activas":"Cancelar tour y todas sus reservas"},[s("div",Ja,[s("div",Ka,[e[31]||(e[31]=s("p",{class:"text-xs md:text-sm opacity-90"},"Cancelar",-1)),k.value?A("",!0):(h(),E("p",Qa,"Sin reservas"))]),n(r(p),{icon:y.value.cambiarEstado?r(N):r(he),class:R([{"animate-spin":y.value.cambiarEstado},"text-xs md:text-sm opacity-75"])},null,8,["icon","class"])])],10,Xa)):A("",!0)])])):A("",!0),s("div",es,[s("div",as,[s("div",ss,[e[32]||(e[32]=s("h3",{class:"text-base font-medium text-gray-800 flex items-center gap-2"},[s("i",{class:"pi pi-filter text-blue-600 text-sm"}),s("span",null,"Filtros")],-1)),s("div",ts,c(B.value.length)+" resultado"+c(B.value.length!==1?"s":""),1)]),s("button",{onClick:ea,disabled:j.value,class:"bg-red-500 hover:bg-red-600 border border-red-500 px-2 py-1 text-xs text-white shadow-md rounded-md disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-1 shrink-0"},[j.value?(h(),xe(r(p),{key:0,icon:r(N),class:"animate-spin h-3 w-3"},null,8,["icon"])):A("",!0),s("span",null,c(j.value?"Limpiando...":"Limpiar"),1)],8,rs)]),s("div",os,[s("div",ls,[n(r(p),{icon:r(ya),class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"},null,8,["icon"]),n(r(fa),{modelValue:m.value.busqueda,"onUpdate:modelValue":e[4]||(e[4]=a=>m.value.busqueda=a),placeholder:"Buscar por cliente...",class:"w-full h-9 text-sm rounded-md pl-10",style:{"background-color":"white","border-color":"#93c5fd"}},null,8,["modelValue"])]),s("div",ns,[n(r(ne),{modelValue:m.value.fechaDesde,"onUpdate:modelValue":e[5]||(e[5]=a=>m.value.fechaDesde=a),placeholder:"Fecha desde",dateFormat:"dd/mm/yy",class:"w-full h-9 text-sm",style:{"background-color":"white","border-color":"#93c5fd"},showIcon:""},null,8,["modelValue"]),n(r(ne),{modelValue:m.value.fechaHasta,"onUpdate:modelValue":e[6]||(e[6]=a=>m.value.fechaHasta=a),placeholder:"Fecha hasta",dateFormat:"dd/mm/yy",class:"w-full h-9 text-sm",style:{"background-color":"white","border-color":"#93c5fd"},showIcon:""},null,8,["modelValue"]),n(r(ga),{modelValue:m.value.estado,"onUpdate:modelValue":e[7]||(e[7]=a=>m.value.estado=a),options:[{label:"Todos los estados",value:null},{label:"Pendientes",value:"PENDIENTE"},{label:"Confirmadas",value:"CONFIRMADA"}],optionLabel:"label",optionValue:"value",placeholder:"Filtrar por estado",class:"w-full h-9 text-sm",style:{"background-color":"white","border-color":"#93c5fd"}},null,8,["modelValue"])]),s("div",is,[s("p",ds,[n(r(p),{icon:r(ha),class:"h-3 w-3 text-yellow-500"},null,8,["icon"]),e[33]||(e[33]=z(" Haz clic en cualquier fila para ver los detalles. "))])])])]),n(r(ba),{value:B.value,paginator:"",rows:10,rowsPerPageOptions:[5,10,20,50],paginatorTemplate:"RowsPerPageDropdown FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink",currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} reservas",responsiveLayout:"scroll",class:"mt-2 sm:mt-4 overflow-x-auto",onRowClick:Xe,pt:{root:{class:"text-xs sm:text-sm"},wrapper:{class:"text-xs sm:text-sm overflow-x-auto"},table:{class:"text-xs sm:text-sm min-w-full"},thead:{class:"text-xs sm:text-sm"},headerRow:{class:"text-xs sm:text-sm"},headerCell:{class:"text-xs sm:text-sm font-medium py-2 sm:py-3 px-1 sm:px-2"},tbody:{class:"text-xs sm:text-sm"},bodyRow:{class:"text-xs sm:text-sm cursor-pointer hover:bg-blue-50 transition-colors duration-200"},bodyCell:{class:"py-2 sm:py-3 px-1 sm:px-2 text-xs sm:text-sm"}}},{empty:w(()=>[s("div",us,[n(r(p),{icon:r(W),class:"text-4xl text-gray-400 mb-4"},null,8,["icon"]),e[34]||(e[34]=s("p",{class:"text-gray-500 text-lg"},"No se encontraron reservas",-1)),e[35]||(e[35]=s("p",{class:"text-gray-400 text-sm mt-2"}," Ajusta los filtros para encontrar las reservas que buscas ",-1))])]),loading:w(()=>e[36]||(e[36]=[s("div",{class:"text-center py-12"},[s("i",{class:"pi pi-spin pi-spinner text-3xl text-blue-500 mb-4"}),s("p",{class:"text-gray-500 text-lg"},"Cargando reservas...")],-1)])),default:w(()=>[n(r(V),{field:"fecha_reserva",header:"Fecha",class:"w-28 min-w-16"},{body:w(a=>[s("span",cs,c(Qe(a.data.fecha_reserva)),1)]),_:1}),n(r(V),{field:"cliente.nombres",header:"Cliente",class:"w-16 hidden sm:table-cell"},{body:w(a=>{var l,d,i,g,x,C,T,te,re,oe,le,Ne;return[s("div",ms,[s("div",vs,[n(r(p),{icon:r(Me),class:"text-blue-600 text-xs sm:text-sm"},null,8,["icon"])]),s("div",ps,[s("div",{class:"font-medium text-gray-900 text-xs sm:text-sm truncate",title:((d=(l=a.data.cliente)==null?void 0:l.user)==null?void 0:d.name)||((i=a.data.cliente)==null?void 0:i.nombres)||"N/A"},c(((x=(g=a.data.cliente)==null?void 0:g.user)==null?void 0:x.name)||((C=a.data.cliente)==null?void 0:C.nombres)||"N/A"),9,fs),s("div",{class:"text-xs text-gray-500 truncate hidden sm:block",title:((te=(T=a.data.cliente)==null?void 0:T.user)==null?void 0:te.email)||((re=a.data.cliente)==null?void 0:re.correo)||"N/A"},c(((le=(oe=a.data.cliente)==null?void 0:oe.user)==null?void 0:le.email)||((Ne=a.data.cliente)==null?void 0:Ne.correo)||"N/A"),9,gs)])])]}),_:1}),n(r(V),{header:"Personas",class:"w-20 sm:w-24 lg:w-28 min-w-16 hidden md:table-cell"},{body:w(a=>[s("div",null,[s("div",bs,[n(r(p),{icon:r(Me),class:"text-gray-400 text-xs mr-1"},null,8,["icon"]),s("span",xs,c((a.data.mayores_edad||0)+(a.data.menores_edad||0)),1)]),s("div",ys,c(a.data.mayores_edad||0)+"A â€¢ "+c(a.data.menores_edad||0)+"N ",1)])]),_:1}),n(r(V),{field:"total",header:"Total",class:"w-12 min-w-12"},{body:w(a=>[s("span",hs," $"+c(Number(a.data.total||0).toFixed(2)),1)]),_:1}),n(r(V),{field:"estado",header:"Estado",class:"w-24 sm:w-28 lg:w-36 min-w-20 hidden lg:table-cell"},{body:w(a=>{var l,d;return[s("span",{class:R([Je(a.data.estado),"px-2 py-1 rounded-full text-xs font-medium"])},[s("span",ws,c(((l=ee.find(i=>i.value===a.data.estado))==null?void 0:l.label)||a.data.estado),1),s("span",As,c((((d=ee.find(i=>i.value===a.data.estado))==null?void 0:d.label)||a.data.estado).substring(0,4)),1)],2)]}),_:1}),n(r(V),{header:"Acciones",class:"w-24 sm:w-28 lg:w-32 min-w-20"},{body:w(a=>[s("button",{class:"bg-green-500 hover:bg-green-600 text-white px-2 py-2 rounded-md transition-all duration-200 ease-in-out inline-flex items-center gap-1 text-xs shadow-md hover:shadow-lg hover:-translate-y-1",onClick:l=>Ye(a.data),title:"MÃ¡s acciones"},[n(r(p),{icon:r(Ea),class:"h-3 w-4 sm:h-4 sm:w-5"},null,8,["icon"]),e[37]||(e[37]=s("span",{class:"hidden md:inline"},"MÃ¡s",-1))],8,Es)]),_:1})]),_:1},8,["value"]),n(Ra,{visible:L.value,"onUpdate:visible":e[8]||(e[8]=a=>L.value=a),"detalles-visible":Q.value,"onUpdate:detallesVisible":e[9]||(e[9]=a=>Q.value=a),"rechazar-visible":K.value,"onUpdate:rechazarVisible":e[10]||(e[10]=a=>K.value=a),reserva:q.value,tour:de.value,"dialog-style":Z.value,procesando:ue.value,"confirmando-reserva":ce.value,"rechazando-reserva":me.value,"estados-reservas":ee,"estados-tours":Re,onConfirmar:aa,onRechazar:sa,onVerDetalles:ta,onActualizarReserva:ra},null,8,["visible","detalles-visible","rechazar-visible","reserva","tour","dialog-style","procesando","confirmando-reserva","rechazando-reserva"]),n(Ca,{visible:J.value,"onUpdate:visible":e[11]||(e[11]=a=>J.value=a),tour:o.value,"dialog-style":Z.value,onEstadoActualizado:Ue},null,8,["visible","tour","dialog-style"]),n(r(Ie),{visible:U.value,"onUpdate:visible":e[14]||(e[14]=a=>U.value=a),modal:"",header:"Cancelar Tour Completo",style:ye(Z.value),closable:!1,draggable:!1},{default:w(()=>{var a;return[s("div",Rs,[s("div",Cs,[s("div",Ds,[n(r(p),{icon:r(ie),class:"text-orange-600 text-lg mt-1 flex-shrink-0"},null,8,["icon"]),e[38]||(e[38]=s("div",null,[s("h4",{class:"font-bold text-orange-800 mb-2"},"Â¡ADVERTENCIA - ELIMINACIÃ“N MASIVA PERMANENTE!"),s("div",{class:"text-sm text-orange-700 space-y-2"},[s("p",null,[s("strong",null,"â€¢ Esta acciÃ³n NO se puede deshacer bajo ninguna circunstancia")]),s("p",null,"â€¢ Se eliminarÃ¡n TODAS las reservas del tour de forma PERMANENTE"),s("p",null,"â€¢ Se eliminarÃ¡n TODOS los detalles asociados a cada reserva"),s("p",null,"â€¢ Los cupos del tour serÃ¡n liberados automÃ¡ticamente"),s("p",null,"â€¢ Se enviarÃ¡n emails de cancelaciÃ³n a TODOS los clientes"),s("p",null,"â€¢ No serÃ¡ posible recuperar ninguna informaciÃ³n posteriormente"),s("div",{class:"mt-3 p-2 bg-orange-100 rounded border border-orange-300"},[s("p",{class:"font-semibold text-orange-900 text-xs"}," AsegÃºrese de que realmente desea eliminar toda la informaciÃ³n antes de continuar ")])])],-1))])]),s("div",_s,[s("div",Ns,[n(r(p),{icon:r(ie),class:"text-red-600"},null,8,["icon"]),s("h4",Ss,"Cancelar Tour: "+c((a=o.value)==null?void 0:a.nombre),1)]),e[39]||(e[39]=s("p",{class:"text-sm text-red-700"}," Esta acciÃ³n cancelarÃ¡ el tour completo y TODAS las reservas asociadas. Se enviarÃ¡n notificaciones por correo a todos los clientes. ",-1)),s("p",Ts,[s("strong",null,"Reservas que serÃ¡n ELIMINADAS PERMANENTEMENTE: "+c(b.value.length),1)])]),s("div",null,[e[40]||(e[40]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[z(" Motivo de la CancelaciÃ³n del Tour "),s("span",{class:"text-red-500"},"*")],-1)),Te(s("textarea",{"onUpdate:modelValue":e[12]||(e[12]=l=>D.value=l),placeholder:"Explique por quÃ© se cancela el tour completo...",class:"w-full p-3 border border-gray-300 rounded-md focus:ring-red-500 focus:border-red-500",rows:"4",maxlength:"500"},null,512),[[Oe,D.value]]),s("small",Os,c(D.value.length)+"/500 caracteres",1)]),s("div",Is,[s("button",{onClick:e[13]||(e[13]=l=>U.value=!1),class:"px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50"}," Cancelar "),s("button",{onClick:We,disabled:!D.value.trim()||S.value,class:"px-4 py-2 bg-red-700 text-white rounded-md hover:bg-red-800 disabled:bg-red-300 flex items-center gap-2"},[n(r(p),{icon:S.value?r(N):r(he),class:R({"animate-spin":S.value})},null,8,["icon","class"]),z(" "+c(S.value?"Eliminando Todo...":"Eliminar Tour y Reservas Definitivamente"),1)],8,Ls)])])]}),_:1},8,["visible","style"]),n(r(Ie),{visible:I.value,"onUpdate:visible":e[19]||(e[19]=a=>I.value=a),modal:"",header:"Reprogramar Tour",style:ye(Z.value),closable:!1,draggable:!1},{default:w(()=>{var a,l,d;return[s("div",Ms,[s("div",ks,[s("h4",Fs,c((a=o.value)==null?void 0:a.nombre),1),s("p",Ps," Fechas actuales: "+c(De((l=o.value)==null?void 0:l.fecha_salida))+" - "+c(De((d=o.value)==null?void 0:d.fecha_regreso)),1)]),s("div",zs,[s("div",null,[e[41]||(e[41]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Salida:",-1)),n(r(ne),{modelValue:v.value.fechaSalida,"onUpdate:modelValue":e[15]||(e[15]=i=>v.value.fechaSalida=i),showTime:"",hourFormat:"12",dateFormat:"dd/mm/yy",showIcon:"",placeholder:"Seleccionar fecha y hora",class:"w-full",minDate:new Date,maxDate:qe(),onDateSelect:fe,onInput:fe},null,8,["modelValue","minDate","maxDate"]),H.value?(h(),E("small",Vs,c(H.value),1)):A("",!0)]),s("div",null,[e[42]||(e[42]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Regreso:",-1)),n(r(ne),{modelValue:v.value.fechaRegreso,"onUpdate:modelValue":e[16]||(e[16]=i=>v.value.fechaRegreso=i),showTime:"",hourFormat:"12",dateFormat:"dd/mm/yy",showIcon:"",placeholder:"Seleccionar fecha y hora",class:"w-full",minDate:He(),onDateSelect:ge,onInput:ge},null,8,["modelValue","minDate"]),G.value?(h(),E("small",$s,c(G.value),1)):A("",!0)])]),s("div",null,[e[43]||(e[43]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Motivo de la ReprogramaciÃ³n",-1)),Te(s("textarea",{"onUpdate:modelValue":e[17]||(e[17]=i=>v.value.motivo=i),placeholder:"Ingrese el motivo de la reprogramaciÃ³n...",class:"w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",rows:"3"},null,512),[[Oe,v.value.motivo]]),e[44]||(e[44]=s("p",{class:"text-xs text-gray-500 mt-2"}," ðŸ’¡ Al reprogramar el tour, todas las reservas asociadas serÃ¡n reprogramadas automÃ¡ticamente y se enviarÃ¡n correos de notificaciÃ³n a los clientes. ",-1))]),s("div",Us,[s("button",{onClick:Ge,disabled:y.value.cambiarEstado,class:"px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"},[y.value.cambiarEstado?(h(),xe(r(p),{key:0,icon:r(N),class:"animate-spin"},null,8,["icon"])):A("",!0),z(" "+c(y.value.cambiarEstado?"Reprogramando...":"Reprogramar Tour"),1)],8,qs),s("button",{onClick:e[18]||(e[18]=i=>{I.value=!1,pe()}),class:"border rounded-md bg-blue-500 hover:bg-blue-700 text-white px-6 py-2",disabled:y.value.cambiarEstado}," Cancelar ",8,Hs)])])]}),_:1},8,["visible","style"])])])]),_:1}))}};export{Qs as default};
