import{r as i,E as H,w as pe,n as R,o as be,a6 as fe,N as E,k as A,h as Z,d as m,x as u,p as l,e as a,$ as s,a0 as he,a2 as ye,y as T,q as _,c as g,t as y,A as W,j as D}from"./vendor-gbh1WW5n.js";import{A as xe}from"./AuthenticatedLayout-CSuYxj7F.js";import{z as we,A as Ce,F as d}from"./ui-BrU4k96Z.js";import{c as z,e as _e,k as J,l as K,m as ke,n as Pe,o as Ee,a as X,p as Y,i as Q,q as Ae}from"./index-B6nVaz6S.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Te={class:"container mx-auto px-4 py-6"},De={class:"mb-6 mt-2"},Se={class:"bg-white rounded-lg shadow-md"},Le={class:"flex flex-col sm:flex-row lg:justify-between lg:items-center gap-4 p-1 sm:p-1 md:p-3 lg:p-4"},Ne={class:"flex items-center gap-2 w-full justify-center lg:w-auto lg:justify-end"},ze={key:0,class:"flex flex-col items-center justify-center py-12 space-y-4 bg-white rounded-lg shadow-md"},Oe={class:"bg-blue-50 p-3 rounded-lg shadow-sm border mb-4"},Ue={class:"space-y-3"},Ve={class:"relative"},je={class:"text-sm font-medium leading-relaxed"},Ge={class:"flex gap-2 justify-center items-center"},Me=["onClick"],Re=["onClick"],We={class:"flex flex-col items-center justify-center py-12 space-y-4"},Ie={class:"text-center"},Fe={class:"space-y-4"},$e={class:"w-full flex flex-col"},Be={class:"flex items-center gap-4"},qe={key:0,class:"text-gray-500 ml-28 text-xs"},He={key:1,class:"text-red-500 ml-28"},Ze={key:2,class:"text-orange-500 ml-28"},Je={key:3,class:"text-red-500 ml-28"},Ke={key:4,class:"text-red-500 ml-28"},Xe={class:"flex justify-center gap-4 w-full mt-6"},Ye=["disabled"],Qe={key:0},ea={key:1},aa=["disabled"],ta={class:"flex items-center gap-3"},sa={class:"flex flex-col"},oa={class:"flex justify-center gap-4 w-full"},la=["disabled"],ra={key:0},na={key:1},ia=["disabled"],da={class:"flex items-center gap-3"},ua={class:"flex justify-center gap-3 w-full"},fa={__name:"CategoriaProductos",setup(ca){const v=we(),O=i([]),t=i({id:null,nombre:""}),p=i(!1),b=i(!1),S=i(!1),U=i(!0),V=i(typeof window<"u"?window.innerWidth:1024),j=H(()=>V.value<640?{width:"95vw",maxWidth:"380px"}:V.value<768?{width:"400px"}:{width:"450px"}),f=i(!1),x=i(!1),k=i(!1),w=i(!1),C=i(!1),h=i(null),L=i({global:{value:null,matchMode:Ce.CONTAINS}}),G=i(10),ee=i([5,10,20,50]),P=i("Guardar"),ae=H(()=>{let o=O.value;if(L.value.global.value){const e=L.value.global.value.toLowerCase();o=o.filter(r=>r.nombre.toLowerCase().includes(e))}return o});pe([t],()=>{h.value&&f.value&&R(()=>{const o={...t.value},e=JSON.stringify(o)!==JSON.stringify(h.value),r=!h.value.id,c=t.value.nombre;C.value=e||r&&c})},{deep:!0,flush:"post"});function N(){t.value={id:null,nombre:""},w.value=!1}const I=()=>{typeof window<"u"&&(V.value=window.innerWidth)},te=()=>{S.value=!0};be(()=>{se(),typeof window<"u"&&window.addEventListener("resize",I)}),fe(()=>{typeof window<"u"&&window.removeEventListener("resize",I)});const F=async()=>{try{const o=await E.get("/api/categorias-productos");O.value=(o.data.data||o.data||[]).map(e=>({...e,categoria_id:e.id})).sort((e,r)=>new Date(r.created_at)-new Date(e.created_at))}catch{v.add({severity:"error",summary:"Error",detail:"No se pudieron cargar las categorías de productos.",life:4e3})}},se=async()=>{U.value=!0;try{const o=await E.get("/api/categorias-productos");O.value=(o.data.data||o.data||[]).map(e=>({...e,categoria_id:e.id})).sort((e,r)=>new Date(r.created_at)-new Date(e.created_at))}catch{v.add({severity:"error",summary:"Error",detail:"No se pudieron cargar las categorías de productos.",life:4e3})}finally{U.value=!1}},$=()=>{N(),P.value="Guardar",w.value=!1,f.value=!0,R(()=>{h.value={...t.value},C.value=!1})},oe=o=>{N(),w.value=!1,t.value={...o},P.value="Actualizar",f.value=!0,R(()=>{h.value={...t.value},C.value=!1})},le=async()=>{var o,e;if(w.value=!0,p.value=!0,!t.value.nombre||t.value.nombre.length<3||t.value.nombre.length>50){v.add({severity:"warn",summary:"Campos requeridos",detail:"El nombre debe tener entre 3 y 50 caracteres.",life:4e3}),p.value=!1;return}try{t.value.id?(await E.put(`/api/categorias-productos/${t.value.id}`,{nombre:t.value.nombre}),v.add({severity:"success",summary:"¡Éxito!",detail:"La categoría ha sido actualizada correctamente.",life:5e3})):(await E.post("/api/categorias-productos",{nombre:t.value.nombre}),v.add({severity:"success",summary:"¡Éxito!",detail:"La categoría ha sido creada correctamente.",life:5e3})),await F(),f.value=!1,C.value=!1,h.value=null,N()}catch(r){console.error("Error al procesar categoría:",r),v.add({severity:"error",summary:"Error",detail:((e=(o=r.response)==null?void 0:o.data)==null?void 0:e.message)||"Error al procesar la categoría",life:3e3})}finally{p.value=!1}},re=o=>{t.value={...o},x.value=!0},ne=async()=>{var o,e;b.value=!0;try{await E.delete(`/api/categorias-productos/${t.value.id}`),await F(),x.value=!1,v.add({severity:"success",summary:"¡Eliminada!",detail:"La categoría ha sido eliminada correctamente.",life:5e3})}catch(r){x.value=!1;const c=((e=(o=r.response)==null?void 0:o.data)==null?void 0:e.message)||r.message||"Error desconocido al eliminar la categoría";v.add({severity:"error",summary:"Error",detail:c,life:6e3})}finally{b.value=!1}},ie=()=>{C.value?k.value=!0:B()},B=()=>{f.value=!1,k.value=!1,C.value=!1,h.value=null,N()},de=()=>{k.value=!1},ue=()=>{t.value.nombre&&t.value.nombre.length>50&&(t.value.nombre=t.value.nombre.substring(0,50))},ce=o=>{const e=o.target.value,r=e.match(/[^a-zA-ZáéíóúÁÉÍÓÚñÑ\s]/g);r&&r.length>0&&v.add({severity:"warn",summary:"Caracteres no permitidos",detail:"Solo se permiten letras, espacios y acentos. Se han removido los caracteres no válidos.",life:3e3});const c=e.replace(/[^a-zA-ZáéíóúÁÉÍÓÚñÑ\s]/g,"").toLocaleUpperCase("es-ES");o.target.value=c,t.value.nombre=c,ue()},me=o=>{o.preventDefault();const e=(o.clipboardData||window.clipboardData).getData("text"),r=e.replace(/[^a-zA-ZáéíóúÁÉÍÓÚñÑ\s]/g,"").replace(/\s+/g," ").trim().toLocaleUpperCase("es-ES");r!==e.toLocaleUpperCase("es-ES")&&v.add({severity:"info",summary:"Texto limpiado",detail:"Se han removido números y caracteres especiales del texto pegado y convertido a mayúsculas.",life:3e3});const c=r.length>50?r.substring(0,50):r;t.value.nombre=c,o.target.value=c};return(o,e)=>{const r=A("Toast"),c=A("InputText"),q=A("Column"),ve=A("DataTable"),M=A("Dialog");return m(),Z(xe,null,{default:u(()=>[l(s(he),{title:"Control de Categorías de Productos"}),l(r,{class:"z-[9999]"}),a("div",Te,[a("div",De,[l(s(ye),{href:o.route("productos"),onClick:te,class:T([{"opacity-50 cursor-not-allowed":S.value},"inline-flex p-2 items-center bg-blue-500 hover:bg-blue-600 text-white hover:text-gray-200 rounded-md transition-colors duration-200 mb-4"]),title:"Regresar a Productos"},{default:u(()=>[l(s(d),{icon:S.value?s(z):s(_e),class:T({"animate-spin":S.value,"h-5 w-5 mr-2":!0})},null,8,["icon","class"]),e[7]||(e[7]=_(" Volver a Productos "))]),_:1,__:[7]},8,["href","class"])]),a("div",Se,[a("div",Le,[e[9]||(e[9]=a("div",{class:"text-center sm:text-left"},[a("h1",{class:"text-3xl font-bold text-blue-600 mb-2"},"Control de las Categorías de Productos"),a("p",{class:"text-gray-600"},"Gestiona las categorías de productos del inventario")],-1)),a("div",Ne,[a("button",{class:"bg-red-500 border border-red-500 p-2 text-sm text-white shadow-md hover:shadow-lg rounded-md hover:-translate-y-1 transition-transform duration-300 flex items-center gap-2",onClick:$},[l(s(d),{icon:s(J),class:"h-4 w-4"},null,8,["icon"]),e[8]||(e[8]=a("span",null,"Agregar",-1))])])]),U.value?(m(),g("div",ze,[l(s(d),{icon:s(z),class:"animate-spin h-10 w-10 text-blue-600"},null,8,["icon"]),e[10]||(e[10]=a("span",{class:"text-gray-600 font-medium text-lg"},"Cargando categorías...",-1))])):(m(),Z(ve,{key:1,value:ae.value,dataKey:"id",paginator:!0,rows:G.value,rowsPerPageOptions:ee.value,rowsPerPage:G.value,"onUpdate:rowsPerPage":e[1]||(e[1]=n=>G.value=n),paginatorTemplate:"RowsPerPageDropdown FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink",currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} categorías",class:"overflow-x-auto max-w-full",responsiveLayout:"scroll"},{header:u(()=>[a("div",Oe,[a("div",Ue,[a("div",Ve,[l(s(d),{icon:s(Ee),class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"},null,8,["icon"]),l(c,{modelValue:L.value.global.value,"onUpdate:modelValue":e[0]||(e[0]=n=>L.value.global.value=n),placeholder:"Buscar categorías...",class:"w-full h-9 text-sm rounded-md pl-10",style:{"background-color":"white","border-color":"#93c5fd"}},null,8,["modelValue"])])])])]),empty:u(()=>[a("div",We,[l(s(d),{icon:s(Pe),class:"h-12 w-12 text-gray-400"},null,8,["icon"]),a("div",Ie,[e[15]||(e[15]=a("h3",{class:"text-lg font-semibold text-gray-700 mb-2"},"NO HAY CATEGORÍAS AGREGADAS",-1)),e[16]||(e[16]=a("p",{class:"text-gray-500 mb-4"},'Comienza agregando tu primera categoría haciendo clic en el botón "Agregar"',-1)),a("button",{class:"bg-red-500 hover:bg-red-600 text-white px-6 py-2 rounded-md shadow-md transition-all duration-200 flex items-center gap-2 mx-auto",onClick:$},[l(s(d),{icon:s(J),class:"h-4 w-4"},null,8,["icon"]),e[14]||(e[14]=_(" Agregar Categoría "))])])])]),default:u(()=>[l(q,{field:"nombre",header:"Nombre",sortable:"",class:"w-96 min-w-52"},{body:u(n=>[a("div",je,y(n.data.nombre),1)]),_:1}),l(q,{exportable:!1,class:"w-52 min-w-28"},{header:u(()=>e[11]||(e[11]=[a("div",{class:"text-center w-full font-bold"}," Acciones ",-1)])),body:u(n=>[a("div",Ge,[a("button",{class:"flex bg-blue-500 border p-1 py-2 sm:p-2 text-sm shadow-md hover:shadow-lg rounded-md hover:-translate-y-1 transition-transform duration-300",onClick:ge=>oe(n.data)},[l(s(d),{icon:s(K),class:"h-3 w-6 sm:h-4 sm:w-7 text-white"},null,8,["icon"]),e[12]||(e[12]=a("span",{class:"hidden md:block text-white"},"Editar",-1))],8,Me),a("button",{class:"flex bg-red-500 border p-1 py-2 sm:p-2 text-sm shadow-md hover:shadow-lg rounded-md hover:-translate-y-1 transition-transform duration-300",onClick:ge=>re(n.data)},[l(s(d),{icon:s(ke),class:"h-3 w-6 sm:h-4 sm:w-7 text-white"},null,8,["icon"]),e[13]||(e[13]=a("span",{class:"hidden md:block text-white"},"Eliminar",-1))],8,Re)])]),_:1})]),_:1},8,["value","rows","rowsPerPageOptions","rowsPerPage"])),l(M,{visible:f.value,"onUpdate:visible":e[3]||(e[3]=n=>f.value=n),header:P.value+" Categoría",modal:!0,style:W(j.value),closable:!1,draggable:!1},{footer:u(()=>[a("div",Xe,[a("button",{class:"bg-red-500 hover:bg-red-700 text-white border-none px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",onClick:le,disabled:p.value||!t.value.nombre||t.value.nombre.length<3||t.value.nombre.length>50},[l(s(d),{icon:p.value?s(z):s(X),class:T(["h-5 text-white",{"animate-spin":p.value}])},null,8,["icon","class"]),p.value?(m(),g("span",ea,y(P.value==="Guardar"?"Guardando...":"Actualizando..."),1)):(m(),g("span",Qe,y(P.value),1))],8,Ye),a("button",{type:"button",class:"bg-blue-500 hover:bg-blue-700 text-white px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",onClick:ie,disabled:p.value},[l(s(d),{icon:s(Y),class:"h-5"},null,8,["icon"]),e[18]||(e[18]=_("Cancelar "))],8,aa)])]),default:u(()=>[a("div",Fe,[a("div",$e,[a("div",Be,[e[17]||(e[17]=a("label",{for:"nombre",class:"w-24 flex items-center gap-1"},[_(" Nombre: "),a("span",{class:"text-red-500 font-bold"},"*")],-1)),l(c,{modelValue:t.value.nombre,"onUpdate:modelValue":e[2]||(e[2]=n=>t.value.nombre=n),modelModifiers:{trim:!0},id:"nombre",name:"nombre",maxlength:50,class:T([{"p-invalid":w.value&&(!t.value.nombre||t.value.nombre.length<3||t.value.nombre.length>50),"border-orange-400 focus:border-orange-500":t.value.nombre&&t.value.nombre.length>45&&t.value.nombre.length<=50,"border-red-400 focus:border-red-500":t.value.nombre&&t.value.nombre.length>50},"flex-1 border-2 border-gray-400 hover:border-gray-500 focus:border-gray-500 focus:ring-0 focus:shadow-none rounded-md"]),onInput:ce,onPaste:me,placeholder:"MALETAS, ACCESORIOS, ROPA, ETC."},null,8,["modelValue","class"])]),t.value.nombre?(m(),g("small",qe," Caracteres: "+y(t.value.nombre.length)+"/50 ",1)):D("",!0),t.value.nombre&&t.value.nombre.length<3?(m(),g("small",He," El nombre debe tener al menos 3 caracteres. ")):D("",!0),t.value.nombre&&t.value.nombre.length>45&&t.value.nombre.length<=50?(m(),g("small",Ze," Te quedan "+y(50-t.value.nombre.length)+" caracteres ",1)):D("",!0),t.value.nombre&&t.value.nombre.length>50?(m(),g("small",Je," Has excedido el límite por "+y(t.value.nombre.length-50)+" caracteres ",1)):D("",!0),w.value&&!t.value.nombre?(m(),g("small",Ke," El nombre es obligatorio. ")):D("",!0)])])]),_:1},8,["visible","header","style"]),l(M,{visible:x.value,"onUpdate:visible":e[5]||(e[5]=n=>x.value=n),header:"Eliminar categoría",modal:!0,style:W(j.value),closable:!1,draggable:!1},{footer:u(()=>[a("div",oa,[a("button",{type:"button",class:"bg-red-500 hover:bg-red-700 text-white border-none px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",onClick:ne,disabled:b.value},[l(s(d),{icon:b.value?s(z):s(X),class:T(["h-5",{"animate-spin":b.value}])},null,8,["icon","class"]),b.value?(m(),g("span",na,"Eliminando...")):(m(),g("span",ra,"Eliminar"))],8,la),a("button",{type:"button",class:"bg-blue-500 hover:bg-blue-700 text-white px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",onClick:e[4]||(e[4]=n=>x.value=!1),disabled:b.value},[l(s(d),{icon:s(Y),class:"h-5"},null,8,["icon"]),e[22]||(e[22]=a("span",null,"Cancelar",-1))],8,ia)])]),default:u(()=>[a("div",ta,[l(s(d),{icon:s(Q),class:"h-8 w-8 text-red-500"},null,8,["icon"]),a("div",sa,[a("span",null,[e[19]||(e[19]=_("¿Estás seguro de eliminar la categoría: ")),a("b",null,y(t.value.nombre),1),e[20]||(e[20]=_("?"))]),e[21]||(e[21]=a("span",{class:"text-red-600 text-sm font-medium mt-1"},"Esta acción es irreversible.",-1))])])]),_:1},8,["visible","style"]),l(M,{visible:k.value,"onUpdate:visible":e[6]||(e[6]=n=>k.value=n),header:"Cambios sin guardar",modal:!0,style:W(j.value),closable:!1,draggable:!1},{footer:u(()=>[a("div",ua,[a("button",{type:"button",class:"bg-red-500 hover:bg-red-700 text-white border-none px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",onClick:B},[l(s(d),{icon:s(Ae),class:"h-4"},null,8,["icon"]),e[24]||(e[24]=a("span",null,"Salir sin guardar",-1))]),a("button",{type:"button",class:"bg-blue-500 hover:bg-blue-700 text-white px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",onClick:de},[l(s(d),{icon:s(K),class:"h-4"},null,8,["icon"]),e[25]||(e[25]=a("span",null,"Continuar",-1))])])]),default:u(()=>[a("div",da,[l(s(d),{icon:s(Q),class:"h-8 w-8 text-red-500"},null,8,["icon"]),e[23]||(e[23]=a("div",{class:"flex flex-col"},[a("span",null,"¡Tienes información sin guardar!"),a("span",{class:"text-red-600 text-sm font-medium mt-1"},"¿Deseas salir sin guardar?")],-1))])]),_:1},8,["visible","style"])])])]),_:1})}}};export{fa as default};
