import{a4 as K,r as b,E as X,o as J,w as x,h as Q,d as m,x as C,e as a,q as v,t as d,I as W,c as p,j as g,y,v as I,a7 as M,p as _,$ as c,a9 as Y,N as q}from"./vendor-CaDzpwPW.js";import{z as O,q as ee,A as N,g as oe}from"./ui-BjYE_i4I.js";import{f as ae,at as te,g as le,G as ie}from"./index-DIJG4gfJ.js";import{z as ne}from"./vue-tel-input-AlIeehSu.js";import{_ as re}from"./_plugin-vue_export-helper-DlAUqK2U.js";const se={class:"text-xl font-bold text-red-700 flex items-center gap-2"},ue={class:"py-4"},de={class:"bg-blue-50 rounded-lg p-4 mb-6"},ce={class:"text-sm text-blue-700"},me={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},fe=["value","maxlength","placeholder"],ve={key:0,class:"text-red-500 text-xs"},pe={key:0,class:"text-red-500 text-xs"},ge={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},be={key:0,class:"text-red-500 text-xs"},xe={key:0,class:"text-red-500 text-xs"},ye={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},_e={class:"mr-1"},De={key:1,class:"text-red-500 text-xs"},Ee={class:"sm:col-span-1"},we={key:0,class:"text-red-500 text-xs"},Ce={class:"flex justify-center gap-4 w-full mt-6"},Ie=["disabled"],Ne=["disabled"],Ve={__name:"ModalDatosCliente",props:{visible:{type:Boolean,default:!1},tieneClienteExistente:{type:Boolean,default:!1}},emits:["update:visible","cliente-guardado"],setup(V,{emit:R}){const j=V,E=R,F=K(),D=O(),f=b(!1);b([]),b(!0);const k=X(()=>{var e;return(e=F.props.auth)==null?void 0:e.user}),t=b({numero_identificacion:"",fecha_nacimiento:null,genero:"",direccion:"",telefono:"",tipo_documento:"DUI"}),l=b({}),i=b({isValid:!1,country:null,formattedNumber:"",mensaje:""});J(async()=>{});const U=()=>{E("update:visible",!1),B()},B=()=>{t.value={numero_identificacion:"",fecha_nacimiento:null,genero:"",direccion:"",telefono:"",tipo_documento:"DUI"},l.value={}},G=async e=>{try{e&&typeof e=="object"&&(i.value.isValid=e.valid===!0,i.value.country={name:e.country,code:e.countryCode},i.value.formattedNumber=e.formatted||"",e.valid===!0&&e.formatted&&(t.value.telefono=e.formatted),j.tieneClienteExistente?e.valid===!0?i.value.mensaje="Número válido (guardado previamente)":t.value.telefono&&e.valid===!1?i.value.mensaje="Número de teléfono inválido para "+e.country:i.value.mensaje="":t.value.telefono&&e.valid===!1?i.value.mensaje="Número de teléfono inválido para "+e.country:e.valid===!0?await L(t.value.telefono):i.value.mensaje="")}catch(o){console.error("[ModalDatosCliente] Error en validación:",o),i.value.mensaje="Error en validación"}},L=async e=>{var o,n;if(!(!e||e.length<8))try{const u=await q.post("/api/clientes/validar-telefono",{telefono:e});u.data.disponible?i.value.mensaje="Número válido para "+((o=i.value.country)==null?void 0:o.name):(i.value.isValid=!1,i.value.mensaje=u.data.message||"Este teléfono ya está registrado")}catch(u){console.error("[ModalDatosCliente] Error validando teléfono:",u),((n=u.response)==null?void 0:n.status)===401?i.value.mensaje="Error de autenticación":i.value.mensaje="Error al validar teléfono"}},$=()=>{const e={};return t.value.numero_identificacion?(w(),l.value.numero_identificacion&&(e.numero_identificacion=l.value.numero_identificacion)):e.numero_identificacion="El número de identificación es requerido",t.value.fecha_nacimiento||(e.fecha_nacimiento="La fecha de nacimiento es requerida"),t.value.genero||(e.genero="El género es requerido"),t.value.direccion||(e.direccion="La dirección es requerida"),t.value.telefono?i.value.isValid===!1&&(e.telefono=i.value.mensaje||"Por favor, ingrese un número de teléfono válido"):e.telefono="El número de teléfono es requerido",t.value.tipo_documento||(e.tipo_documento="El tipo de documento es requerido"),l.value=e,Object.keys(l.value).length===0},h=async()=>{var e,o,n,u,s,A,S,P,T;if(!$()){const r=Object.keys(l.value);r.length===1&&r[0]==="telefono"&&i.value.isValid===!1?D.add({severity:"warn",summary:"Teléfono ya registrado",detail:i.value.mensaje||"Este número de teléfono ya está registrado. Por favor, use un número diferente.",life:5e3}):D.add({severity:"error",summary:"Formulario incompleto",detail:"Por favor completa todos los campos requeridos",life:4e3});return}try{f.value=!0;const r=await q.post("/api/registro-cliente",t.value);D.add({severity:"success",summary:"Información guardada",detail:"Tus datos han sido guardados correctamente",life:3e3}),E("cliente-guardado",r.data.data||r.data),U()}catch(r){console.error("[ModalDatosCliente] Error al guardar cliente:",r),console.error("[ModalDatosCliente] Detalles del error:",(e=r.response)==null?void 0:e.data),(n=(o=r.response)==null?void 0:o.data)!=null&&n.errors&&(l.value=r.response.data.errors),(s=(u=r.response)==null?void 0:u.data)!=null&&s.message&&((S=(A=r.response)==null?void 0:A.data)!=null&&S.message.includes("formato"))&&(l.value.numero_identificacion=r.response.data.message),D.add({severity:"error",summary:"Error al guardar",detail:((T=(P=r.response)==null?void 0:P.data)==null?void 0:T.message)||"No se pudo guardar la información",life:5e3})}finally{f.value=!1}},z=e=>{const n=e.replace(/[^0-9]/g,"").substring(0,9);return n.length>8?n.substring(0,8)+"-"+n.substring(8):n},Z=e=>e.toUpperCase().replace(/[^A-Z0-9]/g,"").substring(0,9),H=e=>{const o=e.target.value;let n="";t.value.tipo_documento==="DUI"?(n=z(o),t.value.numero_identificacion=n,e.target.value=n):t.value.tipo_documento==="PASAPORTE"&&(n=Z(o),t.value.numero_identificacion=n,e.target.value=n),w()},w=()=>{if(!t.value.numero_identificacion){delete l.value.numero_identificacion;return}t.value.tipo_documento==="DUI"?/^\d{8}-\d{1}$/.test(t.value.numero_identificacion)?delete l.value.numero_identificacion:l.value.numero_identificacion="El DUI debe tener 9 dígitos (formato: 12345678-9)":t.value.tipo_documento==="PASAPORTE"&&(/^[A-Z0-9]{6,9}$/.test(t.value.numero_identificacion)?delete l.value.numero_identificacion:l.value.numero_identificacion="El PASAPORTE debe tener entre 6 y 9 caracteres (solo letras mayúsculas y números)")};return x(()=>t.value.numero_identificacion,()=>{w()}),x(()=>t.value.tipo_documento,()=>{t.value.numero_identificacion="",delete l.value.numero_identificacion}),x(()=>t.value.fecha_nacimiento,e=>{e&&l.value.fecha_nacimiento&&delete l.value.fecha_nacimiento}),x(()=>t.value.genero,e=>{e&&l.value.genero&&delete l.value.genero}),x(()=>t.value.direccion,e=>{e&&e.trim()&&l.value.direccion&&delete l.value.direccion}),x(()=>t.value.telefono,e=>{e&&l.value.telefono&&i.value.isValid&&delete l.value.telefono}),(e,o)=>(m(),Q(c(oe),{visible:V.visible,"onUpdate:visible":o[5]||(o[5]=n=>E("update:visible",n)),modal:"",closable:!1,class:"max-w-2xl w-full mx-4",draggable:!1},{header:C(()=>[a("h3",se,[_(c(N),{icon:c(ie)},null,8,["icon"]),o[6]||(o[6]=v(" Completar información de cliente "))])]),footer:C(()=>[a("div",Ce,[a("button",{type:"button",class:"bg-red-600 hover:bg-red-700 text-white px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",onClick:h,disabled:f.value},[_(c(N),{icon:f.value?c(ae):c(te),class:y(["h-5",{"animate-spin":f.value}])},null,8,["icon","class"]),v(" "+d(f.value?"Guardando...":"Guardar y Continuar"),1)],8,Ie),a("button",{type:"button",class:"bg-blue-500 hover:bg-blue-700 text-white px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",onClick:U,disabled:f.value},[_(c(N),{icon:c(le),class:"h-5"},null,8,["icon"]),o[19]||(o[19]=v(" Cancelar "))],8,Ne)])]),default:C(()=>{var n,u;return[a("div",ue,[a("div",de,[o[9]||(o[9]=a("h4",{class:"font-semibold text-blue-800 mb-2"},"Información de tu cuenta:",-1)),a("div",ce,[a("p",null,[o[7]||(o[7]=a("strong",null,"Nombre:",-1)),v(" "+d((n=k.value)==null?void 0:n.name),1)]),a("p",null,[o[8]||(o[8]=a("strong",null,"Email:",-1)),v(" "+d((u=k.value)==null?void 0:u.email),1)])])]),a("form",{onSubmit:W(h,["prevent"]),class:"space-y-4"},[a("div",me,[a("div",null,[o[10]||(o[10]=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Número de Identificación",-1)),a("input",{value:t.value.numero_identificacion,onInput:H,type:"text",required:"",maxlength:t.value.tipo_documento==="DUI"?10:9,class:y(["w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",{"border-red-500":l.value.numero_identificacion}]),placeholder:t.value.tipo_documento==="DUI"?"Ingrese 9 dígitos (ej: 123456789)":"Ingrese su PASAPORTE (ej: A1B2C3D4)"},null,42,fe),l.value.numero_identificacion?(m(),p("small",ve,d(l.value.numero_identificacion),1)):g("",!0)]),a("div",null,[o[12]||(o[12]=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Tipo de Documento",-1)),I(a("select",{"onUpdate:modelValue":o[0]||(o[0]=s=>t.value.tipo_documento=s),required:"",class:y(["w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",{"border-red-500":l.value.tipo_documento}])},o[11]||(o[11]=[a("option",{value:"",disabled:""},"Seleccione un tipo",-1),a("option",{value:"DUI"},"DUI",-1),a("option",{value:"PASAPORTE"},"PASAPORTE",-1)]),2),[[M,t.value.tipo_documento]]),l.value.tipo_documento?(m(),p("small",pe,d(l.value.tipo_documento),1)):g("",!0)])]),a("div",ge,[a("div",null,[o[13]||(o[13]=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Fecha de Nacimiento",-1)),_(c(ee),{modelValue:t.value.fecha_nacimiento,"onUpdate:modelValue":o[1]||(o[1]=s=>t.value.fecha_nacimiento=s),maxDate:new Date,"date-format":"dd/mm/yy",placeholder:"Seleccionar fecha de nacimiento",showIcon:"",yearNavigator:"",yearRange:"1920:2010",class:"w-full",inputClass:`w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 ${l.value.fecha_nacimiento?"border-red-500":""}`},null,8,["modelValue","maxDate","inputClass"]),l.value.fecha_nacimiento?(m(),p("small",be,d(l.value.fecha_nacimiento),1)):g("",!0)]),a("div",null,[o[15]||(o[15]=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Género",-1)),I(a("select",{"onUpdate:modelValue":o[2]||(o[2]=s=>t.value.genero=s),required:"",class:y(["w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",{"border-red-500":l.value.genero}])},o[14]||(o[14]=[a("option",{value:""},"Seleccione",-1),a("option",{value:"MASCULINO"},"Masculino",-1),a("option",{value:"FEMENINO"},"Femenino",-1)]),2),[[M,t.value.genero]]),l.value.genero?(m(),p("small",xe,d(l.value.genero),1)):g("",!0)])]),a("div",ye,[a("div",null,[o[16]||(o[16]=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Teléfono",-1)),_(c(ne),{modelValue:t.value.telefono,"onUpdate:modelValue":o[3]||(o[3]=s=>t.value.telefono=s),defaultCountry:"SV",preferredCountries:["SV","GT","HN","CR","NI","PA","BZ"],validCharactersOnly:!0,dropdownOptions:{showDialCodeInSelection:!0,showFlags:!0,showSearchBox:!0,showDialCodeInList:!0},inputOptions:{placeholder:"Número de teléfono"},mode:"international",class:"w-full border border-gray-300 rounded-lg",onValidate:G},null,8,["modelValue"]),i.value.mensaje?(m(),p("p",{key:0,class:y(["text-xs mt-1 flex items-center",i.value.isValid?"text-green-600":"text-red-600"])},[a("span",_e,d(i.value.isValid?"✓":"⚠️"),1),v(" "+d(i.value.mensaje),1)],2)):g("",!0),l.value.telefono&&!i.value.mensaje?(m(),p("small",De,d(l.value.telefono),1)):g("",!0)]),a("div",Ee,[o[17]||(o[17]=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Dirección",-1)),I(a("input",{"onUpdate:modelValue":o[4]||(o[4]=s=>t.value.direccion=s),type:"text",required:"",maxlength:"200",class:y(["w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",{"border-red-500":l.value.direccion}]),placeholder:"Dirección completa"},null,2),[[Y,t.value.direccion]]),l.value.direccion?(m(),p("small",we,d(l.value.direccion),1)):g("",!0)])]),o[18]||(o[18]=a("div",{class:"bg-blue-50 border border-blue-200 rounded-lg p-4 mt-4"},[a("p",{class:"text-sm text-blue-800"},[a("strong",null,"Nota:"),v(" Esta información es necesaria para procesar tu compra. ")])],-1))],32)])]}),_:1},8,["visible"]))}},Pe=re(Ve,[["__scopeId","data-v-445ee03e"]]);export{Pe as default};
