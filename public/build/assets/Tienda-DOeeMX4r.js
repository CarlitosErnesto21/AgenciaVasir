import H from"./Catalogo-Cbt9MBIX.js";import J from"./FiltrosPanel-4zsOni4X.js";import K from"./SearchBar-BjXklgzR.js";import Q from"./ProductGrid-BSsE0z8H.js";import X from"./PaginationControls-Dxlz6b84.js";import Y from"./EmptyState-BQycoVDm.js";import Z from"./ModalAuthRequerido-Dq0SHJVI.js";import ee from"./CarritoCompras-CuwzkMEO.js";import ae from"./CarritoButton-T08B23Y1.js";import{a3 as te,r as o,o as oe,N as E,E as f,w as U,k as re,h as se,d as le,x as ie,p as l,e as c,q as ne,$ as I,a5 as ce}from"./vendor-gbh1WW5n.js";import{z as ue,F as de}from"./ui-BrU4k96Z.js";import{u as me}from"./carrito-CgUgBSMJ.js";import{a8 as ve}from"./index-BL4yA-eF.js";import{_ as pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-DtyEsSN9.js";import"./app-Cy1dPPr6.js";import"./ImageWithFallback-D9gRbSkH.js";import"./ModalDatosCliente-BH90beXd.js";import"./vue-tel-input-nvsKEitw.js";const ge={class:"bg-gradient-to-br from-gray-50 via-blue-50/30 to-red-50/30 w-full pt-20 md:pt-24 lg:pt-28 xl:pt-28"},fe={class:"w-full mb-4 -mt-0 md:-mt-3"},Pe={class:"bg-gradient-to-r from-red-500 via-blue-600 to-blue-600 text-white text-center py-4 sm:py-6 relative shadow-xl"},xe={class:"absolute top-4 right-4"},ye={class:"text-2xl sm:text-3xl md:text-4xl font-bold mb-2"},be={class:"w-full px-2 sm:px-4 pb-4 sm:pb-4 lg:pb-4"},Ce={class:"flex flex-col lg:flex-row gap-4 lg:gap-8"},_e={class:"flex-1"},we={__name:"Tienda",setup(he){const i=ue(),R=te(),w=me(),m=o([]),h=o([]),P=o(!0),x=o(!0),y=o(!1),F=o(null),n=o([]),u=o(""),d=o(""),v=o(""),T=o(!1),r=o(1),p=o(8);o(0),oe(async()=>{await Promise.all([S(),$()]),w.verificarEstadoAutenticacion()});const S=async()=>{try{P.value=!0;const a=await E.get("/api/productos");m.value=(a.data.data||a.data||[]).map(e=>{var s;return{id:e.id,nombre:e.nombre,descripcion:e.descripcion,precio:parseFloat(e.precio),stock_actual:e.stock_actual,categoria:((s=e.categoria)==null?void 0:s.nombre)||"Sin categoría",categoria_id:e.categoria_id,imagen:e.imagenes&&e.imagenes.length>0?typeof e.imagenes[0]=="string"?e.imagenes[0]:e.imagenes[0].nombre:null,imagenes:e.imagenes||[]}}).filter(e=>e.stock_actual>0)}catch(a){console.error("Error al cargar productos:",a),i.add({severity:"error",summary:"Error",detail:"No se pudieron cargar los productos",life:3e3})}finally{P.value=!1}},$=async()=>{try{x.value=!0;const a=await E.get("/api/categorias-productos");h.value=(a.data.data||a.data||[]).map(e=>({id:e.id,nombre:e.nombre,cantidad:0}))}catch(a){console.error("Error al cargar categorías:",a),i.add({severity:"error",summary:"Error",detail:"No se pudieron cargar las categorías",life:3e3})}finally{x.value=!1}},z=f(()=>h.value.map(a=>({...a,cantidad:m.value.filter(e=>e.categoria===a.nombre).length})).filter(a=>a.cantidad>0)),g=f(()=>{let a=[...m.value];if(v.value){const e=v.value.toLowerCase();a=a.filter(s=>s.nombre.toLowerCase().includes(e)||s.descripcion.toLowerCase().includes(e)||s.categoria.toLowerCase().includes(e))}return n.value.length>0&&(a=a.filter(e=>n.value.includes(e.categoria))),u.value&&!isNaN(u.value)&&(a=a.filter(e=>e.precio>=parseFloat(u.value))),d.value&&!isNaN(d.value)&&(a=a.filter(e=>e.precio<=parseFloat(d.value))),a}),b=f(()=>Math.ceil(g.value.length/p.value)),k=f(()=>{const a=(r.value-1)*p.value,e=a+p.value;return g.value.slice(a,e)}),B=f(()=>{if(m.value.length===0)return{min:0,max:0,promedio:0};const a=m.value.map(e=>e.precio);return{min:Math.min(...a),max:Math.max(...a),promedio:a.reduce((e,s)=>e+s,0)/a.length}}),G=a=>{const e=n.value.indexOf(a);e>-1?n.value.splice(e,1):n.value.push(a),r.value=1},C=()=>{n.value=[],u.value="",d.value="",v.value="",r.value=1,i.add({severity:"info",summary:"Filtros limpiados",life:1e3})},L=()=>{r.value=1,i.add({severity:"success",summary:`Mostrando ${g.value.length} productos`,life:1e3})},_=a=>{a>=1&&a<=b.value&&(r.value=a)},V=()=>{r.value>1&&_(r.value-1)},j=()=>{r.value<b.value&&_(r.value+1)};U(v,()=>{r.value=1}),U([u,d],()=>{r.value=1});const D=a=>{var A;const e=(a.cantidadSeleccionada,a),s=a.cantidadSeleccionada||1;if(e.stock_actual<=0){i.add({severity:"warn",summary:`El producto "${e.nombre}" no está disponible`,life:3e3});return}if(s>e.stock_actual){i.add({severity:"warn",summary:"Stock insuficiente",detail:`Solo hay ${e.stock_actual} unidades disponibles de "${e.nombre}"`,life:3e3});return}const t=(A=R.props.auth)==null?void 0:A.user;if(!t){F.value=e,y.value=!0;return}if(t.roles&&Array.isArray(t.roles)&&t.roles.some(M=>M.name==="Administrador"||M.name==="Empleado")){i.add({severity:"warn",summary:"Acceso Restringido",detail:'Solo las cuentas de Cliente pueden realizar compras. Puedes ver los detalles del producto usando el botón "Info".',life:5e3});return}const W={...e,cantidadSeleccionada:s},N=w.agregarProducto(W);N.success||i.add({severity:"warn",summary:"Stock insuficiente",detail:N.message,life:3e3})},q=a=>{ce.visit(`/tienda/producto/${a.id}`)},O=async()=>{await Promise.all([S(),$()]),i.add({severity:"success",summary:"Datos actualizados",life:2e3})};return(a,e)=>{const s=re("Toast");return le(),se(H,null,{default:ie(()=>[l(s,{class:"z-[9999]"}),c("div",ge,[c("div",fe,[c("div",Pe,[c("div",xe,[l(ae)]),c("h1",ye,[l(I(de),{icon:I(ve),class:"mr-2 text-yellow-300 swing-animation"},null,8,["icon"]),e[8]||(e[8]=ne(" Productos "))]),e[9]||(e[9]=c("p",{class:"text-base sm:text-lg text-red-100 px-4"},"Encuentra los mejores productos para tu viaje",-1))])]),c("div",be,[c("div",Ce,[l(J,{categories:z.value,selectedCategories:n.value,minPrice:u.value,maxPrice:d.value,showMobileFilters:T.value,loadingCategories:x.value,preciosStats:B.value,"onUpdate:selectedCategories":e[0]||(e[0]=t=>n.value=t),"onUpdate:minPrice":e[1]||(e[1]=t=>u.value=t),"onUpdate:maxPrice":e[2]||(e[2]=t=>d.value=t),"onUpdate:showMobileFilters":e[3]||(e[3]=t=>T.value=t),onToggleCategory:G,onClearFilters:C,onApplyPriceFilter:L},null,8,["categories","selectedCategories","minPrice","maxPrice","showMobileFilters","loadingCategories","preciosStats"]),c("div",_e,[l(K,{searchTerm:v.value,allFilteredProducts:g.value,selectedCategories:n.value,minPrice:u.value,maxPrice:d.value,"onUpdate:searchTerm":e[4]||(e[4]=t=>v.value=t),onClearFilters:C},null,8,["searchTerm","allFilteredProducts","selectedCategories","minPrice","maxPrice"]),l(Q,{loading:P.value,filteredProducts:k.value,onComprarProducto:D,onIrADetalle:q},null,8,["loading","filteredProducts"]),l(X,{currentPage:r.value,totalPagesComputed:b.value,allFilteredProducts:g.value,itemsPerPage:p.value,"onUpdate:currentPage":e[5]||(e[5]=t=>r.value=t),"onUpdate:itemsPerPage":e[6]||(e[6]=t=>p.value=t),onGoToPage:_,onGoToPreviousPage:V,onGoToNextPage:j},null,8,["currentPage","totalPagesComputed","allFilteredProducts","itemsPerPage"]),l(Y,{loading:P.value,filteredProducts:k.value,products:m.value,onClearFilters:C,onRecargarDatos:O},null,8,["loading","filteredProducts","products"])])])])]),l(Z,{visible:y.value,"onUpdate:visible":e[7]||(e[7]=t=>y.value=t),productoInfo:F.value},null,8,["visible","productoInfo"]),l(ee)]),_:1})}}},Oe=pe(we,[["__scopeId","data-v-efce0311"]]);export{Oe as default};
