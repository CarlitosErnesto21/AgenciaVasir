import{N as M,r as i,E as J,w as ua,n as H,o as ca,k as z,h as ce,d as p,x as D,p as m,e as l,$ as v,a0 as ma,q as E,a1 as va,y,t as f,j as x,v as ke,c as g,F as me,l as ve,a7 as Ce,A as pa}from"./vendor-CqKcGHPa.js";import{A as ga}from"./AuthenticatedLayout-TqVZ00Ka.js";import{z as fa,F as pe,A as P}from"./ui-CVJOYm3g.js";import{j as ba,f as j,q as ya,b as De,t as ha,c as xa,d as wa,e as _a,g as ka}from"./index-CQ5n6JFv.js";import Ca from"./Modales-D2r7fMIG.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ActualizarStock-BhRTyFX3.js";const Da={class:"container mx-auto px-4 py-6"},Pa={class:"bg-white rounded-lg shadow-md"},Ea={class:"flex flex-col sm:flex-row lg:justify-between lg:items-center mb-4 gap-4 p-6"},Aa={class:"w-full"},Sa={class:"text-blue-600 text-xs text-center sm:text-start mt-1 font-medium flex items-center gap-1 justify-center sm:justify-start"},Va={class:"flex items-center gap-2 w-full justify-center lg:w-auto lg:justify-end"},Ta={class:"block sm:hidden"},Na={class:"hidden sm:block"},Ia={class:"bg-blue-50 p-3 rounded-lg shadow-sm border mb-4"},La={class:"flex flex-col sm:flex-row items-center justify-between mb-3"},Ua={class:"flex items-center gap-3"},Ma={class:"bg-blue-50 border border-blue-200 text-blue-700 px-3 py-1 rounded text-sm font-medium"},za=["disabled"],Fa=["disabled"],Oa={class:"space-y-3"},$a={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-2 gap-3"},Ba=["value"],ja=["value"],Ka=["title"],qa=["title"],Ra={class:"text-sm leading-relaxed"},Ga={class:"text-sm font-medium leading-relaxed"},Wa={class:"flex gap-2 justify-center items-center"},Za=["onClick"],Ja=["onClick"],Ha=["onClick"],Ya={class:"space-y-4"},Qa={class:"w-full flex flex-col"},Xa={class:"flex items-center gap-4"},et={key:0,class:"text-red-500 ml-28"},at={key:1,class:"text-red-500 ml-28"},tt={key:2,class:"text-orange-500 ml-28"},st={key:3,class:"text-red-500 ml-28"},lt={class:"w-full flex flex-col"},ot={class:"flex items-start gap-4"},rt={key:0,class:"text-red-500 ml-28"},nt={key:1,class:"text-orange-500 ml-28"},it={key:2,class:"text-red-500 ml-28"},dt={class:"w-full flex flex-col"},ut={class:"flex items-center gap-4 sm:gap-5"},ct={key:0,class:"text-red-500 ml-28"},mt={class:"w-full flex flex-col"},vt={class:"flex items-center gap-12 sm:gap-11"},pt={class:"w-full relative"},gt={key:0,class:"text-red-500 ml-28"},ft={class:"flex gap-4"},bt={class:"flex-1"},yt={key:0,class:"text-red-500 font-bold"},ht={key:1,class:"text-gray-400 text-xs"},xt={key:0,class:"text-blue-600 text-xs mt-1 block"},wt={class:"flex-1"},_t={key:0,class:"text-red-500 font-bold"},kt={key:1,class:"text-gray-400 text-xs"},Ct={key:0,class:"text-blue-600 text-xs mt-1 block"},Dt={class:"w-full flex flex-col"},Pt={class:"flex items-center gap-4"},Et={class:"flex-1"},At={class:"flex items-center gap-3 mb-2"},St=["disabled"],Vt={class:"flex items-center gap-2"},Tt={key:0,class:"text-red-500 ml-28"},Nt={class:"grid grid-cols-3 ml-2 sm:ml-5 gap-y-2"},It=["src"],Lt=["onClick"],Ut={class:"flex justify-center gap-4 w-full mt-6"},Mt=["disabled"],zt={key:0},Ft={key:1},Ot=["disabled"],Y="/api/productos",ge="/storage/productos/",Jt={__name:"Productos",setup($t){M.defaults.withCredentials=!0;const u=fa(),V=i([]),t=i({id:null,nombre:"",descripcion:"",precio:null,stock_actual:null,stock_minimo:null,categoria_id:null}),b=i([]),K=i([]),te=i([]),q=i([]),T=i(!1),F=i(!1),Q=i(!1),R=i(!1),w=i(!1),N=i(!1),A=i(null),G=i(!1),se=i(!1),_=i(null),X=i(!1),O=i(!1),le=i(!1),S=i(!1),$=i(!1),B=i(!1),I=i(!1),fe=i(!0),ee=i([]),L=i(""),U=i(""),k=i({global:{value:null,matchMode:pe.CONTAINS},categoria:{value:null,matchMode:pe.EQUALS},estado:{value:null,matchMode:pe.EQUALS}}),Pe=i([{label:"Disponible",value:"DISPONIBLE"},{label:"Stock Bajo",value:"STOCK_BAJO"},{label:"Agotado",value:"AGOTADO"}]),oe=i(10),Ee=i([5,10,20,50]),W=i("Guardar"),re=i(0),be=i(null),ne=J(()=>{let a=V.value;if(k.value.global.value){const e=k.value.global.value.toLowerCase();a=a.filter(s=>{var r;return s.nombre.toLowerCase().includes(e)||s.descripcion&&s.descripcion.toLowerCase().includes(e)||((r=s.categoria)==null?void 0:r.nombre)&&s.categoria.nombre.toLowerCase().includes(e)})}return k.value.categoria.value&&(a=a.filter(e=>e.categoria_id==k.value.categoria.value)),k.value.estado.value&&(a=a.filter(e=>ie(e).value===k.value.estado.value)),a}),ye=J(()=>b.value.length<5),Ae=J(()=>ee.value.map(a=>({...a,nombreTruncado:a.nombre.length>20?a.nombre.substring(0,17)+"...":a.nombre}))),Se=J(()=>$.value?"Cargando...":B.value?"Abriendo...":ye.value?"Seleccionar":"L√≠mite alcanzado"),ie=a=>a.stock_actual<=0?{label:"Agotado",value:"AGOTADO",class:"bg-red-100 text-red-800"}:a.stock_actual<=a.stock_minimo?{label:"Stock Bajo",value:"STOCK_BAJO",class:"bg-yellow-100 text-yellow-800"}:{label:"Disponible",value:"DISPONIBLE",class:"bg-green-100 text-green-800"};ua([t,b,q],()=>{A.value&&T.value&&H(()=>{const a={...t.value,imagenes_actuales:[...b.value]},e=JSON.stringify(a)!==JSON.stringify({...A.value,imagenes_actuales:A.value.imagenes_originales})||q.value.length>0,s=!A.value.id,r=t.value.nombre||t.value.descripcion||t.value.precio||t.value.categoria_id||b.value.length>0;N.value=e||s&&r})},{deep:!0,flush:"post"});function ae(){t.value={id:null,nombre:"",descripcion:"",precio:null,stock_actual:null,stock_minimo:null,categoria_id:null},b.value=[],K.value=[],q.value=[],w.value=!1}const Ve=()=>{H(()=>{setTimeout(()=>{document.querySelectorAll(".p-select").forEach(e=>{const s=e.querySelector(".p-select-label, .p-placeholder");s&&(s.style.overflow="hidden",s.style.textOverflow="ellipsis",s.style.whiteSpace="nowrap",s.style.maxWidth="calc(100% - 2.5rem)",s.style.display="block")})},100)})};ca(()=>{Te(),Ne(),Ve()});const de=async()=>{try{const a=await M.get(Y);V.value=(a.data.data||a.data||[]).map(e=>({...e,imagenes:(e.imagenes||[]).map(s=>typeof s=="string"?s:s.nombre)})).sort((e,s)=>{const r=new Date(e.created_at);return new Date(s.created_at)-r})}catch{u.add({severity:"error",summary:"Error",detail:"No se pudieron cargar los productos.",life:4e3})}},Te=async()=>{fe.value=!0,u.add({severity:"info",summary:"Cargando productos...",life:2e3});try{const a=await M.get(Y);V.value=(a.data.data||a.data||[]).map(e=>({...e,imagenes:(e.imagenes||[]).map(s=>typeof s=="string"?s:s.nombre)})).sort((e,s)=>{const r=new Date(e.created_at);return new Date(s.created_at)-r}),u.add({severity:"success",summary:"Productos cargados",life:2e3})}catch{u.add({severity:"error",summary:"Error",detail:"No se pudieron cargar los productos.",life:4e3})}finally{fe.value=!1}},Ne=async()=>{try{const a=await M.get("/api/categorias-productos");ee.value=a.data.data||a.data||[]}catch{ee.value=[],u.add({severity:"error",summary:"Error",detail:"No se pudieron cargar las categor√≠as.",life:4e3})}},Ie=()=>{k.value.categoria.value=L.value===""?null:L.value},Le=()=>{k.value.estado.value=U.value===""?null:U.value},he=async()=>{S.value=!0;try{await new Promise(a=>setTimeout(a,300)),L.value="",U.value="",k.value.global.value=null,k.value.categoria.value=null,k.value.estado.value=null,u.add({severity:"success",summary:"Filtros limpiados",life:2e3})}finally{S.value=!1}},Ue=()=>{O.value=!0},Me=()=>{ae(),W.value="Guardar",w.value=!1,T.value=!0,H(()=>{A.value={...t.value,imagenes_originales:[...b.value]},N.value=!1})},ze=a=>{ae(),w.value=!1,t.value={...a},b.value=(a.imagenes||[]).map(e=>typeof e=="string"?e:e.nombre),N.value=!1,W.value="Actualizar",T.value=!0,H(()=>{A.value={...t.value,imagenes_originales:[...b.value]},N.value=!1})},Fe=async()=>{if(w.value=!0,!t.value.nombre||t.value.nombre.length<3||t.value.nombre.length>100){u.add({severity:"warn",summary:"Campos requeridos",detail:"Por favor verifica que todos los campos obligatorios est√©n completos y cumplan los requisitos.",life:4e3});return}if(!t.value.descripcion||t.value.descripcion.length<10||t.value.descripcion.length>255){u.add({severity:"warn",summary:"Campos requeridos",detail:"Por favor verifica que todos los campos obligatorios est√©n completos y cumplan los requisitos.",life:4e3});return}if(_e()){u.add({severity:"warn",summary:"Nombre duplicado",detail:"Ya existe un producto con este nombre. Por favor elige un nombre diferente.",life:5e3});return}if(!t.value.precio||!t.value.categoria_id||b.value.length===0){u.add({severity:"warn",summary:"Campos requeridos",detail:"Por favor verifica que todos los campos obligatorios est√©n completos.",life:4e3});return}if(!t.value.id&&(t.value.stock_actual===null||t.value.stock_minimo===null)){u.add({severity:"warn",summary:"Campos requeridos",detail:"Para productos nuevos, el stock actual y m√≠nimo son obligatorios.",life:4e3});return}if(t.value.precio<=0||t.value.precio>9999.99){u.add({severity:"warn",summary:"Verificar datos",detail:"Por favor revisa los valores ingresados y corrige cualquier inconsistencia.",life:4e3});return}if(!t.value.id&&(t.value.stock_actual!==null&&t.value.stock_actual<0||t.value.stock_minimo!==null&&t.value.stock_minimo<1)){u.add({severity:"warn",summary:"Verificar datos",detail:"Por favor revisa los valores de stock y corrige cualquier inconsistencia.",life:4e3});return}const a=2*1024*1024;if(K.value.filter(s=>s.size>a).length>0){u.add({severity:"warn",summary:"Verificar archivos",detail:"Por favor revisa el tama√±o de las im√°genes seleccionadas.",life:4e3});return}try{I.value=!0;const s=new FormData;s.append("nombre",t.value.nombre||""),s.append("descripcion",t.value.descripcion||""),s.append("precio",t.value.precio||""),s.append("categoria_id",t.value.categoria_id||""),t.value.id||(s.append("stock_actual",t.value.stock_actual||"0"),s.append("stock_minimo",t.value.stock_minimo||"1")),K.value.forEach(n=>s.append("imagenes[]",n)),q.value.forEach(n=>{const d=n.includes("/")?n.split("/").pop():n;s.append("removed_images[]",d)});let r;t.value.id?(s.append("_method","PUT"),r=await M.post(`${Y}/${t.value.id}`,s,{headers:{"Content-Type":"multipart/form-data"}}),u.add({severity:"success",summary:"¬°√âxito!",detail:"El producto ha sido actualizado correctamente.",life:5e3})):(r=await M.post(Y,s,{headers:{"Content-Type":"multipart/form-data"}}),u.add({severity:"success",summary:"¬°√âxito!",detail:"El producto ha sido creado correctamente.",life:5e3})),await de(),T.value=!1,N.value=!1,A.value=null,ae()}catch(s){if(console.error("Error al guardar producto:",s),s.response&&s.response.status===422){const r=s.response.data.errors;let n="Por favor revisa los siguientes errores:";if(r){const d=[];r.nombre&&r.nombre.forEach(c=>{c.includes("Ya existe un producto")?d.push("Ya existe un producto con este nombre."):c.includes("solo puede contener")?d.push("El nombre solo puede contener letras may√∫sculas, acentos y espacios."):d.push(c)}),r.descripcion&&r.descripcion.forEach(c=>{c.includes("solo puede contener")?d.push("La descripci√≥n solo puede contener letras may√∫sculas, acentos, espacios y signos de puntuaci√≥n b√°sicos."):d.push(c)}),Object.keys(r).forEach(c=>{c!=="nombre"&&c!=="descripcion"&&r[c].forEach(C=>d.push(C))}),d.length>0&&(n=d.join(" "))}u.add({severity:"error",summary:"Error de validaci√≥n",detail:n,life:8e3})}else u.add({severity:"error",summary:"Error",detail:"Ocurri√≥ un error inesperado. Por favor intenta nuevamente.",life:6e3})}finally{I.value=!1}},Oe=a=>{t.value={...a},F.value=!0},$e=async()=>{var a,e,s,r,n;le.value=!0;try{await M.delete(`${Y}/${t.value.id}`),await de(),F.value=!1,u.add({severity:"success",summary:"¬°Eliminado!",detail:"El producto ha sido eliminado correctamente.",life:5e3})}catch(d){if(F.value=!1,((a=d.response)==null?void 0:a.status)===422){const c=d.response.data;let C=c.error||"El producto est√° siendo utilizado en el sistema.";c.details&&Array.isArray(c.details)&&(C+=`

üìã Detalles:
‚Ä¢ `+c.details.join(`
‚Ä¢ `)),u.add({severity:"warn",summary:"‚ùå No se puede eliminar",detail:C,life:1e4})}else if(((e=d.response)==null?void 0:e.status)===404)u.add({severity:"error",summary:"Producto no encontrado",detail:"El producto que intentas eliminar no existe o ya fue eliminado.",life:5e3}),await de();else if(((s=d.response)==null?void 0:s.status)===500)u.add({severity:"error",summary:"Error del servidor",detail:"Ocurri√≥ un error interno. Por favor, contacta al administrador.",life:6e3});else{const c=((n=(r=d.response)==null?void 0:r.data)==null?void 0:n.error)||d.message||"Error desconocido";u.add({severity:"error",summary:"Error",detail:`No se pudo eliminar el producto: ${c}`,life:6e3})}}finally{le.value=!1}},Be=()=>{N.value?R.value=!0:xe()},xe=()=>{T.value=!1,R.value=!1,N.value=!1,A.value=null,ae()},je=()=>{R.value=!1},Ke=a=>{_.value=a,G.value=!0},qe=a=>{G.value=!1,_.value=a,X.value=!0},Re=a=>{G.value=!1,_.value=a,Q.value=!0},Ge=async a=>{var r;const e=((r=a.data)==null?void 0:r.producto)||a.producto||a;if(!e||!e.id){console.error("No se pudo obtener el producto actualizado");return}const s=V.value.findIndex(n=>n.id===e.id);s!==-1&&(V.value[s]={...V.value[s],stock_actual:e.stock_actual,stock_minimo:e.stock_minimo,updated_at:e.updated_at}),_.value&&_.value.id===e.id&&(_.value={..._.value,stock_actual:e.stock_actual,stock_minimo:e.stock_minimo,updated_at:e.updated_at}),X.value=!1,u.add({severity:"success",summary:"Stock actualizado",detail:`El stock de "${e.nombre}" se ha actualizado correctamente.`,life:3e3}),await H()},We=a=>{if(_.value&&_.value.imagenes&&_.value.imagenes.length>0){te.value=_.value.imagenes.map(s=>{const r=typeof s=="string"?s:s.nombre;return ge+r});const e=Math.max(0,Math.min(a,te.value.length-1));re.value=e,setTimeout(()=>{se.value=!0},50)}else u.add({severity:"warn",summary:"Sin im√°genes",detail:"No hay im√°genes disponibles para mostrar.",life:5e3})},Ze=a=>{a.originalEvent.target.closest("button")||(_.value=a.data,Q.value=!0)},ue=i(typeof window<"u"?window.innerWidth:1024),we=J(()=>ue.value<640?{width:"95vw",maxWidth:"380px"}:ue.value<768?{width:"400px"}:{width:"450px"}),Je=async()=>{B.value=!0;try{await new Promise(a=>setTimeout(a,100)),be.value.click()}finally{setTimeout(()=>{B.value=!1},200)}},He=async a=>{const e=a.target?a.target.files:a.files,s=2*1024*1024;if(!e||e.length===0)return;if(b.value.length+e.length>5){u.add({severity:"warn",summary:"L√≠mite de im√°genes",detail:`Solo puedes subir m√°ximo 5 im√°genes. Actualmente tienes ${b.value.length} y est√°s intentando agregar ${e.length}.`,life:5e3});return}$.value=!0;try{for(const n of e)if(n instanceof File){if(b.value.length>=5){u.add({severity:"warn",summary:"L√≠mite alcanzado",detail:"Has alcanzado el l√≠mite m√°ximo de 5 im√°genes.",life:4e3});break}if(n.size>s){u.add({severity:"warn",summary:"Archivo demasiado grande",detail:`El archivo "${n.name}" excede el tama√±o m√°ximo de 2MB.`,life:5e3});continue}if(!n.type.startsWith("image/")){u.add({severity:"warn",summary:"Formato no v√°lido",detail:`El archivo "${n.name}" no es una imagen v√°lida.`,life:4e3});continue}await new Promise(c=>setTimeout(c,100)),K.value.push(n);const d=new FileReader;d.onload=c=>b.value.push(c.target.result),d.readAsDataURL(n)}e.length>0&&u.add({severity:"success",summary:"Im√°genes cargadas",detail:`Se han cargado ${e.length} imagen(es) correctamente.`,life:3e3})}catch{u.add({severity:"error",summary:"Error",detail:"Ocurri√≥ un error al procesar las im√°genes.",life:4e3})}finally{$.value=!1,a.target&&(a.target.value="")}},Ye=a=>{const e=b.value[a];typeof e=="string"&&e.startsWith("data:image")?(b.value.splice(a,1),K.value.splice(a,1)):(q.value.push(e),b.value.splice(a,1))},Qe=()=>{t.value.nombre&&(t.value.nombre=t.value.nombre.toUpperCase(),t.value.nombre=t.value.nombre.replace(/[^A-Z√Å√â√ç√ì√ö√ë√ú\s]/g,""),t.value.nombre.length>100&&(t.value.nombre=t.value.nombre.substring(0,100)))},Xe=a=>{const e=a.key;if(!([8,9,27,13,46,35,36,37,38,39,40].includes(a.keyCode)||a.ctrlKey&&[65,67,86,88,90,89].includes(a.keyCode))&&!/^[a-zA-Z√°√©√≠√≥√∫√Å√â√ç√ì√ö√±√ë√º√ú\s]$/.test(e)){a.preventDefault();return}},ea=a=>{a.preventDefault();const e=(a.clipboardData||window.clipboardData).getData("text");if(!e)return;let s=e.toUpperCase().replace(/[^A-Z√Å√â√ç√ì√ö√ë√ú\s]/g,"");const r=a.target,n=r.value||"",d=r.selectionStart||0,c=r.selectionEnd||0,C=n.substring(0,d),Z=n.substring(c);let o=C+s+Z;o.length>100&&(o=o.substring(0,100)),t.value.nombre=o,setTimeout(()=>{const h=Math.min(d+s.length,o.length);r.setSelectionRange(h,h)},0)},_e=()=>{if(!t.value.nombre||t.value.nombre.length<3)return!1;const a=t.value.nombre.trim().toUpperCase();return V.value.some(e=>t.value.id&&e.id===t.value.id?!1:e.nombre.trim().toUpperCase()===a)},aa=a=>{const e=a.key;if(!([8,9,27,13,46,35,36,37,38,39,40].includes(a.keyCode)||a.ctrlKey&&[65,67,86,88,90,89].includes(a.keyCode))&&!/^[a-zA-Z0-9√°√©√≠√≥√∫√Å√â√ç√ì√ö√±√ë√º√ú\s.,;:!?¬°¬ø()\/\-_@#$%&*+=\[\]{}|\\~`"']$/.test(e)){a.preventDefault();return}},ta=a=>{a.preventDefault();const e=(a.clipboardData||window.clipboardData).getData("text");if(!e)return;let s=e.toUpperCase().replace(/[^A-Z√Å√â√ç√ì√ö√ë√ú0-9\s.,;:!?¬°¬ø()\/\-_@#$%&*+=\[\]{}|\\~`"']/g,"");const r=a.target,n=r.value||"",d=r.selectionStart||0,c=r.selectionEnd||0,C=n.substring(0,d),Z=n.substring(c);let o=C+s+Z;o.length>255&&(o=o.substring(0,255)),t.value.descripcion=o,setTimeout(()=>{const h=Math.min(d+s.length,o.length);r.setSelectionRange(h,h)},0)},sa=()=>{t.value.descripcion&&(t.value.descripcion=t.value.descripcion.toUpperCase(),t.value.descripcion=t.value.descripcion.replace(/[^A-Z√Å√â√ç√ì√ö√ë√ú0-9\s.,;:!?¬°¬ø()\/\-_@#$%&*+=\[\]{}|\\~`"']/g,""),t.value.descripcion.length>255&&(t.value.descripcion=t.value.descripcion.substring(0,255)))},la=a=>{const e=a.target.value,s=a.key;if([8,9,27,13,46,35,36,37,38,39,40].includes(a.keyCode)||a.ctrlKey&&[65,67,86,88].includes(a.keyCode))return;if(!/[0-9.]/.test(s)){a.preventDefault();return}if(s==="."&&e.includes(".")){a.preventDefault();return}if(s!=="."){const d=e.split(".");if(d[0].length>=3&&!e.includes(".")){a.preventDefault();return}if(d.length>1&&d[1].length>=2){a.preventDefault();return}}const r=e+s;if(parseFloat(r)>9999.99){a.preventDefault();return}},oa=a=>{a.preventDefault();let s=(a.clipboardData||window.clipboardData).getData("text").replace(/[^\d.]/g,"");if(!s||s===".")return;if((s.match(/\./g)||[]).length>1){const C=s.indexOf(".");s=s.substring(0,C+1)+s.substring(C+1).replace(/\./g,"")}const n=parseFloat(s);if(isNaN(n))return;const c=Math.min(n,9999.99).toFixed(2);t.value.precio=c,a.target.value=c},ra=a=>{const e=a.target.value,s=a.key;if([8,9,27,13,46,35,36,37,38,39,40].includes(a.keyCode)||a.ctrlKey&&[65,67,86,88].includes(a.keyCode))return;if(!/[0-9]/.test(s)){a.preventDefault();return}const r=e+s,n=parseInt(r);if(r.length>4||n>9999){a.preventDefault();return}},na=a=>{a.preventDefault();const s=(a.clipboardData||window.clipboardData).getData("text").replace(/[^0-9]/g,"");if(s){let r=parseInt(s);r>9999&&(r=9999),a.target.value=r.toString(),a.target.dispatchEvent(new Event("input",{bubbles:!0}))}},ia=a=>{const e=a.target.value,s=a.key;if([8,9,27,13,46,35,36,37,38,39,40].includes(a.keyCode)||a.ctrlKey&&[65,67,86,88].includes(a.keyCode))return;if(!/[0-9]/.test(s)){a.preventDefault();return}const r=e+s,n=parseInt(r);if(r.length>3||n>100){a.preventDefault();return}},da=a=>{a.preventDefault();const s=(a.clipboardData||window.clipboardData).getData("text").replace(/[^0-9]/g,"");if(s){let r=parseInt(s);r>100&&(r=100),r<1&&(r=1),a.target.value=r.toString(),a.target.dispatchEvent(new Event("input",{bubbles:!0}))}};return(a,e)=>{const s=z("Toast"),r=z("InputText"),n=z("Column"),d=z("DataTable"),c=z("Textarea"),C=z("Select"),Z=z("Dialog");return p(),ce(ga,null,{default:D(()=>[m(v(ma),{title:"Productos"}),m(s,{class:"z-[9999]"}),l("div",Da,[e[41]||(e[41]=l("div",{class:"mb-6"},[l("h1",{class:"text-3xl font-bold text-blue-600 mb-2"},"Cat√°logo de Productos"),l("p",{class:"text-gray-600"},"Gesti√≥n completa del inventario de productos")],-1)),l("div",Pa,[l("div",Ea,[l("div",Aa,[e[20]||(e[20]=l("h3",{class:"text-2xl sm:text-3xl text-blue-600 font-bold text-center sm:text-start"},"Lista de Productos",-1)),l("p",Sa,[m(v(P),{icon:v(ba),class:"h-4 w-4 text-yellow-500"},null,8,["icon"]),e[19]||(e[19]=E(" Haz clic en cualquier fila para ver los detalles. "))])]),l("div",Va,[m(v(va),{href:a.route("catProductos"),onClick:Ue,class:y([{"opacity-50 cursor-not-allowed":O.value},"bg-blue-500 border border-blue-500 p-2 text-sm text-white shadow-md hover:shadow-lg rounded-md hover:-translate-y-1 transition-transform duration-300 flex items-center gap-2"])},{default:D(()=>[m(v(P),{icon:O.value?v(j):v(ya),class:y({"animate-spin":O.value,"h-4":!0})},null,8,["icon","class"]),l("span",Ta,f(O.value?"Cargando...":"Categor√≠as"),1),l("span",Na,f(O.value?"Cargando...":"Categor√≠as"),1)]),_:1},8,["href","class"]),l("button",{class:"bg-red-500 border flex border-red-500 p-2 text-sm text-white shadow-md hover:shadow-lg rounded-md hover:-translate-y-1 transition-transform duration-300",onClick:Me},[m(v(P),{icon:v(De),class:"h-4 w-4 mr-1 text-white"},null,8,["icon"]),e[21]||(e[21]=l("span",null,"Agregar",-1))])])]),m(d,{value:ne.value,dataKey:"id",paginator:!0,rows:oe.value,rowsPerPageOptions:Ee.value,rowsPerPage:oe.value,"onUpdate:rowsPerPage":e[3]||(e[3]=o=>oe.value=o),paginatorTemplate:"RowsPerPageDropdown FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink",currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} productos",class:"overflow-x-auto max-w-full",responsiveLayout:"scroll",onRowClick:Ze,pt:{root:{class:"text-sm"},wrapper:{class:"text-sm"},table:{class:"text-sm"},thead:{class:"text-sm"},headerRow:{class:"text-sm"},headerCell:{class:"text-sm font-medium py-3 px-2"},tbody:{class:"text-sm"},bodyRow:{class:"h-20 text-sm cursor-pointer hover:bg-blue-50 transition-colors duration-200"},bodyCell:{class:"py-3 px-2 text-sm"},paginator:{class:"text-xs sm:text-sm"},paginatorWrapper:{class:"flex flex-wrap justify-center sm:justify-between items-center gap-2 p-2"}}},{header:D(()=>[l("div",Ia,[l("div",La,[l("div",Ua,[e[22]||(e[22]=l("h3",{class:"text-base font-medium text-gray-800 flex items-center gap-2"},[l("i",{class:"pi pi-filter text-blue-600 text-sm"}),l("span",null,"Filtros")],-1)),l("div",Ma,f(ne.value.length)+" resultado"+f(ne.value.length!==1?"s":""),1),l("button",{class:"bg-red-500 hover:bg-red-600 border border-red-500 px-3 py-1 text-sm text-white shadow-md rounded-md flex sm:hidden disabled:opacity-50 disabled:cursor-not-allowed items-center gap-2",onClick:he,disabled:S.value},[S.value?(p(),ce(v(P),{key:0,icon:v(j),class:"animate-spin h-3 w-3"},null,8,["icon"])):x("",!0),l("span",null,f(S.value?"Limp...":"Limpiar"),1)],8,za)]),l("button",{class:"bg-red-500 hover:bg-red-600 border border-red-500 px-3 py-1 text-sm text-white shadow-md rounded-md hidden sm:flex disabled:opacity-50 disabled:cursor-not-allowed items-center gap-2",onClick:he,disabled:S.value},[S.value?(p(),ce(v(P),{key:0,icon:v(j),class:"animate-spin h-3 w-3"},null,8,["icon"])):x("",!0),l("span",null,f(S.value?"Limpiando...":"Limpiar filtros"),1)],8,Fa)]),l("div",Oa,[l("div",null,[m(r,{modelValue:k.value.global.value,"onUpdate:modelValue":e[0]||(e[0]=o=>k.value.global.value=o),placeholder:"üîç Buscar productos...",class:"w-full h-9 text-sm rounded-md",style:{"background-color":"white","border-color":"#93c5fd"}},null,8,["modelValue"])]),l("div",$a,[l("div",null,[ke(l("select",{"onUpdate:modelValue":e[1]||(e[1]=o=>L.value=o),onChange:Ie,class:y(["w-full h-9 text-sm border border-blue-300 rounded-md px-3 py-1 bg-white focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 truncate",L.value===""||L.value===null?"text-gray-400":"text-gray-900"])},[e[23]||(e[23]=l("option",{value:"",disabled:"",select:"",hiddene:"",hiddend:"",hidden:""},"Categor√≠a",-1)),(p(!0),g(me,null,ve(ee.value,o=>(p(),g("option",{key:o.id,value:o.id,class:"truncate text-gray-900 text-lg"},f(o.nombre),9,Ba))),128))],34),[[Ce,L.value]])]),l("div",null,[ke(l("select",{"onUpdate:modelValue":e[2]||(e[2]=o=>U.value=o),onChange:Le,class:y(["w-full h-9 text-sm border border-blue-300 rounded-md px-3 py-1 bg-white focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 truncate",U.value===""||U.value===null?"text-gray-400":"text-gray-900"])},[e[24]||(e[24]=l("option",{value:"",disabled:"",select:"",hiddene:"",hiddend:"",hidden:""},"Estado",-1)),(p(!0),g(me,null,ve(Pe.value,o=>(p(),g("option",{key:o.value,value:o.value,class:"text-gray-900 truncate text-lg"},f(o.label),9,ja))),128))],34),[[Ce,U.value]])])])])])]),default:D(()=>[m(n,{field:"nombre",header:"Nombre",sortable:"",class:"w-28"},{body:D(o=>[l("div",{class:"text-sm font-medium leading-relaxed overflow-hidden",style:{"max-width":"100px","text-overflow":"ellipsis","white-space":"nowrap"},title:o.data.nombre},f(o.data.nombre),9,Ka)]),_:1}),m(n,{field:"descripcion",header:"Descripci√≥n",class:"w-28 hidden md:table-cell"},{body:D(o=>[l("div",{class:"text-sm font-medium leading-relaxed overflow-hidden",style:{"max-width":"100px","text-overflow":"ellipsis","white-space":"nowrap"},title:o.data.descripcion},f(o.data.descripcion),9,qa)]),_:1}),m(n,{field:"categoria.nombre",header:"Categor√≠a",class:"w-32 hidden md:table-cell"},{body:D(o=>{var h;return[l("div",Ra,f(((h=o.data.categoria)==null?void 0:h.nombre)||"Sin categor√≠a"),1)]}),_:1}),m(n,{field:"precio",header:"Precio",class:"w-16"},{body:D(o=>[l("div",Ga,f(isNaN(Number(o.data.precio))?"":`$${Number(o.data.precio).toFixed(2)}`),1)]),_:1}),m(n,{field:"estado",header:"Estado",class:"w-28 hidden sm:table-cell"},{body:D(o=>[l("span",{class:y("inline-flex items-center px-2 py-1 rounded-full text-xs font-medium "+ie(o.data).class)},f(ie(o.data).label),3)]),_:1}),m(n,{exportable:!1,class:"w-52 min-w-36"},{header:D(()=>e[25]||(e[25]=[l("div",{class:"text-center w-full font-bold"}," Acciones ",-1)])),body:D(o=>[l("div",Wa,[l("button",{class:"flex bg-green-500 border p-1 py-2 sm:p-2 text-sm shadow-md hover:shadow-lg rounded-md hover:-translate-y-1 transition-transform duration-300",onClick:h=>Ke(o.data)},[m(v(P),{icon:v(ha),class:"h-3 w-6 sm:h-4 sm:w-7 text-white"},null,8,["icon"]),e[26]||(e[26]=l("span",{class:"hidden md:block text-white"},"M√°s",-1))],8,Za),l("button",{class:"flex bg-blue-500 border p-1 py-2 sm:p-2 text-sm shadow-md hover:shadow-lg rounded-md hover:-translate-y-1 transition-transform duration-300",onClick:h=>ze(o.data)},[m(v(P),{icon:v(xa),class:"h-3 w-6 sm:h-4 sm:w-7 text-white"},null,8,["icon"]),e[27]||(e[27]=l("span",{class:"hidden md:block text-white"},"Editar",-1))],8,Ja),l("button",{class:"flex bg-red-500 border p-1 py-2 sm:p-2 text-sm shadow-md hover:shadow-lg rounded-md hover:-translate-y-1 transition-transform duration-300",onClick:h=>Oe(o.data)},[m(v(P),{icon:v(wa),class:"h-3 w-6 sm:h-4 sm:w-7 text-white"},null,8,["icon"]),e[28]||(e[28]=l("span",{class:"hidden md:block text-white"},"Eliminar",-1))],8,Ha)])]),_:1})]),_:1},8,["value","rows","rowsPerPageOptions","rowsPerPage"]),m(Z,{visible:T.value,"onUpdate:visible":e[10]||(e[10]=o=>T.value=o),header:W.value+" Producto",modal:!0,style:pa(we.value),closable:!1,draggable:!1},{footer:D(()=>[l("div",Ut,[l("button",{class:"bg-red-500 hover:bg-red-700 text-white border-none px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",onClick:Fe,disabled:I.value},[m(v(P),{icon:I.value?v(j):v(_a),class:y(["h-5 text-white",{"animate-spin":I.value}])},null,8,["icon","class"]),I.value?(p(),g("span",Ft,f(W.value==="Guardar"?"Guardando...":"Actualizando..."),1)):(p(),g("span",zt,f(W.value),1))],8,Mt),l("button",{type:"button",class:"bg-blue-500 hover:bg-blue-700 text-white px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",onClick:Be,disabled:I.value},[m(v(P),{icon:v(ka),class:"h-5"},null,8,["icon"]),e[40]||(e[40]=E("Cancelar "))],8,Ot)])]),default:D(()=>[l("div",Ya,[l("div",Qa,[l("div",Xa,[e[29]||(e[29]=l("label",{for:"nombre",class:"w-24 flex items-center gap-1"},[E(" Nombre: "),l("span",{class:"text-red-500 font-bold"},"*")],-1)),m(r,{modelValue:t.value.nombre,"onUpdate:modelValue":e[4]||(e[4]=o=>t.value.nombre=o),id:"nombre",name:"nombre",maxlength:100,class:y([{"p-invalid":w.value&&(!t.value.nombre||t.value.nombre.length<3||t.value.nombre.length>100)},"flex-1 border-2 border-gray-400 hover:border-gray-500 focus:border-gray-500 focus:ring-0 focus:shadow-none rounded-md"]),placeholder:"TAZA PARA CAF√â, ETC.",onInput:Qe,onKeydown:Xe,onPaste:ea},null,8,["modelValue","class"])]),t.value.nombre&&t.value.nombre.length<3?(p(),g("small",et," El nombre debe tener al menos 3 caracteres. Actual: "+f(t.value.nombre.length)+"/3 ",1)):x("",!0),t.value.nombre&&t.value.nombre.length>=3&&_e()?(p(),g("small",at," ‚ö†Ô∏è Ya existe un producto con este nombre. ")):x("",!0),t.value.nombre&&t.value.nombre.length>=90&&t.value.nombre.length<=100?(p(),g("small",tt," Caracteres restantes: "+f(100-t.value.nombre.length),1)):x("",!0),w.value&&!t.value.nombre?(p(),g("small",st," El nombre es obligatorio. ")):x("",!0)]),l("div",lt,[l("div",ot,[e[30]||(e[30]=l("label",{for:"descripcion",class:"w-24 flex items-center gap-1 mt-2"},[E(" Descripci√≥n: "),l("span",{class:"text-red-500 font-bold"},"*")],-1)),m(c,{modelValue:t.value.descripcion,"onUpdate:modelValue":e[5]||(e[5]=o=>t.value.descripcion=o),id:"descripcion",name:"descripcion",maxlength:255,rows:"3",class:y([{"p-invalid":w.value&&(!t.value.descripcion||t.value.descripcion.length<10||t.value.descripcion.length>255)},"flex-1 border-2 border-gray-400 hover:border-gray-500 focus:border-gray-500 focus:ring-0 focus:shadow-none rounded-md"]),onInput:sa,onKeydown:aa,onPaste:ta,placeholder:"TAZA DE CER√ÅMICA IDEAL PARA CAF√â CALIENTE - 250ML, ETC."},null,8,["modelValue","class"])]),t.value.descripcion&&t.value.descripcion.length<10?(p(),g("small",rt," La descripci√≥n debe tener al menos 10 caracteres. Actual: "+f(t.value.descripcion.length)+"/10 ",1)):x("",!0),t.value.descripcion&&t.value.descripcion.length>=230&&t.value.descripcion.length<=255?(p(),g("small",nt," Caracteres restantes: "+f(255-t.value.descripcion.length),1)):x("",!0),w.value&&!t.value.descripcion?(p(),g("small",it," La descripci√≥n es obligatoria. ")):x("",!0)]),l("div",dt,[l("div",ut,[e[31]||(e[31]=l("label",{for:"categoria_id",class:"w-36 sm:w-32 flex items-center gap-1"},[E(" Categor√≠a: "),l("span",{class:"text-red-500 font-bold"},"*")],-1)),m(C,{modelValue:t.value.categoria_id,"onUpdate:modelValue":e[6]||(e[6]=o=>t.value.categoria_id=o),options:Ae.value,optionLabel:o=>ue.value.value<640?o.nombreTruncado:o.nombre,optionValue:"id",id:"categoria_id",name:"categoria_id",class:y(["w-full rounded-md border-2 border-gray-400 hover:border-gray-500",{"p-invalid":w.value&&!t.value.categoria_id}]),placeholder:"Seleccionar"},null,8,["modelValue","options","optionLabel","class"])]),w.value&&!t.value.categoria_id?(p(),g("small",ct," La categor√≠a es obligatoria. ")):x("",!0)]),l("div",mt,[l("div",vt,[e[33]||(e[33]=l("label",{for:"precio",class:"w-24 flex items-center gap-1"},[E(" Precio: "),l("span",{class:"text-red-500 font-bold"},"*")],-1)),l("div",pt,[e[32]||(e[32]=l("span",{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 pointer-events-none"},"$",-1)),m(r,{modelValue:t.value.precio,"onUpdate:modelValue":e[7]||(e[7]=o=>t.value.precio=o),id:"precio",name:"precio",type:"text",inputmode:"decimal",class:y(["w-full pl-8 border-2 border-gray-400 hover:border-gray-500 focus:border-gray-500 focus:ring-0 focus:shadow-none rounded-md",{"p-invalid":w.value&&(!t.value.precio||t.value.precio<=0||t.value.precio>9999.99)}]),placeholder:"0.00",onKeydown:la,onPaste:oa},null,8,["modelValue","class"])])]),w.value&&(t.value.precio==null||t.value.precio<=0||t.value.precio>9999.99)?(p(),g("small",gt," El precio es obligatorio, debe ser mayor a 0 y menor o igual a 9999.99. ")):x("",!0)]),l("div",ft,[l("div",bt,[l("label",{for:"stock_actual",class:y(["block mb-2",t.value.id!==null?"text-gray-500":""])},[e[34]||(e[34]=E(" Stock actual: ")),t.value.id===null?(p(),g("span",yt,"*")):(p(),g("span",ht,"(Deshabilitado)"))],2),m(r,{modelValue:t.value.stock_actual,"onUpdate:modelValue":e[8]||(e[8]=o=>t.value.stock_actual=o),id:"stock_actual",name:"stock_actual",type:"number",inputmode:"numeric",min:"0",max:"9999",disabled:t.value.id!==null,class:y([{"bg-gray-100 cursor-not-allowed":t.value.id!==null,"border-2 border-gray-400 hover:border-gray-500 focus:border-gray-500 focus:ring-0 focus:shadow-none":t.value.id===null,"border-2 border-gray-300":t.value.id!==null},"w-full rounded-md"]),placeholder:"0",onKeydown:ra,onPaste:na},null,8,["modelValue","disabled","class"]),t.value.id!==null?(p(),g("small",xt,' Para actualizar el stock usa el bot√≥n "M√°s" ‚Üí "Actualizar Stock" ')):x("",!0)]),l("div",wt,[l("label",{for:"stock_minimo",class:y(["block mb-2",t.value.id!==null?"text-gray-500":""])},[e[35]||(e[35]=E(" Stock m√≠nimo: ")),t.value.id===null?(p(),g("span",_t,"*")):(p(),g("span",kt,"(Deshabilitado)"))],2),m(r,{modelValue:t.value.stock_minimo,"onUpdate:modelValue":e[9]||(e[9]=o=>t.value.stock_minimo=o),id:"stock_minimo",name:"stock_minimo",type:"number",inputmode:"numeric",min:"1",max:"100",disabled:t.value.id!==null,class:y([{"bg-gray-100 cursor-not-allowed":t.value.id!==null,"border-2 border-gray-400 hover:border-gray-500 focus:border-gray-500 focus:ring-0 focus:shadow-none":t.value.id===null,"border-2 border-gray-300":t.value.id!==null},"w-full rounded-md"]),placeholder:"1",onKeydown:ia,onPaste:da},null,8,["modelValue","disabled","class"]),t.value.id!==null?(p(),g("small",Ct,' Para actualizar el stock m√≠nimo usa "Actualizar Stock" ')):x("",!0)])]),l("div",Dt,[l("div",Pt,[e[38]||(e[38]=l("label",{for:"imagenes",class:"w-24 flex items-center gap-1"},[E("Im√°genes:"),l("span",{class:"text-red-500 font-bold"},"*")],-1)),l("div",Et,[l("div",At,[l("input",{type:"file",id:"imagenes",name:"imagenes[]",accept:"image/*",multiple:"",onChange:He,class:"hidden",ref_key:"fileInput",ref:be},null,544),l("button",{type:"button",class:"bg-blue-500 hover:bg-blue-700 text-white px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2 outline-none focus:outline-none active:outline-none disabled:opacity-50 disabled:cursor-not-allowed",onClick:Je,disabled:$.value||B.value||!ye.value},[m(v(P),{icon:$.value?v(j):B.value?v(j):v(De),class:y({"animate-spin":$.value||B.value})},null,8,["icon","class"]),E(" "+f(Se.value),1)],8,St),l("div",Vt,[l("span",{class:y(["text-sm font-medium",b.value.length>=5?"text-red-600":"text-gray-600"])},f(b.value.length)+"/5 ",3),e[36]||(e[36]=l("span",{class:"text-xs text-gray-500"},"im√°genes",-1))])]),e[37]||(e[37]=l("div",{class:"text-xs text-gray-500 mb-2"}," M√°ximo 5 im√°genes por producto ‚Ä¢ Formatos: JPG, PNG, GIF ‚Ä¢ Tama√±o m√°ximo: 2MB por imagen ",-1))])]),w.value&&b.value.length===0?(p(),g("small",Tt,"Las im√°genes son obligatorias (al menos una).")):x("",!0)]),l("div",Nt,[(p(!0),g(me,null,ve(b.value,(o,h)=>(p(),g("div",{key:h,class:"relative w-24 sm:w-28 h-24 sm:h-28"},[l("img",{src:o.startsWith("data:image")?o:ge+o,alt:"Vista previa",class:"w-full h-full object-cover rounded border"},null,8,It),l("button",{onClick:Bt=>Ye(h),class:"absolute top-2 right-2 bg-gray-600/80 hover:bg-gray-700/80 text-white font-bold py-1 px-2 rounded-full shadow",style:{transform:"translate(50%, -50%)"}},e[39]||(e[39]=[l("i",{class:"pi pi-times text-xs"},null,-1)]),8,Lt)]))),128))])])]),_:1},8,["visible","header","style"]),m(Ca,{visible:G.value,"onUpdate:visible":e[11]||(e[11]=o=>G.value=o),"details-visible":Q.value,"onUpdate:detailsVisible":e[12]||(e[12]=o=>Q.value=o),"carousel-visible":se.value,"onUpdate:carouselVisible":e[13]||(e[13]=o=>se.value=o),"delete-visible":F.value,"onUpdate:deleteVisible":e[14]||(e[14]=o=>F.value=o),"unsaved-changes-visible":R.value,"onUpdate:unsavedChangesVisible":e[15]||(e[15]=o=>R.value=o),"update-stock-visible":X.value,"onUpdate:updateStockVisible":e[16]||(e[16]=o=>X.value=o),"carousel-index":re.value,"onUpdate:carouselIndex":e[17]||(e[17]=o=>re.value=o),producto:_.value||t.value,"dialog-style":we.value,"selected-images":te.value,"image-path":ge,"is-deleting":le.value,onUpdateStock:qe,onDeleteProduct:$e,onCancelDelete:e[18]||(e[18]=()=>F.value=!1),onCloseWithoutSaving:xe,onContinueEditing:je,onViewDetails:Re,onOpenImageModal:We,onStockUpdated:Ge},null,8,["visible","details-visible","carousel-visible","delete-visible","unsaved-changes-visible","update-stock-visible","carousel-index","producto","dialog-style","selected-images","is-deleting"])])])]),_:1})}}};export{Jt as default};
