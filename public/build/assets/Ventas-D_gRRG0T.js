import{N as Z,r as m,w as Xe,E as ie,o as Ye,a6 as Ke,h as J,d as x,x as v,p as n,e,$ as a,a0 as Ze,t as i,c as h,y,j as T,v as ge,F as be,l as he,a7 as ye,q as g,A as we,a5 as _e}from"./vendor-gbh1WW5n.js";import{A as Je}from"./AuthenticatedLayout-CSuYxj7F.js";import{z as et,A as ke,a as tt,F as r,e as Ce,f as C,h as at,q as ee,g as Ee}from"./ui-BrU4k96Z.js";import{R as lt,a as st,p as q,u as De,c as S,U as Ve,m as ot,n as Pe,w as nt,V as Se,o as it,W as rt,b as dt,L as ct,N as Ae,X as ut,h as Le,O as mt,P as vt,Q as pt,j as ft,Y as xt,Z as gt,i as Fe}from"./index-B6nVaz6S.js";import{f as bt}from"./index-DtyEsSN9.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ht={class:"container mx-auto px-4 py-6"},yt={class:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6"},wt={class:"bg-gradient-to-r from-yellow-400 to-yellow-600 text-white rounded-lg p-4 shadow-md"},_t={class:"flex items-center justify-between"},kt={class:"text-2xl font-bold"},Ct={class:"bg-gradient-to-r from-green-400 to-green-600 text-white rounded-lg p-4 shadow-md"},Et={class:"flex items-center justify-between"},Dt={class:"text-2xl font-bold"},Vt={class:"bg-gradient-to-r from-red-400 to-red-600 text-white rounded-lg p-4 shadow-md"},Pt={class:"flex items-center justify-between"},St={class:"text-2xl font-bold"},At={class:"bg-gradient-to-r from-blue-400 to-blue-600 text-white rounded-lg p-4 shadow-md"},Lt={class:"flex items-center justify-between"},Ft={class:"text-2xl font-bold"},jt={class:"bg-white rounded-lg shadow-md"},Tt={key:0,class:"flex flex-col items-center justify-center py-12"},$t={class:"bg-blue-50 p-3 rounded-lg shadow-sm border mb-4"},It={class:"flex flex-col sm:flex-row items-center justify-between mb-3"},Rt={class:"flex flex-col sm:flex-row sm:items-center gap-3"},Nt={class:"flex items-center gap-3"},Wt={class:"text-base font-medium text-gray-800 flex items-center gap-2"},Bt={class:"bg-blue-50 border border-blue-200 text-blue-700 px-3 py-1 rounded text-sm font-medium"},Ht={class:"grid grid-cols-2 gap-2 sm:hidden"},Ut=["disabled"],Mt=["disabled"],Gt={class:"flex gap-2"},Ot=["disabled"],zt=["disabled"],qt={class:"space-y-3"},Qt={class:"relative"},Xt={class:"sm:hidden"},Yt=["value"],Kt={class:"grid grid-cols-2 gap-3 sm:hidden"},Zt={class:"hidden sm:grid sm:grid-cols-3 gap-3"},Jt=["value"],ea={class:"px-1 mt-3"},ta={class:"text-blue-600 text-xs font-medium flex items-center gap-1"},aa={class:"text-sm leading-relaxed"},la={class:"flex items-center gap-2"},sa={class:"text-sm font-medium"},oa={class:"text-sm font-bold text-green-600"},na={class:"text-sm text-center"},ia={class:"flex flex-wrap gap-2 justify-center items-center"},ra=["onClick"],da=["onClick"],ca={class:"flex flex-col items-center justify-center py-12 text-center"},ua={class:"w-full"},ma={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3"},va={class:"flex flex-col sm:flex-row gap-3 sm:items-center"},pa={class:"flex items-center gap-2"},fa={class:"flex items-center gap-2"},xa={class:"text-right"},ga={class:"text-sm font-bold text-blue-700 leading-tight"},ba={key:0,class:"space-y-4"},ha={class:"bg-white rounded-lg border p-4"},ya={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},wa={class:"space-y-3"},_a={class:"flex items-center gap-2"},ka={class:"flex items-center gap-2"},Ca={class:"flex flex-col gap-1"},Ea={key:0,class:"flex flex-wrap items-center gap-2"},Da={class:"text-xs sm:text-sm break-all"},Va={key:1,class:"text-gray-500 italic text-xs sm:text-sm"},Pa={class:"flex flex-col gap-1"},Sa={key:0,class:"flex flex-wrap items-center gap-2"},Aa={class:"text-xs sm:text-sm"},La={class:"flex gap-1"},Fa=["href"],ja=["href"],Ta={key:1,class:"text-gray-500 italic text-xs sm:text-sm"},$a={key:0,class:"bg-gradient-to-r from-yellow-50 to-orange-50 rounded-lg border-2 border-yellow-300 p-4"},Ia={class:"flex items-center justify-between mb-4"},Ra={class:"flex items-center gap-2"},Na={class:"flex items-center gap-2"},Wa={class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800"},Ba={class:"space-y-3"},Ha={class:"text-sm text-gray-600"},Ua={key:0,class:"flex justify-center"},Ma=["disabled"],Ga={key:1,class:"space-y-3"},Oa={class:"bg-white rounded-lg border border-yellow-300 p-4"},za={class:"flex items-center justify-between mb-2"},qa={class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800"},Qa={class:"bg-gray-50 rounded-md p-3 mb-3"},Xa={class:"text-sm text-gray-800 break-all font-mono"},Ya={class:"flex items-center justify-between text-xs text-gray-500"},Ka={class:"flex flex-wrap gap-2 justify-center"},Za={class:"bg-blue-50 border border-blue-200 rounded-lg p-3"},Ja={class:"text-sm font-medium text-blue-800 mb-2"},el={class:"bg-white rounded-lg border p-4"},tl={class:"text-lg font-semibold text-gray-800 mb-4"},al={class:"flex items-center gap-2"},ll={class:"font-medium"},sl={class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800"},ol={class:"font-medium"},nl={class:"font-bold text-green-600"},il={class:"flex justify-center gap-4 w-full mt-6"},rl={key:0,class:"space-y-4"},dl={class:"bg-gray-50 p-4 rounded-lg border"},cl={class:"space-y-2 text-sm"},ul={class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},ml={class:"flex items-start gap-2"},vl={class:"text-sm text-yellow-800"},pl={class:"flex justify-center gap-4 w-full mt-6"},fl=["disabled"],xl=["disabled"],kl={__name:"Ventas",props:{ventas:{type:[Array,Object],default:()=>[]}},setup(je){var xe;Z.defaults.withCredentials=!0;const _=et(),Q=je,A=m(Array.isArray(Q.ventas)?Q.ventas:((xe=Q.ventas)==null?void 0:xe.data)||[]),f=m(null);Xe(()=>Q.ventas,s=>{A.value=Array.isArray(s)?s:(s==null?void 0:s.data)||[]},{deep:!0});const X=m(!1),L=m(!1),o=m({tipo:null,venta:null,titulo:"",mensaje:"",color:"",icono:null,textoBoton:"",importante:""}),N=m(!1),w=m(null),M=m(!1),W=m(!1),F=m(!1),$=m(!1),E=m(!1),G=m(!0),B=m(new Set),I=m(new Set),O=m(""),V=m(""),te=m({global:{value:null,matchMode:ke.CONTAINS},estado:{value:null,matchMode:ke.EQUALS}}),b=m({estado:null,fechaDesde:null,fechaHasta:null}),re=m([{name:"Pendiente",value:"pendiente"},{name:"Completada",value:"completada"},{name:"Cancelada",value:"cancelada"}]),ae=m(10),Te=m([5,10,20,50]),le=ie(()=>{let s=A.value;if(O.value){const t=O.value.toLowerCase();s=s.filter(l=>{var d,c,p;return((p=(c=(d=l.cliente)==null?void 0:d.user)==null?void 0:c.name)==null?void 0:p.toLowerCase().includes(t))||l.id.toString().includes(t)||l.estado.toLowerCase().includes(t)})}if(V.value&&(s=s.filter(t=>t.estado===V.value)),b.value.fechaDesde){const t=new Date(b.value.fechaDesde);s=s.filter(l=>new Date(l.fecha)>=t)}if(b.value.fechaHasta){const t=new Date(b.value.fechaHasta);s=s.filter(l=>new Date(l.fecha)<=t)}return s.sort((t,l)=>{const d={pendiente:1,completada:2,cancelada:3},c=d[t.estado.toLowerCase()]||4,p=d[l.estado.toLowerCase()]||4;if(c!==p)return c-p;const D=new Date(t.fecha);return new Date(l.fecha)-D})}),Y=ie(()=>{const s={pendientes:0,completadas:0,canceladas:0,totalVendido:0};return A.value.forEach(t=>{switch(t.estado){case"pendiente":s.pendientes++;break;case"completada":s.completadas++,s.totalVendido+=parseFloat(t.total||0);break;case"cancelada":s.canceladas++;break}}),s}),de=m(typeof window<"u"?window.innerWidth:1024),ce=ie(()=>de.value<640?{width:"95vw",maxWidth:"380px"}:de.value<768?{width:"80vw"}:{width:"70vw",maxWidth:"900px"}),ue=()=>{te.value.estado.value=V.value===""?null:V.value},me=async()=>{F.value=!0;try{await new Promise(s=>setTimeout(s,300)),V.value="",O.value="",te.value.global.value=null,te.value.estado.value=null,b.value={estado:null,fechaDesde:null,fechaHasta:null},_.add({severity:"success",summary:"Filtros limpiados",life:2e3})}finally{F.value=!1}},j=()=>{},ve=async()=>{E.value=!0,G.value=!0;try{await _e.reload({only:["ventas"],preserveScroll:!0,preserveState:!0})}catch(s){console.error("Error al cargar las ventas:",s),_.add({severity:"error",summary:"Error",detail:"No se pudieron cargar las ventas",life:3e3})}finally{setTimeout(()=>{E.value=!1,G.value=!1},500)}},$e=async()=>{const s=o.value.venta;if(s)try{console.warn("procesarVenta() - Función deshabilitada: las ventas se crean como completadas"),_.add({severity:"info",summary:"Información",detail:"Las ventas se procesan automáticamente al crear el pago",life:3e3}),L.value=!1,o.value={tipo:null,venta:null}}finally{B.value.delete(s.id)}},Ie=s=>{o.value={tipo:"cancelar",venta:s,titulo:"¿Cancelar esta venta?",mensaje:"Esta acción cancelará la venta y restaurará el stock si estaba completada.",color:"orange",icono:q,textoBoton:"Sí, Cancelar",importante:"Si la venta estaba completada, se restaurará automáticamente el stock de todos los productos."},L.value=!0},Re=async()=>{var t,l;const s=o.value.venta;if(s){I.value.add(s.id);try{const d=await Z.post(`/api/ventas/${s.id}/cancelar`),c=A.value.findIndex(p=>p.id===s.id);c!==-1&&(A.value[c]={...A.value[c],estado:"cancelada"}),_.add({severity:"success",summary:"Éxito",detail:"Venta cancelada correctamente",life:3e3}),L.value=!1,o.value={tipo:null,venta:null}}catch(d){_.add({severity:"error",summary:"Error",detail:((l=(t=d.response)==null?void 0:t.data)==null?void 0:l.message)||"Error al cancelar la venta",life:3e3})}finally{I.value.delete(s.id)}}},Ne=s=>{o.value={tipo:"eliminar",venta:s,titulo:"¿Eliminar esta venta?",mensaje:"Esta acción no se puede deshacer.",color:"red",icono:Fe,textoBoton:"Sí, Eliminar",importante:s.estado==="completada"?"Se restaurará el stock de todos los productos de esta venta.":"Esta venta será eliminada permanentemente del sistema."},L.value=!0},We=async()=>{var t,l;const s=o.value.venta;if(s){$.value=!0;try{const d=await Z.delete(`/api/ventas/${s.id}/eliminar`),c=A.value.findIndex(p=>p.id===s.id);c!==-1&&A.value.splice(c,1),_.add({severity:"success",summary:"Éxito",detail:"Venta eliminada correctamente",life:3e3}),L.value=!1,o.value={tipo:null,venta:null}}catch(d){_.add({severity:"error",summary:"Error",detail:((l=(t=d.response)==null?void 0:t.data)==null?void 0:l.message)||"Error al eliminar la venta",life:3e3})}finally{$.value=!1}}},Be=()=>{switch(o.value.tipo){case"procesar":$e();break;case"cancelar":Re();break;case"eliminar":We();break}},He=()=>{L.value=!1,o.value={tipo:null,venta:null}},Ue=async()=>{var s,t,l,d,c,p,D,P;if(f.value){N.value=!0,w.value=null,M.value=!1;try{const u=f.value,k=u.detalle_ventas||[],R=k.map(U=>({id:U.producto.id,nombre:U.producto.nombre,precio:U.precio_unitario,cantidad:U.cantidad,imagen:U.producto.primera_imagen||null,subtotal:U.subtotal})),K=`Venta #${u.id} - ${k.length} producto(s) - Cliente: ${((t=(s=u.cliente)==null?void 0:s.user)==null?void 0:t.name)||"Cliente"}`,z=await Z.post("/api/wompi/payment-link",{customer_email:((d=(l=u.cliente)==null?void 0:l.user)==null?void 0:d.email)||"",amount:parseFloat(u.total),description:K,reference:`VENTA-${u.id}-${Date.now()}`,customer_name:((p=(c=u.cliente)==null?void 0:c.user)==null?void 0:p.name)||"Cliente",venta_id:u.id,productos:R});if(z.data.success)w.value={payment_link:z.data.payment_link,reference:z.data.reference,link_id:z.data.link_id},M.value=!0,_.add({severity:"success",summary:"¡Enlace generado!",detail:"Enlace de pago de Wompi creado exitosamente",life:4e3});else throw new Error(z.data.message||"Error al generar enlace")}catch(u){console.error("Error generando enlace Wompi:",u),_.add({severity:"error",summary:"Error",detail:((P=(D=u.response)==null?void 0:D.data)==null?void 0:P.message)||"No se pudo generar el enlace de pago",life:5e3})}finally{N.value=!1}}},Me=async()=>{var s;if((s=w.value)!=null&&s.payment_link)try{await navigator.clipboard.writeText(w.value.payment_link),W.value=!0,_.add({severity:"success",summary:"¡Copiado!",detail:"Enlace copiado al portapapeles",life:3e3}),setTimeout(()=>{W.value=!1},3e3)}catch{const l=document.createElement("textarea");l.value=w.value.payment_link,document.body.appendChild(l),l.select(),document.execCommand("copy"),document.body.removeChild(l),_.add({severity:"info",summary:"Enlace copiado",detail:"Enlace copiado usando método alternativo",life:3e3})}},Ge=()=>{var s;(s=w.value)!=null&&s.payment_link&&window.open(w.value.payment_link,"_blank")},pe=()=>{w.value=null,M.value=!1,W.value=!1},Oe=()=>{X.value=!1,setTimeout(()=>{pe()},200)},ze=s=>{s.originalEvent.target.closest("button")||(f.value=s.data,X.value=!0)},fe=s=>s?new Date(s).toLocaleDateString("es-ES",{year:"numeric",month:"2-digit",day:"2-digit"}):"N/A",H=s=>s?parseFloat(s).toLocaleString("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00",se=s=>{switch(s){case"pendiente":return"bg-yellow-100 text-yellow-800";case"completada":return"bg-green-100 text-green-800";case"cancelada":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},oe=s=>{switch(s){case"pendiente":return"Pendiente de Pago";case"completada":return"Completada";case"cancelada":return"Cancelada";default:return"Desconocido"}},qe=s=>{if(!s)return;/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?window.location.href=`mailto:${s}`:window.open(`https://mail.google.com/mail/?view=cm&fs=1&to=${s}`,"_blank")};let ne=null;const Qe=()=>{_e.reload({only:["ventas"],preserveScroll:!0,preserveState:!0})};return Ye(()=>{G.value=!0,setTimeout(()=>{G.value=!1},1500),ne=setInterval(()=>{Qe()},3e4)}),Ke(()=>{ne&&clearInterval(ne)}),(s,t)=>(x(),J(Je,null,{default:v(()=>[n(a(Ze),{title:"Ventas"}),n(a(tt),{class:"z-[9999]"}),e("div",ht,[t[25]||(t[25]=e("div",{class:"mb-6 text-center sm:text-left"},[e("h1",{class:"text-3xl font-bold text-blue-600 mb-2"},"Gestión de Ventas de Productos"),e("p",{class:"text-gray-600"},"Visualiza y administra todas las ventas de productos realizadas en el sistema.")],-1)),e("div",yt,[e("div",wt,[e("div",_t,[e("div",null,[t[11]||(t[11]=e("div",{class:"text-yellow-100 text-sm"},"Ventas Pendientes",-1)),e("div",kt,i(Y.value.pendientes),1)]),n(a(r),{icon:a(lt),class:"text-3xl text-yellow-200"},null,8,["icon"])])]),e("div",Ct,[e("div",Et,[e("div",null,[t[12]||(t[12]=e("div",{class:"text-green-100 text-sm"},"Ventas Completadas",-1)),e("div",Dt,i(Y.value.completadas),1)]),n(a(r),{icon:a(st),class:"text-3xl text-green-200"},null,8,["icon"])])]),e("div",Vt,[e("div",Pt,[e("div",null,[t[13]||(t[13]=e("div",{class:"text-red-100 text-sm"},"Ventas Canceladas",-1)),e("div",St,i(Y.value.canceladas),1)]),n(a(r),{icon:a(q),class:"text-3xl text-red-200"},null,8,["icon"])])]),e("div",At,[e("div",Lt,[e("div",null,[t[14]||(t[14]=e("div",{class:"text-blue-100 text-sm"},"Total Vendido",-1)),e("div",Ft,"$"+i(H(Y.value.totalVendido)),1)]),n(a(r),{icon:a(De),class:"text-3xl text-blue-200"},null,8,["icon"])])])]),e("div",jt,[G.value?(x(),h("div",Tt,[n(a(r),{icon:a(S),class:"animate-spin h-8 w-8 text-blue-600 mb-3"},null,8,["icon"]),t[15]||(t[15]=e("p",{class:"text-gray-600 font-medium"},"Cargando ventas...",-1))])):(x(),J(a(Ce),{key:1,value:le.value,dataKey:"id",paginator:!0,rows:ae.value,rowsPerPageOptions:Te.value,rowsPerPage:ae.value,"onUpdate:rowsPerPage":t[7]||(t[7]=l=>ae.value=l),paginatorTemplate:"RowsPerPageDropdown FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink",currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} ventas",class:"overflow-x-auto max-w-full",responsiveLayout:"scroll",onRowClick:ze,pt:{root:{class:"text-sm"},wrapper:{class:"text-sm"},table:{class:"text-sm"},thead:{class:"text-sm"},headerRow:{class:"text-sm"},headerCell:{class:"text-sm font-medium py-3 px-2"},tbody:{class:"text-sm"},bodyRow:{class:"h-20 text-sm cursor-pointer hover:bg-blue-50 transition-colors duration-200"},bodyCell:{class:"py-3 px-2 text-sm"},paginator:{class:"text-xs sm:text-sm"},paginatorWrapper:{class:"flex flex-wrap justify-center sm:justify-between items-center gap-2 p-2"}}},{header:v(()=>[e("div",$t,[e("div",It,[e("div",Rt,[e("div",Nt,[e("h3",Wt,[n(a(r),{icon:a(nt),class:"text-blue-600 text-sm"},null,8,["icon"]),t[16]||(t[16]=e("span",null,"Filtros",-1))]),e("div",Bt,i(le.value.length)+" resultado"+i(le.value.length!==1?"s":""),1)]),e("div",Ht,[e("button",{class:"bg-blue-500 hover:bg-blue-600 border border-blue-500 px-3 py-2 text-sm text-white shadow-md rounded-md disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",onClick:ve,disabled:E.value},[n(a(r),{icon:E.value?a(S):a(Se),class:y([{"animate-spin":E.value},"h-3 w-3"])},null,8,["icon","class"]),e("span",null,i(E.value?"Recargando...":"Recargar"),1)],8,Ut),e("button",{class:"bg-red-500 hover:bg-red-600 border border-red-500 px-3 py-2 text-sm text-white shadow-md rounded-md disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",onClick:me,disabled:F.value},[F.value?(x(),J(a(r),{key:0,icon:a(S),class:"animate-spin h-3 w-3"},null,8,["icon"])):T("",!0),e("span",null,i(F.value?"Limpiando...":"Limpiar"),1)],8,Mt)])]),e("div",Gt,[e("button",{class:"bg-blue-500 hover:bg-blue-600 border border-blue-500 px-3 py-1 text-sm text-white shadow-md rounded-md hidden sm:flex disabled:opacity-50 disabled:cursor-not-allowed items-center gap-2",onClick:ve,disabled:E.value},[n(a(r),{icon:E.value?a(S):a(Se),class:y([{"animate-spin":E.value},"h-3 w-3"])},null,8,["icon","class"]),e("span",null,i(E.value?"Recargando...":"Recargar"),1)],8,Ot),e("button",{class:"bg-red-500 hover:bg-red-600 border border-red-500 px-3 py-1 text-sm text-white shadow-md rounded-md hidden sm:flex disabled:opacity-50 disabled:cursor-not-allowed items-center gap-2",onClick:me,disabled:F.value},[F.value?(x(),J(a(r),{key:0,icon:a(S),class:"animate-spin h-3 w-3"},null,8,["icon"])):T("",!0),e("span",null,i(F.value?"Limpiando...":"Limpiar filtros"),1)],8,zt)])]),e("div",qt,[e("div",Qt,[n(a(r),{icon:a(it),class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"},null,8,["icon"]),n(a(at),{modelValue:O.value,"onUpdate:modelValue":t[0]||(t[0]=l=>O.value=l),placeholder:"Buscar ventas...",class:"w-full h-9 text-sm rounded-md pl-10",style:{"background-color":"white","border-color":"#93c5fd"}},null,8,["modelValue"])]),e("div",Xt,[ge(e("select",{"onUpdate:modelValue":t[1]||(t[1]=l=>V.value=l),onChange:ue,class:"w-full h-9 text-sm border border-blue-300 rounded-md px-3 py-1 bg-white text-gray-400 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 truncate"},[t[17]||(t[17]=e("option",{value:"",disabled:"",selected:"",hidden:""},"Estado",-1)),(x(!0),h(be,null,he(re.value,l=>(x(),h("option",{key:l.value,value:l.value,class:"truncate"},i(l.name),9,Yt))),128))],544),[[ye,V.value]])]),e("div",Kt,[e("div",null,[n(a(ee),{modelValue:b.value.fechaDesde,"onUpdate:modelValue":t[2]||(t[2]=l=>b.value.fechaDesde=l),placeholder:"Fecha Desde",class:"w-full h-9 text-sm border",style:{"background-color":"white","border-color":"#93c5fd"},onDateSelect:j,onClear:j,showIcon:!0,dateFormat:"dd/mm/yy",maxDate:b.value.fechaHasta},null,8,["modelValue","maxDate"])]),e("div",null,[n(a(ee),{modelValue:b.value.fechaHasta,"onUpdate:modelValue":t[3]||(t[3]=l=>b.value.fechaHasta=l),placeholder:"Fecha Hasta",class:"w-full h-9 text-sm border",style:{"background-color":"white","border-color":"#93c5fd"},onDateSelect:j,onClear:j,showIcon:!0,dateFormat:"dd/mm/yy",minDate:b.value.fechaDesde},null,8,["modelValue","minDate"])])]),e("div",Zt,[e("div",null,[ge(e("select",{"onUpdate:modelValue":t[4]||(t[4]=l=>V.value=l),onChange:ue,class:"w-full h-9 text-sm border border-blue-300 rounded-md px-3 py-1 bg-white text-gray-400 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 truncate"},[t[18]||(t[18]=e("option",{value:"",disabled:"",selected:"",hidden:""},"Estado",-1)),(x(!0),h(be,null,he(re.value,l=>(x(),h("option",{key:l.value,value:l.value,class:"truncate text-gray-900"},i(l.name),9,Jt))),128))],544),[[ye,V.value]])]),e("div",null,[n(a(ee),{modelValue:b.value.fechaDesde,"onUpdate:modelValue":t[5]||(t[5]=l=>b.value.fechaDesde=l),placeholder:"Fecha desde",class:"w-full h-9 text-sm border",style:{"background-color":"white","border-color":"#93c5fd"},onDateSelect:j,onClear:j,showIcon:!0,dateFormat:"dd/mm/yy",maxDate:b.value.fechaHasta},null,8,["modelValue","maxDate"])]),e("div",null,[n(a(ee),{modelValue:b.value.fechaHasta,"onUpdate:modelValue":t[6]||(t[6]=l=>b.value.fechaHasta=l),placeholder:"Fecha hasta",class:"w-full h-9 text-sm border",style:{"background-color":"white","border-color":"#93c5fd"},onDateSelect:j,onClear:j,showIcon:!0,dateFormat:"dd/mm/yy",minDate:b.value.fechaDesde},null,8,["modelValue","minDate"])])]),e("div",ea,[e("p",ta,[n(a(r),{icon:a(Pe),class:"h-3 w-3 text-yellow-500"},null,8,["icon"]),t[19]||(t[19]=g(" Haz clic en cualquier fila para ver los detalles. "))])])])])]),empty:v(()=>[e("div",ca,[n(a(r),{icon:a(Pe),class:"h-16 w-16 text-gray-400 mb-4"},null,8,["icon"]),t[23]||(t[23]=e("p",{class:"text-xl font-semibold text-gray-600 mb-2"},"NO HAY VENTAS REGISTRADAS",-1)),t[24]||(t[24]=e("p",{class:"text-gray-500 mb-6"},"Las ventas aparecerán aquí cuando se realicen compras",-1))])]),default:v(()=>[n(a(C),{field:"fecha",header:"Fecha",sortable:"",class:"w-24 hidden md:table-cell"},{body:v(l=>[e("div",aa,i(fe(l.data.fecha)),1)]),_:1}),n(a(C),{field:"cliente.user.name",header:"Cliente",sortable:"",class:"w-32 min-w-24"},{body:v(l=>{var d,c;return[e("div",la,[n(a(r),{icon:a(Ve),class:"text-gray-500 text-xs"},null,8,["icon"]),e("span",sa,i(((c=(d=l.data.cliente)==null?void 0:d.user)==null?void 0:c.name)||"N/A"),1)])]}),_:1}),n(a(C),{field:"total",header:"Total",class:"w-24"},{body:v(l=>[e("div",oa," $"+i(H(l.data.total)),1)]),_:1}),n(a(C),{field:"estado",header:"Estado",class:"w-28 hidden sm:table-cell"},{body:v(l=>[e("span",{class:y("inline-flex items-center px-2 py-1 rounded-full text-xs font-medium "+se(l.data.estado))},i(oe(l.data.estado)),3)]),_:1}),n(a(C),{header:"Items",class:"w-16 hidden md:table-cell"},{body:v(l=>{var d;return[e("div",na,i(((d=l.data.detalle_ventas)==null?void 0:d.length)||0),1)]}),_:1}),n(a(C),{exportable:!1,class:"w-64 min-w-32"},{header:v(()=>t[20]||(t[20]=[e("div",{class:"text-center w-full font-bold"}," Acciones ",-1)])),body:v(l=>[e("div",ia,[l.data.estado==="completada"?(x(),h("button",{key:0,class:"flex bg-orange-500 border p-1 py-2 sm:p-2 text-sm shadow-md hover:shadow-lg rounded-md hover:-translate-y-1 transition-transform duration-300",onClick:d=>Ie(l.data),title:"Cancelar venta"},[n(a(r),{icon:a(q),class:"h-4 w-5 sm:h-4 sm:w-6 text-white"},null,8,["icon"]),t[21]||(t[21]=e("span",{class:"hidden lg:block text-white ml-1"},"Cancelar",-1))],8,ra)):T("",!0),e("button",{class:"flex bg-red-500 border p-1 py-2 sm:p-2 text-sm shadow-md hover:shadow-lg rounded-md hover:-translate-y-1 transition-transform duration-300",onClick:d=>Ne(l.data),title:"Eliminar venta"},[n(a(r),{icon:a(ot),class:"h-4 w-5 sm:h-4 sm:w-6 text-white"},null,8,["icon"]),t[22]||(t[22]=e("span",{class:"hidden lg:block text-white ml-1"},"Eliminar",-1))],8,da)])]),_:1})]),_:1},8,["value","rows","rowsPerPageOptions","rowsPerPage"]))])]),n(a(Ee),{visible:X.value,"onUpdate:visible":t[9]||(t[9]=l=>X.value=l),style:we(ce.value),modal:!0,closable:!1,draggable:!1},{header:v(()=>[e("div",ua,[e("div",ma,[t[26]||(t[26]=e("div",null,[e("h3",{class:"text-lg sm:text-xl font-bold text-gray-800 mb-1"}," Detalles de la Venta ")],-1)),e("div",va,[e("div",pa,[e("span",{class:y("px-3 py-1.5 rounded-full text-sm font-bold shadow-md border-2 border-white "+se(f.value.estado))},i(oe(f.value.estado)),3)]),e("div",fa,[n(a(r),{icon:a(gt),class:"text-blue-600 text-lg"},null,8,["icon"]),e("div",xa,[e("p",ga,i(fe(f.value.fecha)),1)])])])])])]),footer:v(()=>[e("div",il,[e("button",{class:"bg-blue-500 hover:bg-blue-700 text-white px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",onClick:Oe},[n(a(r),{icon:a(q),class:"h-5"},null,8,["icon"]),t[45]||(t[45]=g(" Cerrar "))])])]),default:v(()=>{var l,d,c,p,D,P;return[f.value?(x(),h("div",ba,[e("div",ha,[t[34]||(t[34]=e("div",{class:"mb-4"},[e("h4",{class:"text-lg font-semibold text-gray-800"},"Información General")],-1)),e("div",ya,[e("div",wa,[e("div",_a,[n(a(r),{icon:a(rt),class:"text-gray-500 text-sm"},null,8,["icon"]),t[27]||(t[27]=e("strong",null,"ID:",-1)),g(" #"+i(f.value.id),1)]),e("div",ka,[n(a(r),{icon:a(Ve),class:"text-gray-500 text-sm"},null,8,["icon"]),t[28]||(t[28]=e("strong",null,"Cliente:",-1)),g(" "+i(((d=(l=f.value.cliente)==null?void 0:l.user)==null?void 0:d.name)||"N/A"),1)]),e("div",Ca,[t[30]||(t[30]=e("span",{class:"font-medium text-gray-700"},"Email:",-1)),(p=(c=f.value.cliente)==null?void 0:c.user)!=null&&p.email?(x(),h("div",Ea,[e("span",Da,i(f.value.cliente.user.email),1),e("a",{onClick:t[8]||(t[8]=u=>qe(f.value.cliente.user.email)),href:"#",class:"inline-flex items-center gap-1 px-2 py-1 bg-red-500 hover:bg-red-600 text-white text-xs rounded-md transition-colors duration-200 cursor-pointer",title:"Abrir Gmail para enviar correo"},[n(a(r),{icon:a(dt),class:"h-3 w-3"},null,8,["icon"]),t[29]||(t[29]=e("span",{class:"hidden sm:inline"},"Enviar Email",-1))])])):(x(),h("span",Va,"Email no disponible"))]),e("div",Pa,[t[33]||(t[33]=e("span",{class:"font-medium text-gray-700"},"Teléfono:",-1)),(D=f.value.cliente)!=null&&D.telefono?(x(),h("div",Sa,[e("span",Aa,i(f.value.cliente.telefono),1),e("div",La,[e("a",{href:`https://wa.me/${f.value.cliente.telefono.replace(/[^0-9]/g,"")}`,target:"_blank",rel:"noopener noreferrer",class:"inline-flex items-center gap-1 px-2 py-1 bg-green-500 hover:bg-green-600 text-white text-xs rounded-md transition-colors duration-200",title:"Enviar mensaje por WhatsApp"},[n(a(r),{icon:a(bt),class:"h-3 w-3"},null,8,["icon"]),t[31]||(t[31]=e("span",{class:"hidden sm:inline"},"WhatsApp",-1))],8,Fa),e("a",{href:`tel:${f.value.cliente.telefono}`,class:"inline-flex items-center gap-1 px-2 py-1 bg-blue-500 hover:bg-blue-600 text-white text-xs rounded-md transition-colors duration-200",title:"Llamar por teléfono"},[n(a(r),{icon:a(ct),class:"h-3 w-3"},null,8,["icon"]),t[32]||(t[32]=e("span",{class:"hidden sm:inline"},"Llamar",-1))],8,ja)])])):(x(),h("span",Ta,"Teléfono no disponible"))])])])]),f.value.estado==="pendiente"?(x(),h("div",$a,[e("div",Ia,[e("div",Ra,[n(a(r),{icon:a(Ae),class:"text-orange-600 text-lg"},null,8,["icon"]),t[35]||(t[35]=e("h4",{class:"text-lg font-semibold text-gray-800"},"Generar Enlace de Pago Wompi",-1))]),e("div",Na,[e("span",Wa,[n(a(r),{icon:a(De),class:"mr-1"},null,8,["icon"]),g(" Total: $"+i(H(f.value.total)),1)])])]),e("div",Ba,[e("p",Ha,[n(a(r),{icon:a(ut),class:"text-blue-500 mr-1"},null,8,["icon"]),t[36]||(t[36]=e("strong",null,"¿El cliente aún no ha pagado?",-1)),t[37]||(t[37]=e("br",null,null,-1)),t[38]||(t[38]=g(" Genera un enlace de pago personalizado para que el cliente pueda pagar esta venta directamente. "))]),M.value?T("",!0):(x(),h("div",Ua,[e("button",{onClick:Ue,disabled:N.value,class:"bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-600 hover:to-orange-600 disabled:opacity-50 disabled:cursor-not-allowed text-white px-6 py-3 rounded-lg transition-all duration-200 flex items-center gap-2 shadow-lg hover:shadow-xl"},[n(a(r),{icon:N.value?a(S):a(Ae),class:y({"animate-spin":N.value})},null,8,["icon","class"]),g(" "+i(N.value?"Generando enlace...":"Generar Enlace de Pago"),1)],8,Ma)])),M.value&&w.value?(x(),h("div",Ga,[e("div",Oa,[e("div",za,[t[40]||(t[40]=e("span",{class:"text-sm font-medium text-gray-700"},"Enlace de Pago Generado:",-1)),e("span",qa,[n(a(r),{icon:a(Le),class:"mr-1"},null,8,["icon"]),t[39]||(t[39]=g(" ¡Listo para usar! "))])]),e("div",Qa,[e("p",Xa,i(w.value.payment_link),1)]),e("div",Ya,[e("span",null,"Referencia: "+i(w.value.reference),1),e("span",null,"ID: "+i(w.value.link_id),1)])]),e("div",Ka,[e("button",{onClick:Me,class:y(["px-4 py-2 rounded-lg transition-all duration-200 flex items-center gap-2 text-sm font-medium",W.value?"bg-green-500 text-white":"bg-blue-500 hover:bg-blue-600 text-white"])},[n(a(r),{icon:W.value?a(Le):a(mt)},null,8,["icon"]),g(" "+i(W.value?"¡Copiado!":"Copiar Enlace"),1)],2),e("button",{onClick:Ge,class:"bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-lg transition-all duration-200 flex items-center gap-2 text-sm font-medium"},[n(a(r),{icon:a(vt)},null,8,["icon"]),t[41]||(t[41]=g(" Ver Enlace "))]),e("button",{onClick:pe,class:"bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-all duration-200 flex items-center gap-2 text-sm font-medium"},[n(a(r),{icon:a(pt)},null,8,["icon"]),t[42]||(t[42]=g(" Limpiar "))])]),e("div",Za,[e("h5",Ja,[n(a(r),{icon:a(ft),class:"mr-1"},null,8,["icon"]),t[43]||(t[43]=g(" Instrucciones de uso: "))]),t[44]||(t[44]=e("ul",{class:"text-xs text-blue-700 space-y-1"},[e("li",null,"• Copia el enlace y envíalo al cliente por WhatsApp, email o SMS"),e("li",null,"• El cliente podrá pagar correctamente su carrito"),e("li",null,"• Recibirás notificación automática cuando se complete el pago"),e("li",null,"• El enlace es seguro y está protegido por Wompi")],-1))])])):T("",!0)])])):T("",!0),e("div",el,[e("h4",tl," Productos Vendidos ("+i(((P=f.value.detalle_ventas)==null?void 0:P.length)||0)+") ",1),n(a(Ce),{value:f.value.detalle_ventas,class:"text-sm",stripedRows:""},{default:v(()=>[n(a(C),{field:"producto.nombre",header:"Producto"},{body:v(({data:u})=>{var k;return[e("div",al,[n(a(r),{icon:a(xt),class:"text-blue-500 text-sm"},null,8,["icon"]),e("span",ll,i((k=u.producto)==null?void 0:k.nombre),1)])]}),_:1}),n(a(C),{field:"producto.categoria.nombre",header:"Categoría"},{body:v(({data:u})=>{var k,R;return[e("span",sl,i(((R=(k=u.producto)==null?void 0:k.categoria)==null?void 0:R.nombre)||"Sin categoría"),1)]}),_:1}),n(a(C),{field:"cantidad",header:"Cantidad",style:{width:"100px"}},{body:v(({data:u})=>[e("span",ol,i(u.cantidad),1)]),_:1}),n(a(C),{field:"precio_unitario",header:"Precio Unit.",style:{width:"120px"}},{body:v(({data:u})=>[e("span",null,"$"+i(H(u.precio_unitario)),1)]),_:1}),n(a(C),{field:"subtotal",header:"Subtotal",style:{width:"120px","font-size":"17px"}},{body:v(({data:u})=>[e("span",nl," $"+i(H(u.subtotal)),1)]),_:1})]),_:1},8,["value"])])])):T("",!0)]}),_:1},8,["visible","style"]),n(a(Ee),{visible:L.value,"onUpdate:visible":t[10]||(t[10]=l=>L.value=l),style:we(ce.value),header:o.value.titulo,modal:!0,closable:!1,draggable:!1},{footer:v(()=>{var l,d,c,p,D,P,u,k,R,K;return[e("div",pl,[e("button",{class:y(["text-white px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",o.value.color==="green"?"bg-green-500 hover:bg-green-600":o.value.color==="orange"?"bg-orange-500 hover:bg-orange-600":"bg-red-500 hover:bg-red-600"]),onClick:Be,disabled:o.value.tipo==="procesar"&&B.value.has((l=o.value.venta)==null?void 0:l.id)||o.value.tipo==="cancelar"&&I.value.has((d=o.value.venta)==null?void 0:d.id)||o.value.tipo==="eliminar"&&$.value},[n(a(r),{icon:o.value.tipo==="procesar"&&B.value.has((c=o.value.venta)==null?void 0:c.id)?a(S):o.value.tipo==="cancelar"&&I.value.has((p=o.value.venta)==null?void 0:p.id)?a(S):o.value.tipo==="eliminar"&&$.value?a(S):o.value.icono,class:y(["h-4",{"animate-spin":o.value.tipo==="procesar"&&B.value.has((D=o.value.venta)==null?void 0:D.id)||o.value.tipo==="cancelar"&&I.value.has((P=o.value.venta)==null?void 0:P.id)||o.value.tipo==="eliminar"&&$.value}])},null,8,["icon","class"]),g(" "+i(o.value.tipo==="procesar"&&B.value.has((u=o.value.venta)==null?void 0:u.id)?"Procesando...":o.value.tipo==="cancelar"&&I.value.has((k=o.value.venta)==null?void 0:k.id)?"Cancelando...":o.value.tipo==="eliminar"&&$.value?"Eliminando...":o.value.textoBoton),1)],10,fl),e("button",{class:"bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",onClick:He,disabled:o.value.tipo==="procesar"&&B.value.has((R=o.value.venta)==null?void 0:R.id)||o.value.tipo==="cancelar"&&I.value.has((K=o.value.venta)==null?void 0:K.id)||o.value.tipo==="eliminar"&&$.value},[n(a(r),{icon:a(q),class:"h-4"},null,8,["icon"]),t[53]||(t[53]=g(" Cerrar "))],8,xl)])]}),default:v(()=>{var l,d,c,p;return[o.value.venta?(x(),h("div",rl,[e("div",{class:y(["flex items-center gap-3 p-4 rounded-lg border",o.value.color==="green"?"bg-green-50 border-green-200":o.value.color==="orange"?"bg-orange-50 border-orange-200":"bg-red-50 border-red-200"])},[n(a(r),{icon:o.value.icono,class:y(["text-2xl",o.value.color==="green"?"text-green-500":o.value.color==="orange"?"text-orange-500":"text-red-500"])},null,8,["icon","class"]),e("div",null,[e("h4",{class:y(["text-lg font-semibold",o.value.color==="green"?"text-green-800":o.value.color==="orange"?"text-orange-800":"text-red-800"])},i(o.value.titulo),3),e("p",{class:y([o.value.color==="green"?"text-green-700":o.value.color==="orange"?"text-orange-700":"text-red-700"])},i(o.value.mensaje),3)])],2),e("div",dl,[t[51]||(t[51]=e("h5",{class:"font-semibold text-gray-800 mb-2"},"Información de la venta:",-1)),e("div",cl,[e("div",null,[t[46]||(t[46]=e("strong",null,"ID:",-1)),g(" #"+i(o.value.venta.id),1)]),e("div",null,[t[47]||(t[47]=e("strong",null,"Cliente:",-1)),g(" "+i(((d=(l=o.value.venta.cliente)==null?void 0:l.user)==null?void 0:d.name)||"N/A"),1)]),e("div",null,[t[48]||(t[48]=e("strong",null,"Email:",-1)),g(" "+i(((p=(c=o.value.venta.cliente)==null?void 0:c.user)==null?void 0:p.email)||"N/A"),1)]),e("div",null,[t[49]||(t[49]=e("strong",null,"Total:",-1)),g(" $"+i(H(o.value.venta.total)),1)]),e("div",null,[t[50]||(t[50]=e("strong",null,"Estado:",-1)),e("span",{class:y("inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ml-1 "+se(o.value.venta.estado))},i(oe(o.value.venta.estado)),3)])])]),e("div",ul,[e("div",ml,[n(a(r),{icon:a(Fe),class:"text-yellow-500 text-sm mt-0.5"},null,8,["icon"]),e("div",vl,[t[52]||(t[52]=e("strong",null,"Importante:",-1)),g(" "+i(o.value.importante),1)])])])])):T("",!0)]}),_:1},8,["visible","style","header"])]),_:1}))}};export{kl as default};
