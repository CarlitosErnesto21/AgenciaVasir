import{A as xe}from"./AuthenticatedLayout-DLrSmUd9.js";import{r as o,E as Ae,o as Ce,a5 as _e,w as ke,c as m,d as v,p as n,$ as t,a0 as Ve,x as f,e as l,t as k,A as K,j as $,q as S,y as F,F as X,l as Ee,n as Pe}from"./vendor-Bf9odu9b.js";import{z as Se,F as De,a as $e,A as p,e as Fe,f as R,h as Q,g as Y,p as Ue,k as Le}from"./ui-ByAzYu1X.js";import{f as Me,a as Ne,b as Ie,c as Te,d as We,e as G,g as Z,h as ee,i as je}from"./index-dTLVUhwl.js";import Oe from"./Modales-BrpyQjrr.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Re={class:"container mx-auto px-4 py-6"},Ge={class:"bg-white rounded-lg shadow-md"},ze={class:"flex flex-col sm:flex-row lg:justify-between lg:items-center mb-4 gap-4 p-6"},Be={class:"flex items-center gap-2 w-full justify-center lg:w-auto lg:justify-end"},qe={class:"bg-blue-50 p-3 rounded-lg shadow-sm border mb-4"},Je={class:"flex items-center justify-between mb-3"},He={class:"flex items-center gap-3"},Ke={class:"text-base font-medium text-gray-800 flex items-center gap-2"},Xe={class:"bg-blue-100 border border-blue-200 text-blue-700 px-3 py-1 rounded text-sm font-medium"},Qe={class:"space-y-3"},Ye={class:"text-sm font-medium leading-relaxed"},Ze={class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800"},ea={class:"flex gap-2 justify-center items-center"},aa=["onClick"],sa=["onClick"],la=["onClick"],ta={class:"space-y-6"},oa={class:"w-full flex flex-col"},na={key:0,class:"text-red-500 mt-1"},ia={class:"w-full flex flex-col"},ra={key:0,class:"text-red-500 mt-1"},da={class:"w-full flex flex-col"},ua={key:0,class:"text-red-500 mt-1"},ca={key:0,class:"w-full"},ma={class:"grid grid-cols-2 sm:grid-cols-3 gap-4"},va=["src"],fa=["onClick"],pa={class:"flex justify-center gap-4 w-full mt-6"},ga=["disabled"],ba={key:0},ha={key:1},ya=["disabled"],wa={class:"flex items-center gap-3"},xa={class:"flex flex-col"},Aa={class:"flex justify-center gap-4 w-full"},Ca=["disabled"],_a={key:0},ka={key:1},Va=["disabled"],D="/api/aerolineas",ae="/storage/aerolineas/",Ma={__name:"Aerolineas",setup(Ea){const d=Se(),V=o([]),z=o(),U=o({global:{value:null,matchMode:De.CONTAINS}}),L=o(typeof window<"u"?window.innerWidth:1024),M=Ae(()=>L.value<640?{width:"95vw",maxWidth:"380px"}:L.value<768?{width:"400px"}:{width:"450px"}),N=o(10),se=o([5,10,20,50]),i=o({id:null,nombre:"",fecha:null,imagenes:[]}),r=o([]),y=o([]),h=o([]),g=o(!1),E=o("Guardar"),c=o(!1),w=o(!1),I=o(!1),T=o(!1),W=o(!1),P=o(!1),le=o([]),j=o(0),A=o(!1),x=o(!1),C=o(null),_=o(!1),b=o(null);Ce(()=>{te(),typeof window<"u"&&window.addEventListener("resize",B)}),_e(()=>{typeof window<"u"&&window.removeEventListener("resize",B)});const B=()=>{typeof window<"u"&&(L.value=window.innerWidth)},q=async()=>{try{const s=await axios.get(D);V.value=s.data.map(e=>({...e,imagenes:(e.imagenes||[]).map(a=>typeof a=="string"?a:a.nombre)}))}catch{d.add({severity:"error",summary:"Error",detail:"No se pudieron cargar las aerolíneas",life:4e3})}},te=async()=>{d.add({severity:"info",summary:"Cargando aerolíneas...",life:2e3});try{const s=await axios.get(D);V.value=s.data.map(e=>({...e,imagenes:(e.imagenes||[]).map(a=>typeof a=="string"?a:a.nombre)})),d.add({severity:"success",summary:"Aerolíneas cargadas",life:2e3})}catch{d.add({severity:"error",summary:"Error",detail:"No se pudieron cargar las aerolíneas",life:4e3})}},oe=()=>{i.value={id:null,nombre:"",fecha:null,imagenes:[]},r.value=[],y.value=[],h.value=[],g.value=!1,E.value="Guardar",_.value=!1,b.value={id:null,nombre:"",fecha:null,imagenes:[],imagenes_originales:[]},c.value=!0},ne=s=>{i.value={...s},y.value=[],E.value="Actualizar",r.value=Array.isArray(s.imagenes)?s.imagenes.map(e=>typeof e=="string"?e:e.nombre):[],h.value=[],_.value=!1,b.value={...s,imagenes_originales:Array.isArray(s.imagenes)?s.imagenes.map(e=>typeof e=="string"?e:e.nombre):[]},c.value=!0},ie=()=>{_.value?P.value=!0:J()},J=()=>{c.value=!1,P.value=!1,_.value=!1,b.value=null,r.value=[],y.value=[],h.value=[],g.value=!1},re=async()=>{if(g.value=!0,!(!i.value.nombre||!i.value.fecha)){if(r.value.length===0){d.add({severity:"error",summary:"Error",detail:"Debes subir al menos una imagen.",life:4e3});return}try{A.value=!0;const s=new FormData;s.append("nombre",String(i.value.nombre));let e=i.value.fecha;e&&typeof e=="object"&&typeof e.toISOString=="function"?e=e.toISOString().split("T")[0]:typeof e=="string"?e=e:e="",s.append("fecha",e),y.value.forEach(u=>{s.append("imagenes[]",u)}),h.value.forEach(u=>{s.append("removed_images[]",u.split("/").pop())});let a;i.value.id?(s.append("_method","PUT"),a=await axios.post(`${D}/${i.value.id}`,s,{headers:{"Content-Type":"multipart/form-data"}}),d.add({severity:"info",summary:"Aerolínea actualizada",life:3e3})):(a=await axios.post(D,s,{headers:{"Content-Type":"multipart/form-data"}}),d.add({severity:"success",summary:"Aerolínea agregada",life:3e3})),await q(),c.value=!1,i.value={id:null,nombre:"",fecha:null,imagenes:[]},r.value=[],y.value=[],h.value=[],g.value=!1,_.value=!1,b.value=null}catch{d.add({severity:"error",summary:"Error",detail:"No se pudo guardar la aerolínea.",life:4e3})}finally{A.value=!1}}},de=s=>{C.value={...s},w.value=!0},H=async()=>{try{x.value=!0,await axios.delete(`${D}/${C.value.id}`),await q(),w.value=!1,C.value=null,d.add({severity:"success",summary:"Aerolínea eliminada",life:3e3})}catch{d.add({severity:"error",summary:"Error",detail:"No se pudo eliminar la aerolínea.",life:3e3})}finally{x.value=!1}},ue=s=>{for(const e of s.files)if(e instanceof File){y.value.push(e);const a=new FileReader;a.onload=u=>{r.value.push(u.target.result),c.value&&O()},a.readAsDataURL(e)}},ce=s=>{const e=r.value[s];typeof e=="string"&&e.startsWith("data:image")?(r.value.splice(s,1),y.value.splice(s,1)):(h.value.push(e),r.value.splice(s,1)),c.value&&O()},me=s=>{C.value=s,T.value=!0},ve=s=>{C.value=s,W.value=!0},fe=s=>{j.value=s,I.value=!0},pe=()=>{J(),window.pendingAction&&(window.pendingAction(),window.pendingAction=null)},ge=()=>{P.value=!1,window.pendingAction=null},be=s=>{i.value={id:null,nombre:`${s.nombre} (Copia)`,fecha:s.fecha,imagenes:[]},r.value=Array.isArray(s.imagenes)?s.imagenes.map(e=>typeof e=="string"?e:e.nombre):[],y.value=[],h.value=[],g.value=!1,E.value="Guardar",_.value=!1,b.value={id:null,nombre:`${s.nombre} (Copia)`,fecha:s.fecha,imagenes:[],imagenes_originales:Array.isArray(s.imagenes)?s.imagenes.map(e=>typeof e=="string"?e:e.nombre):[]},c.value=!0,d.add({severity:"info",summary:"Aerolínea duplicada",detail:"Se ha creado una copia de la aerolínea para editar",life:3e3})},he=s=>{d.add({severity:"info",summary:"Cambio de estado",detail:`Función para cambiar estado de: ${s.nombre}`,life:3e3})},ye=s=>{d.add({severity:"info",summary:"Generar reporte",detail:`Generando reporte para: ${s.nombre}`,life:3e3})},we=s=>{d.add({severity:"info",summary:"Archivar aerolínea",detail:`Archivando aerolínea: ${s.nombre}`,life:3e3})},O=()=>{!b.value||!c.value||Pe(()=>{const s={...i.value,imagenes_actuales:[...r.value]},e=JSON.stringify(s)!==JSON.stringify({...b.value,imagenes_actuales:b.value.imagenes_originales})||h.value.length>0,a=!b.value.id,u=i.value.nombre||i.value.fecha||r.value.length>0;_.value=e||a&&u})};return ke([i,r,h],()=>{b.value&&c.value&&O()},{deep:!0,flush:"post"}),(s,e)=>(v(),m(X,null,[n(t(Ve),{title:"Aerolíneas"}),n(xe,null,{default:f(()=>[n(t($e),{class:"z-[9999]"}),l("div",Re,[e[22]||(e[22]=l("div",{class:"mb-6"},[l("h1",{class:"text-3xl font-bold text-blue-600 mb-2"},"Gestión de Aerolíneas"),l("p",{class:"text-gray-600"},"Administra las aerolíneas del sistema")],-1)),l("div",Ge,[l("div",ze,[e[16]||(e[16]=l("h3",{class:"text-2xl sm:text-3xl text-blue-600 font-bold text-center sm:text-start"},"Lista de Aerolíneas",-1)),l("div",Be,[l("button",{class:"bg-red-500 border border-red-500 p-2 text-sm text-white shadow-md hover:shadow-lg rounded-md hover:-translate-y-1 transition-transform duration-300 flex items-center gap-2",onClick:oe},[n(t(p),{icon:t(Me),class:"h-4 w-4"},null,8,["icon"]),e[15]||(e[15]=l("span",null,"Agregar Aerolínea",-1))])])]),n(t(Fe),{value:V.value,selection:z.value,"onUpdate:selection":e[1]||(e[1]=a=>z.value=a),dataKey:"id",filters:U.value,paginator:!0,rows:N.value,rowsPerPageOptions:se.value,rowsPerPage:N.value,"onUpdate:rowsPerPage":e[2]||(e[2]=a=>N.value=a),paginatorTemplate:"RowsPerPageDropdown FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink",currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} aerolíneas",class:"overflow-x-auto",responsiveLayout:"scroll",pt:{root:{class:"text-sm"},wrapper:{class:"text-sm"},table:{class:"text-sm"},thead:{class:"text-sm"},headerRow:{class:"text-sm"},headerCell:{class:"text-sm font-medium py-3 px-2"},tbody:{class:"text-sm"},bodyRow:{class:"h-16 text-sm"},bodyCell:{class:"py-3 px-2 text-sm"},paginator:{class:"text-xs sm:text-sm"},paginatorWrapper:{class:"flex flex-wrap justify-center sm:justify-between items-center gap-2 p-2"}}},{header:f(()=>[l("div",qe,[l("div",Je,[l("div",He,[l("h3",Ke,[n(t(p),{icon:t(We),class:"text-blue-600 text-sm"},null,8,["icon"]),e[17]||(e[17]=l("span",null,"Filtros y Búsqueda",-1))]),l("div",Xe,k(V.value.length)+" resultado"+k(V.value.length!==1?"s":""),1)])]),l("div",Qe,[l("div",null,[n(t(Q),{modelValue:U.value.global.value,"onUpdate:modelValue":e[0]||(e[0]=a=>U.value.global.value=a),placeholder:"🔍 Buscar aerolíneas...",class:"w-full h-9 text-sm rounded-md",style:{"background-color":"white","border-color":"#93c5fd"}},null,8,["modelValue"])])])])]),default:f(()=>[n(t(R),{field:"nombre",header:"Nombre",sortable:"",class:"w-96 min-w-16"},{body:f(a=>[l("div",Ye,k(a.data.nombre),1)]),_:1}),n(t(R),{field:"fecha",header:"Fecha de Fundación",sortable:"",class:"w-96 min-w-16"},{body:f(a=>[l("span",Ze,k(a.data.fecha?new Date(a.data.fecha).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"}):"No definida"),1)]),_:1}),n(t(R),{exportable:!1,class:"w-52 min-w-16"},{header:f(()=>e[18]||(e[18]=[l("div",{class:"text-center w-full font-bold"}," Acciones ",-1)])),body:f(a=>[l("div",ea,[l("button",{class:"flex bg-green-500 hover:bg-green-600 border p-1 py-2 sm:p-2 text-sm shadow-md hover:shadow-lg rounded-md hover:-translate-y-1 transition-transform duration-300",onClick:u=>me(a.data),title:"Más acciones"},[n(t(p),{icon:t(Ne),class:"h-3 w-6 sm:h-4 sm:w-7 text-white"},null,8,["icon"]),e[19]||(e[19]=l("span",{class:"hidden md:block text-white"},"Más",-1))],8,aa),l("button",{class:"flex bg-blue-500 hover:bg-blue-600 border p-1 py-2 sm:p-2 text-sm shadow-md hover:shadow-lg rounded-md hover:-translate-y-1 transition-transform duration-300",onClick:u=>ne(a.data),title:"Editar aerolínea"},[n(t(p),{icon:t(Ie),class:"h-3 w-6 sm:h-4 sm:w-7 text-white"},null,8,["icon"]),e[20]||(e[20]=l("span",{class:"hidden md:block text-white"},"Editar",-1))],8,sa),l("button",{class:"flex bg-red-500 hover:bg-red-600 border p-1 py-2 sm:p-2 text-sm shadow-md hover:shadow-lg rounded-md hover:-translate-y-1 transition-transform duration-300",onClick:u=>de(a.data),title:"Eliminar aerolínea"},[n(t(p),{icon:t(Te),class:"h-3 w-6 sm:h-4 sm:w-7 text-white"},null,8,["icon"]),e[21]||(e[21]=l("span",{class:"hidden md:block text-white"},"Eliminar",-1))],8,la)])]),_:1})]),_:1},8,["value","selection","filters","rows","rowsPerPageOptions","rowsPerPage"])])]),n(t(Y),{visible:c.value,"onUpdate:visible":e[5]||(e[5]=a=>c.value=a),header:E.value+" Aerolínea",modal:!0,closable:!1,style:K(M.value),draggable:!1},{footer:f(()=>[l("div",pa,[l("button",{type:"button",class:"bg-red-500 hover:bg-red-700 text-white border-none px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",onClick:re,disabled:A.value},[n(t(p),{icon:A.value?t(Z):t(ee),class:F(["h-5 text-white",{"animate-spin":A.value}])},null,8,["icon","class"]),A.value?(v(),m("span",ha,"Guardando...")):(v(),m("span",ba,k(E.value),1))],8,ga),l("button",{type:"button",class:"bg-blue-500 hover:bg-blue-700 text-white px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",onClick:ie,disabled:A.value},[n(t(p),{icon:t(G),class:"h-5"},null,8,["icon"]),e[27]||(e[27]=l("span",null,"Cancelar",-1))],8,ya)])]),default:f(()=>[l("div",ta,[l("div",oa,[e[23]||(e[23]=l("label",{for:"nombre",class:"text-sm font-medium text-gray-700 mb-2"},[S(" Nombre de la Aerolínea: "),l("span",{class:"text-red-500"},"*")],-1)),n(t(Q),{modelValue:i.value.nombre,"onUpdate:modelValue":e[3]||(e[3]=a=>i.value.nombre=a),modelModifiers:{trim:!0},id:"nombre",placeholder:"Ingresa el nombre de la aerolínea",class:F([{"border-red-300":g.value&&!i.value.nombre},"w-full"])},null,8,["modelValue","class"]),g.value&&!i.value.nombre?(v(),m("small",na," ⚠️ El nombre es obligatorio ")):$("",!0)]),l("div",ia,[e[24]||(e[24]=l("label",{for:"fecha",class:"text-sm font-medium text-gray-700 mb-2"},[S(" Fecha de Fundación: "),l("span",{class:"text-red-500"},"*")],-1)),n(t(Ue),{modelValue:i.value.fecha,"onUpdate:modelValue":e[4]||(e[4]=a=>i.value.fecha=a),id:"fecha",showIcon:!0,dateFormat:"yy-mm-dd",class:F([{"border-red-300":g.value&&!i.value.fecha},"w-full"]),manualInput:!1,placeholder:"Selecciona la fecha de fundación"},null,8,["modelValue","class"]),g.value&&!i.value.fecha?(v(),m("small",ra," ⚠️ La fecha es obligatoria ")):$("",!0)]),l("div",da,[e[25]||(e[25]=l("label",{for:"imagenes",class:"text-sm font-medium text-gray-700 mb-2"},[S(" Imágenes: "),l("span",{class:"text-red-500"},"*")],-1)),n(t(Le),{mode:"basic",name:"imagenes[]",accept:"image/*",auto:!0,chooseLabel:"Seleccionar imágenes",onSelect:ue,customUpload:!0,multiple:!0,class:"w-full"}),g.value&&r.value.length===0?(v(),m("small",ua," ⚠️ Al menos una imagen es obligatoria ")):$("",!0)]),r.value.length>0?(v(),m("div",ca,[e[26]||(e[26]=l("label",{class:"text-sm font-medium text-gray-700 mb-3 block"},"Vista previa de imágenes:",-1)),l("div",ma,[(v(!0),m(X,null,Ee(r.value,(a,u)=>(v(),m("div",{key:u,class:"relative group"},[l("img",{src:a.startsWith("data:image")?a:ae+a,alt:"Vista previa",class:"w-full h-24 object-cover rounded-lg border group-hover:opacity-75 transition-opacity"},null,8,va),l("button",{onClick:Pa=>ce(u),class:"absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 shadow opacity-0 group-hover:opacity-100 transition-opacity",title:"Eliminar imagen"},[n(t(p),{icon:t(G),class:"h-3 w-3"},null,8,["icon"])],8,fa)]))),128))])])):$("",!0)])]),_:1},8,["visible","header","style"]),n(t(Y),{visible:w.value,"onUpdate:visible":e[7]||(e[7]=a=>w.value=a),header:"Eliminar aerolínea",modal:!0,style:K(M.value),closable:!1,draggable:!1},{footer:f(()=>[l("div",Aa,[l("button",{type:"button",class:"bg-red-500 hover:bg-red-700 text-white border-none px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",onClick:H,disabled:x.value},[n(t(p),{icon:x.value?t(Z):t(ee),class:F(["h-5",{"animate-spin":x.value}])},null,8,["icon","class"]),x.value?(v(),m("span",ka,"Eliminando...")):(v(),m("span",_a,"Eliminar"))],8,Ca),l("button",{type:"button",class:"bg-blue-500 hover:bg-blue-700 text-white px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",onClick:e[6]||(e[6]=a=>w.value=!1),disabled:x.value},[n(t(p),{icon:t(G),class:"h-5"},null,8,["icon"]),e[31]||(e[31]=l("span",null,"Cancelar",-1))],8,Va)])]),default:f(()=>{var a;return[l("div",wa,[n(t(p),{icon:t(je),class:"h-8 w-8 text-red-500"},null,8,["icon"]),l("div",xa,[l("span",null,[e[28]||(e[28]=S("¿Estás seguro de eliminar la aerolínea: ")),l("b",null,k((a=C.value)==null?void 0:a.nombre),1),e[29]||(e[29]=S("?"))]),e[30]||(e[30]=l("span",{class:"text-red-600 text-sm font-medium mt-1"},"Esta acción es irreversible.",-1))])])]}),_:1},8,["visible","style"]),n(Oe,{visible:T.value,"onUpdate:visible":e[8]||(e[8]=a=>T.value=a),detailsVisible:W.value,"onUpdate:detailsVisible":e[9]||(e[9]=a=>W.value=a),carouselVisible:I.value,"onUpdate:carouselVisible":e[10]||(e[10]=a=>I.value=a),deleteVisible:w.value,"onUpdate:deleteVisible":e[11]||(e[11]=a=>w.value=a),unsavedChangesVisible:P.value,"onUpdate:unsavedChangesVisible":e[12]||(e[12]=a=>P.value=a),aerolinea:C.value,dialogStyle:M.value,selectedImages:le.value,carouselIndex:j.value,imagePath:ae,isDeleting:x.value,"onUpdate:carouselIndex":e[13]||(e[13]=a=>j.value=a),onDuplicate:be,onChangeStatus:he,onGenerateReport:ye,onArchive:we,onViewDetails:ve,onOpenImageModal:fe,onDeleteAerolinea:H,onCancelDelete:e[14]||(e[14]=a=>w.value=!1),onCloseWithoutSaving:pe,onContinueEditing:ge},null,8,["visible","detailsVisible","carouselVisible","deleteVisible","unsavedChangesVisible","aerolinea","dialogStyle","selectedImages","carouselIndex","isDeleting"])]),_:1})],64))}};export{Ma as default};
