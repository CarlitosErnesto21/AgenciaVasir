import{F as b,e as k,g as E}from"./index-Cz7jU3Cp.js";import{r as f,m as R,y as F,p as j,o as g,w as p,c as D,f as S,a as l,b as n,u as c,E as B}from"./app-WKwrJkJC.js";import N from"./ResumenTour-VD5jKeA5.js";import T from"./FormularioDatosPersonales-CciqR48P.js";import U from"./SelectorCupos-BkPL4KO9.js";const A={key:0,class:"space-y-3 sm:space-y-4 lg:space-y-6 text-xs sm:text-sm text-gray-700"},M={class:"flex flex-row gap-3 sm:gap-4 pt-4 sm:pt-6 px-1 sm:px-0"},$={__name:"ModalReservaTour",props:{visible:{type:Boolean,default:!1},tourSeleccionado:{type:Object,default:null},user:{type:Object,default:null}},emits:["update:visible","confirmar-reserva"],setup(r,{emit:_}){const i=r,u=_,m=f(null),o=f({correo:"",nombres:"",tipo_documento:null,tipo_documento_id:null,numero_identificacion:"",fecha_nacimiento:"",genero:"",direccion:"",telefono:"",cupos_adultos:1,cupos_menores:0}),d=f(!1),w=async()=>{var a;if(!i.user)return null;try{const e=await fetch("/api/cliente-datos",{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":((a=document.querySelector('meta[name="csrf-token"]'))==null?void 0:a.getAttribute("content"))||"","X-Requested-With":"XMLHttpRequest"},credentials:"same-origin"});return e.ok?(await e.json()).cliente||null:(e.status===404||console.error("Error al cargar datos del cliente:",e.status),null)}catch(e){return console.error("Error al cargar datos del cliente:",e),null}},y=async()=>{const a=i.user;let e="",s="";if(a&&(s=a.email||"",e=a.name||""),o.value={correo:s,nombres:e,tipo_documento:null,tipo_documento_id:null,numero_identificacion:"",fecha_nacimiento:"",genero:"",direccion:"",telefono:"",cupos_adultos:1,cupos_menores:0},d.value=!1,a){const t=await w();if(t){d.value=!0;let x="";if(t.fecha_nacimiento)try{x=new Date(t.fecha_nacimiento)}catch(C){console.warn("Error al formatear fecha de nacimiento:",C)}o.value={...o.value,tipo_documento_id:t.tipo_documento_id,numero_identificacion:t.numero_identificacion||"",fecha_nacimiento:x,genero:t.genero||"",direccion:t.direccion||"",telefono:t.telefono||""}}}},v=()=>{u("update:visible",!1)},h=async()=>{var a,e;if(!((a=m.value)!=null&&a.validateForm&&!m.value.validateForm())){if(o.value.cupos_adultos<=0&&o.value.cupos_menores<=0){alert("Debe seleccionar al menos un cupo");return}try{const s=await B.post("/reservas",{tour_id:i.tourSeleccionado.id,cliente_data:{correo:o.value.correo,nombres:o.value.nombres,tipo_documento:o.value.tipo_documento,numero_identificacion:o.value.numero_identificacion,fecha_nacimiento:o.value.fecha_nacimiento,genero:o.value.genero,direccion:o.value.direccion,telefono:o.value.telefono},cupos_adultos:o.value.cupos_adultos,cupos_menores:o.value.cupos_menores,precio_total:precios.value.total});u("reserva-confirmada",s.data),v()}catch(s){console.error("Error al confirmar reserva:",s),((e=s.response)==null?void 0:e.status)===419?(alert("Su sesiÃ³n ha expirado. Por favor, recargue la pÃ¡gina."),window.location.reload()):alert("Error al procesar la reserva. IntÃ©ntelo de nuevo.")}}};return R(()=>i.visible,async a=>{a&&await y()}),(a,e)=>{const s=F("Dialog");return g(),j(s,{visible:r.visible,"onUpdate:visible":e[3]||(e[3]=t=>u("update:visible",t)),modal:"",closable:!1,class:"w-[95vw] sm:w-[90vw] md:w-[85vw] lg:w-[80vw] xl:max-w-4xl mx-2 sm:mx-4",draggable:!1},{header:p(()=>e[4]||(e[4]=[n("h3",{class:"text-sm sm:text-base lg:text-lg font-bold text-red-700 flex items-center"},[n("span",{class:"mr-1 sm:mr-2"},"ðŸ§¾"),n("span",{class:"hidden sm:inline"},"Reservando Tour"),n("span",{class:"sm:hidden"},"Reserva")],-1)])),footer:p(()=>[n("div",M,[n("button",{onClick:v,type:"button",class:"bg-white hover:bg-red-50 text-red-600 border border-red-600 flex-1 sm:flex-none sm:px-6 px-3 py-3 sm:py-2 text-sm sm:text-base font-medium rounded-lg transition-all duration-200 ease-in-out flex items-center justify-center gap-2"},[l(c(b),{icon:c(k),class:"h-4 w-4 text-red-600"},null,8,["icon"]),e[5]||(e[5]=n("span",{class:"hidden sm:inline"},"Cancelar",-1)),e[6]||(e[6]=n("span",{class:"sm:hidden"},"Cancelar",-1))]),n("button",{onClick:h,type:"button",class:"bg-red-600 hover:bg-red-700 text-white border border-red-600 flex-1 sm:flex-none sm:px-6 px-3 py-3 sm:py-2 text-sm sm:text-base font-semibold rounded-lg transition-all duration-200 ease-in-out flex items-center justify-center gap-2 shadow-lg hover:shadow-xl"},[l(c(b),{icon:c(E),class:"h-4 w-4 text-white"},null,8,["icon"]),e[7]||(e[7]=n("span",{class:"hidden sm:inline"},"Confirmar Reserva",-1)),e[8]||(e[8]=n("span",{class:"sm:hidden"},"Confirmar",-1))])])]),default:p(()=>[r.tourSeleccionado?(g(),D("div",A,[l(N,{"tour-seleccionado":r.tourSeleccionado},null,8,["tour-seleccionado"]),l(T,{ref_key:"formularioDatosRef",ref:m,formulario:o.value,"onUpdate:formulario":e[0]||(e[0]=t=>o.value=t),"tiene-cliente-existente":d.value,user:r.user},null,8,["formulario","tiene-cliente-existente","user"]),l(U,{"cupos-adultos":o.value.cupos_adultos,"onUpdate:cuposAdultos":e[1]||(e[1]=t=>o.value.cupos_adultos=t),"cupos-menores":o.value.cupos_menores,"onUpdate:cuposMenores":e[2]||(e[2]=t=>o.value.cupos_menores=t)},null,8,["cupos-adultos","cupos-menores"])])):S("",!0)]),_:1},8,["visible"])}}};export{$ as default};
