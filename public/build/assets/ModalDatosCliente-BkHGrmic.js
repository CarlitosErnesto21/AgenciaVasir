import{a4 as R,r as y,E as $,o as H,N as k,h as K,d as u,x as E,e as o,q as g,t as c,I as X,v as N,c as m,j as b,y as x,a9 as U,F as q,l as Z,a7 as T,p as w,$ as f}from"./vendor-CaDzpwPW.js";import{z as J,q as Q,A as D,g as W}from"./ui-BjYE_i4I.js";import{f as Y,au as O,g as ee,G as oe}from"./index-BSa8eY-g.js";import{z as ae}from"./vue-tel-input-AlIeehSu.js";import{_ as le}from"./_plugin-vue_export-helper-DlAUqK2U.js";const te={class:"text-xl font-bold text-red-700 flex items-center gap-2"},re={class:"py-4"},se={class:"bg-blue-50 rounded-lg p-4 mb-6"},ne={class:"text-sm text-blue-700"},ie={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},de={key:0,class:"text-red-500 text-xs"},ue=["disabled"],ce={key:0,value:"",disabled:""},me={key:1,value:"",disabled:""},fe=["value"],ve={key:0,class:"text-red-500 text-xs"},pe={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},ge={key:0,class:"text-red-500 text-xs"},be={key:0,class:"text-red-500 text-xs"},ye={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},xe={class:"mr-1"},_e={key:1,class:"text-red-500 text-xs"},we={class:"sm:col-span-1"},Ce={key:0,class:"text-red-500 text-xs"},Ne={class:"flex justify-center gap-4 w-full mt-6"},Ve=["disabled"],ke=["disabled"],Ee={__name:"ModalDatosCliente",props:{visible:{type:Boolean,default:!1},tieneClienteExistente:{type:Boolean,default:!1}},emits:["update:visible","cliente-guardado"],setup(h,{emit:F}){const B=h,V=F,j=R(),_=J(),p=y(!1),v=y([]),C=y(!0),I=$(()=>{var l;return(l=j.props.auth)==null?void 0:l.user}),t=y({numero_identificacion:"",fecha_nacimiento:null,genero:"",direccion:"",telefono:"",tipo_documento_id:null}),a=y({}),r=y({isValid:!1,country:null,formattedNumber:"",mensaje:""});H(async()=>{await A()});const A=async()=>{var l,e,d;try{C.value=!0;const n=await k.get("/api/tipo-documentos"),s=n.data.tipos||n.data.data||n.data||[];v.value=s.map(i=>({nombre:i.nombre,id:i.id})),v.value.length===0&&console.warn("No se encontraron tipos de documento"),v.value.length>0&&(t.value.tipo_documento_id=v.value[0].id)}catch(n){console.error("Error al cargar tipos de documento:",n),console.error("Response data:",(l=n.response)==null?void 0:l.data),v.value=[{id:1,nombre:"DUI"},{id:2,nombre:"CÉDULA"},{id:3,nombre:"PASAPORTE"}];let s="No se pudieron cargar los tipos de documento. Usando valores por defecto.";((e=n.response)==null?void 0:e.status)===401?s="No estás autorizado para acceder a esta información":((d=n.response)==null?void 0:d.status)===404&&(s="Servicio no encontrado"),_.add({severity:"error",summary:"Error",detail:s,life:3e3})}finally{C.value=!1}},M=()=>{V("update:visible",!1),L()},L=()=>{t.value={numero_identificacion:"",fecha_nacimiento:null,genero:"",direccion:"",telefono:"",tipo_documento_id:v.value.length>0?v.value[0].id:null},a.value={}},P=async l=>{try{l&&typeof l=="object"&&(r.value.isValid=l.valid===!0,r.value.country={name:l.country,code:l.countryCode},r.value.formattedNumber=l.formatted||"",l.valid===!0&&l.formatted&&(t.value.telefono=l.formatted),B.tieneClienteExistente?l.valid===!0?r.value.mensaje="Número válido (guardado previamente)":t.value.telefono&&l.valid===!1?r.value.mensaje="Número de teléfono inválido para "+l.country:r.value.mensaje="":t.value.telefono&&l.valid===!1?r.value.mensaje="Número de teléfono inválido para "+l.country:l.valid===!0?await z(t.value.telefono):r.value.mensaje="")}catch(e){console.error("[ModalDatosCliente] Error en validación:",e),r.value.mensaje="Error en validación"}},z=async l=>{var e,d;if(!(!l||l.length<8))try{const n=await k.post("/api/clientes/validar-telefono",{telefono:l});n.data.disponible?r.value.mensaje="Número válido para "+((e=r.value.country)==null?void 0:e.name):(r.value.isValid=!1,r.value.mensaje=n.data.message||"Este teléfono ya está registrado")}catch(n){console.error("[ModalDatosCliente] Error validando teléfono:",n),((d=n.response)==null?void 0:d.status)===401?r.value.mensaje="Error de autenticación":r.value.mensaje="Error al validar teléfono"}},G=()=>(a.value={},t.value.numero_identificacion.trim()||(a.value.numero_identificacion="El número de identificación es requerido"),t.value.fecha_nacimiento||(a.value.fecha_nacimiento="La fecha de nacimiento es requerida"),t.value.genero||(a.value.genero="El género es requerido"),t.value.direccion.trim()||(a.value.direccion="La dirección es requerida"),t.value.telefono?r.value.isValid===!1&&(a.value.telefono=r.value.mensaje||"Por favor, ingrese un número de teléfono válido"):a.value.telefono="El número de teléfono es requerido",t.value.tipo_documento_id||(a.value.tipo_documento_id="El tipo de documento es requerido"),Object.keys(a.value).length===0),S=async()=>{var l,e,d,n,s;if(!G()){const i=Object.keys(a.value);i.length===1&&i[0]==="telefono"&&r.value.isValid===!1?_.add({severity:"warn",summary:"Teléfono ya registrado",detail:r.value.mensaje||"Este número de teléfono ya está registrado. Por favor, use un número diferente.",life:5e3}):_.add({severity:"error",summary:"Formulario incompleto",detail:"Por favor completa todos los campos requeridos",life:4e3});return}try{p.value=!0;const i=await k.post("/api/registro-cliente",t.value);_.add({severity:"success",summary:"Información guardada",detail:"Tus datos han sido guardados correctamente",life:3e3}),V("cliente-guardado",i.data.data||i.data),M()}catch(i){console.error("[ModalDatosCliente] Error al guardar cliente:",i),console.error("[ModalDatosCliente] Detalles del error:",(l=i.response)==null?void 0:l.data),(d=(e=i.response)==null?void 0:e.data)!=null&&d.errors&&(a.value=i.response.data.errors),_.add({severity:"error",summary:"Error al guardar",detail:((s=(n=i.response)==null?void 0:n.data)==null?void 0:s.message)||"No se pudo guardar la información",life:5e3})}finally{p.value=!1}};return(l,e)=>(u(),K(f(W),{visible:h.visible,"onUpdate:visible":e[6]||(e[6]=d=>V("update:visible",d)),modal:"",closable:!1,class:"max-w-2xl w-full mx-4",draggable:!1},{header:E(()=>[o("h3",te,[w(f(D),{icon:f(oe)},null,8,["icon"]),e[7]||(e[7]=g(" Completar información de cliente "))])]),footer:E(()=>[o("div",Ne,[o("button",{type:"button",class:"bg-red-600 hover:bg-red-700 text-white px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",onClick:S,disabled:p.value},[w(f(D),{icon:p.value?f(Y):f(O),class:x(["h-5",{"animate-spin":p.value}])},null,8,["icon","class"]),g(" "+c(p.value?"Guardando...":"Guardar y Continuar"),1)],8,Ve),o("button",{type:"button",class:"bg-blue-500 hover:bg-blue-700 text-white px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",onClick:M,disabled:p.value},[w(f(D),{icon:f(ee),class:"h-5"},null,8,["icon"]),e[20]||(e[20]=g(" Cancelar "))],8,ke)])]),default:E(()=>{var d,n;return[o("div",re,[o("div",se,[e[10]||(e[10]=o("h4",{class:"font-semibold text-blue-800 mb-2"},"Información de tu cuenta:",-1)),o("div",ne,[o("p",null,[e[8]||(e[8]=o("strong",null,"Nombre:",-1)),g(" "+c((d=I.value)==null?void 0:d.name),1)]),o("p",null,[e[9]||(e[9]=o("strong",null,"Email:",-1)),g(" "+c((n=I.value)==null?void 0:n.email),1)])])]),o("form",{onSubmit:X(S,["prevent"]),class:"space-y-4"},[o("div",ie,[o("div",null,[e[11]||(e[11]=o("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Número de Identificación",-1)),N(o("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>t.value.numero_identificacion=s),type:"text",required:"",maxlength:"25",class:x(["w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",{"border-red-500":a.value.numero_identificacion}]),placeholder:"Ingrese su DUI o documento"},null,2),[[U,t.value.numero_identificacion]]),a.value.numero_identificacion?(u(),m("small",de,c(a.value.numero_identificacion),1)):b("",!0)]),o("div",null,[e[13]||(e[13]=o("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Tipo de Documento",-1)),N(o("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>t.value.tipo_documento_id=s),required:"",disabled:C.value,class:x(["w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100",{"border-red-500":a.value.tipo_documento_id}])},[C.value?(u(),m("option",ce,"Cargando tipos...")):v.value.length===0?(u(),m("option",me,"No hay tipos disponibles")):(u(),m(q,{key:2},[e[12]||(e[12]=o("option",{value:"",disabled:""},"Seleccione un tipo",-1)),(u(!0),m(q,null,Z(v.value,s=>(u(),m("option",{key:s.id,value:s.id},c(s.nombre),9,fe))),128))],64))],10,ue),[[T,t.value.tipo_documento_id]]),a.value.tipo_documento_id?(u(),m("small",ve,c(a.value.tipo_documento_id),1)):b("",!0)])]),o("div",pe,[o("div",null,[e[14]||(e[14]=o("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Fecha de Nacimiento",-1)),w(f(Q),{modelValue:t.value.fecha_nacimiento,"onUpdate:modelValue":e[2]||(e[2]=s=>t.value.fecha_nacimiento=s),maxDate:new Date,"date-format":"dd/mm/yy",placeholder:"Seleccionar fecha de nacimiento",showIcon:"",yearNavigator:"",yearRange:"1920:2010",class:"w-full",inputClass:`w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 ${a.value.fecha_nacimiento?"border-red-500":""}`},null,8,["modelValue","maxDate","inputClass"]),a.value.fecha_nacimiento?(u(),m("small",ge,c(a.value.fecha_nacimiento),1)):b("",!0)]),o("div",null,[e[16]||(e[16]=o("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Género",-1)),N(o("select",{"onUpdate:modelValue":e[3]||(e[3]=s=>t.value.genero=s),required:"",class:x(["w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",{"border-red-500":a.value.genero}])},e[15]||(e[15]=[o("option",{value:""},"Seleccione",-1),o("option",{value:"MASCULINO"},"Masculino",-1),o("option",{value:"FEMENINO"},"Femenino",-1)]),2),[[T,t.value.genero]]),a.value.genero?(u(),m("small",be,c(a.value.genero),1)):b("",!0)])]),o("div",ye,[o("div",null,[e[17]||(e[17]=o("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Teléfono",-1)),w(f(ae),{modelValue:t.value.telefono,"onUpdate:modelValue":e[4]||(e[4]=s=>t.value.telefono=s),defaultCountry:"SV",preferredCountries:["SV","GT","HN","CR","NI","PA","BZ"],validCharactersOnly:!0,dropdownOptions:{showDialCodeInSelection:!0,showFlags:!0,showSearchBox:!0,showDialCodeInList:!0},inputOptions:{placeholder:"Número de teléfono"},mode:"international",class:"w-full border border-gray-300 rounded-lg",onValidate:P},null,8,["modelValue"]),r.value.mensaje?(u(),m("p",{key:0,class:x(["text-xs mt-1 flex items-center",r.value.isValid?"text-green-600":"text-red-600"])},[o("span",xe,c(r.value.isValid?"✓":"⚠️"),1),g(" "+c(r.value.mensaje),1)],2)):b("",!0),a.value.telefono&&!r.value.mensaje?(u(),m("small",_e,c(a.value.telefono),1)):b("",!0)]),o("div",we,[e[18]||(e[18]=o("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Dirección",-1)),N(o("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>t.value.direccion=s),type:"text",required:"",maxlength:"200",class:x(["w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",{"border-red-500":a.value.direccion}]),placeholder:"Dirección completa"},null,2),[[U,t.value.direccion]]),a.value.direccion?(u(),m("small",Ce,c(a.value.direccion),1)):b("",!0)])]),e[19]||(e[19]=o("div",{class:"bg-blue-50 border border-blue-200 rounded-lg p-4 mt-4"},[o("p",{class:"text-sm text-blue-800"},[o("strong",null,"Nota:"),g(" Esta información es necesaria para procesar tu compra. ")])],-1))],32)])]}),_:1},8,["visible"]))}},Ue=le(Ee,[["__scopeId","data-v-04332998"]]);export{Ue as default};
