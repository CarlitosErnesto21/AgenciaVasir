import{r as i,E as W,w as ce,n as F,o as me,a5 as ve,N as E,k as T,h as fe,d as f,x as u,p as l,e as a,$ as s,a0 as ge,a1 as be,y as D,t as _,A as B,c as g,j as U,q as V}from"./vendor-DbRibEpp.js";import{A as pe}from"./AuthenticatedLayout-CFWaTI0x.js";import{z as we,F as xe,A as m}from"./ui-CrZM8ROW.js";import{f as G,a as he,b as ye,c as Y,d as Ce,e as J,g as K,h as X,i as _e}from"./index-DWkcdlMl.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Pe={class:"container mx-auto px-4 py-6"},ke={class:"bg-white rounded-lg shadow-md"},Ee={class:"flex flex-col sm:flex-row lg:justify-between lg:items-center mb-4 gap-4 p-6"},Te={class:"flex items-center gap-3"},De={class:"flex items-center gap-2 w-full justify-center lg:w-auto lg:justify-end"},Le={class:"bg-blue-50 p-3 rounded-lg shadow-sm border mb-4"},Ne={class:"text-sm font-medium leading-relaxed"},Ae={class:"flex gap-2 justify-center items-center"},Se=["onClick"],Oe=["onClick"],Ue={class:"space-y-4"},Ve={class:"w-full flex flex-col"},je={class:"flex items-center gap-4"},ze={key:0,class:"text-red-500 ml-28"},$e={key:1,class:"text-red-500 ml-28"},Me={key:2,class:"text-orange-500 ml-28"},We={key:3,class:"text-red-500 ml-28"},Fe={class:"flex justify-center gap-4 w-full mt-6"},Be=["disabled"],Ge={key:0},Ie={key:1},Re=["disabled"],qe={class:"flex items-center gap-3"},Ye={class:"flex flex-col"},Je={class:"flex justify-center gap-4 w-full"},Ke=["disabled"],Xe={key:0},He={key:1},Qe=["disabled"],Ze={class:"flex items-center gap-3"},ea={class:"flex justify-center gap-3 w-full"},na={__name:"CategoriaProductos",setup(aa){const d=we(),L=i([]),t=i({id:null,nombre:""}),v=i(!1),b=i(!1),N=i(!1),j=i(typeof window<"u"?window.innerWidth:1024),z=W(()=>j.value<640?{width:"95vw",maxWidth:"380px"}:j.value<768?{width:"400px"}:{width:"450px"}),p=i(!1),h=i(!1),P=i(!1),y=i(!1),C=i(!1),w=i(null),A=i({global:{value:null,matchMode:xe.CONTAINS}}),$=i(10),H=i([5,10,20,50]),k=i("Guardar"),Q=W(()=>{let o=L.value;if(A.value.global.value){const e=A.value.global.value.toLowerCase();o=o.filter(r=>r.nombre.toLowerCase().includes(e))}return o}),S=W(()=>!t.value.nombre||t.value.nombre.length<3?!1:L.value.some(o=>o.nombre.toLowerCase()===t.value.nombre.toLowerCase()&&o.id!==t.value.id));ce([t],()=>{w.value&&p.value&&F(()=>{const o={...t.value},e=JSON.stringify(o)!==JSON.stringify(w.value),r=!w.value.id,c=t.value.nombre;C.value=e||r&&c})},{deep:!0,flush:"post"});function O(){t.value={id:null,nombre:""},y.value=!1}const I=()=>{typeof window<"u"&&(j.value=window.innerWidth)},Z=()=>{N.value=!0};me(()=>{ee(),typeof window<"u"&&window.addEventListener("resize",I)}),ve(()=>{typeof window<"u"&&window.removeEventListener("resize",I)});const R=async()=>{try{const o=await E.get("/api/categorias-productos");L.value=(o.data.data||o.data||[]).map(e=>({...e,categoria_id:e.id})).sort((e,r)=>new Date(r.created_at)-new Date(e.created_at))}catch{d.add({severity:"error",summary:"Error",detail:"No se pudieron cargar las categorías de productos.",life:4e3})}},ee=async()=>{d.add({severity:"info",summary:"Cargando categorías...",life:2e3});try{const o=await E.get("/api/categorias-productos");L.value=(o.data.data||o.data||[]).map(e=>({...e,categoria_id:e.id})).sort((e,r)=>new Date(r.created_at)-new Date(e.created_at)),d.add({severity:"success",summary:"Categorías cargadas",life:2e3})}catch{d.add({severity:"error",summary:"Error",detail:"No se pudieron cargar las categorías de productos.",life:4e3})}},ae=()=>{O(),k.value="Guardar",y.value=!1,p.value=!0,F(()=>{w.value={...t.value},C.value=!1})},te=o=>{O(),y.value=!1,t.value={...o},k.value="Actualizar",p.value=!0,F(()=>{w.value={...t.value},C.value=!1})},se=async()=>{var o,e;if(y.value=!0,v.value=!0,!t.value.nombre||t.value.nombre.length<3||t.value.nombre.length>50){d.add({severity:"warn",summary:"Campos requeridos",detail:"El nombre debe tener entre 3 y 50 caracteres.",life:4e3}),v.value=!1;return}if(S.value){d.add({severity:"warn",summary:"Categoría duplicada",detail:`Ya existe una categoría con el nombre "${t.value.nombre}". Por favor, elige un nombre diferente.`,life:6e3}),v.value=!1;return}try{t.value.id?(await E({method:"POST",url:`/api/categorias-productos/${t.value.id}`,data:{_method:"PUT",nombre:t.value.nombre}}),d.add({severity:"success",summary:"¡Éxito!",detail:"La categoría ha sido actualizada correctamente.",life:5e3})):(await E.post("/api/categorias-productos",{nombre:t.value.nombre}),d.add({severity:"success",summary:"¡Éxito!",detail:"La categoría ha sido creada correctamente.",life:5e3})),await R(),p.value=!1,C.value=!1,w.value=null,O()}catch(r){if(r.response&&r.response.status===422){const c=r.response.data.errors;if(c&&c.nombre){const x=c.nombre[0];x.includes("unique")||x.includes("ya existe")||x.includes("duplicado")?d.add({severity:"warn",summary:"Categoría duplicada",detail:`Ya existe una categoría con el nombre "${t.value.nombre}". Por favor, elige un nombre diferente.`,life:6e3}):d.add({severity:"warn",summary:"Error de validación",detail:x,life:5e3})}else d.add({severity:"warn",summary:"Error de validación",detail:r.response.data.message||"Por favor verifica los datos ingresados.",life:5e3})}else{const c=((e=(o=r.response)==null?void 0:o.data)==null?void 0:e.message)||"Error al procesar la categoría.";d.add({severity:"error",summary:"Error",detail:c,life:6e3})}}finally{v.value=!1}},oe=o=>{t.value={...o},h.value=!0},le=async()=>{var o,e;b.value=!0;try{await E({method:"POST",url:`/api/categorias-productos/${t.value.id}`,data:{_method:"DELETE"}}),await R(),h.value=!1,d.add({severity:"success",summary:"¡Eliminada!",detail:"La categoría ha sido eliminada correctamente.",life:5e3})}catch(r){h.value=!1;const c=((e=(o=r.response)==null?void 0:o.data)==null?void 0:e.error)||r.message||"Error desconocido";d.add({severity:"error",summary:"Error",detail:`No se pudo eliminar la categoría: ${c}`,life:6e3})}finally{b.value=!1}},re=()=>{C.value?P.value=!0:q()},q=()=>{p.value=!1,P.value=!1,C.value=!1,w.value=null,O()},ne=()=>{P.value=!1},ie=()=>{t.value.nombre&&t.value.nombre.length>50&&(t.value.nombre=t.value.nombre.substring(0,50))};return(o,e)=>{const r=T("Toast"),c=T("InputText"),x=T("Column"),de=T("DataTable"),M=T("Dialog");return f(),fe(pe,null,{default:u(()=>[l(s(ge),{title:"Control de Categorías de Productos"}),l(r,{class:"z-[9999]"}),a("div",Pe,[e[21]||(e[21]=a("div",{class:"mb-6"},[a("h1",{class:"text-3xl font-bold text-blue-600 mb-2"},"Control de Categorías"),a("p",{class:"text-gray-600"},"Gestión de categorías de productos")],-1)),a("div",ke,[a("div",Ee,[a("div",Te,[l(s(be),{href:o.route("productos"),onClick:Z,class:D([{"opacity-50 cursor-not-allowed":N.value},"flex items-center text-blue-600 hover:text-blue-700 transition-colors duration-200 px-3 py-2 rounded-lg"]),title:"Regresar a Productos"},{default:u(()=>[l(s(m),{icon:N.value?s(G):s(he),class:D({"animate-spin":N.value,"h-5 w-5":!0})},null,8,["icon","class"])]),_:1},8,["href","class"]),e[7]||(e[7]=a("h3",{class:"text-2xl sm:text-3xl text-blue-600 font-bold text-center sm:text-start"},"Lista de Categorías",-1))]),a("div",De,[a("button",{class:"bg-red-500 border border-red-500 p-2 text-sm text-white shadow-md hover:shadow-lg rounded-md hover:-translate-y-1 transition-transform duration-300 flex items-center gap-2",onClick:ae},[l(s(m),{icon:s(ye),class:"h-4 w-4"},null,8,["icon"]),e[8]||(e[8]=a("span",null,"Agregar categoría",-1))])])]),l(de,{value:Q.value,dataKey:"id",paginator:!0,rows:$.value,rowsPerPageOptions:H.value,rowsPerPage:$.value,"onUpdate:rowsPerPage":e[1]||(e[1]=n=>$.value=n),paginatorTemplate:"RowsPerPageDropdown FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink",currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} categorías",class:"overflow-x-auto max-w-full",responsiveLayout:"scroll"},{header:u(()=>[a("div",Le,[l(c,{modelValue:A.value.global.value,"onUpdate:modelValue":e[0]||(e[0]=n=>A.value.global.value=n),placeholder:"🔍 Buscar categorías...",class:"w-full h-9 text-sm rounded-md",style:{"background-color":"white","border-color":"#93c5fd"}},null,8,["modelValue"])])]),default:u(()=>[l(x,{field:"nombre",header:"Nombre",sortable:"",class:"w-96 min-w-52"},{body:u(n=>[a("div",Ne,_(n.data.nombre),1)]),_:1}),l(x,{exportable:!1,class:"w-52 min-w-28"},{header:u(()=>e[9]||(e[9]=[a("div",{class:"text-center w-full font-bold"}," Acciones ",-1)])),body:u(n=>[a("div",Ae,[a("button",{class:"flex bg-blue-500 border p-1 py-2 sm:p-2 text-sm shadow-md hover:shadow-lg rounded-md hover:-translate-y-1 transition-transform duration-300",onClick:ue=>te(n.data)},[l(s(m),{icon:s(Y),class:"h-3 w-6 sm:h-4 sm:w-7 text-white"},null,8,["icon"]),e[10]||(e[10]=a("span",{class:"hidden md:block text-white"},"Editar",-1))],8,Se),a("button",{class:"flex bg-red-500 border p-1 py-2 sm:p-2 text-sm shadow-md hover:shadow-lg rounded-md hover:-translate-y-1 transition-transform duration-300",onClick:ue=>oe(n.data)},[l(s(m),{icon:s(Ce),class:"h-3 w-6 sm:h-4 sm:w-7 text-white"},null,8,["icon"]),e[11]||(e[11]=a("span",{class:"hidden md:block text-white"},"Eliminar",-1))],8,Oe)])]),_:1})]),_:1},8,["value","rows","rowsPerPageOptions","rowsPerPage"]),l(M,{visible:p.value,"onUpdate:visible":e[3]||(e[3]=n=>p.value=n),header:k.value+" Categoría",modal:!0,style:B(z.value),closable:!1,draggable:!1},{footer:u(()=>[a("div",Fe,[a("button",{class:"bg-red-500 hover:bg-red-700 text-white border-none px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",onClick:se,disabled:S.value||v.value},[l(s(m),{icon:v.value?s(G):s(J),class:D(["h-5 text-white",{"animate-spin":v.value}])},null,8,["icon","class"]),v.value?(f(),g("span",Ie,_(k.value==="Guardar"?"Guardando...":"Actualizando..."),1)):(f(),g("span",Ge,_(k.value),1))],8,Be),a("button",{type:"button",class:"bg-blue-500 hover:bg-blue-700 text-white px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",onClick:re,disabled:v.value},[l(s(m),{icon:s(K),class:"h-5"},null,8,["icon"]),e[13]||(e[13]=V("Cancelar "))],8,Re)])]),default:u(()=>[a("div",Ue,[a("div",Ve,[a("div",je,[e[12]||(e[12]=a("label",{for:"nombre",class:"w-24 flex items-center gap-1"},[V(" Nombre: "),a("span",{class:"text-red-500 font-bold"},"*")],-1)),l(c,{modelValue:t.value.nombre,"onUpdate:modelValue":e[2]||(e[2]=n=>t.value.nombre=n),modelModifiers:{trim:!0},id:"nombre",name:"nombre",maxlength:50,class:D([{"p-invalid":y.value&&(!t.value.nombre||t.value.nombre.length<3||t.value.nombre.length>50)||S.value},"flex-1"]),onInput:ie,placeholder:"Nombre de la categoría"},null,8,["modelValue","class"])]),t.value.nombre&&t.value.nombre.length<3?(f(),g("small",ze," El nombre debe tener al menos 3 caracteres. Actual: "+_(t.value.nombre.length)+"/3 ",1)):U("",!0),S.value?(f(),g("small",$e," Ya existe una categoría con este nombre. Por favor, elige un nombre diferente. ")):U("",!0),t.value.nombre&&t.value.nombre.length>=45&&t.value.nombre.length<=50?(f(),g("small",Me," Caracteres restantes: "+_(50-t.value.nombre.length),1)):U("",!0),y.value&&!t.value.nombre?(f(),g("small",We," El nombre es obligatorio. ")):U("",!0)])])]),_:1},8,["visible","header","style"]),l(M,{visible:h.value,"onUpdate:visible":e[5]||(e[5]=n=>h.value=n),header:"Eliminar categoría",modal:!0,style:B(z.value),closable:!1,draggable:!1},{footer:u(()=>[a("div",Je,[a("button",{type:"button",class:"bg-red-500 hover:bg-red-700 text-white border-none px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",onClick:le,disabled:b.value},[l(s(m),{icon:b.value?s(G):s(J),class:D(["h-5",{"animate-spin":b.value}])},null,8,["icon","class"]),b.value?(f(),g("span",He,"Eliminando...")):(f(),g("span",Xe,"Eliminar"))],8,Ke),a("button",{type:"button",class:"bg-blue-500 hover:bg-blue-700 text-white px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",onClick:e[4]||(e[4]=n=>h.value=!1),disabled:b.value},[l(s(m),{icon:s(K),class:"h-5"},null,8,["icon"]),e[17]||(e[17]=a("span",null,"Cancelar",-1))],8,Qe)])]),default:u(()=>[a("div",qe,[l(s(m),{icon:s(X),class:"h-8 w-8 text-red-500"},null,8,["icon"]),a("div",Ye,[a("span",null,[e[14]||(e[14]=V("¿Estás seguro de eliminar la categoría: ")),a("b",null,_(t.value.nombre),1),e[15]||(e[15]=V("?"))]),e[16]||(e[16]=a("span",{class:"text-red-600 text-sm font-medium mt-1"},"Esta acción es irreversible.",-1))])])]),_:1},8,["visible","style"]),l(M,{visible:P.value,"onUpdate:visible":e[6]||(e[6]=n=>P.value=n),header:"Cambios sin guardar",modal:!0,style:B(z.value),closable:!1,draggable:!1},{footer:u(()=>[a("div",ea,[a("button",{type:"button",class:"bg-red-500 hover:bg-red-700 text-white border-none px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",onClick:q},[l(s(m),{icon:s(_e),class:"h-4"},null,8,["icon"]),e[19]||(e[19]=a("span",null,"Salir sin guardar",-1))]),a("button",{type:"button",class:"bg-blue-500 hover:bg-blue-700 text-white px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",onClick:ne},[l(s(m),{icon:s(Y),class:"h-4"},null,8,["icon"]),e[20]||(e[20]=a("span",null,"Continuar",-1))])])]),default:u(()=>[a("div",Ze,[l(s(m),{icon:s(X),class:"h-8 w-8 text-red-500"},null,8,["icon"]),e[18]||(e[18]=a("div",{class:"flex flex-col"},[a("span",null,"¡Tienes información sin guardar!"),a("span",{class:"text-red-600 text-sm font-medium mt-1"},"¿Deseas salir sin guardar?")],-1))])]),_:1},8,["visible","style"])])])]),_:1})}}};export{na as default};
