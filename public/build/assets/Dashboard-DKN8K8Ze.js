import{A as X}from"./AuthenticatedLayout-CVGmrV7_.js";import{a4 as ee,E as N,r,o as U,w as te,k as ae,c as B,d as b,p as h,$ as w,a0 as se,x as oe,h as F,j as le,e as l,y as re,t as ie,F as ne,N as S}from"./vendor-CqKcGHPa.js";import{s as Z}from"./app-DIAIkN39.js";import"./ui-DrLUz167.js";import ue from"./LoadingState-Z4RWo1eI.js";import de from"./MetricasCard-BblevU2N.js";import ce from"./WidgetsSecundarios-B_Jj3EKo.js";import ve from"./ActividadReciente-rsDgoLMM.js";import pe from"./ModalesInteractivos-BraEzban.js";import me from"./GraficosSection-DSzWBWI2.js";import fe from"./FormularioDatosCompletos-CqU3JOf8.js";import"./index-BXYozc4i.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vue-tel-input-J95PmLrS.js";const ge={key:2,class:"px-2 sm:px-4 lg:px-6 py-4 sm:py-6 space-y-4 sm:space-y-6 mt-1 sm:mt-1"},be={class:"flex justify-between items-center"},he=["disabled"],ye={class:"grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6"},xe={class:"bg-white rounded-lg shadow-sm border border-gray-100 p-4 sm:p-6"},_e={class:"h-48 sm:h-64"},ke={key:1,class:"flex items-center justify-center h-full"},we={class:"bg-white rounded-lg shadow-sm border border-gray-100 p-4 sm:p-6"},Se={class:"h-48 sm:h-64"},De={key:1,class:"flex items-center justify-center h-full"},Ae={class:"grid grid-cols-1 xl:grid-cols-2 gap-4 sm:gap-6"},$e=5*60*1e3,Ye={__name:"Dashboard",setup(Ce){const i=ee().props.user,q=N(()=>i&&i.roles&&i.roles.some(e=>e.name==="Administrador")),$=N(()=>i&&i.empleado?i.empleado:null),C=r(!1),z=N(()=>{if(!i)return!1;const e=$.value;return q.value&&(!e||!e.cargo||!e.telefono)});U(()=>{z.value&&(C.value=!0)}),te(z,e=>{e&&(C.value=!0)});const E=r(),M=r(),L=r(),H=r(),y=r(!0),o=r({}),P=r(null),V=r(null),D=r([{label:"Ventas Hoy",value:"0",icon:"pi pi-shopping-cart",color:"from-[#ef233c] to-[#d90429]",text:"text-[#7b1f26]",key:"ventas_hoy",category:"ventas",description:"Ventas del día"},{label:"Ingresos Hoy",value:"$0",icon:"pi pi-dollar",color:"from-[#ffd600] to-[#ffb700]",text:"text-[#a68700]",key:"ingresos_hoy",category:"ventas",description:"Ingresos del día"},{label:"Reservas del Mes",value:"0",icon:"pi pi-calendar-plus",color:"from-[#6c00f9] to-[#480ca8]",text:"text-[#240046]",key:"reservas_mes",category:"reservas",description:"Reservas este mes"},{label:"Tours Activos",value:"0",icon:"pi pi-map-marker",color:"from-[#0077b6] to-[#023e8a]",text:"text-[#03045e]",key:"tours_activos",category:"reservas",description:"Tours disponibles"}]),A=r([{title:"Reservas Pendientes",value:"0",icon:"pi pi-clock",color:"bg-[#fff3b0] border-[#ffd600]",iconColor:"text-[#ffd600]",key:"reservas_pendientes"},{title:"Productos Stock Bajo",value:"0",icon:"pi pi-exclamation-triangle",color:"bg-[#ffe5e5] border-[#ef233c]",iconColor:"text-[#d90429]",key:"productos_stock_bajo"},{title:"Valor Inventario",value:"$0",icon:"pi pi-wallet",color:"bg-[#e5daff] border-[#6c00f9]",iconColor:"text-[#480ca8]",key:"valor_total_inventario"},{title:"Clientes Activos",value:"0",icon:"pi pi-users",color:"bg-[#d0f1ff] border-[#0077b6]",iconColor:"text-[#023e8a]",key:"clientes_activos"}]),j=r(!1),G=()=>{j.value=!j.value},I=(e,t=null)=>{if(e.includes("$")){let s;return t&&t.valor_total_inventario?s=parseFloat(t.valor_total_inventario):s=parseFloat(e.replace(/[$,.\s]/g,"")),isNaN(s)?"$0":s>=1e6?"$"+(s/1e6).toFixed(1)+"M":s>=1e3?"$"+(s/1e3).toFixed(0)+"k":"$"+s.toFixed(0)}return e},Y=async(e=!1)=>{const t=Date.now();if(!e&&P.value&&V.value&&t<V.value){o.value=P.value,O(o.value.inventario,o.value.ventas,o.value.reservas,o.value.resumenReservas,o.value.tours),T(o.value.inventario,o.value.ventas,o.value.stockBajo,o.value.reservas,o.value.resumenReservas),y.value=!1;return}y.value=!0;try{const s={headers:{Accept:"application/json"},timeout:1e4},[n,x,v,u,p,m]=await Promise.allSettled([S.get("/api/inventario/resumen",s),S.get("/api/ventas?desde="+new Date(Date.now()-30*24*60*60*1e3).toISOString().split("T")[0],s),S.get("/api/inventario/stock-bajo?limit=20",s),S.get("/api/reservas?per_page=100&desde="+new Date(Date.now()-60*24*60*60*1e3).toISOString().split("T")[0],s),S.get("/api/reservas/resumen",s),S.get("/api/tours?estado=activo,disponible&limit=50",s)]),_=n.status==="fulfilled"?n.value.data.data||n.value.data||{}:{},d=x.status==="fulfilled"?x.value.data.data||x.value.data||[]:[],f=v.status==="fulfilled"?v.value.data.data||v.value.data||[]:[],k=u.status==="fulfilled"?u.value.data.data||u.value.data||[]:[],g=p.status==="fulfilled"?p.value.data.data||p.value.data||[]:[],R=m.status==="fulfilled"?m.value.data.data||m.value.data||[]:[];O(_,d,k,g,R),T(_,d,f,k,g),o.value={inventario:_,ventas:d,stockBajo:f,reservas:k,resumenReservas:g,tours:R},P.value={...o.value},V.value=Date.now()+$e}catch{O({},[],[],[],[]),T({},[],[],[])}finally{y.value=!1}},O=(e,t,s,n,x)=>{const v=Array.isArray(t)?t:[],u=Array.isArray(s)?s:[],p=Array.isArray(x)?x:[],m=new Date().toISOString().split("T")[0],_=v.filter(a=>a.fecha?a.fecha.split("T")[0]===m:!1).length,d=v.filter(a=>a.fecha?a.fecha.split("T")[0]===m:!1).reduce((a,c)=>a+(parseFloat(c.total)||0),0),f=new Date().getMonth(),k=new Date().getFullYear(),g=u.filter(a=>{if(!a.fecha_reserva&&!a.fecha)return!1;const c=new Date(a.fecha_reserva||a.fecha);return c.getMonth()===f&&c.getFullYear()===k}).length,R=p.filter(a=>!a.estado||a.estado.toLowerCase()==="activo"||a.estado.toLowerCase()==="disponible").length;D.value[0].value=_.toString(),D.value[1].value=`$${d.toLocaleString("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2})}`,D.value[2].value=g.toString(),D.value[3].value=R.toString();const Q=u.filter(a=>a.estado&&a.estado.toLowerCase()==="pendiente").length,W=new Set(u.map(a=>{var c;return(c=a.cliente)==null?void 0:c.id}).filter(a=>a)).size;A.value[0].value=Q.toString(),A.value[1].value=(e.productos_stock_bajo||0).toString(),A.value[2].value=`$${Number(e.valor_total_inventario||0).toLocaleString("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2})}`,A.value[3].value=W.toString()},T=(e,t,s,n,x)=>{const v=e.total_productos||0,u=e.productos_stock_bajo||0,p=e.productos_agotados||0,m=e.productos_disponibles||Math.max(0,v-u-p),_=Array.isArray(n)?n:[];E.value={labels:["Productos Disponibles","Stock Bajo","Agotados"],datasets:[{label:"Estado del Inventario",data:[m,u,p],backgroundColor:["#10b981","#f59e0b","#ef4444"],hoverBackgroundColor:["#34d399","#fbbf24","#f87171"]}]};const d=_.reduce((f,k)=>{const g=k.estado||"Sin estado";return f[g]=(f[g]||0)+1,f},{});Object.keys(d).length===0&&(d["Sin reservas"]=0),M.value={labels:Object.keys(d),datasets:[{label:"Reservas por Estado",data:Object.values(d),backgroundColor:["#f59e0b","#10b981","#ef4444","#3b82f6"]}]}},J=()=>({maintainAspectRatio:!1,plugins:{title:{display:!0,text:"Estado del Inventario",font:{size:18}},legend:{display:!0,position:"bottom",labels:{usePointStyle:!0,color:"#374151"}},tooltip:{callbacks:{label:function(e){return`${e.label}: ${e.parsed} productos`}}}}}),K=()=>({maintainAspectRatio:!1,plugins:{title:{display:!0,text:"Reservas por Estado",font:{size:18}},legend:{display:!1},tooltip:{callbacks:{label:function(e){return`${e.label}: ${e.parsed.y} reservas`}}}},scales:{x:{ticks:{color:"#374151"},grid:{color:"#e5e7eb"}},y:{beginAtZero:!0,ticks:{color:"#374151"},grid:{color:"#e5e7eb"}}}});return U(()=>{L.value=J(),H.value=K(),Y()}),(e,t)=>{const s=ae("Toast");return b(),B(ne,null,[h(w(se),{title:"Dashboard"}),h(X,null,{default:oe(()=>[h(s,{class:"z-[9999]"}),C.value?(b(),F(fe,{key:0,empleado:$.value&&$.value.value?$.value.value:{},"user-id":w(i)&&w(i).id?w(i).id:null,onClose:t[0]||(t[0]=n=>C.value=!1)},null,8,["empleado","user-id"])):le("",!0),y.value?(b(),F(ue,{key:1})):(b(),B("div",ge,[l("div",be,[t[3]||(t[3]=l("h1",{class:"text-2xl sm:text-3xl font-bold text-blue-600"},"Dashboard administrativo",-1)),l("button",{onClick:t[1]||(t[1]=n=>Y(!0)),disabled:y.value,class:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white text-sm font-medium rounded-lg transition-colors duration-200"},[l("i",{class:re(["pi pi-refresh",{"animate-spin":y.value}])},null,2),l("span",null,ie(y.value?"Actualizando...":"Actualizar"),1)],8,he)]),h(de,{metrics:D.value,"dashboard-data":o.value,"format-value-for-mobile":I},null,8,["metrics","dashboard-data"]),l("div",ye,[h(ce,{widgets:A.value,"dashboard-data":o.value,"format-value-for-mobile":I,onToggleStockModal:G},null,8,["widgets","dashboard-data"]),l("div",xe,[t[5]||(t[5]=l("h3",{class:"text-base sm:text-lg font-semibold text-gray-900 mb-3 sm:mb-4"},"Inventario por Estado",-1)),l("div",_e,[E.value?(b(),F(w(Z),{key:0,type:"pie",data:E.value,options:L.value,class:"w-full h-full"},null,8,["data","options"])):(b(),B("div",ke,t[4]||(t[4]=[l("p",{class:"text-gray-500 text-xs sm:text-sm"},"No hay datos de inventario",-1)])))])]),l("div",we,[t[7]||(t[7]=l("h3",{class:"text-base sm:text-lg font-semibold text-gray-900 mb-3 sm:mb-4"},"Reservas por Estado",-1)),l("div",Se,[M.value?(b(),F(w(Z),{key:0,type:"bar",data:M.value,options:H.value,class:"w-full h-full"},null,8,["data","options"])):(b(),B("div",De,t[6]||(t[6]=[l("p",{class:"text-gray-500 text-xs sm:text-sm"},"No hay datos de reservas",-1)])))])])]),l("div",Ae,[h(me,{"resumen-reservas-data":o.value.resumenReservas,"reservas-data":o.value.reservas},null,8,["resumen-reservas-data","reservas-data"]),h(ve,{"dashboard-data":o.value,"format-value-for-mobile":I},null,8,["dashboard-data"])])])),h(pe,{"show-productos-stock-bajo-modal":j.value,"dashboard-data":o.value,onCloseStockModal:t[2]||(t[2]=n=>j.value=!1)},null,8,["show-productos-stock-bajo-modal","dashboard-data"])]),_:1})],64)}}};export{Ye as default};
