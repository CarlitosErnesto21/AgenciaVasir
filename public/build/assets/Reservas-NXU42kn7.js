import{r as u,E as _,w as me,o as Ke,a3 as Re,a6 as Qe,h as ve,d as y,x as h,p as n,e as s,$ as l,a0 as ea,A as pe,t as v,y as E,c as C,j as A,q as j,v as De,a9 as _e,N as O,n as aa}from"./vendor-CqKcGHPa.js";import{A as sa}from"./AuthenticatedLayout-DnegqiP_.js";import{z as ta,D as la,a as oa,r as ra,F as p,h as na,q as te,o as ia,e as da,f as z,g as Ne}from"./ui-DrLUz167.js";import{c as le,e as N,g as ua,z as B,B as oe,C as Te,l as fe,n as ca,D as Se,E as ma,k as va,w as pa}from"./index-t8PHqkOa.js";import fa from"./Modales-tjLuI1vf.js";import ga from"./CambiarEstado-Dq3pyi_m.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-DtyEsSN9.js";const ba={class:"flex items-center gap-3"},xa={class:"flex flex-col"},ya={class:"text-red-600 text-sm font-medium mt-1"},ha={class:"container mx-auto px-4 py-6"},wa={class:"mb-6"},Aa=["disabled"],Ea={class:"bg-white rounded-lg shadow-md"},Ca={key:0,class:"p-6 border-b border-gray-200"},Ra={class:"mb-4 space-y-2"},Da={class:"text-sm text-blue-600 flex items-center gap-2"},_a={key:0,class:"text-sm text-amber-600 flex items-center gap-2 bg-amber-50 p-2 rounded-md"},Na={key:1,class:"text-sm text-blue-600 flex items-center gap-2 bg-blue-50 p-3 rounded-md border border-blue-200"},Ta={key:2,class:"text-sm text-purple-600 flex items-center gap-2 bg-purple-50 p-3 rounded-md border border-purple-200"},Sa={key:3,class:"text-sm text-gray-600 flex items-center gap-2 bg-gray-50 p-2 rounded-md"},Oa={class:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:flex lg:flex-wrap gap-2 md:gap-3"},Ia={class:"bg-gray-100 border-2 border-gray-300 rounded-lg px-2 py-2 md:px-4 md:py-3 flex-1 min-w-0"},La={class:"text-xs md:text-sm font-bold text-gray-800"},Ma={class:"flex items-center gap-2 text-white"},ka={class:"flex items-center gap-2 text-white"},Pa={class:"flex items-center gap-2 text-white"},Fa=["title"],za={class:"flex items-center gap-2 text-white"},$a={class:"flex-1"},Va={key:0,class:"text-xs opacity-70"},Ua={class:"bg-blue-50 p-3 rounded-lg shadow-sm border mb-4 mx-4"},qa={class:"flex flex-wrap items-center justify-between gap-2 mb-3"},Ha={class:"flex items-center gap-2 flex-wrap"},ja={class:"bg-blue-50 border border-blue-200 text-blue-700 px-2 py-1 rounded text-xs font-medium"},Ba=["disabled"],Ga={class:"space-y-3"},Za={class:"grid grid-cols-1 md:grid-cols-3 gap-3"},Wa={class:"px-4 mb-3"},Xa={class:"text-blue-600 text-xs font-medium flex items-center gap-1"},Ya={class:"text-center py-12"},Ja={class:"font-medium text-xs sm:text-sm"},Ka={class:"flex items-center gap-1 sm:gap-3"},Qa={class:"w-6 h-6 sm:w-8 sm:h-8 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0"},es={class:"min-w-0 flex-1"},as=["title"],ss=["title"],ts={class:"text-xs sm:text-sm"},ls={class:"font-medium"},os={class:"text-xs text-gray-500"},rs={class:"font-medium text-green-600 text-xs sm:text-sm"},ns={class:"hidden xl:inline"},is={class:"xl:hidden"},ds=["onClick"],us={class:"space-y-4"},cs={class:"bg-orange-50 p-4 rounded-lg border border-orange-200 mb-4"},ms={class:"flex items-start gap-3"},vs={class:"bg-red-50 p-4 rounded-lg border border-red-200"},ps={class:"flex items-center gap-2 mb-2"},fs={class:"font-semibold text-red-800"},gs={class:"text-xs text-red-600 mt-2"},bs={class:"text-gray-500"},xs={class:"flex justify-end gap-3 pt-4"},ys=["disabled"],hs={class:"space-y-4"},ws={class:"bg-blue-50 p-4 rounded-lg border border-blue-200"},As={class:"font-semibold text-blue-800 mb-2"},Es={class:"text-sm text-blue-600"},Cs={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Rs={class:"flex justify-center items-center gap-3 pt-4"},Ds=["disabled"],_s=["disabled"],Fs={__name:"Reservas",setup(Ns){const f=ta(),Oe=la(),g=u([]),Ie=u([]),ge=u(!1);u(!1);const $=u(null),o=u(null),be=u(!1),G=u(!1),x=u({cambiarEstado:!1}),Z=u(!1),I=u(!1),b=u({fechaSalida:null,fechaRegreso:null,motivo:""}),m=u({busqueda:"",fechaDesde:null,fechaHasta:null,estado:null}),L=u(!1),W=u(!1),V=u(!1),X=u(!1),Y=u(null),re=u(null),Le=u(""),D=u("");u(null),u(""),u("");const xe=u(typeof window<"u"?window.innerWidth:1024),U=u(!1),ne=u(!1),ie=u(!1),de=u(!1),T=u(!1),J=[{label:"Pendiente",value:"PENDIENTE",severity:"warn",color:"bg-yellow-100 text-yellow-800",icon:ma},{label:"Confirmada",value:"CONFIRMADA",severity:"success",color:"bg-green-100 text-green-800",icon:va},{label:"En Curso",value:"EN_CURSO",severity:"info",color:"bg-blue-100 text-blue-800",icon:oe},{label:"Finalizada",value:"FINALIZADA",severity:"secondary",color:"bg-gray-100 text-gray-800",icon:Te},{label:"Rechazada",value:"CANCELADA",severity:"danger",color:"bg-red-100 text-red-800",icon:fe},{label:"Reprogramada",value:"REPROGRAMADA",severity:"info",color:"bg-purple-100 text-purple-800",icon:oe}],ye=[{label:"Disponible",value:"DISPONIBLE",color:"bg-green-100 text-green-800"},{label:"Completo",value:"COMPLETO",color:"bg-orange-100 text-orange-800"},{label:"En Curso",value:"EN_CURSO",color:"bg-blue-100 text-blue-800"},{label:"Finalizado",value:"FINALIZADO",color:"bg-gray-100 text-gray-800"},{label:"Cancelada",value:"CANCELADA",color:"bg-red-100 text-red-800"},{label:"Reprogramada",value:"REPROGRAMADA",color:"bg-purple-100 text-purple-800"}],M=_(()=>{if(!o.value)return!1;const t=q.value.filter(a=>["CONFIRMADA","REPROGRAMADA"].includes(a.estado)).reduce((a,r)=>{const d=r.mayores_edad||0,i=r.menores_edad||0;return a+d+i},0),e=o.value.cupo_min||0;return t>=e}),k=_(()=>!o.value||!g.value?!1:g.value.some(t=>["PENDIENTE","CONFIRMADA","EN_CURSO","REPROGRAMADA"].includes(t.estado))),K=_(()=>{if(!o.value||!g.value||g.value.length===0)return!1;const t=g.value.some(a=>a.estado==="PENDIENTE"),e=g.value.some(a=>a.estado==="CONFIRMADA");return!t&&e}),ue=_(()=>!o.value||!g.value||g.value.length===0?!1:o.value.estado==="REPROGRAMADA"?!g.value.some(e=>e.estado==="PENDIENTE")&&M.value:o.value.estado==="DISPONIBLE"?M.value:o.value.estado==="COMPLETO"?K.value&&M.value:!1),q=_(()=>{let t=g.value;if(m.value.busqueda){const a=m.value.busqueda.toLowerCase();t=t.filter(r=>{var d,i,c,w,R,S;return(((i=(d=r.cliente)==null?void 0:d.user)==null?void 0:i.name)||((c=r.cliente)==null?void 0:c.nombres)||"").toLowerCase().includes(a)||(((R=(w=r.cliente)==null?void 0:w.user)==null?void 0:R.email)||((S=r.cliente)==null?void 0:S.correo)||"").toLowerCase().includes(a)})}return m.value.fechaDesde&&(t=t.filter(a=>new Date(a.fecha_reserva)>=new Date(m.value.fechaDesde))),m.value.fechaHasta&&(t=t.filter(a=>new Date(a.fecha_reserva)<=new Date(m.value.fechaHasta))),m.value.estado&&(t=t.filter(a=>a.estado===m.value.estado)),t.sort((a,r)=>{const d={PENDIENTE:1,CONFIRMADA:2,EN_CURSO:3,REPROGRAMADA:4,COMPLETADA:5,SUSPENDIDA:6,CANCELADA:7},i=d[a.estado]||6,c=d[r.estado]||6;return i!==c?i-c:new Date(r.fecha_reserva)-new Date(a.fecha_reserva)})});_(()=>({pendientes:g.value.filter(t=>t.estado==="PENDIENTE").length,confirmadas:g.value.filter(t=>t.estado==="CONFIRMADA").length}));const Me=async t=>{be.value=!0;try{const e=await O.get(`/api/tours/${t}`);o.value=e.data}catch(e){console.error("Error cargando tour:",e),f.add({severity:"error",summary:"Error",detail:"No se pudo cargar la informaci√≥n del tour",life:4e3})}finally{be.value=!1}},ke=()=>new URLSearchParams(window.location.search).get("tour"),Q=async t=>{if(!o.value)return;if(t==="REPROGRAMADA"){P(),b.value={fechaSalida:o.value.fecha_salida?new Date(o.value.fecha_salida):null,fechaRegreso:o.value.fecha_regreso?new Date(o.value.fecha_regreso):null,motivo:""},I.value=!0;return}if(t==="CANCELADA"){Ve();return}const a={EN_CURSO:{header:"Cambio de Estado del Tour",message:"¬°Tienes un cambio de estado pendiente!",detail:'¬øDeseas marcar este tour como "En Curso"?'},FINALIZADO:{header:"Finalizar Tour",message:"¬°Tienes un cambio de estado pendiente!",detail:"¬øDeseas finalizar este tour permanentemente?"}}[t];a&&Oe.require({message:{header:a.message,content:a.detail},header:a.header,icon:"pi pi-exclamation-triangle",position:"center",rejectClass:"bg-blue-500 hover:bg-blue-700 text-white border-none px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",acceptClass:"bg-red-500 hover:bg-red-700 text-white border-none px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2 ml-3",rejectLabel:"‚úì Continuar",acceptLabel:"‚úï Cancelar",accept:()=>{},reject:async()=>{await Pe(t)}})},Pe=async t=>{var e,a,r,d;x.value.cambiarEstado=!0;try{const i=await O.put(`/api/tours/${o.value.id}/cambiar-estado`,{estado:t});o.value.estado=t,f.add({severity:"success",summary:"Estado actualizado",detail:`El tour ahora est√° ${t.toLowerCase()}`,life:3e3}),await F()}catch(i){console.error("Error actualizando estado:",i),console.error("Respuesta del servidor:",(e=i.response)==null?void 0:e.data),((a=i.response)==null?void 0:a.status)===422?f.add({severity:"warn",summary:"Validaci√≥n fallida",detail:i.response.data.message||"No se pudo actualizar el estado",life:8e3}):f.add({severity:"error",summary:"Error",detail:((d=(r=i.response)==null?void 0:r.data)==null?void 0:d.message)||"No se pudo actualizar el estado",life:4e3})}finally{x.value.cambiarEstado=!1}},Fe=async t=>{o.value=t,Z.value=!1;const e={CANCELADA:{severity:"warn",summary:"Tour cancelado",detail:`El tour ha sido cancelado. Se enviaron notificaciones de cancelaci√≥n a ${t.reservas_canceladas||0} cliente(s) con reservas.`},FINALIZADO:{severity:"success",summary:"Tour finalizado",detail:`El tour ha sido finalizado correctamente. Se enviaron notificaciones a ${t.reservas_finalizadas||0} cliente(s).`},default:{severity:"success",summary:"Estado actualizado",detail:"El estado del tour se ha actualizado correctamente"}},a=e[t.estado]||e.default;f.add({severity:a.severity,summary:a.summary,detail:a.detail,life:5e3}),await F()},ce=()=>{document.body.style.overflow="",document.body.style.paddingRight=""},P=()=>{L.value=!1,W.value=!1,V.value=!1,X.value=!1,Z.value=!1,I.value=!1,Y.value=null,re.value=null,Le.value="",D.value="",T.value=!1,ce()},ze=async()=>{var e,a;if(!b.value.fechaSalida||!b.value.fechaRegreso){f.add({severity:"warn",summary:"Campos requeridos",detail:"Debe seleccionar las nuevas fechas de salida y regreso",life:4e3});return}if(!b.value.motivo.trim()){f.add({severity:"warn",summary:"Motivo requerido",detail:"Debe ingresar un motivo para la reprogramaci√≥n",life:4e3});return}if((b.value.fechaRegreso-b.value.fechaSalida)/(1e3*60*60)<1){f.add({severity:"warn",summary:"Fechas inv√°lidas",detail:"La fecha y hora de regreso debe ser al menos 1 hora despu√©s de la salida",life:4e3});return}x.value.cambiarEstado=!0;try{const r=c=>{if(c instanceof Date){const w=c.getFullYear(),R=String(c.getMonth()+1).padStart(2,"0"),S=String(c.getDate()).padStart(2,"0"),ee=String(c.getHours()).padStart(2,"0"),ae=String(c.getMinutes()).padStart(2,"0"),se=String(c.getSeconds()).padStart(2,"0");return`${w}-${R}-${S} ${ee}:${ae}:${se}`}return c},d=await O.put(`/api/tours/${o.value.id}/cambiar-estado`,{estado:"REPROGRAMADA",fecha_salida:r(b.value.fechaSalida),fecha_regreso:r(b.value.fechaRegreso),motivo_reprogramacion:b.value.motivo,reprogramar_reservas:!0});o.value={...o.value,...d.data},P();const i=d.data.reservas_reprogramadas||0;f.add({severity:"success",summary:"Tour y reservas reprogramados",detail:`El tour ha sido reprogramado correctamente. ${i} reserva(s) fueron reprogramada(s) y se enviaron notificaciones por correo.`,life:5e3}),await F()}catch(r){console.error("Error reprogramando tour:",r),f.add({severity:"error",summary:"Error",detail:((a=(e=r.response)==null?void 0:e.data)==null?void 0:a.message)||"No se pudo reprogramar el tour",life:4e3})}finally{x.value.cambiarEstado=!1}},$e=()=>{G.value=!0,Re.visit("/tours")},H=_(()=>xe.value<640?{width:"95vw",maxWidth:"380px"}:xe.value<768?{width:"400px"}:{width:"450px"}),F=async()=>{if($.value){ge.value=!0;try{const t={busqueda:m.value.busqueda||void 0,fecha_inicio:m.value.fechaDesde||void 0,fecha_fin:m.value.fechaHasta||void 0,tour_id:$.value},e=await O.get("/api/reservas",{params:t,withCredentials:!0});g.value=Array.isArray(e.data)?e.data:e.data.data||[]}catch(t){console.error("Error cargando reservas:",t),f.add({severity:"error",summary:"Error",detail:"No se pudieron cargar las reservas del tour",life:4e3}),g.value=[]}finally{ge.value=!1}}},Ve=()=>{P(),D.value="",V.value=!0},Ue=async()=>{var t,e;if(!D.value.trim()){f.add({severity:"warn",summary:"Campo requerido",detail:"Debe ingresar un motivo para cancelar el tour",life:4e3});return}T.value=!0;try{const a=await O.put(`/api/tours/${o.value.id}/cambiar-estado`,{estado:"CANCELADA",motivo_cancelacion:D.value,cancelar_reservas:!0});o.value.estado="CANCELADA",await F(),P();const r=a.data.reservas_canceladas||0;f.add({severity:"warn",summary:"¬°Tour Cancelado!",detail:`El tour ha sido cancelado. Se cancelaron ${r} reserva(s) y se enviaron notificaciones por correo.`,life:5e3})}catch(a){console.error("Error cancelando tour:",a),f.add({severity:"error",summary:"Error",detail:((e=(t=a.response)==null?void 0:t.data)==null?void 0:e.message)||"No se pudo cancelar el tour",life:4e3})}finally{T.value=!1}},he=t=>{P(),Y.value=t,X.value=!0},qe=t=>{P(),Y.value=t;const e=Ie.value.find(a=>{var r;return((r=t.detallesTours)==null?void 0:r.some(d=>d.tour_id===a.id))||t.entidad_nombre===a.nombre});re.value=e,L.value=!0},He=t=>{t.originalEvent.target.closest("button")||he(t.data)},je=t=>{const e=J.find(a=>a.value===t);return(e==null?void 0:e.color)||"bg-gray-100 text-gray-800"},Be=t=>{const e=ye.find(a=>a.value===t);return(e==null?void 0:e.label)||t},Ge=t=>{if(!t)return"N/A";const e=new Date(t);return e.getHours()===0&&e.getMinutes()===0?e.toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"}):e.toLocaleString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})},we=t=>{if(!t)return"N/A";const e=new Date(t);return e.getHours()===0&&e.getMinutes()===0?e.toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"})+" (Sin hora especificada)":e.toLocaleString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})},Ze=async()=>{U.value=!0;try{m.value={busqueda:"",fechaDesde:null,fechaHasta:null,estado:null},f.add({severity:"success",summary:"Filtros limpiados",life:1500})}finally{U.value=!1}},We=_(()=>{if(b.value.fechaSalida instanceof Date){const t=new Date(b.value.fechaSalida);return t.setHours(t.getHours()+1),t}return new Date}),Xe=async t=>{var e,a,r,d,i;ie.value=!0;try{await O.put(`/api/reservas/${t.id}/confirmar`);const c=g.value.findIndex(w=>w.id===t.id);c!==-1&&(g.value[c].estado="CONFIRMADA"),L.value=!1,f.add({severity:"success",summary:"¬°Confirmada!",detail:`Reserva de ${((a=(e=t.cliente)==null?void 0:e.user)==null?void 0:a.name)||((r=t.cliente)==null?void 0:r.nombres)} confirmada correctamente`,life:4e3})}catch(c){console.error("Error confirmando reserva:",c),f.add({severity:"error",summary:"Error",detail:((i=(d=c.response)==null?void 0:d.data)==null?void 0:i.message)||"No se pudo confirmar la reserva",life:4e3})}finally{ie.value=!1}},Ye=async t=>{var e,a,r,d,i;de.value=!0,ne.value=!0;try{const c=await O.put(`/api/reservas/${t.reserva.id}/rechazar`,{motivo:t.motivo}),w=g.value.findIndex(R=>R.id===t.reserva.id);w!==-1&&g.value.splice(w,1),W.value=!1,L.value=!1,f.add({severity:"success",summary:"¬°Eliminada!",detail:`Reserva de ${((a=(e=t.reserva.cliente)==null?void 0:e.user)==null?void 0:a.name)||((r=t.reserva.cliente)==null?void 0:r.nombres)} eliminada correctamente`,life:4e3})}catch(c){console.error("Error rechazando reserva:",c),f.add({severity:"error",summary:"Error",detail:((i=(d=c.response)==null?void 0:d.data)==null?void 0:i.message)||"No se pudo rechazar la reserva",life:4e3})}finally{ne.value=!1,de.value=!1}},Je=t=>{he(t)};me(()=>[m.value.busqueda,m.value.fechaDesde,m.value.fechaHasta,m.value.estado],()=>{clearTimeout(window.searchTimeout),window.searchTimeout=setTimeout(()=>{F()},500)},{deep:!0}),me(I,t=>{t?(document.body.style.overflow="hidden",document.body.style.paddingRight="15px"):(document.body.style.overflow="",document.body.style.paddingRight="")});const Ae=()=>{aa(()=>{setTimeout(()=>{document.querySelectorAll(".p-select").forEach(e=>{const a=e.querySelector(".p-select-label, .p-placeholder");a&&(a.style.overflow="hidden",a.style.textOverflow="ellipsis",a.style.whiteSpace="nowrap",a.style.maxWidth="calc(100% - 2.5rem)",a.style.display="block")})},100)})};return me([m],()=>{Ae()},{deep:!0}),Ke(async()=>{try{if($.value=ke(),!$.value){f.add({severity:"warn",summary:"Tour no especificado",detail:"Redirigiendo a la lista de tours...",life:3e3}),setTimeout(()=>{Re.visit("/tours")},2e3);return}await Promise.all([Me($.value),F()]),Ae()}catch(t){console.error("Error cargando datos iniciales:",t)}}),Qe(()=>{ce()}),(t,e)=>(y(),ve(sa,null,{default:h(()=>[n(l(ea),{title:"Gesti√≥n de Reservas"}),n(l(oa),{class:"z-[9999]"}),n(l(ra),{class:"z-[9999]",style:pe(H.value),draggable:!1,closable:!1},{message:h(a=>[s("div",ba,[n(l(p),{icon:l(le),class:"h-8 w-8 text-red-500"},null,8,["icon"]),s("div",xa,[s("span",null,v(a.message.header),1),s("span",ya,v(a.message.content),1)])])]),_:1},8,["style"]),s("div",ha,[s("div",wa,[s("button",{onClick:$e,disabled:G.value,class:"flex items-center text-blue-600 hover:text-blue-700 transition-colors duration-200 px-3 py-2 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed",title:"Regresar a Tours"},[n(l(p),{icon:G.value?l(N):l(ua),class:E(["h-5 w-5 mr-2",{"animate-spin":G.value}])},null,8,["icon","class"]),e[20]||(e[20]=s("span",{class:"font-medium"},"Volver a Tours",-1))],8,Aa)]),s("div",Ea,[o.value?(y(),C("div",Ca,[e[30]||(e[30]=s("h3",{class:"text-lg font-semibold text-blue-600 mb-2"},"Cambiar Estado del Tour",-1)),s("div",Ra,[s("p",Da,[n(l(p),{icon:l(B),class:"h-4 w-4 text-blue-500"},null,8,["icon"]),e[21]||(e[21]=j(" Haz clic en cualquier tarjeta para cambiar el estado del tour "))]),!M.value&&o.value.estado==="DISPONIBLE"&&k.value?(y(),C("p",_a,[n(l(p),{icon:l(le),class:"h-4 w-4 text-amber-500"},null,8,["icon"]),s("span",null," Cupo m√≠nimo no cumplido ("+v(o.value.cupo_min)+" personas requeridas). Actualmente hay "+v(q.value.filter(a=>a.estado==="CONFIRMADA").reduce((a,r)=>a+(r.mayores_edad||0)+(r.menores_edad||0),0))+" personas confirmadas. Solo se puede cancelar el tour. ",1)])):A("",!0),o.value.estado==="COMPLETO"&&!K.value?(y(),C("p",Na,[n(l(p),{icon:l(B),class:"h-4 w-4 text-blue-500"},null,8,["icon"]),e[22]||(e[22]=s("span",{class:"font-medium"}," Tour completo - Debe confirmar TODAS las reservas pendientes para poder poner el tour en curso ",-1))])):A("",!0),o.value.estado==="REPROGRAMADA"&&!ue.value?(y(),C("p",Ta,[n(l(p),{icon:l(B),class:"h-4 w-4 text-purple-500"},null,8,["icon"]),e[23]||(e[23]=s("span",{class:"font-medium"}," Tour reprogramado - Confirme las reservas pendientes para habilitarlo en curso ",-1))])):A("",!0),!k.value&&(o.value.estado==="DISPONIBLE"||o.value.estado==="REPROGRAMADA")?(y(),C("p",Sa,[n(l(p),{icon:l(B),class:"h-4 w-4 text-gray-500"},null,8,["icon"]),e[24]||(e[24]=s("span",null," Este tour no tiene reservas activas. ",-1))])):A("",!0)]),s("div",Oa,[s("div",Ia,[e[25]||(e[25]=s("p",{class:"text-xs md:text-sm text-gray-600 mb-1"},"Estado Actual",-1)),s("p",La,v(Be(o.value.estado)),1)]),o.value.estado!=="EN_CURSO"&&o.value.estado!=="FINALIZADO"&&o.value.estado!=="CANCELADA"?(y(),C("div",{key:0,class:E(["rounded-lg px-2 py-2 md:px-4 md:py-3 flex-1 min-w-0 transition-all duration-200",ue.value?"bg-gradient-to-r from-blue-500 to-blue-600 cursor-pointer hover:shadow-lg hover:scale-105":"bg-gray-400 cursor-not-allowed opacity-60"]),onClick:e[0]||(e[0]=a=>ue.value?Q("EN_CURSO"):null)},[s("div",Ma,[e[26]||(e[26]=s("div",{class:"flex-1"},[s("p",{class:"text-xs md:text-sm opacity-90"},"En Curso")],-1)),n(l(p),{icon:x.value.cambiarEstado?l(N):l(oe),class:E([{"animate-spin":x.value.cambiarEstado},"text-xs md:text-sm opacity-75"])},null,8,["icon","class"])])],2)):A("",!0),o.value.estado!=="FINALIZADO"&&o.value.estado!=="CANCELADA"&&o.value.estado==="EN_CURSO"?(y(),C("div",{key:1,class:"bg-gradient-to-r from-gray-500 to-gray-600 cursor-pointer hover:shadow-lg transition-all duration-200 hover:scale-105 rounded-lg px-2 py-2 md:px-4 md:py-3 flex-1 min-w-0",onClick:e[1]||(e[1]=a=>Q("FINALIZADO"))},[s("div",ka,[e[27]||(e[27]=s("div",{class:"flex-1"},[s("p",{class:"text-xs md:text-sm opacity-90"},"Finalizar")],-1)),n(l(p),{icon:x.value.cambiarEstado?l(N):l(Te),class:E([{"animate-spin":x.value.cambiarEstado},"text-xs md:text-sm opacity-75"])},null,8,["icon","class"])])])):A("",!0),o.value.estado!=="REPROGRAMADA"&&o.value.estado!=="FINALIZADO"&&o.value.estado!=="CANCELADA"&&o.value.estado!=="EN_CURSO"?(y(),C("div",{key:2,class:E(["rounded-lg px-2 py-2 md:px-4 md:py-3 flex-1 min-w-0 transition-all duration-200",o.value.estado==="DISPONIBLE"&&M.value||o.value.estado==="COMPLETO"&&K.value?"bg-gradient-to-r from-purple-500 to-purple-600 cursor-pointer hover:shadow-lg hover:scale-105":"bg-gray-400 cursor-not-allowed opacity-60"]),onClick:e[2]||(e[2]=a=>o.value.estado==="DISPONIBLE"&&M.value||o.value.estado==="COMPLETO"&&K.value?Q("REPROGRAMADA"):null)},[s("div",Pa,[e[28]||(e[28]=s("div",{class:"flex-1"},[s("p",{class:"text-xs md:text-sm opacity-90"},"Reprogramar")],-1)),n(l(p),{icon:x.value.cambiarEstado?l(N):l(oe),class:E([{"animate-spin":x.value.cambiarEstado},"text-xs md:text-sm opacity-75"])},null,8,["icon","class"])])],2)):A("",!0),o.value.estado!=="CANCELADA"&&o.value.estado!=="FINALIZADO"&&o.value.estado!=="EN_CURSO"?(y(),C("div",{key:3,class:E(["rounded-lg px-2 py-2 md:px-4 md:py-3 flex-1 min-w-0 transition-all duration-200",k.value||o.value.estado==="COMPLETO"||o.value.estado==="REPROGRAMADA"?"bg-gradient-to-r from-red-500 to-red-600 cursor-pointer hover:shadow-lg hover:scale-105":"bg-gray-400 cursor-not-allowed opacity-60"]),onClick:e[3]||(e[3]=a=>k.value||o.value.estado==="COMPLETO"||o.value.estado==="REPROGRAMADA"?Q("CANCELADA"):null),title:!k.value&&o.value.estado!=="COMPLETO"?"No se puede cancelar un tour sin reservas activas":"Cancelar tour y todas sus reservas"},[s("div",za,[s("div",$a,[e[29]||(e[29]=s("p",{class:"text-xs md:text-sm opacity-90"},"Cancelar",-1)),k.value?A("",!0):(y(),C("p",Va,"Sin reservas"))]),n(l(p),{icon:x.value.cambiarEstado?l(N):l(fe),class:E([{"animate-spin":x.value.cambiarEstado},"text-xs md:text-sm opacity-75"])},null,8,["icon","class"])])],10,Fa)):A("",!0)])])):A("",!0),s("div",Ua,[s("div",qa,[s("div",Ha,[e[31]||(e[31]=s("h3",{class:"text-base font-medium text-gray-800 flex items-center gap-2"},[s("i",{class:"pi pi-filter text-blue-600 text-sm"}),s("span",null,"Filtros")],-1)),s("div",ja,v(q.value.length)+" resultado"+v(q.value.length!==1?"s":""),1)]),s("button",{onClick:Ze,disabled:U.value,class:"bg-red-500 hover:bg-red-600 border border-red-500 px-2 py-1 text-xs text-white shadow-md rounded-md disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-1 shrink-0"},[U.value?(y(),ve(l(p),{key:0,icon:l(N),class:"animate-spin h-3 w-3"},null,8,["icon"])):A("",!0),s("span",null,v(U.value?"Limpiando...":"Limpiar"),1)],8,Ba)]),s("div",Ga,[s("div",null,[n(l(na),{modelValue:m.value.busqueda,"onUpdate:modelValue":e[4]||(e[4]=a=>m.value.busqueda=a),placeholder:"üîç Buscar por cliente...",class:"w-full h-9 text-sm rounded-md",style:{"background-color":"white","border-color":"#93c5fd"}},null,8,["modelValue"])]),s("div",Za,[n(l(te),{modelValue:m.value.fechaDesde,"onUpdate:modelValue":e[5]||(e[5]=a=>m.value.fechaDesde=a),placeholder:"Fecha desde",dateFormat:"dd/mm/yy",class:"w-full h-9 text-sm",style:{"background-color":"white","border-color":"#93c5fd"},showIcon:""},null,8,["modelValue"]),n(l(te),{modelValue:m.value.fechaHasta,"onUpdate:modelValue":e[6]||(e[6]=a=>m.value.fechaHasta=a),placeholder:"Fecha hasta",dateFormat:"dd/mm/yy",class:"w-full h-9 text-sm",style:{"background-color":"white","border-color":"#93c5fd"},showIcon:""},null,8,["modelValue"]),n(l(ia),{modelValue:m.value.estado,"onUpdate:modelValue":e[7]||(e[7]=a=>m.value.estado=a),options:[{label:"Todos los estados",value:null},{label:"Pendientes",value:"PENDIENTE"},{label:"Confirmadas",value:"CONFIRMADA"}],optionLabel:"label",optionValue:"value",placeholder:"Filtrar por estado",class:"w-full h-9 text-sm",style:{"background-color":"white","border-color":"#93c5fd"}},null,8,["modelValue"])])])]),s("div",Wa,[s("p",Xa,[n(l(p),{icon:l(ca),class:"h-3 w-3 text-yellow-500"},null,8,["icon"]),e[32]||(e[32]=j(" Haz clic en cualquier fila para ver los detalles. "))])]),n(l(da),{value:q.value,paginator:"",rows:10,rowsPerPageOptions:[5,10,20,50],paginatorTemplate:"RowsPerPageDropdown FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink",currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} reservas",responsiveLayout:"scroll",class:"mt-2 sm:mt-4 overflow-x-auto",onRowClick:He,pt:{root:{class:"text-xs sm:text-sm"},wrapper:{class:"text-xs sm:text-sm overflow-x-auto"},table:{class:"text-xs sm:text-sm min-w-full"},thead:{class:"text-xs sm:text-sm"},headerRow:{class:"text-xs sm:text-sm"},headerCell:{class:"text-xs sm:text-sm font-medium py-2 sm:py-3 px-1 sm:px-2"},tbody:{class:"text-xs sm:text-sm"},bodyRow:{class:"text-xs sm:text-sm cursor-pointer hover:bg-blue-50 transition-colors duration-200"},bodyCell:{class:"py-2 sm:py-3 px-1 sm:px-2 text-xs sm:text-sm"}}},{empty:h(()=>[s("div",Ya,[n(l(p),{icon:l(B),class:"text-4xl text-gray-400 mb-4"},null,8,["icon"]),e[33]||(e[33]=s("p",{class:"text-gray-500 text-lg"},"No se encontraron reservas",-1)),e[34]||(e[34]=s("p",{class:"text-gray-400 text-sm mt-2"}," Ajusta los filtros para encontrar las reservas que buscas ",-1))])]),loading:h(()=>e[35]||(e[35]=[s("div",{class:"text-center py-12"},[s("i",{class:"pi pi-spin pi-spinner text-3xl text-blue-500 mb-4"}),s("p",{class:"text-gray-500 text-lg"},"Cargando reservas...")],-1)])),default:h(()=>[n(l(z),{field:"fecha_reserva",header:"Fecha",class:"w-28 min-w-16"},{body:h(a=>[s("span",Ja,v(Ge(a.data.fecha_reserva)),1)]),_:1}),n(l(z),{field:"cliente.nombres",header:"Cliente",class:"w-16 hidden sm:table-cell"},{body:h(a=>{var r,d,i,c,w,R,S,ee,ae,se,Ee,Ce;return[s("div",Ka,[s("div",Qa,[n(l(p),{icon:l(Se),class:"text-blue-600 text-xs sm:text-sm"},null,8,["icon"])]),s("div",es,[s("div",{class:"font-medium text-gray-900 text-xs sm:text-sm truncate",title:((d=(r=a.data.cliente)==null?void 0:r.user)==null?void 0:d.name)||((i=a.data.cliente)==null?void 0:i.nombres)||"N/A"},v(((w=(c=a.data.cliente)==null?void 0:c.user)==null?void 0:w.name)||((R=a.data.cliente)==null?void 0:R.nombres)||"N/A"),9,as),s("div",{class:"text-xs text-gray-500 truncate hidden sm:block",title:((ee=(S=a.data.cliente)==null?void 0:S.user)==null?void 0:ee.email)||((ae=a.data.cliente)==null?void 0:ae.correo)||"N/A"},v(((Ee=(se=a.data.cliente)==null?void 0:se.user)==null?void 0:Ee.email)||((Ce=a.data.cliente)==null?void 0:Ce.correo)||"N/A"),9,ss)])])]}),_:1}),n(l(z),{header:"Personas",class:"w-20 sm:w-24 lg:w-28 min-w-16 hidden md:table-cell"},{body:h(a=>[s("div",null,[s("div",ts,[n(l(p),{icon:l(Se),class:"text-gray-400 text-xs mr-1"},null,8,["icon"]),s("span",ls,v((a.data.mayores_edad||0)+(a.data.menores_edad||0)),1)]),s("div",os,v(a.data.mayores_edad||0)+"A ‚Ä¢ "+v(a.data.menores_edad||0)+"N ",1)])]),_:1}),n(l(z),{field:"total",header:"Total",class:"w-12 min-w-12"},{body:h(a=>[s("span",rs," $"+v(Number(a.data.total||0).toFixed(2)),1)]),_:1}),n(l(z),{field:"estado",header:"Estado",class:"w-24 sm:w-28 lg:w-36 min-w-20 hidden lg:table-cell"},{body:h(a=>{var r,d;return[s("span",{class:E([je(a.data.estado),"px-2 py-1 rounded-full text-xs font-medium"])},[s("span",ns,v(((r=J.find(i=>i.value===a.data.estado))==null?void 0:r.label)||a.data.estado),1),s("span",is,v((((d=J.find(i=>i.value===a.data.estado))==null?void 0:d.label)||a.data.estado).substring(0,4)),1)],2)]}),_:1}),n(l(z),{header:"Acciones",class:"w-24 sm:w-28 lg:w-32 min-w-20"},{body:h(a=>[s("button",{class:"bg-green-500 hover:bg-green-600 text-white px-2 py-2 rounded-md transition-all duration-200 ease-in-out inline-flex items-center gap-1 text-xs shadow-md hover:shadow-lg hover:-translate-y-1",onClick:r=>qe(a.data),title:"M√°s acciones"},[n(l(p),{icon:l(pa),class:"h-3 w-4 sm:h-4 sm:w-5"},null,8,["icon"]),e[36]||(e[36]=s("span",{class:"hidden md:inline"},"M√°s",-1))],8,ds)]),_:1})]),_:1},8,["value"]),n(fa,{visible:L.value,"onUpdate:visible":e[8]||(e[8]=a=>L.value=a),"detalles-visible":X.value,"onUpdate:detallesVisible":e[9]||(e[9]=a=>X.value=a),"rechazar-visible":W.value,"onUpdate:rechazarVisible":e[10]||(e[10]=a=>W.value=a),reserva:Y.value,tour:re.value,"dialog-style":H.value,procesando:ne.value,"confirmando-reserva":ie.value,"rechazando-reserva":de.value,"estados-reservas":J,"estados-tours":ye,onConfirmar:Xe,onRechazar:Ye,onVerDetalles:Je},null,8,["visible","detalles-visible","rechazar-visible","reserva","tour","dialog-style","procesando","confirmando-reserva","rechazando-reserva"]),n(ga,{visible:Z.value,"onUpdate:visible":e[11]||(e[11]=a=>Z.value=a),tour:o.value,"dialog-style":H.value,onEstadoActualizado:Fe},null,8,["visible","tour","dialog-style"]),n(l(Ne),{visible:V.value,"onUpdate:visible":e[14]||(e[14]=a=>V.value=a),modal:"",header:"Cancelar Tour Completo",style:pe(H.value),closable:!1,draggable:!1},{default:h(()=>{var a;return[s("div",us,[s("div",cs,[s("div",ms,[n(l(p),{icon:l(le),class:"text-orange-600 text-lg mt-1 flex-shrink-0"},null,8,["icon"]),e[37]||(e[37]=s("div",null,[s("h4",{class:"font-bold text-orange-800 mb-2"},"¬°ADVERTENCIA - ELIMINACI√ìN MASIVA PERMANENTE!"),s("div",{class:"text-sm text-orange-700 space-y-2"},[s("p",null,[s("strong",null,"‚Ä¢ Esta acci√≥n NO se puede deshacer bajo ninguna circunstancia")]),s("p",null,"‚Ä¢ Se eliminar√°n TODAS las reservas del tour de forma PERMANENTE"),s("p",null,"‚Ä¢ Se eliminar√°n TODOS los detalles asociados a cada reserva"),s("p",null,"‚Ä¢ Los cupos del tour ser√°n liberados autom√°ticamente"),s("p",null,"‚Ä¢ Se enviar√°n emails de cancelaci√≥n a TODOS los clientes"),s("p",null,"‚Ä¢ No ser√° posible recuperar ninguna informaci√≥n posteriormente"),s("div",{class:"mt-3 p-2 bg-orange-100 rounded border border-orange-300"},[s("p",{class:"font-semibold text-orange-900 text-xs"}," Aseg√∫rese de que realmente desea eliminar toda la informaci√≥n antes de continuar ")])])],-1))])]),s("div",vs,[s("div",ps,[n(l(p),{icon:l(le),class:"text-red-600"},null,8,["icon"]),s("h4",fs,"Cancelar Tour: "+v((a=o.value)==null?void 0:a.nombre),1)]),e[38]||(e[38]=s("p",{class:"text-sm text-red-700"}," Esta acci√≥n cancelar√° el tour completo y TODAS las reservas asociadas. Se enviar√°n notificaciones por correo a todos los clientes. ",-1)),s("p",gs,[s("strong",null,"Reservas que ser√°n ELIMINADAS PERMANENTEMENTE: "+v(g.value.length),1)])]),s("div",null,[e[39]||(e[39]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[j(" Motivo de la Cancelaci√≥n del Tour "),s("span",{class:"text-red-500"},"*")],-1)),De(s("textarea",{"onUpdate:modelValue":e[12]||(e[12]=r=>D.value=r),placeholder:"Explique por qu√© se cancela el tour completo...",class:"w-full p-3 border border-gray-300 rounded-md focus:ring-red-500 focus:border-red-500",rows:"4",maxlength:"500"},null,512),[[_e,D.value]]),s("small",bs,v(D.value.length)+"/500 caracteres",1)]),s("div",xs,[s("button",{onClick:e[13]||(e[13]=r=>V.value=!1),class:"px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50"}," Cancelar "),s("button",{onClick:Ue,disabled:!D.value.trim()||T.value,class:"px-4 py-2 bg-red-700 text-white rounded-md hover:bg-red-800 disabled:bg-red-300 flex items-center gap-2"},[n(l(p),{icon:T.value?l(N):l(fe),class:E({"animate-spin":T.value})},null,8,["icon","class"]),j(" "+v(T.value?"Eliminando Todo...":"Eliminar Tour y Reservas Definitivamente"),1)],8,ys)])])]}),_:1},8,["visible","style"]),n(l(Ne),{visible:I.value,"onUpdate:visible":e[19]||(e[19]=a=>I.value=a),modal:"",header:"Reprogramar Tour",style:pe(H.value),closable:!1,draggable:!1},{default:h(()=>{var a,r,d;return[s("div",hs,[s("div",ws,[s("h4",As,v((a=o.value)==null?void 0:a.nombre),1),s("p",Es," Fechas actuales: "+v(we((r=o.value)==null?void 0:r.fecha_salida))+" - "+v(we((d=o.value)==null?void 0:d.fecha_regreso)),1)]),s("div",Cs,[s("div",null,[e[40]||(e[40]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Salida:",-1)),n(l(te),{modelValue:b.value.fechaSalida,"onUpdate:modelValue":e[15]||(e[15]=i=>b.value.fechaSalida=i),showTime:"",hourFormat:"12",dateFormat:"dd/mm/yy",showIcon:"",placeholder:"Seleccionar fecha y hora",class:"w-full",minDate:new Date},null,8,["modelValue","minDate"])]),s("div",null,[e[41]||(e[41]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Regreso:",-1)),n(l(te),{modelValue:b.value.fechaRegreso,"onUpdate:modelValue":e[16]||(e[16]=i=>b.value.fechaRegreso=i),showTime:"",hourFormat:"12",dateFormat:"dd/mm/yy",showIcon:"",placeholder:"Seleccionar fecha y hora",class:"w-full",minDate:We.value},null,8,["modelValue","minDate"])])]),s("div",null,[e[42]||(e[42]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Motivo de la Reprogramaci√≥n",-1)),De(s("textarea",{"onUpdate:modelValue":e[17]||(e[17]=i=>b.value.motivo=i),placeholder:"Ingrese el motivo de la reprogramaci√≥n...",class:"w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",rows:"3"},null,512),[[_e,b.value.motivo]]),e[43]||(e[43]=s("p",{class:"text-xs text-gray-500 mt-2"}," üí° Al reprogramar el tour, todas las reservas asociadas ser√°n reprogramadas autom√°ticamente y se enviar√°n correos de notificaci√≥n a los clientes. ",-1))]),s("div",Rs,[s("button",{onClick:ze,disabled:x.value.cambiarEstado,class:"px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"},[x.value.cambiarEstado?(y(),ve(l(p),{key:0,icon:l(N),class:"animate-spin"},null,8,["icon"])):A("",!0),j(" "+v(x.value.cambiarEstado?"Reprogramando...":"Reprogramar Tour"),1)],8,Ds),s("button",{onClick:e[18]||(e[18]=i=>{I.value=!1,ce()}),class:"border rounded-md bg-blue-500 hover:bg-blue-700 text-white px-6 py-2",disabled:x.value.cambiarEstado}," Cancelar ",8,_s)])])]}),_:1},8,["visible","style"])])])]),_:1}))}};export{Fs as default};
