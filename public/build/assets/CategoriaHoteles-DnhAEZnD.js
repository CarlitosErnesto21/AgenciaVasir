import{r as i,E as W,w as ve,n as $,o as fe,a6 as ge,N as E,k as D,h as be,d as g,x as c,p as r,e as t,$ as o,a0 as pe,a1 as xe,y as T,t as _,A as B,c as b,j as U,q as j}from"./vendor-CaDzpwPW.js";import{A as he}from"./AuthenticatedLayout-AKZeTM27.js";import{z as we,F as ye,A as m}from"./ui-BjYE_i4I.js";import{f as F,a as Ce,b as _e,c as Y,d as ke,e as Z,g as J,h as K,i as Pe}from"./index-DngIDQG3.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Ee={class:"container mx-auto px-4 py-6"},De={class:"bg-white rounded-lg shadow-md"},Te={class:"flex flex-col sm:flex-row lg:justify-between lg:items-center mb-4 gap-4 p-6"},Ne={class:"flex items-center gap-3"},Le={class:"flex items-center gap-2 w-full justify-center lg:w-auto lg:justify-end"},Ae={class:"bg-blue-50 p-3 rounded-lg shadow-sm border mb-4"},Se={class:"text-sm font-medium leading-relaxed"},Oe={class:"flex gap-2 justify-center items-center"},Ue=["onClick"],je=["onClick"],ze={class:"space-y-4"},Ve={class:"w-full flex flex-col"},Me={class:"flex items-center gap-4"},Re={key:0,class:"text-red-500 ml-28"},We={key:1,class:"text-red-500 ml-28"},$e={key:2,class:"text-orange-500 ml-28"},Be={key:3,class:"text-red-500 ml-28"},Fe={class:"flex justify-center gap-4 w-full mt-6"},Ge=["disabled"],He={key:0},Ie={key:1},qe=["disabled"],Ye={class:"flex items-center gap-3"},Ze={class:"flex flex-col"},Je={class:"flex justify-center gap-4 w-full"},Ke=["disabled"],Xe={key:0},Qe={key:1},ea=["disabled"],aa={class:"flex items-center gap-3"},ta={class:"flex justify-center gap-3 w-full"},da={__name:"CategoriaHoteles",setup(sa){const d=we(),N=i([]),a=i({id:null,nombre:""}),v=i(!1),p=i(!1),L=i(!1),z=i(typeof window<"u"?window.innerWidth:1024),V=W(()=>z.value<640?{width:"95vw",maxWidth:"380px"}:z.value<768?{width:"400px"}:{width:"450px"}),x=i(!1),w=i(!1),k=i(!1),y=i(!1),C=i(!1),h=i(null),A=i({global:{value:null,matchMode:ye.CONTAINS}}),M=i(10),X=i([5,10,20,50]),P=i("Guardar"),Q=W(()=>{let s=N.value;if(A.value.global.value){const e=A.value.global.value.toLowerCase();s=s.filter(l=>l.nombre.toLowerCase().includes(e))}return s}),S=W(()=>!a.value.nombre||a.value.nombre.length<3?!1:N.value.some(s=>s.nombre.toLowerCase()===a.value.nombre.toLowerCase()&&s.id!==a.value.id));ve([a],()=>{h.value&&x.value&&$(()=>{const s={...a.value},e=JSON.stringify(s)!==JSON.stringify(h.value),l=!h.value.id,u=a.value.nombre;C.value=e||l&&u})},{deep:!0,flush:"post"});function O(){a.value={id:null,nombre:""},y.value=!1}const G=()=>{typeof window<"u"&&(z.value=window.innerWidth)},ee=()=>{L.value=!0};fe(()=>{ae(),typeof window<"u"&&window.addEventListener("resize",G)}),ge(()=>{typeof window<"u"&&window.removeEventListener("resize",G)});const H=async()=>{try{const s=await E.get("/api/categorias-hoteles");N.value=(s.data.data||s.data||[]).map(e=>({...e,categoria_id:e.id})).sort((e,l)=>new Date(l.created_at)-new Date(e.created_at))}catch{d.add({severity:"error",summary:"Error",detail:"No se pudieron cargar las categor√≠as de hoteles.",life:4e3})}},ae=async()=>{d.add({severity:"info",summary:"Cargando categor√≠as...",life:2e3});try{const s=await E.get("/api/categorias-hoteles");N.value=(s.data.data||s.data||[]).map(e=>({...e,categoria_id:e.id})).sort((e,l)=>new Date(l.created_at)-new Date(e.created_at)),d.add({severity:"success",summary:"Categor√≠as cargadas",life:2e3})}catch{d.add({severity:"error",summary:"Error",detail:"No se pudieron cargar las categor√≠as de hoteles.",life:4e3})}},te=()=>{O(),P.value="Guardar",y.value=!1,x.value=!0,$(()=>{h.value={...a.value},C.value=!1})},se=s=>{O(),y.value=!1,a.value={...s},P.value="Actualizar",x.value=!0,$(()=>{h.value={...a.value},C.value=!1})},le=async()=>{var s,e;if(y.value=!0,v.value=!0,!a.value.nombre||a.value.nombre.length<3||a.value.nombre.length>50){d.add({severity:"warn",summary:"Campos requeridos",detail:"El nombre debe tener entre 3 y 50 caracteres.",life:4e3}),v.value=!1;return}if(S.value){d.add({severity:"warn",summary:"Categor√≠a duplicada",detail:`Ya existe una categor√≠a con el nombre "${a.value.nombre}". Por favor, elige un nombre diferente.`,life:6e3}),v.value=!1;return}try{a.value.id?(await E({method:"POST",url:`/api/categorias-hoteles/${a.value.id}`,data:{_method:"PUT",nombre:a.value.nombre}}),d.add({severity:"success",summary:"¬°√âxito!",detail:"La categor√≠a ha sido actualizada correctamente.",life:5e3})):(await E.post("/api/categorias-hoteles",{nombre:a.value.nombre}),d.add({severity:"success",summary:"¬°√âxito!",detail:"La categor√≠a ha sido creada correctamente.",life:5e3})),await H(),x.value=!1,C.value=!1,h.value=null,O()}catch(l){if(l.response&&l.response.status===422){const u=l.response.data.errors;if(u&&u.nombre){const f=u.nombre[0];f.includes("unique")||f.includes("ya existe")||f.includes("duplicado")?d.add({severity:"warn",summary:"Categor√≠a duplicada",detail:`Ya existe una categor√≠a con el nombre "${a.value.nombre}". Por favor, elige un nombre diferente.`,life:6e3}):d.add({severity:"warn",summary:"Error de validaci√≥n",detail:f,life:5e3})}else d.add({severity:"warn",summary:"Error de validaci√≥n",detail:l.response.data.message||"Por favor verifica los datos ingresados.",life:5e3})}else{const u=((e=(s=l.response)==null?void 0:s.data)==null?void 0:e.message)||"Error al procesar la categor√≠a.";d.add({severity:"error",summary:"Error",detail:u,life:6e3})}}finally{v.value=!1}},oe=s=>{a.value={...s},w.value=!0},re=async()=>{var s,e,l;p.value=!0;try{await E({method:"POST",url:`/api/categorias-hoteles/${a.value.id}`,data:{_method:"DELETE"}}),await H(),w.value=!1,d.add({severity:"success",summary:"¬°Eliminada!",detail:"La categor√≠a ha sido eliminada correctamente.",life:5e3})}catch(u){if(w.value=!1,((s=u.response)==null?void 0:s.status)===422)d.add({severity:"warn",summary:"No se puede eliminar",detail:u.response.data.message,life:5e3});else{const f=((l=(e=u.response)==null?void 0:e.data)==null?void 0:l.error)||u.message||"Error desconocido";d.add({severity:"error",summary:"Error",detail:`No se pudo eliminar la categor√≠a: ${f}`,life:6e3})}}finally{p.value=!1}},ne=()=>{C.value?k.value=!0:I()},I=()=>{x.value=!1,k.value=!1,C.value=!1,h.value=null,O()},ie=()=>{k.value=!1},q=()=>{a.value.nombre&&(a.value.nombre=a.value.nombre.toUpperCase(),a.value.nombre=a.value.nombre.replace(/[^A-Z√Å√â√ç√ì√ö√ë0-9\s]/g,""),a.value.nombre=a.value.nombre.replace(/\s+/g," "),a.value.nombre.length>50&&(a.value.nombre=a.value.nombre.substring(0,50)),a.value.nombre=a.value.nombre.trim())},de=s=>{/[a-zA-Z√°√©√≠√≥√∫√±√Å√â√ç√ì√ö√ë0-9\s]/.test(s.key)||s.preventDefault()},ue=s=>{s.preventDefault();const e=(s.clipboardData||window.clipboardData).getData("text");if(e){let l=e.toUpperCase();l=l.replace(/[^A-Z√Å√â√ç√ì√ö√ë0-9\s]/g,""),l=l.replace(/\s+/g," "),l=l.trim(),l.length>50&&(l=l.substring(0,50)),a.value.nombre=l,q()}};return(s,e)=>{const l=D("Toast"),u=D("InputText"),f=D("Column"),ce=D("DataTable"),R=D("Dialog");return g(),be(he,null,{default:c(()=>[r(o(pe),{title:"Control de Categor√≠as de Hoteles"}),r(l,{class:"z-[9999]"}),t("div",Ee,[e[21]||(e[21]=t("div",{class:"mb-6"},[t("h1",{class:"text-3xl font-bold text-blue-600 mb-2"},"Control de Categor√≠as de Hoteles"),t("p",{class:"text-gray-600"},"Gesti√≥n de categor√≠as de hoteles")],-1)),t("div",De,[t("div",Te,[t("div",Ne,[r(o(xe),{href:s.route("hoteles"),onClick:ee,class:T([{"opacity-50 cursor-not-allowed":L.value},"flex items-center text-blue-600 hover:text-blue-700 transition-colors duration-200 px-3 py-2 rounded-lg"]),title:"Regresar a Hoteles"},{default:c(()=>[r(o(m),{icon:L.value?o(F):o(Ce),class:T({"animate-spin":L.value,"h-5 w-5":!0})},null,8,["icon","class"])]),_:1},8,["href","class"]),e[7]||(e[7]=t("h3",{class:"text-2xl sm:text-3xl text-blue-600 font-bold text-center sm:text-start"},"Lista de Categor√≠as",-1))]),t("div",Le,[t("button",{class:"bg-red-500 border border-red-500 p-2 text-sm text-white shadow-md hover:shadow-lg rounded-md hover:-translate-y-1 transition-transform duration-300 flex items-center gap-2",onClick:te},[r(o(m),{icon:o(_e),class:"h-4 w-4"},null,8,["icon"]),e[8]||(e[8]=t("span",null,"Agregar categor√≠a",-1))])])]),r(ce,{value:Q.value,dataKey:"id",paginator:!0,rows:M.value,rowsPerPageOptions:X.value,rowsPerPage:M.value,"onUpdate:rowsPerPage":e[1]||(e[1]=n=>M.value=n),paginatorTemplate:"RowsPerPageDropdown FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink",currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} categor√≠as",class:"overflow-x-auto max-w-full",responsiveLayout:"scroll",pt:{root:{class:"text-sm"},wrapper:{class:"text-sm"},table:{class:"text-sm"},thead:{class:"text-sm"},headerRow:{class:"text-sm"},headerCell:{class:"text-sm font-medium py-3 px-2"},tbody:{class:"text-sm"},bodyRow:{class:"h-16 text-sm"},bodyCell:{class:"py-3 px-2 text-sm"},paginator:{class:"text-xs sm:text-sm"},paginatorWrapper:{class:"flex flex-wrap justify-center sm:justify-between items-center gap-2 p-2"}}},{header:c(()=>[t("div",Ae,[r(u,{modelValue:A.value.global.value,"onUpdate:modelValue":e[0]||(e[0]=n=>A.value.global.value=n),placeholder:"üîç Buscar categor√≠as...",class:"w-full h-9 text-sm rounded-md",style:{"background-color":"white","border-color":"#93c5fd"}},null,8,["modelValue"])])]),default:c(()=>[r(f,{field:"nombre",header:"Nombre",sortable:"",class:"w-96 min-w-52"},{body:c(n=>[t("div",Se,_(n.data.nombre),1)]),_:1}),r(f,{exportable:!1,class:"w-52 min-w-28"},{header:c(()=>e[9]||(e[9]=[t("div",{class:"text-center w-full font-bold"}," Acciones ",-1)])),body:c(n=>[t("div",Oe,[t("button",{class:"flex bg-blue-500 border p-1 py-2 sm:p-2 text-sm shadow-md hover:shadow-lg rounded-md hover:-translate-y-1 transition-transform duration-300",onClick:me=>se(n.data)},[r(o(m),{icon:o(Y),class:"h-3 w-6 sm:h-4 sm:w-7 text-white"},null,8,["icon"]),e[10]||(e[10]=t("span",{class:"hidden md:block text-white"},"Editar",-1))],8,Ue),t("button",{class:"flex bg-red-500 border p-1 py-2 sm:p-2 text-sm shadow-md hover:shadow-lg rounded-md hover:-translate-y-1 transition-transform duration-300",onClick:me=>oe(n.data)},[r(o(m),{icon:o(ke),class:"h-3 w-6 sm:h-4 sm:w-7 text-white"},null,8,["icon"]),e[11]||(e[11]=t("span",{class:"hidden md:block text-white"},"Eliminar",-1))],8,je)])]),_:1})]),_:1},8,["value","rows","rowsPerPageOptions","rowsPerPage"]),r(R,{visible:x.value,"onUpdate:visible":e[3]||(e[3]=n=>x.value=n),header:P.value+" Categor√≠a",modal:!0,style:B(V.value),closable:!1,draggable:!1},{footer:c(()=>[t("div",Fe,[t("button",{class:"bg-red-500 hover:bg-red-700 text-white border-none px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",onClick:le,disabled:S.value||v.value},[r(o(m),{icon:v.value?o(F):o(Z),class:T(["h-5 text-white",{"animate-spin":v.value}])},null,8,["icon","class"]),v.value?(g(),b("span",Ie,_(P.value==="Guardar"?"Guardando...":"Actualizando..."),1)):(g(),b("span",He,_(P.value),1))],8,Ge),t("button",{type:"button",class:"bg-blue-500 hover:bg-blue-700 text-white px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",onClick:ne,disabled:v.value},[r(o(m),{icon:o(J),class:"h-5"},null,8,["icon"]),e[13]||(e[13]=j("Cancelar "))],8,qe)])]),default:c(()=>[t("div",ze,[t("div",Ve,[t("div",Me,[e[12]||(e[12]=t("label",{for:"nombre",class:"w-24 flex items-center gap-1"},[j(" Nombre: "),t("span",{class:"text-red-500 font-bold"},"*")],-1)),r(u,{modelValue:a.value.nombre,"onUpdate:modelValue":e[2]||(e[2]=n=>a.value.nombre=n),modelModifiers:{trim:!0},id:"nombre",name:"nombre",maxlength:50,class:T([{"p-invalid":y.value&&(!a.value.nombre||a.value.nombre.length<3||a.value.nombre.length>50)||S.value},"flex-1 border-2 border-gray-400 hover:border-gray-500 focus:border-gray-500 focus:ring-0 focus:shadow-none rounded-md"]),onInput:q,onKeypress:de,onPaste:ue,placeholder:"NOMBRE DE LA CATEGOR√çA"},null,8,["modelValue","class"])]),a.value.nombre&&a.value.nombre.length<3?(g(),b("small",Re," El nombre debe tener al menos 3 caracteres. Actual: "+_(a.value.nombre.length)+"/3 ",1)):U("",!0),S.value?(g(),b("small",We," Ya existe una categor√≠a con este nombre. Por favor, elige un nombre diferente. ")):U("",!0),a.value.nombre&&a.value.nombre.length>=45&&a.value.nombre.length<=50?(g(),b("small",$e," Caracteres restantes: "+_(50-a.value.nombre.length),1)):U("",!0),y.value&&!a.value.nombre?(g(),b("small",Be," El nombre es obligatorio. ")):U("",!0)])])]),_:1},8,["visible","header","style"]),r(R,{visible:w.value,"onUpdate:visible":e[5]||(e[5]=n=>w.value=n),header:"Eliminar categor√≠a",modal:!0,style:B(V.value),closable:!1,draggable:!1},{footer:c(()=>[t("div",Je,[t("button",{type:"button",class:"bg-red-500 hover:bg-red-700 text-white border-none px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",onClick:re,disabled:p.value},[r(o(m),{icon:p.value?o(F):o(Z),class:T(["h-5",{"animate-spin":p.value}])},null,8,["icon","class"]),p.value?(g(),b("span",Qe,"Eliminando...")):(g(),b("span",Xe,"Eliminar"))],8,Ke),t("button",{type:"button",class:"bg-blue-500 hover:bg-blue-700 text-white px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",onClick:e[4]||(e[4]=n=>w.value=!1),disabled:p.value},[r(o(m),{icon:o(J),class:"h-5"},null,8,["icon"]),e[17]||(e[17]=t("span",null,"Cancelar",-1))],8,ea)])]),default:c(()=>[t("div",Ye,[r(o(m),{icon:o(K),class:"h-8 w-8 text-red-500"},null,8,["icon"]),t("div",Ze,[t("span",null,[e[14]||(e[14]=j("¬øEst√°s seguro de eliminar la categor√≠a: ")),t("b",null,_(a.value.nombre),1),e[15]||(e[15]=j("?"))]),e[16]||(e[16]=t("span",{class:"text-red-600 text-sm font-medium mt-1"},"Esta acci√≥n es irreversible.",-1))])])]),_:1},8,["visible","style"]),r(R,{visible:k.value,"onUpdate:visible":e[6]||(e[6]=n=>k.value=n),header:"Cambios sin guardar",modal:!0,style:B(V.value),closable:!1,draggable:!1},{footer:c(()=>[t("div",ta,[t("button",{type:"button",class:"bg-red-500 hover:bg-red-700 text-white border-none px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",onClick:I},[r(o(m),{icon:o(Pe),class:"h-4"},null,8,["icon"]),e[19]||(e[19]=t("span",null,"Salir sin guardar",-1))]),t("button",{type:"button",class:"bg-blue-500 hover:bg-blue-700 text-white px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",onClick:ie},[r(o(m),{icon:o(Y),class:"h-4"},null,8,["icon"]),e[20]||(e[20]=t("span",null,"Continuar",-1))])])]),default:c(()=>[t("div",aa,[r(o(m),{icon:o(K),class:"h-8 w-8 text-red-500"},null,8,["icon"]),e[18]||(e[18]=t("div",{class:"flex flex-col"},[t("span",null,"¬°Tienes informaci√≥n sin guardar!"),t("span",{class:"text-red-600 text-sm font-medium mt-1"},"¬øDeseas salir sin guardar?")],-1))])]),_:1},8,["visible","style"])])])]),_:1})}}};export{da as default};
