import{r as b,E as oe,w as T,a6 as re,h as ie,d as o,x as j,c as r,j as g,e as a,t as u,y,q as A,F as q,l as H,p as k,$ as c,v as U,a9 as B,I as ne,A as de,N as O}from"./vendor-gbh1WW5n.js";import{z as ue,F as _,q as Z,g as ce}from"./ui-BrU4k96Z.js";import{G as me,i as ve,c as be,a as pe,o as fe}from"./index-CZ1H-pGg.js";import{_ as ge}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ye={key:0,class:"space-y-6"},xe={class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},he={class:"text-lg font-semibold text-blue-800 mb-2"},Ae={class:"grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm"},we={class:"ml-2"},Ee={class:"ml-2"},Re={class:"ml-2"},De={class:"space-y-3"},Ce={class:"grid grid-cols-1 sm:grid-cols-2 gap-3"},ke=["onClick"],Se={class:"flex items-start gap-3"},Fe={key:0,class:"w-full h-full rounded-full bg-white transform scale-50"},Me={class:"flex-1 min-w-0"},Oe={class:"text-xs text-gray-500 mt-1 leading-tight"},_e={key:0,class:"text-red-500"},Ne={key:0,class:"bg-purple-50 border border-purple-200 rounded-lg p-4 space-y-4"},Le={class:"flex items-center gap-2 mb-4"},ze={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},Pe={key:0,class:"text-red-500"},$e={key:0,class:"text-red-500"},Ie={class:"grid grid-cols-1 sm:grid-cols-2 gap-2 mb-3"},Ve=["onClick"],Ge={key:0,class:"text-red-500"},Te={class:"text-gray-500"},je={key:1,class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},qe={class:"flex items-start gap-3"},He={class:"text-sm text-yellow-700 mt-1"},Ue={key:0},Be={class:"flex justify-center gap-4 w-full mt-6"},Ze=["disabled"],Xe={key:0},Ye={key:1},Je=["disabled"],Ke={__name:"CambiarEstado",props:{visible:{type:Boolean,default:!1},tour:{type:Object,default:()=>({})},dialogStyle:{type:Object,default:()=>({})}},emits:["update:visible","estadoActualizado"],setup(n,{emit:X}){const i=n,N=X,x=ue(),R=b([{label:"Disponible",value:"DISPONIBLE",descripcion:"El tour está disponible para reservas",color:"text-green-600",disponible:!0},{label:"Completo",value:"COMPLETO",descripcion:"No hay cupos disponibles",color:"text-red-600",disponible:!0},{label:"En Curso",value:"EN_CURSO",descripcion:"El tour está en desarrollo",color:"text-blue-600",disponible:!0},{label:"Finalizado",value:"FINALIZADO",descripcion:"El tour ha finalizado exitosamente y se notificará a los clientes",color:"text-gray-600",disponible:!0},{label:"Cancelada",value:"CANCELADA",descripcion:"El tour será cancelado y se notificará a todos los clientes con reservas",color:"text-red-600",disponible:!0},{label:"Reprogramada",value:"REPROGRAMADA",descripcion:"El tour ha sido reprogramado a una nueva fecha",color:"text-purple-600",disponible:!0}]),l=b(null),L=b(!1),d=b(null),p=b(null),v=b(""),h=b(""),w=b(!1),f=b(!1),z=oe({get:()=>i.visible,set:s=>N("update:visible",s)});T([()=>i.visible,()=>i.tour],()=>{i.visible&&i.tour?(P(),document.body.style.overflow="hidden"):document.body.style.overflow="auto"}),T(l,s=>{L.value=s==="REPROGRAMADA",s!=="REPROGRAMADA"&&(d.value=null,p.value=null,v.value="",h.value="")}),re(()=>{document.body.style.overflow="auto"});const Y=b(["Condiciones climáticas adversas","Problemas de transporte","Falta de cupo mínimo","Solicitud de clientes","Mantenimiento de instalaciones","Emergencia sanitaria","Otro motivo"]),P=()=>{var s;l.value=((s=i.tour)==null?void 0:s.estado)||null,L.value=!1,d.value=null,p.value=null,v.value="",h.value="",f.value=!1},$=()=>{P(),document.body.style.overflow="auto",N("update:visible",!1)},J=()=>{if(!l.value)return x.add({severity:"warn",summary:"Campos requeridos",detail:"Debes seleccionar un estado.",life:4e3}),!1;if(l.value==="REPROGRAMADA"){if(!d.value)return x.add({severity:"warn",summary:"Campos requeridos",detail:"Debes seleccionar una nueva fecha de salida.",life:4e3}),!1;if(!p.value)return x.add({severity:"warn",summary:"Campos requeridos",detail:"Debes seleccionar una nueva fecha de regreso.",life:4e3}),!1;if(!v.value.trim())return x.add({severity:"warn",summary:"Campos requeridos",detail:"Debes especificar el motivo de la reprogramación.",life:4e3}),!1;const s=new Date;if(d.value<s)return x.add({severity:"warn",summary:"Fecha inválida",detail:"La nueva fecha de salida debe ser futura.",life:4e3}),!1;if(p.value<=d.value)return x.add({severity:"warn",summary:"Fecha inválida",detail:"La fecha de regreso debe ser posterior a la fecha de salida.",life:4e3}),!1}return!0},K=async s=>{var e,E,S,F,M;if(s&&(s.preventDefault(),s.stopPropagation()),f.value=!0,!!J()){w.value=!0;try{const t={estado:l.value};let m;if(l.value==="FINALIZADO"){const D={observaciones:h.value||""};m=await O.put(`/api/tours/${i.tour.id}/finalizar`,D)}else if(l.value==="CANCELADA")t.motivo_cancelacion=h.value||"Tour cancelado por el administrador",t.cancelar_reservas=!0,m=await O.put(`/api/tours/${i.tour.id}/cambiar-estado`,t);else if(l.value==="REPROGRAMADA"){const D=C=>{const W=C.getFullYear(),ee=String(C.getMonth()+1).padStart(2,"0"),ae=String(C.getDate()).padStart(2,"0"),te=String(C.getHours()).padStart(2,"0"),le=String(C.getMinutes()).padStart(2,"0"),se=String(C.getSeconds()).padStart(2,"0");return`${W}-${ee}-${ae} ${te}:${le}:${se}`};t.fecha_salida=D(d.value),t.fecha_regreso=D(p.value),t.motivo_reprogramacion=v.value,t.observaciones=h.value,m=await O.put(`/api/tours/${i.tour.id}/cambiar-estado`,t)}else m=await O.put(`/api/tours/${i.tour.id}/cambiar-estado`,t);const G=m.data.tour||{...i.tour,estado:l.value,fecha_salida:l.value==="REPROGRAMADA"?t.fecha_salida:i.tour.fecha_salida,fecha_regreso:l.value==="REPROGRAMADA"?t.fecha_regreso:i.tour.fecha_regreso};N("estadoActualizado",G),x.add({severity:"success",summary:"¡Estado actualizado!",detail:l.value==="REPROGRAMADA"?"El tour ha sido reprogramado correctamente.":l.value==="FINALIZADO"?"El tour ha sido finalizado correctamente.":l.value==="CANCELADA"?"El tour ha sido cancelado y se notificó a todos los clientes.":`El estado del tour ha sido cambiado a ${(e=R.value.find(D=>D.value===l.value))==null?void 0:e.label}.`,life:4e3}),$()}catch(t){let m="No se pudo cambiar el estado del tour.";(S=(E=t.response)==null?void 0:E.data)!=null&&S.message?m=t.response.data.message:(M=(F=t.response)==null?void 0:F.data)!=null&&M.errors&&(m=Object.values(t.response.data.errors).flat().join(", ")),x.add({severity:"error",summary:"Error",detail:m,life:4e3})}finally{w.value=!1}}},I=()=>{const s=new Date;return s.setHours(s.getHours()+1),s},Q=()=>{if(!d.value)return I();const s=new Date(d.value);return s.setHours(s.getHours()+1),s},V=s=>{if(!s)return"N/A";const e=new Date(s);return isNaN(e.getTime())?"Fecha inválida":e.getHours()===0&&e.getMinutes()===0?e.toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"})+" (Sin hora especificada)":e.toLocaleString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})};return(s,e)=>(o(),ie(c(ce),{visible:z.value,"onUpdate:visible":e[4]||(e[4]=E=>z.value=E),header:"Cambiar Estado del Tour",modal:!0,style:de(n.dialogStyle),closable:!1,draggable:!1},{footer:j(()=>[a("div",Be,[a("button",{type:"button",class:"bg-red-500 hover:bg-red-700 text-white border-none px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",onClick:ne(K,["prevent"]),disabled:w.value||!l.value},[k(c(_),{icon:w.value?c(be):c(pe),class:y(["h-5 text-white",{"animate-spin":w.value}])},null,8,["icon","class"]),w.value?(o(),r("span",Ye,u(l.value==="REPROGRAMADA"?"Reprogramando...":"Actualizando..."),1)):(o(),r("span",Xe,"Cambiar Estado"))],8,Ze),a("button",{type:"button",class:"bg-blue-500 hover:bg-blue-700 text-white px-9 sm:px-12 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",onClick:$,disabled:w.value},[k(c(_),{icon:c(fe),class:"h-5 text-white"},null,8,["icon"]),e[22]||(e[22]=A(" Cancelar "))],8,Je)])]),default:j(()=>{var E,S,F,M;return[n.tour?(o(),r("div",ye,[a("div",xe,[a("h4",he,u(n.tour.nombre),1),a("div",Ae,[a("div",null,[e[5]||(e[5]=a("span",{class:"font-medium text-gray-700"},"Estado actual:",-1)),a("span",{class:y([((E=R.value.find(t=>t.value===n.tour.estado))==null?void 0:E.color)||"text-gray-600","ml-2 font-semibold"])},u(((S=R.value.find(t=>t.value===n.tour.estado))==null?void 0:S.label)||n.tour.estado),3)]),a("div",null,[e[6]||(e[6]=a("span",{class:"font-medium text-gray-700"},"Categoría:",-1)),a("span",we,u(n.tour.categoria),1)]),a("div",null,[e[7]||(e[7]=a("span",{class:"font-medium text-gray-700"},"Salida:",-1)),a("span",Ee,u(V(n.tour.fecha_salida)),1)]),a("div",null,[e[8]||(e[8]=a("span",{class:"font-medium text-gray-700"},"Regreso:",-1)),a("span",Re,u(V(n.tour.fecha_regreso)),1)])])]),a("div",De,[e[9]||(e[9]=a("label",{class:"block text-sm font-semibold text-gray-700"},[A(" Nuevo Estado "),a("span",{class:"text-red-500"},"*")],-1)),e[10]||(e[10]=a("div",{class:"text-xs text-gray-500 mb-3"},"Selecciona el nuevo estado para el tour",-1)),a("div",Ce,[(o(!0),r(q,null,H(R.value,t=>(o(),r("button",{key:t.value,type:"button",class:y(["w-full p-3 rounded-lg border-2 transition-all duration-200 ease-in-out text-left",l.value===t.value?"border-blue-500 bg-blue-50 shadow-md":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"]),onClick:m=>l.value=t.value},[a("div",Se,[a("div",{class:y(["w-4 h-4 rounded-full border-2 flex-shrink-0 mt-0.5",l.value===t.value?"border-blue-500 bg-blue-500":"border-gray-300"])},[l.value===t.value?(o(),r("div",Fe)):g("",!0)],2),a("div",Me,[a("div",{class:y([t.color,"font-medium text-sm"])},u(t.label),3),a("div",Oe,u(t.descripcion),1)])])],10,ke))),128))]),f.value&&!l.value?(o(),r("small",_e," Debes seleccionar un estado. ")):g("",!0)]),L.value?(o(),r("div",Ne,[a("div",Le,[k(c(_),{icon:c(me),class:"text-purple-600"},null,8,["icon"]),e[11]||(e[11]=a("h5",{class:"text-lg font-semibold text-purple-800"},"Datos de Reprogramación",-1))]),a("div",ze,[a("div",null,[e[12]||(e[12]=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[A(" Nueva Fecha de Salida "),a("span",{class:"text-red-500"},"*")],-1)),k(c(Z),{modelValue:d.value,"onUpdate:modelValue":e[0]||(e[0]=t=>d.value=t),showTime:"",showIcon:"",dateFormat:"dd/mm/yy",timeFormat:"12",hourFormat:"12",minDate:I(),placeholder:"Selecciona fecha y hora (AM/PM)",class:y(["w-full",{"p-invalid":f.value&&!d.value}])},null,8,["modelValue","minDate","class"]),f.value&&!d.value?(o(),r("small",Pe," La nueva fecha de salida es obligatoria. ")):g("",!0)]),a("div",null,[e[13]||(e[13]=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[A(" Nueva Fecha de Regreso "),a("span",{class:"text-red-500"},"*")],-1)),k(c(Z),{modelValue:p.value,"onUpdate:modelValue":e[1]||(e[1]=t=>p.value=t),showTime:"",showIcon:"",dateFormat:"dd/mm/yy",timeFormat:"12",hourFormat:"12",minDate:Q(),placeholder:"Selecciona fecha y hora (AM/PM)",class:y(["w-full",{"p-invalid":f.value&&!p.value}])},null,8,["modelValue","minDate","class"]),f.value&&!p.value?(o(),r("small",$e," La nueva fecha de regreso es obligatoria. ")):g("",!0)])]),a("div",null,[e[15]||(e[15]=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[A(" Motivo de la Reprogramación "),a("span",{class:"text-red-500"},"*")],-1)),e[16]||(e[16]=a("div",{class:"text-xs text-gray-500 mb-3"},"Selecciona un motivo predefinido o escribe uno personalizado",-1)),a("div",Ie,[(o(!0),r(q,null,H(Y.value,t=>(o(),r("button",{key:t,type:"button",class:y(["text-left p-2 rounded-md border transition-all duration-200 ease-in-out text-sm",v.value===t?"border-purple-500 bg-purple-50 text-purple-800":"border-gray-200 hover:border-gray-300 hover:bg-gray-50 text-gray-700"]),onClick:m=>v.value=t},u(t),11,Ve))),128))]),a("div",null,[e[14]||(e[14]=a("label",{class:"block text-xs font-medium text-gray-600 mb-1"}," Motivo personalizado: ",-1)),U(a("textarea",{"onUpdate:modelValue":e[2]||(e[2]=t=>v.value=t),rows:"2",placeholder:"Escribe un motivo personalizado...",class:y(["w-full p-2 border border-gray-300 rounded-md text-sm focus:ring-purple-500 focus:border-purple-500",{"border-red-500":f.value&&!v.value.trim()}]),maxlength:"255"},null,2),[[B,v.value]])]),f.value&&!v.value.trim()?(o(),r("small",Ge," El motivo es obligatorio. ")):g("",!0)]),a("div",null,[e[17]||(e[17]=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Observaciones Adicionales ",-1)),U(a("textarea",{"onUpdate:modelValue":e[3]||(e[3]=t=>h.value=t),rows:"3",placeholder:"Agrega cualquier observación adicional...",class:"w-full p-2 border border-gray-300 rounded-md text-sm focus:ring-purple-500 focus:border-purple-500",maxlength:"500"},null,512),[[B,h.value]]),a("small",Te,u(h.value.length)+"/500 caracteres ",1)])])):g("",!0),l.value&&l.value!==n.tour.estado?(o(),r("div",je,[a("div",qe,[k(c(_),{icon:c(ve),class:"text-yellow-600 mt-1"},null,8,["icon"]),a("div",null,[e[21]||(e[21]=a("h5",{class:"font-medium text-yellow-800"},"Confirmación de cambio",-1)),a("p",He,[e[18]||(e[18]=A(" Estás a punto de cambiar el estado del tour de ")),a("strong",null,u((F=R.value.find(t=>t.value===n.tour.estado))==null?void 0:F.label),1),e[19]||(e[19]=A(" a ")),a("strong",null,u((M=R.value.find(t=>t.value===l.value))==null?void 0:M.label),1),e[20]||(e[20]=A(". ")),l.value==="REPROGRAMADA"?(o(),r("span",Ue," Esto actualizará las fechas del tour y notificará a los clientes con reservas. ")):g("",!0)])])])])):g("",!0)])):g("",!0)]}),_:1},8,["visible","style"]))}},ta=ge(Ke,[["__scopeId","data-v-a27281b5"]]);export{ta as default};
