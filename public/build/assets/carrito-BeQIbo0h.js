import{d as S}from"./app-Myg8lxFC.js";import{r,a4 as x,E as d}from"./vendor-CqKcGHPa.js";const z=S("carrito",()=>{const s=r([]),i=r(!1),g=x(),n=r(0),o=r(0),f=d(()=>s.value.reduce((a,e)=>a+e.cantidad,0)),v=d(()=>s.value.reduce((a,e)=>a+e.precio*e.cantidad,0)),p=d(()=>s.value.length===0),C=a=>{const e=s.value.find(c=>c.id===a.id),t=a.cantidadSeleccionada||1;if(e){const c=e.cantidad+t;return c<=e.stock_actual?(e.cantidad=c,n.value=t,o.value++,{success:!0,message:t===1?"Producto agregado al carrito":`${t} productos agregados al carrito`}):{success:!1,message:"No hay suficiente stock disponible"}}else return a.stock_actual>=t?(s.value.push({id:a.id,nombre:a.nombre,precio:a.precio,imagen:a.imagen,stock_actual:a.stock_actual,cantidad:t}),n.value=t,o.value++,{success:!0,message:t===1?"Producto agregado al carrito":`${t} productos agregados al carrito`}):{success:!1,message:"No hay suficiente stock disponible"}},u=a=>{const e=s.value.findIndex(t=>t.id===a);e>-1&&s.value.splice(e,1)},h=(a,e)=>{const t=s.value.find(c=>c.id===a);return t?e<=0?(u(a),{success:!0,message:"Producto eliminado del carrito"}):e<=t.stock_actual?(t.cantidad=e,{success:!0,message:"Cantidad actualizada"}):{success:!1,message:`Solo hay ${t.stock_actual} unidades disponibles`}:{success:!1,message:"Producto no encontrado en el carrito"}},k=a=>{const e=s.value.find(t=>t.id===a);return e?e.cantidad<e.stock_actual?(e.cantidad+=1,{success:!0,message:"Cantidad incrementada"}):{success:!1,message:"No hay suficiente stock disponible"}:{success:!1,message:"Producto no encontrado en el carrito"}},y=a=>{const e=s.value.find(t=>t.id===a);e&&(e.cantidad<=1?u(a):e.cantidad-=1)},b=()=>{s.value=[]},l=()=>{s.value=[],i.value=!1},P=()=>{var t;const a=(t=g.props.auth)==null?void 0:t.user,e=s.value.length>0;!a&&e&&l()},_=()=>{i.value=!i.value},A=()=>{i.value=!0},I=()=>{i.value=!1},m=a=>s.value.find(e=>e.id===a);return{items:s,isVisible:i,itemCount:f,totalPrice:v,isEmpty:p,agregarProducto:C,eliminarProducto:u,actualizarCantidad:h,incrementarCantidad:k,decrementarCantidad:y,limpiarCarrito:b,limpiarCarritoAlCerrarSesion:l,toggleVisibility:_,mostrarCarrito:A,ocultarCarrito:I,getItem:m,hasItem:a=>s.value.some(e=>e.id===a),getItemQuantity:a=>{const e=m(a);return e?e.cantidad:0},verificarEstadoAutenticacion:P,lastAddedQuantity:n,triggerAnimation:o}});export{z as u};
