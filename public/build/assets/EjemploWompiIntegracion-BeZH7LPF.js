import{z as T}from"./ui-BibPgP1I.js";import{r as g,E as z,o as L,c as y,d as v,e,j as S,t as u,v as D,a5 as B,a9 as q,q as R,y as N,N as W,n as U,p as V,$ as E,F,l as H}from"./vendor-BOi6Gr0G.js";import{_ as M}from"./_plugin-vue_export-helper-DlAUqK2U.js";const K={class:"wompi-payment-widget"},J={key:0,class:"text-center py-8"},G={key:1,class:"payment-form"},Q={class:"mb-6"},X={class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},Y={class:"flex justify-between items-center"},Z={class:"text-2xl font-bold text-blue-600"},ee={key:0,class:"text-sm text-gray-600 mt-1"},te={class:"mb-6 space-y-4"},se={class:"mb-6"},oe={class:"flex items-start space-x-3"},ae={class:"flex space-x-4"},re=["disabled"],ne={key:0,class:"flex items-center justify-center"},ie={key:1},le={key:2,class:"payment-result text-center py-8"},de={key:0,class:"success"},ce={class:"bg-green-50 border border-green-200 rounded-lg p-4 mb-4"},ue={class:"text-sm text-green-800"},me={class:"text-sm text-green-800"},pe={key:1,class:"error"},ge={class:"text-gray-600 mb-4"},ye={class:"flex space-x-4 justify-center"},ve={__name:"WompiPaymentWidget",props:{amount:{type:Number,required:!0},currency:{type:String,default:"COP"},type:{type:String,required:!0,validator:o=>["venta","reserva"].includes(o)},itemId:{type:Number,required:!0},description:{type:String,default:""}},emits:["success","error","cancel"],setup(o,{emit:x}){const r=o,p=T(),P=g(!0),_=g(!1),d=g(!1),n=g(""),C=g(!1),w=g(null),$=g(null),m=g(null),h=g(""),s=z(()=>new Intl.NumberFormat("es-CO",{style:"currency",currency:r.currency}).format(r.amount)),k=z(()=>!_.value&&n.value&&C.value&&m.value),a=async()=>{try{const l=await W.get("/api/wompi/config");$.value=l.data;try{const t=await W.get("/api/wompi/acceptance-token");h.value=t.data.acceptance_token}catch(t){console.warn("Usando token de prueba:",t.message),h.value="sandbox_acceptance_token"}await i()}catch(l){console.error("Error cargando configuración de Wompi:",l),p.add({severity:"error",summary:"Error",detail:"No se pudo cargar el formulario de pago",life:5e3})}},i=async()=>{try{window.WidgetCheckout||await b(),await U(),m.value=new window.WidgetCheckout({currency:r.currency,amountInCents:Math.round(r.amount*100),reference:`${r.type.toUpperCase()}_${r.itemId}_${Date.now()}`,publicKey:$.value.public_key,redirectUrl:window.location.origin+"/payment/success"}),m.value.render("wompi-widget-container"),P.value=!1}catch(l){console.error("Error inicializando widget de Wompi:",l),p.add({severity:"error",summary:"Error",detail:"No se pudo inicializar el formulario de pago",life:5e3})}},b=()=>new Promise((l,t)=>{if(window.WidgetCheckout){l();return}const c=document.createElement("script");c.src=$.value.widget_url,c.onload=l,c.onerror=t,document.head.appendChild(c)}),j=async()=>{var l,t;if(k.value){_.value=!0;try{const c=await m.value.createToken();if(!c||c.status!=="CREATED")throw new Error("No se pudo procesar la información de la tarjeta");const A={[`${r.type}_id`]:r.itemId,token:c.id,customer_email:n.value,acceptance_token:h.value},I=await W.post(`/api/pagos/${r.type}`,A);if(I.data.success)w.value={success:!0,reference:I.data.pago.referencia_wompi,data:I.data},p.add({severity:"success",summary:"Pago Exitoso",detail:"Tu pago ha sido procesado correctamente",life:5e3});else throw new Error(I.data.message||"Error procesando el pago")}catch(c){console.error("Error procesando pago:",c),w.value={success:!1,message:((t=(l=c.response)==null?void 0:l.data)==null?void 0:t.message)||c.message||"Error procesando el pago"},p.add({severity:"error",summary:"Error en el Pago",detail:w.value.message,life:5e3})}finally{_.value=!1,d.value=!0}}},f=()=>{d.value=!1,w.value=null,_.value=!1,m.value&&m.value.render("wompi-widget-container")};return L(()=>{a()}),(l,t)=>(v(),y("div",K,[P.value?(v(),y("div",J,t[5]||(t[5]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"},null,-1),e("p",{class:"mt-4 text-gray-600"},"Cargando formulario de pago...",-1)]))):d.value?(v(),y("div",le,[w.value.success?(v(),y("div",de,[t[14]||(t[14]=e("div",{class:"text-green-600 text-6xl mb-4"},"✓",-1)),t[15]||(t[15]=e("h3",{class:"text-2xl font-bold text-green-600 mb-2"},"¡Pago Exitoso!",-1)),t[16]||(t[16]=e("p",{class:"text-gray-600 mb-4"},"Tu pago ha sido procesado correctamente.",-1)),e("div",ce,[e("p",ue,[t[12]||(t[12]=e("strong",null,"Referencia:",-1)),R(" "+u(w.value.reference),1)]),e("p",me,[t[13]||(t[13]=e("strong",null,"Monto:",-1)),R(" "+u(s.value),1)])]),e("button",{onClick:t[3]||(t[3]=c=>l.$emit("success",w.value)),class:"bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-md font-medium"}," Continuar ")])):(v(),y("div",pe,[t[17]||(t[17]=e("div",{class:"text-red-600 text-6xl mb-4"},"✗",-1)),t[18]||(t[18]=e("h3",{class:"text-2xl font-bold text-red-600 mb-2"},"Error en el Pago",-1)),e("p",ge,u(w.value.message),1),e("div",ye,[e("button",{onClick:f,class:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-md font-medium"}," Intentar de Nuevo "),e("button",{onClick:t[4]||(t[4]=c=>l.$emit("error",w.value)),class:"bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-md font-medium"}," Cancelar ")])]))])):(v(),y("div",G,[e("div",Q,[t[7]||(t[7]=e("h3",{class:"text-xl font-semibold text-gray-800 mb-2"},"Procesar Pago",-1)),e("div",X,[e("div",Y,[t[6]||(t[6]=e("span",{class:"text-gray-700"},"Total a pagar:",-1)),e("span",Z,u(s.value),1)]),o.description?(v(),y("div",ee,u(o.description),1)):S("",!0)])]),e("div",te,[e("div",null,[t[8]||(t[8]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Email del cliente * ",-1)),D(e("input",{"onUpdate:modelValue":t[0]||(t[0]=c=>n.value=c),type:"email",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"cliente@ejemplo.com"},null,512),[[B,n.value]])])]),t[11]||(t[11]=e("div",{class:"mb-6"},[e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Información de la tarjeta "),e("div",{id:"wompi-widget-container",class:"border border-gray-300 rounded-md p-4"})],-1)),e("div",se,[e("label",oe,[D(e("input",{"onUpdate:modelValue":t[1]||(t[1]=c=>C.value=c),type:"checkbox",class:"mt-1 h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"},null,512),[[q,C.value]]),t[9]||(t[9]=e("span",{class:"text-sm text-gray-700"},[R(" Acepto los "),e("a",{href:"#",class:"text-blue-600 hover:underline"},"términos y condiciones"),R(" y autorizo el procesamiento de mis datos para realizar este pago. ")],-1))])]),e("div",ae,[e("button",{onClick:j,disabled:!k.value,class:N(["flex-1 py-3 px-4 rounded-md font-medium transition-colors",k.value?"bg-blue-600 hover:bg-blue-700 text-white":"bg-gray-300 text-gray-500 cursor-not-allowed"])},[_.value?(v(),y("span",ne,t[10]||(t[10]=[e("svg",{class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),R(" Procesando... ")]))):(v(),y("span",ie,"Procesar Pago"))],10,re),e("button",{onClick:t[2]||(t[2]=c=>l.$emit("cancel")),class:"px-6 py-3 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 transition-colors"}," Cancelar ")])]))]))}},be=M(ve,[["__scopeId","data-v-13e9b413"]]),fe={class:"wompi-pay-button"},xe=["disabled"],we={key:0,class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},he={key:0,class:"fixed inset-0 z-50 overflow-y-auto"},_e={class:"flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},ke={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"},Pe={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},Ce={__name:"WompiPayButton",props:{amount:{type:Number,required:!0},currency:{type:String,default:"COP"},type:{type:String,required:!0,validator:o=>["venta","reserva"].includes(o)},itemId:{type:Number,required:!0},description:{type:String,default:""},buttonText:{type:String,default:"Pagar con Tarjeta"},disabled:{type:Boolean,default:!1}},emits:["payment-success","payment-error"],setup(o,{emit:x}){const r=o,p=x,P=T(),_=g(!1),d=()=>{r.disabled||(_.value=!0)},n=()=>{_.value=!1},C=$=>{n(),p("payment-success",$),P.add({severity:"success",summary:"Pago Exitoso",detail:"¡Tu pago ha sido procesado correctamente!",life:5e3})},w=$=>{p("payment-error",$)};return($,m)=>(v(),y("div",fe,[e("button",{onClick:d,disabled:o.disabled,class:N(["inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md transition-colors",o.disabled?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"])},[o.disabled?S("",!0):(v(),y("svg",we,m[0]||(m[0]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"},null,-1)]))),R(" "+u(o.buttonText),1)],10,xe),_.value?(v(),y("div",he,[e("div",_e,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:n}),e("div",ke,[e("div",Pe,[e("div",{class:"flex items-start justify-between mb-4"},[m[2]||(m[2]=e("h3",{class:"text-lg leading-6 font-medium text-gray-900"}," Pagar con Tarjeta ",-1)),e("button",{onClick:n,class:"text-gray-400 hover:text-gray-600 focus:outline-none"},m[1]||(m[1]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),V(be,{amount:o.amount,currency:o.currency,type:o.type,"item-id":o.itemId,description:o.description,onSuccess:C,onError:w,onCancel:n},null,8,["amount","currency","type","item-id","description"])])])])])):S("",!0)]))}},O=M(Ce,[["__scopeId","data-v-a9821957"]]);function $e(){const o=T(),x=g(!1),r=g(null),p=g(""),P=z(()=>r.value&&p.value),_=async()=>{if(!P.value){x.value=!0;try{const a=await W.get("/api/wompi/config");r.value=a.data;try{const i=await W.get("/api/wompi/acceptance-token");p.value=i.data.acceptance_token}catch(i){console.warn("Token de aceptación no disponible (normal en pruebas):",i.message),p.value="sandbox_acceptance_token"}await d()}catch(a){throw console.error("Error inicializando Wompi:",a),o.add({severity:"error",summary:"Error de Configuración",detail:"No se pudo cargar la configuración de pagos",life:5e3}),a}finally{x.value=!1}}},d=()=>new Promise((a,i)=>{if(window.WidgetCheckout){a();return}const b=document.createElement("script");b.src=r.value.widget_url,b.onload=a,b.onerror=i,document.head.appendChild(b)});return{loading:x,wompiConfig:r,acceptanceToken:p,isReady:P,initializeWompi:_,processVentaPayment:async(a,i)=>{var b,j;try{x.value=!0;const f=await W.post("/api/pagos/venta",{venta_id:a,...i});if(f.data.success)return o.add({severity:"success",summary:"Pago Exitoso",detail:"El pago de la venta ha sido procesado correctamente",life:5e3}),{success:!0,data:f.data};throw new Error(f.data.message||"Error procesando el pago")}catch(f){const l=((j=(b=f.response)==null?void 0:b.data)==null?void 0:j.message)||f.message||"Error procesando el pago";return o.add({severity:"error",summary:"Error en el Pago",detail:l,life:5e3}),{success:!1,message:l}}finally{x.value=!1}},processReservaPayment:async(a,i)=>{var b,j;try{x.value=!0;const f=await W.post("/api/pagos/reserva",{reserva_id:a,...i});if(f.data.success)return o.add({severity:"success",summary:"Pago Exitoso",detail:"El pago de la reserva ha sido procesado correctamente",life:5e3}),{success:!0,data:f.data};throw new Error(f.data.message||"Error procesando el pago")}catch(f){const l=((j=(b=f.response)==null?void 0:b.data)==null?void 0:j.message)||f.message||"Error procesando el pago";return o.add({severity:"error",summary:"Error en el Pago",detail:l,life:5e3}),{success:!1,message:l}}finally{x.value=!1}},checkPaymentStatus:async a=>{try{return(await W.get(`/api/pagos/${a}/estado`)).data}catch(i){return console.error("Error consultando estado del pago:",i),o.add({severity:"error",summary:"Error",detail:"No se pudo consultar el estado del pago",life:3e3}),null}},formatAmount:(a,i="COP")=>new Intl.NumberFormat("es-CO",{style:"currency",currency:i}).format(a),toAmountInCents:a=>Math.round(a*100),generateReference:(a,i)=>`${a.toUpperCase()}_${i}_${Date.now()}`,isValidEmail:a=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a),getPublicConfig:()=>{var a,i,b;return{publicKey:(a=r.value)==null?void 0:a.public_key,sandbox:(i=r.value)==null?void 0:i.sandbox,widgetUrl:(b=r.value)==null?void 0:b.widget_url}}}}const Ee={class:"container mx-auto px-4 py-8"},We={class:"max-w-2xl mx-auto"},je={class:"bg-white rounded-lg shadow-md p-6 mb-8"},Re={class:"bg-gray-50 rounded-lg p-4 mb-4"},Ie={class:"flex justify-between items-center mb-2"},Se={class:"font-mono"},Te={class:"flex justify-between items-center mb-2"},ze={class:"flex justify-between items-center"},Ve={class:"text-xl font-bold text-blue-600"},Ne={class:"bg-white rounded-lg shadow-md p-6 mb-8"},Me={class:"bg-gray-50 rounded-lg p-4 mb-4"},De={class:"flex justify-between items-center mb-2"},Oe={class:"font-mono"},Le={class:"flex justify-between items-center mb-2"},Ae={class:"flex justify-between items-center mb-2"},Be={class:"flex justify-between items-center"},qe={class:"text-xl font-bold text-green-600"},Ue={class:"bg-white rounded-lg shadow-md p-6 mb-8"},Fe={class:"bg-gray-50 rounded-lg p-4 mb-4"},He={class:"flex items-center space-x-4"},Ke={class:"flex items-center"},Je={class:"text-sm font-medium"},Ge=["disabled"],Qe={key:0,class:"bg-white rounded-lg shadow-md p-6"},Xe={class:"space-y-3"},Ye={class:"flex justify-between items-start"},Ze={class:"font-semibold"},et={class:"text-sm text-gray-600"},tt={class:"text-sm text-gray-500"},st={class:"text-right"},ot={class:"font-bold text-green-600"},at={__name:"EjemploWompiIntegracion",setup(o){const x=T(),{loading:r,isReady:p,initializeWompi:P,formatAmount:_}=$e(),d=g({id:1001,cliente:"Juan Pérez",total:15e4,descripcion:"3 productos diversos"}),n=g({id:2001,tour:"Tour Cartagena Colonial",fecha:"2025-12-15",total:25e4}),C=g([]),w=h=>{x.add({severity:"success",summary:"Venta Pagada",detail:`La venta #${d.value.id} ha sido pagada exitosamente`,life:8e3}),C.value.push({id:Date.now(),type:"Venta",itemId:d.value.id,description:d.value.descripcion,amount:d.value.total,timestamp:new Date().toLocaleString("es-CO"),result:h}),console.log("Pago de venta exitoso:",h)},$=h=>{x.add({severity:"success",summary:"Reserva Pagada",detail:`La reserva #${n.value.id} ha sido pagada exitosamente`,life:8e3}),C.value.push({id:Date.now(),type:"Reserva",itemId:n.value.id,description:n.value.tour,amount:n.value.total,timestamp:new Date().toLocaleString("es-CO"),result:h}),console.log("Pago de reserva exitoso:",h)},m=h=>{x.add({severity:"error",summary:"Error en el Pago",detail:h.message||"Ocurrió un error procesando el pago",life:8e3}),console.error("Error en el pago:",h)};return L(()=>{P()}),(h,s)=>(v(),y("div",Ee,[e("div",We,[s[14]||(s[14]=e("h1",{class:"text-3xl font-bold text-gray-800 mb-8 text-center"}," Ejemplo de Integración - Pagos con Wompi ",-1)),e("div",je,[s[4]||(s[4]=e("h2",{class:"text-xl font-semibold text-gray-800 mb-4"}," 💰 Pago para Venta ",-1)),e("div",Re,[e("div",Ie,[s[1]||(s[1]=e("span",{class:"text-gray-600"},"Venta ID:",-1)),e("span",Se,"#"+u(d.value.id),1)]),e("div",Te,[s[2]||(s[2]=e("span",{class:"text-gray-600"},"Cliente:",-1)),e("span",null,u(d.value.cliente),1)]),e("div",ze,[s[3]||(s[3]=e("span",{class:"text-gray-600"},"Total:",-1)),e("span",Ve," $"+u(d.value.total.toLocaleString())+" COP ",1)])]),V(O,{amount:d.value.total,currency:"COP",type:"venta","item-id":d.value.id,description:`Venta #${d.value.id} - ${d.value.descripcion}`,"button-text":"💳 Pagar Venta",onPaymentSuccess:w,onPaymentError:m},null,8,["amount","item-id","description"])]),e("div",Ne,[s[9]||(s[9]=e("h2",{class:"text-xl font-semibold text-gray-800 mb-4"}," 🏨 Pago para Reserva ",-1)),e("div",Me,[e("div",De,[s[5]||(s[5]=e("span",{class:"text-gray-600"},"Reserva ID:",-1)),e("span",Oe,"#"+u(n.value.id),1)]),e("div",Le,[s[6]||(s[6]=e("span",{class:"text-gray-600"},"Tour:",-1)),e("span",null,u(n.value.tour),1)]),e("div",Ae,[s[7]||(s[7]=e("span",{class:"text-gray-600"},"Fecha:",-1)),e("span",null,u(n.value.fecha),1)]),e("div",Be,[s[8]||(s[8]=e("span",{class:"text-gray-600"},"Total:",-1)),e("span",qe," $"+u(n.value.total.toLocaleString())+" COP ",1)])]),V(O,{amount:n.value.total,currency:"COP",type:"reserva","item-id":n.value.id,description:`Reserva #${n.value.id} - ${n.value.tour}`,"button-text":"🎫 Pagar Reserva",onPaymentSuccess:$,onPaymentError:m},null,8,["amount","item-id","description"])]),e("div",Ue,[s[11]||(s[11]=e("h2",{class:"text-xl font-semibold text-gray-800 mb-4"}," 🔧 Uso del Composable ",-1)),e("div",Fe,[s[10]||(s[10]=e("p",{class:"text-gray-600 mb-4"}," Estado de la inicialización de Wompi: ",-1)),e("div",He,[e("div",Ke,[e("div",{class:N(["w-3 h-3 rounded-full mr-2",E(r)?"bg-yellow-500":E(p)?"bg-green-500":"bg-red-500"])},null,2),e("span",Je,u(E(r)?"Cargando...":E(p)?"Listo":"No disponible"),1)]),e("button",{onClick:s[0]||(s[0]=(...k)=>E(P)&&E(P)(...k)),disabled:E(r)||E(p),class:"px-4 py-2 bg-blue-600 text-white rounded disabled:bg-gray-400"}," Inicializar Wompi ",8,Ge)])])]),C.value.length>0?(v(),y("div",Qe,[s[13]||(s[13]=e("h2",{class:"text-xl font-semibold text-gray-800 mb-4"}," 📋 Pagos Realizados en esta Sesión ",-1)),e("div",Xe,[(v(!0),y(F,null,H(C.value,k=>(v(),y("div",{key:k.id,class:"border border-gray-200 rounded-lg p-4"},[e("div",Ye,[e("div",null,[e("p",Ze,u(k.type)+" #"+u(k.itemId),1),e("p",et,u(k.description),1),e("p",tt,u(k.timestamp),1)]),e("div",st,[e("p",ot,u(E(_)(k.amount)),1),s[12]||(s[12]=e("span",{class:"inline-block px-2 py-1 text-xs bg-green-100 text-green-800 rounded"}," Exitoso ",-1))])])]))),128))])])):S("",!0)])]))}},lt=M(at,[["__scopeId","data-v-7a315758"]]);export{lt as default};
