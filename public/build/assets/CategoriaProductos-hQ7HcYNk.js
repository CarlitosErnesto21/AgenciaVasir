import{r as i,E as G,w as me,n as M,o as ve,a6 as ge,N as P,k as E,h as be,d as v,x as d,p as r,e as t,$ as o,a0 as fe,a1 as pe,y as D,t as w,A as W,c as g,j as T,q as A}from"./vendor-CqKcGHPa.js";import{A as he}from"./AuthenticatedLayout-CVGmrV7_.js";import{z as we,A as xe,F as m}from"./ui-DrLUz167.js";import{e as I,g as ye,h as Ce,i as q,j as _e,k as Z,l as J,c as H,m as ke}from"./index-BXYozc4i.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Pe={class:"container mx-auto px-4 py-6"},Ee={class:"bg-white rounded-lg shadow-md"},De={class:"flex flex-col sm:flex-row lg:justify-between lg:items-center mb-4 gap-4 p-6"},Te={class:"flex items-center gap-3"},Le={class:"flex items-center gap-2 w-full justify-center lg:w-auto lg:justify-end"},Ne={class:"bg-blue-50 p-3 rounded-lg shadow-sm border mb-4"},Se={class:"text-sm font-medium leading-relaxed"},Ae={class:"flex gap-2 justify-center items-center"},ze=["onClick"],Ue=["onClick"],Oe={class:"space-y-4"},Ve={class:"w-full flex flex-col"},je={class:"flex items-center gap-4"},Me={key:0,class:"text-gray-500 ml-28 text-xs"},We={key:1,class:"text-red-500 ml-28"},Ie={key:2,class:"text-orange-500 ml-28"},Re={key:3,class:"text-red-500 ml-28"},Fe={key:4,class:"text-red-500 ml-28"},$e={class:"flex justify-center gap-4 w-full mt-6"},Be=["disabled"],Ge={key:0},qe={key:1},Ze=["disabled"],Je={class:"flex items-center gap-3"},He={class:"flex flex-col"},Ke={class:"flex justify-center gap-4 w-full"},Xe=["disabled"],Qe={key:0},Ye={key:1},ea=["disabled"],aa={class:"flex items-center gap-3"},ta={class:"flex justify-center gap-3 w-full"},da={__name:"CategoriaProductos",setup(sa){const u=we(),z=i([]),a=i({id:null,nombre:""}),b=i(!1),f=i(!1),L=i(!1),U=i(typeof window<"u"?window.innerWidth:1024),O=G(()=>U.value<640?{width:"95vw",maxWidth:"380px"}:U.value<768?{width:"400px"}:{width:"450px"}),p=i(!1),x=i(!1),_=i(!1),y=i(!1),C=i(!1),h=i(null),N=i({global:{value:null,matchMode:xe.CONTAINS}}),V=i(10),K=i([5,10,20,50]),k=i("Guardar"),X=G(()=>{let s=z.value;if(N.value.global.value){const e=N.value.global.value.toLowerCase();s=s.filter(l=>l.nombre.toLowerCase().includes(e))}return s});me([a],()=>{h.value&&p.value&&M(()=>{const s={...a.value},e=JSON.stringify(s)!==JSON.stringify(h.value),l=!h.value.id,c=a.value.nombre;C.value=e||l&&c})},{deep:!0,flush:"post"});function S(){a.value={id:null,nombre:""},y.value=!1}const R=()=>{typeof window<"u"&&(U.value=window.innerWidth)},Q=()=>{L.value=!0};ve(()=>{Y(),typeof window<"u"&&window.addEventListener("resize",R)}),ge(()=>{typeof window<"u"&&window.removeEventListener("resize",R)});const F=async()=>{try{const s=await P.get("/api/categorias-productos");z.value=(s.data.data||s.data||[]).map(e=>({...e,categoria_id:e.id})).sort((e,l)=>new Date(l.created_at)-new Date(e.created_at))}catch{u.add({severity:"error",summary:"Error",detail:"No se pudieron cargar las categorÃ­as de productos.",life:4e3})}},Y=async()=>{u.add({severity:"info",summary:"Cargando categorÃ­as...",life:2e3});try{const s=await P.get("/api/categorias-productos");z.value=(s.data.data||s.data||[]).map(e=>({...e,categoria_id:e.id})).sort((e,l)=>new Date(l.created_at)-new Date(e.created_at)),u.add({severity:"success",summary:"CategorÃ­as cargadas",life:2e3})}catch{u.add({severity:"error",summary:"Error",detail:"No se pudieron cargar las categorÃ­as de productos.",life:4e3})}},ee=()=>{S(),k.value="Guardar",y.value=!1,p.value=!0,M(()=>{h.value={...a.value},C.value=!1})},ae=s=>{S(),y.value=!1,a.value={...s},k.value="Actualizar",p.value=!0,M(()=>{h.value={...a.value},C.value=!1})},te=async()=>{var s,e;if(y.value=!0,b.value=!0,!a.value.nombre||a.value.nombre.length<3||a.value.nombre.length>30){u.add({severity:"warn",summary:"Campos requeridos",detail:"El nombre debe tener entre 3 y 30 caracteres.",life:4e3}),b.value=!1;return}try{a.value.id?(await P.put(`/api/categorias-productos/${a.value.id}`,{nombre:a.value.nombre}),u.add({severity:"success",summary:"Â¡Ã‰xito!",detail:"La categorÃ­a ha sido actualizada correctamente.",life:5e3})):(await P.post("/api/categorias-productos",{nombre:a.value.nombre}),u.add({severity:"success",summary:"Â¡Ã‰xito!",detail:"La categorÃ­a ha sido creada correctamente.",life:5e3})),await F(),p.value=!1,C.value=!1,h.value=null,S()}catch(l){console.error("Error al procesar categorÃ­a:",l),u.add({severity:"error",summary:"Error",detail:((e=(s=l.response)==null?void 0:s.data)==null?void 0:e.message)||"Error al procesar la categorÃ­a",life:3e3})}finally{b.value=!1}},se=s=>{a.value={...s},x.value=!0},oe=async()=>{var s,e;f.value=!0;try{await P.delete(`/api/categorias-productos/${a.value.id}`),await F(),x.value=!1,u.add({severity:"success",summary:"Â¡Eliminada!",detail:"La categorÃ­a ha sido eliminada correctamente.",life:5e3})}catch(l){x.value=!1;const c=((e=(s=l.response)==null?void 0:s.data)==null?void 0:e.message)||l.message||"Error desconocido al eliminar la categorÃ­a";u.add({severity:"error",summary:"Error",detail:c,life:6e3})}finally{f.value=!1}},le=()=>{C.value?_.value=!0:$()},$=()=>{p.value=!1,_.value=!1,C.value=!1,h.value=null,S()},re=()=>{_.value=!1},ne=()=>{a.value.nombre&&a.value.nombre.length>50&&(a.value.nombre=a.value.nombre.substring(0,50))},ie=s=>{const e=s.target.value,l=e.match(/[^a-zA-ZÃ¡Ã©Ã­Ã³ÃºÃÃ‰ÃÃ“ÃšÃ±Ã‘\s]/g);l&&l.length>0&&u.add({severity:"warn",summary:"Caracteres no permitidos",detail:"Solo se permiten letras, espacios y acentos. Se han removido los caracteres no vÃ¡lidos.",life:3e3});const c=e.replace(/[^a-zA-ZÃ¡Ã©Ã­Ã³ÃºÃÃ‰ÃÃ“ÃšÃ±Ã‘\s]/g,"").toLocaleUpperCase("es-ES");s.target.value=c,a.value.nombre=c,ne()},de=s=>{s.preventDefault();const e=(s.clipboardData||window.clipboardData).getData("text"),l=e.replace(/[^a-zA-ZÃ¡Ã©Ã­Ã³ÃºÃÃ‰ÃÃ“ÃšÃ±Ã‘\s]/g,"").replace(/\s+/g," ").trim().toLocaleUpperCase("es-ES");l!==e.toLocaleUpperCase("es-ES")&&u.add({severity:"info",summary:"Texto limpiado",detail:"Se han removido nÃºmeros y caracteres especiales del texto pegado y convertido a mayÃºsculas.",life:3e3});const c=l.length>50?l.substring(0,50):l;a.value.nombre=c,s.target.value=c};return(s,e)=>{const l=E("Toast"),c=E("InputText"),B=E("Column"),ue=E("DataTable"),j=E("Dialog");return v(),be(he,null,{default:d(()=>[r(o(fe),{title:"Control de CategorÃ­as de Productos"}),r(l,{class:"z-[9999]"}),t("div",Pe,[e[21]||(e[21]=t("div",{class:"mb-6"},[t("h1",{class:"text-3xl font-bold text-blue-600 mb-2"},"Control de CategorÃ­as"),t("p",{class:"text-gray-600"},"GestiÃ³n de categorÃ­as de productos")],-1)),t("div",Ee,[t("div",De,[t("div",Te,[r(o(pe),{href:s.route("productos"),onClick:Q,class:D([{"opacity-50 cursor-not-allowed":L.value},"flex items-center text-blue-600 hover:text-blue-700 transition-colors duration-200 px-3 py-2 rounded-lg"]),title:"Regresar a Productos"},{default:d(()=>[r(o(m),{icon:L.value?o(I):o(ye),class:D({"animate-spin":L.value,"h-5 w-5":!0})},null,8,["icon","class"])]),_:1},8,["href","class"]),e[7]||(e[7]=t("h3",{class:"text-2xl sm:text-3xl text-blue-600 font-bold text-center sm:text-start"},"Lista de CategorÃ­as",-1))]),t("div",Le,[t("button",{class:"bg-red-500 border border-red-500 p-2 text-sm text-white shadow-md hover:shadow-lg rounded-md hover:-translate-y-1 transition-transform duration-300 flex items-center gap-2",onClick:ee},[r(o(m),{icon:o(Ce),class:"h-4 w-4"},null,8,["icon"]),e[8]||(e[8]=t("span",null,"Agregar",-1))])])]),r(ue,{value:X.value,dataKey:"id",paginator:!0,rows:V.value,rowsPerPageOptions:K.value,rowsPerPage:V.value,"onUpdate:rowsPerPage":e[1]||(e[1]=n=>V.value=n),paginatorTemplate:"RowsPerPageDropdown FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink",currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} categorÃ­as",class:"overflow-x-auto max-w-full",responsiveLayout:"scroll"},{header:d(()=>[t("div",Ne,[r(c,{modelValue:N.value.global.value,"onUpdate:modelValue":e[0]||(e[0]=n=>N.value.global.value=n),placeholder:"ðŸ” Buscar categorÃ­as...",class:"w-full h-9 text-sm rounded-md",style:{"background-color":"white","border-color":"#93c5fd"}},null,8,["modelValue"])])]),default:d(()=>[r(B,{field:"nombre",header:"Nombre",sortable:"",class:"w-96 min-w-52"},{body:d(n=>[t("div",Se,w(n.data.nombre),1)]),_:1}),r(B,{exportable:!1,class:"w-52 min-w-28"},{header:d(()=>e[9]||(e[9]=[t("div",{class:"text-center w-full font-bold"}," Acciones ",-1)])),body:d(n=>[t("div",Ae,[t("button",{class:"flex bg-blue-500 border p-1 py-2 sm:p-2 text-sm shadow-md hover:shadow-lg rounded-md hover:-translate-y-1 transition-transform duration-300",onClick:ce=>ae(n.data)},[r(o(m),{icon:o(q),class:"h-3 w-6 sm:h-4 sm:w-7 text-white"},null,8,["icon"]),e[10]||(e[10]=t("span",{class:"hidden md:block text-white"},"Editar",-1))],8,ze),t("button",{class:"flex bg-red-500 border p-1 py-2 sm:p-2 text-sm shadow-md hover:shadow-lg rounded-md hover:-translate-y-1 transition-transform duration-300",onClick:ce=>se(n.data)},[r(o(m),{icon:o(_e),class:"h-3 w-6 sm:h-4 sm:w-7 text-white"},null,8,["icon"]),e[11]||(e[11]=t("span",{class:"hidden md:block text-white"},"Eliminar",-1))],8,Ue)])]),_:1})]),_:1},8,["value","rows","rowsPerPageOptions","rowsPerPage"]),r(j,{visible:p.value,"onUpdate:visible":e[3]||(e[3]=n=>p.value=n),header:k.value+" CategorÃ­a",modal:!0,style:W(O.value),closable:!1,draggable:!1},{footer:d(()=>[t("div",$e,[t("button",{class:"bg-red-500 hover:bg-red-700 text-white border-none px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",onClick:te,disabled:b.value||!a.value.nombre||a.value.nombre.length<3||a.value.nombre.length>30},[r(o(m),{icon:b.value?o(I):o(Z),class:D(["h-5 text-white",{"animate-spin":b.value}])},null,8,["icon","class"]),b.value?(v(),g("span",qe,w(k.value==="Guardar"?"Guardando...":"Actualizando..."),1)):(v(),g("span",Ge,w(k.value),1))],8,Be),t("button",{type:"button",class:"bg-blue-500 hover:bg-blue-700 text-white px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",onClick:le,disabled:b.value},[r(o(m),{icon:o(J),class:"h-5"},null,8,["icon"]),e[13]||(e[13]=A("Cancelar "))],8,Ze)])]),default:d(()=>[t("div",Oe,[t("div",Ve,[t("div",je,[e[12]||(e[12]=t("label",{for:"nombre",class:"w-24 flex items-center gap-1"},[A(" Nombre: "),t("span",{class:"text-red-500 font-bold"},"*")],-1)),r(c,{modelValue:a.value.nombre,"onUpdate:modelValue":e[2]||(e[2]=n=>a.value.nombre=n),modelModifiers:{trim:!0},id:"nombre",name:"nombre",maxlength:30,class:D([{"p-invalid":y.value&&(!a.value.nombre||a.value.nombre.length<3||a.value.nombre.length>30),"border-orange-400 focus:border-orange-500":a.value.nombre&&a.value.nombre.length>25&&a.value.nombre.length<=30,"border-red-400 focus:border-red-500":a.value.nombre&&a.value.nombre.length>30},"flex-1 border-2 border-gray-400 hover:border-gray-500 focus:border-gray-500 focus:ring-0 focus:shadow-none rounded-md"]),onInput:ie,onPaste:de,placeholder:"MALETAS, ACCESORIOS, ROPA, ETC."},null,8,["modelValue","class"])]),a.value.nombre?(v(),g("small",Me," Caracteres: "+w(a.value.nombre.length)+"/30 ",1)):T("",!0),a.value.nombre&&a.value.nombre.length<3?(v(),g("small",We," El nombre debe tener al menos 3 caracteres. ")):T("",!0),a.value.nombre&&a.value.nombre.length>25&&a.value.nombre.length<=30?(v(),g("small",Ie," Te quedan "+w(30-a.value.nombre.length)+" caracteres ",1)):T("",!0),a.value.nombre&&a.value.nombre.length>30?(v(),g("small",Re," Has excedido el lÃ­mite por "+w(a.value.nombre.length-30)+" caracteres ",1)):T("",!0),y.value&&!a.value.nombre?(v(),g("small",Fe," El nombre es obligatorio. ")):T("",!0)])])]),_:1},8,["visible","header","style"]),r(j,{visible:x.value,"onUpdate:visible":e[5]||(e[5]=n=>x.value=n),header:"Eliminar categorÃ­a",modal:!0,style:W(O.value),closable:!1,draggable:!1},{footer:d(()=>[t("div",Ke,[t("button",{type:"button",class:"bg-red-500 hover:bg-red-700 text-white border-none px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",onClick:oe,disabled:f.value},[r(o(m),{icon:f.value?o(I):o(Z),class:D(["h-5",{"animate-spin":f.value}])},null,8,["icon","class"]),f.value?(v(),g("span",Ye,"Eliminando...")):(v(),g("span",Qe,"Eliminar"))],8,Xe),t("button",{type:"button",class:"bg-blue-500 hover:bg-blue-700 text-white px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",onClick:e[4]||(e[4]=n=>x.value=!1),disabled:f.value},[r(o(m),{icon:o(J),class:"h-5"},null,8,["icon"]),e[17]||(e[17]=t("span",null,"Cancelar",-1))],8,ea)])]),default:d(()=>[t("div",Je,[r(o(m),{icon:o(H),class:"h-8 w-8 text-red-500"},null,8,["icon"]),t("div",He,[t("span",null,[e[14]||(e[14]=A("Â¿EstÃ¡s seguro de eliminar la categorÃ­a: ")),t("b",null,w(a.value.nombre),1),e[15]||(e[15]=A("?"))]),e[16]||(e[16]=t("span",{class:"text-red-600 text-sm font-medium mt-1"},"Esta acciÃ³n es irreversible.",-1))])])]),_:1},8,["visible","style"]),r(j,{visible:_.value,"onUpdate:visible":e[6]||(e[6]=n=>_.value=n),header:"Cambios sin guardar",modal:!0,style:W(O.value),closable:!1,draggable:!1},{footer:d(()=>[t("div",ta,[t("button",{type:"button",class:"bg-red-500 hover:bg-red-700 text-white border-none px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",onClick:$},[r(o(m),{icon:o(ke),class:"h-4"},null,8,["icon"]),e[19]||(e[19]=t("span",null,"Salir sin guardar",-1))]),t("button",{type:"button",class:"bg-blue-500 hover:bg-blue-700 text-white px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",onClick:re},[r(o(m),{icon:o(q),class:"h-4"},null,8,["icon"]),e[20]||(e[20]=t("span",null,"Continuar",-1))])])]),default:d(()=>[t("div",aa,[r(o(m),{icon:o(H),class:"h-8 w-8 text-red-500"},null,8,["icon"]),e[18]||(e[18]=t("div",{class:"flex flex-col"},[t("span",null,"Â¡Tienes informaciÃ³n sin guardar!"),t("span",{class:"text-red-600 text-sm font-medium mt-1"},"Â¿Deseas salir sin guardar?")],-1))])]),_:1},8,["visible","style"])])])]),_:1})}}};export{da as default};
