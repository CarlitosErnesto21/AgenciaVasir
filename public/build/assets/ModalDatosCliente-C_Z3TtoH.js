import{a4 as X,r as b,E as J,o as Q,w as x,h as W,d as m,x as I,e as t,q as v,t as u,I as O,c as p,j as g,y,v as k,a7 as F,p as w,$ as c,a9 as ee,N as T}from"./vendor-CaDzpwPW.js";import{z as ae,q as oe,A,g as te}from"./ui-BjYE_i4I.js";import{f as le,av as ie,g as ne,G as re}from"./index-DngIDQG3.js";import{z as se}from"./vue-tel-input-AlIeehSu.js";import{_ as de}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ue={class:"text-xl font-bold text-red-700 flex items-center gap-2"},ce={class:"py-4"},me={class:"bg-blue-50 rounded-lg p-4 mb-6"},fe={class:"text-sm text-blue-700"},ve={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},pe=["value","maxlength","placeholder"],ge={key:0,class:"text-red-500 text-xs"},be={key:0,class:"text-red-500 text-xs"},xe={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},ye={key:0,class:"text-red-500 text-xs"},_e={key:0,class:"text-red-500 text-xs"},De={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},Ee={class:"mr-1"},we={key:1,class:"text-red-500 text-xs"},Ce={class:"sm:col-span-1"},Ne={key:0,class:"text-red-500 text-xs"},Ve={class:"flex justify-center gap-4 w-full mt-6"},he=["disabled"],Ie=["disabled"],ke={__name:"ModalDatosCliente",props:{visible:{type:Boolean,default:!1},tieneClienteExistente:{type:Boolean,default:!1}},emits:["update:visible","cliente-guardado"],setup(U,{emit:q}){const R=U,V=q,B=X(),_=ae(),f=b(!1);b([]),b(!0);const M=J(()=>{var e;return(e=B.props.auth)==null?void 0:e.user}),o=b({numero_identificacion:"",fecha_nacimiento:null,genero:"",direccion:"",telefono:"",tipo_documento:"DUI"}),l=b({}),n=b({isValid:!1,country:null,formattedNumber:"",mensaje:""});Q(async()=>{});const S=()=>{V("update:visible",!1),$()},$=()=>{o.value={numero_identificacion:"",fecha_nacimiento:null,genero:"",direccion:"",telefono:"",tipo_documento:"DUI"},l.value={}},G=async e=>{try{e&&typeof e=="object"&&(n.value.isValid=e.valid===!0,n.value.country={name:e.country,code:e.countryCode},n.value.formattedNumber=e.formatted||"",e.valid===!0&&e.formatted&&(o.value.telefono=e.formatted),R.tieneClienteExistente?e.valid===!0?n.value.mensaje="Número válido (guardado previamente)":o.value.telefono&&e.valid===!1?n.value.mensaje="Número de teléfono inválido para "+e.country:n.value.mensaje="":o.value.telefono&&e.valid===!1?n.value.mensaje="Número de teléfono inválido para "+e.country:e.valid===!0?await L(o.value.telefono):n.value.mensaje="")}catch(a){console.error("[ModalDatosCliente] Error en validación:",a),n.value.mensaje="Error en validación"}},L=async e=>{var a,i;if(!(!e||e.length<8))try{const d=await T.post("/api/clientes/validar-telefono",{telefono:e});d.data.disponible?n.value.mensaje="Número válido para "+((a=n.value.country)==null?void 0:a.name):(n.value.isValid=!1,n.value.mensaje=d.data.message||"Este teléfono ya está registrado")}catch(d){console.error("[ModalDatosCliente] Error validando teléfono:",d),((i=d.response)==null?void 0:i.status)===401?n.value.mensaje="Error de autenticación":n.value.mensaje="Error al validar teléfono"}},z=()=>{const e=new Date;return e.setFullYear(e.getFullYear()-18),e},P=e=>{if(!e)return{esValido:!0,mensaje:""};const a=new Date,i=new Date(e),d=a.getFullYear()-i.getFullYear(),r=i.getMonth(),C=i.getDate(),D=a.getMonth(),N=a.getDate(),E=d-(D<r||D===r&&N<C?1:0);return E<18?{esValido:!1,mensaje:`Debe ser mayor de edad (18 años). Edad actual: ${E} años`}:{esValido:!0,mensaje:""}},Y=()=>{const e={};if(o.value.numero_identificacion?(h(),l.value.numero_identificacion&&(e.numero_identificacion=l.value.numero_identificacion)):e.numero_identificacion="El número de identificación es requerido",!o.value.fecha_nacimiento)e.fecha_nacimiento="La fecha de nacimiento es requerida";else{const a=P(o.value.fecha_nacimiento);a.esValido||(e.fecha_nacimiento=a.mensaje)}return o.value.genero||(e.genero="El género es requerido"),o.value.direccion||(e.direccion="La dirección es requerida"),o.value.telefono?n.value.isValid===!1&&(e.telefono=n.value.mensaje||"Por favor, ingrese un número de teléfono válido"):e.telefono="El número de teléfono es requerido",o.value.tipo_documento||(e.tipo_documento="El tipo de documento es requerido"),l.value=e,Object.keys(l.value).length===0},j=async()=>{var e,a,i,d,r,C,D,N,E;if(!Y()){const s=Object.keys(l.value);s.length===1&&s[0]==="telefono"&&n.value.isValid===!1?_.add({severity:"warn",summary:"Teléfono ya registrado",detail:n.value.mensaje||"Este número de teléfono ya está registrado. Por favor, use un número diferente.",life:5e3}):_.add({severity:"error",summary:"Formulario incompleto",detail:"Por favor completa todos los campos requeridos",life:4e3});return}try{f.value=!0;const s=await T.post("/api/registro-cliente",o.value);_.add({severity:"success",summary:"Información guardada",detail:"Tus datos han sido guardados correctamente",life:3e3}),V("cliente-guardado",s.data.data||s.data),S()}catch(s){console.error("[ModalDatosCliente] Error al guardar cliente:",s),console.error("[ModalDatosCliente] Detalles del error:",(e=s.response)==null?void 0:e.data),(i=(a=s.response)==null?void 0:a.data)!=null&&i.errors&&(l.value=s.response.data.errors),(r=(d=s.response)==null?void 0:d.data)!=null&&r.message&&((D=(C=s.response)==null?void 0:C.data)!=null&&D.message.includes("formato"))&&(l.value.numero_identificacion=s.response.data.message),_.add({severity:"error",summary:"Error al guardar",detail:((E=(N=s.response)==null?void 0:N.data)==null?void 0:E.message)||"No se pudo guardar la información",life:5e3})}finally{f.value=!1}},Z=e=>{const i=e.replace(/[^0-9]/g,"").substring(0,9);return i.length>8?i.substring(0,8)+"-"+i.substring(8):i},H=e=>e.toUpperCase().replace(/[^A-Z0-9]/g,"").substring(0,9),K=e=>{const a=e.target.value;let i="";o.value.tipo_documento==="DUI"?(i=Z(a),o.value.numero_identificacion=i,e.target.value=i):o.value.tipo_documento==="PASAPORTE"&&(i=H(a),o.value.numero_identificacion=i,e.target.value=i),h()},h=()=>{if(!o.value.numero_identificacion){delete l.value.numero_identificacion;return}o.value.tipo_documento==="DUI"?/^\d{8}-\d{1}$/.test(o.value.numero_identificacion)?delete l.value.numero_identificacion:l.value.numero_identificacion="El DUI debe tener 9 dígitos (formato: 12345678-9)":o.value.tipo_documento==="PASAPORTE"&&(/^[A-Z0-9]{6,9}$/.test(o.value.numero_identificacion)?delete l.value.numero_identificacion:l.value.numero_identificacion="El PASAPORTE debe tener entre 6 y 9 caracteres (solo letras mayúsculas y números)")};return x(()=>o.value.numero_identificacion,()=>{h()}),x(()=>o.value.tipo_documento,()=>{o.value.numero_identificacion="",delete l.value.numero_identificacion}),x(()=>o.value.fecha_nacimiento,e=>{if(e){const a=P(e);a.esValido?delete l.value.fecha_nacimiento:(l.value.fecha_nacimiento=a.mensaje,_.add({severity:"error",summary:"Edad insuficiente",detail:a.mensaje,life:4e3}))}}),x(()=>o.value.genero,e=>{e&&l.value.genero&&delete l.value.genero}),x(()=>o.value.direccion,e=>{e&&e.trim()&&l.value.direccion&&delete l.value.direccion}),x(()=>o.value.telefono,e=>{e&&l.value.telefono&&n.value.isValid&&delete l.value.telefono}),(e,a)=>(m(),W(c(te),{visible:U.visible,"onUpdate:visible":a[5]||(a[5]=i=>V("update:visible",i)),modal:"",closable:!1,class:"max-w-2xl w-full mx-4",draggable:!1},{header:I(()=>[t("h3",ue,[w(c(A),{icon:c(re)},null,8,["icon"]),a[6]||(a[6]=v(" Completar información de cliente "))])]),footer:I(()=>[t("div",Ve,[t("button",{type:"button",class:"bg-red-600 hover:bg-red-700 text-white px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",onClick:j,disabled:f.value},[w(c(A),{icon:f.value?c(le):c(ie),class:y(["h-5",{"animate-spin":f.value}])},null,8,["icon","class"]),v(" "+u(f.value?"Guardando...":"Guardar y Continuar"),1)],8,he),t("button",{type:"button",class:"bg-blue-500 hover:bg-blue-700 text-white px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",onClick:S,disabled:f.value},[w(c(A),{icon:c(ne),class:"h-5"},null,8,["icon"]),a[19]||(a[19]=v(" Cancelar "))],8,Ie)])]),default:I(()=>{var i,d;return[t("div",ce,[t("div",me,[a[9]||(a[9]=t("h4",{class:"font-semibold text-blue-800 mb-2"},"Información de tu cuenta:",-1)),t("div",fe,[t("p",null,[a[7]||(a[7]=t("strong",null,"Nombre:",-1)),v(" "+u((i=M.value)==null?void 0:i.name),1)]),t("p",null,[a[8]||(a[8]=t("strong",null,"Email:",-1)),v(" "+u((d=M.value)==null?void 0:d.email),1)])])]),t("form",{onSubmit:O(j,["prevent"]),class:"space-y-4"},[t("div",ve,[t("div",null,[a[10]||(a[10]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Número de Identificación",-1)),t("input",{value:o.value.numero_identificacion,onInput:K,type:"text",required:"",maxlength:o.value.tipo_documento==="DUI"?10:9,class:y(["w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",{"border-red-500":l.value.numero_identificacion}]),placeholder:o.value.tipo_documento==="DUI"?"Ingrese 9 dígitos (ej: 123456789)":"Ingrese su PASAPORTE (ej: A1B2C3D4)"},null,42,pe),l.value.numero_identificacion?(m(),p("small",ge,u(l.value.numero_identificacion),1)):g("",!0)]),t("div",null,[a[12]||(a[12]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Tipo de Documento",-1)),k(t("select",{"onUpdate:modelValue":a[0]||(a[0]=r=>o.value.tipo_documento=r),required:"",class:y(["w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",{"border-red-500":l.value.tipo_documento}])},a[11]||(a[11]=[t("option",{value:"",disabled:""},"Seleccione un tipo",-1),t("option",{value:"DUI"},"DUI",-1),t("option",{value:"PASAPORTE"},"PASAPORTE",-1)]),2),[[F,o.value.tipo_documento]]),l.value.tipo_documento?(m(),p("small",be,u(l.value.tipo_documento),1)):g("",!0)])]),t("div",xe,[t("div",null,[a[13]||(a[13]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Fecha de Nacimiento",-1)),w(c(oe),{modelValue:o.value.fecha_nacimiento,"onUpdate:modelValue":a[1]||(a[1]=r=>o.value.fecha_nacimiento=r),maxDate:z(),"date-format":"dd/mm/yy",placeholder:"Seleccionar fecha de nacimiento (debe ser mayor de 18 años)",showIcon:"",yearNavigator:"",yearRange:"1920:2006",class:"w-full",inputClass:`w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 ${l.value.fecha_nacimiento?"border-red-500":""}`},null,8,["modelValue","maxDate","inputClass"]),l.value.fecha_nacimiento?(m(),p("small",ye,u(l.value.fecha_nacimiento),1)):g("",!0)]),t("div",null,[a[15]||(a[15]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Género",-1)),k(t("select",{"onUpdate:modelValue":a[2]||(a[2]=r=>o.value.genero=r),required:"",class:y(["w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",{"border-red-500":l.value.genero}])},a[14]||(a[14]=[t("option",{value:""},"Seleccione",-1),t("option",{value:"MASCULINO"},"Masculino",-1),t("option",{value:"FEMENINO"},"Femenino",-1)]),2),[[F,o.value.genero]]),l.value.genero?(m(),p("small",_e,u(l.value.genero),1)):g("",!0)])]),t("div",De,[t("div",null,[a[16]||(a[16]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Teléfono",-1)),w(c(se),{modelValue:o.value.telefono,"onUpdate:modelValue":a[3]||(a[3]=r=>o.value.telefono=r),defaultCountry:"SV",preferredCountries:["SV","GT","HN","CR","NI","PA","BZ"],validCharactersOnly:!0,dropdownOptions:{showDialCodeInSelection:!0,showFlags:!0,showSearchBox:!0,showDialCodeInList:!0},inputOptions:{placeholder:"Número de teléfono"},mode:"international",class:"w-full border border-gray-300 rounded-lg",onValidate:G},null,8,["modelValue"]),n.value.mensaje?(m(),p("p",{key:0,class:y(["text-xs mt-1 flex items-center",n.value.isValid?"text-green-600":"text-red-600"])},[t("span",Ee,u(n.value.isValid?"✓":"⚠️"),1),v(" "+u(n.value.mensaje),1)],2)):g("",!0),l.value.telefono&&!n.value.mensaje?(m(),p("small",we,u(l.value.telefono),1)):g("",!0)]),t("div",Ce,[a[17]||(a[17]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Dirección",-1)),k(t("input",{"onUpdate:modelValue":a[4]||(a[4]=r=>o.value.direccion=r),type:"text",required:"",maxlength:"200",class:y(["w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",{"border-red-500":l.value.direccion}]),placeholder:"Dirección completa"},null,2),[[ee,o.value.direccion]]),l.value.direccion?(m(),p("small",Ne,u(l.value.direccion),1)):g("",!0)])]),a[18]||(a[18]=t("div",{class:"bg-blue-50 border border-blue-200 rounded-lg p-4 mt-4"},[t("p",{class:"text-sm text-blue-800"},[t("strong",null,"Nota:"),v(" Esta información es necesaria para procesar tu compra. ")])],-1))],32)])]}),_:1},8,["visible"]))}},je=de(ke,[["__scopeId","data-v-d9bda25d"]]);export{je as default};
