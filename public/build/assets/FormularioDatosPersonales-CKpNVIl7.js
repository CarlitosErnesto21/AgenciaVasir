import{r as y,E as q,o as S,w,c as s,d,j as p,e as t,q as b,t as c,v as x,a9 as E,y as f,F as V,l as U,p as N,$ as D,a7 as A}from"./vendor-DcS5GX9S.js";import{z as j}from"./vue-tel-input-D_h7FK_m.js";import{r as M}from"./ui-DN6aYgk-.js";const T={class:"space-y-6"},B={key:0,class:"bg-gradient-to-r from-blue-50 to-purple-50 p-4 rounded-lg"},L={class:"text-sm text-gray-600 mb-1"},z={class:"text-sm text-gray-600"},R={key:1,class:"flex items-center justify-between mb-3"},G={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},$=["disabled"],H=["value","disabled"],O={key:0,value:"",disabled:""},Z={key:1,value:"",disabled:""},J=["value"],K={class:"grid grid-cols-1 sm:grid-cols-2 gap-4 mt-4"},Q=["disabled"],W={class:"grid grid-cols-1 sm:grid-cols-2 gap-4 mt-4"},X={class:"mr-1"},Y={class:"sm:col-span-1"},_=["disabled"],re={__name:"FormularioDatosPersonales",props:{formulario:{type:Object,required:!0},tieneClienteExistente:{type:Boolean,default:!1},user:{type:Object,default:null}},emits:["update:formulario","mostrar-toast"],setup(l,{expose:k,emit:I}){const m=l,n=I,u=y([]),v=y(!1),i=y({isValid:!1,country:null,formattedNumber:"",mensaje:""}),a=q({get(){return m.formulario},set(o){n("update:formulario",o)}}),P=async()=>{try{v.value=!0;const o=await fetch("/api/tipo-documentos",{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"}});if(o.ok){const e=await o.json();u.value=e.tipos||e}else console.error("Error al cargar tipos de documentos:",o.status),u.value=[{id:1,nombre:"DUI"},{id:2,nombre:"CÉDULA"},{id:3,nombre:"PASAPORTE"}]}catch(o){console.error("Error al cargar tipos de documentos:",o),u.value=[{id:1,nombre:"DUI"},{id:2,nombre:"CÉDULA"},{id:3,nombre:"PASAPORTE"}]}finally{v.value=!1}},F=o=>{try{o&&typeof o=="object"&&(i.value.isValid=o.valid===!0,i.value.country={name:o.country,code:o.countryCode},i.value.formattedNumber=o.formatted||"",a.value.telefono&&o.valid===!1?i.value.mensaje="Número de teléfono inválido para "+o.country:o.valid===!0?i.value.mensaje="Número válido para "+o.country:i.value.mensaje="")}catch{i.value.mensaje="Error en validación"}},h=()=>{const o=new Date;return o.setDate(o.getDate()-1),o};k({tiposDocumentos:u,validateForm:()=>!a.value.tipo_documento&&!a.value.tipo_documento_id?(n("mostrar-toast",{severity:"error",summary:"Campo requerido",detail:"Por favor, seleccione un tipo de documento.",life:4e3}),!1):a.value.numero_identificacion?a.value.fecha_nacimiento?a.value.direccion?a.value.genero?a.value.telefono?a.value.telefono&&i.value.isValid===!1&&i.value.mensaje!=="Número válido (guardado previamente)"?(n("mostrar-toast",{severity:"error",summary:"Teléfono inválido",detail:"Por favor, ingrese un número de teléfono válido.",life:4e3}),!1):!0:(n("mostrar-toast",{severity:"error",summary:"Campo requerido",detail:"Por favor, ingrese su número de teléfono.",life:4e3}),!1):(n("mostrar-toast",{severity:"error",summary:"Campo requerido",detail:"Por favor, seleccione su género.",life:4e3}),!1):(n("mostrar-toast",{severity:"error",summary:"Campo requerido",detail:"Por favor, ingrese su dirección.",life:4e3}),!1):(n("mostrar-toast",{severity:"error",summary:"Campo requerido",detail:"Por favor, seleccione su fecha de nacimiento.",life:4e3}),!1):(n("mostrar-toast",{severity:"error",summary:"Campo requerido",detail:"Por favor, ingrese su número de identificación.",life:4e3}),!1)});const C=o=>{if(o&&o.id){const e={...a.value,tipo_documento:o,tipo_documento_id:o.id};n("update:formulario",e)}};return S(()=>{P()}),w([u,()=>m.formulario.tipo_documento_id],([o,e])=>{if(o.length>0&&e&&!m.formulario.tipo_documento){const r=o.find(g=>g.id===e);r&&C(r)}},{immediate:!0,flush:"post"}),w(()=>m.formulario.telefono,(o,e)=>{o&&o!==e&&m.tieneClienteExistente&&(i.value={isValid:!0,country:{name:"Válido",code:""},formattedNumber:o,mensaje:"Número válido (guardado previamente)"})},{immediate:!0}),(o,e)=>(d(),s("div",T,[l.user?(d(),s("div",B,[e[8]||(e[8]=t("h3",{class:"font-bold text-lg text-gray-800 mb-2"},"Información de tu cuenta:",-1)),t("p",L,[e[6]||(e[6]=t("strong",null,"Nombre:",-1)),b(" "+c(l.user.name),1)]),t("p",z,[e[7]||(e[7]=t("strong",null,"Email:",-1)),b(" "+c(l.user.email),1)])])):p("",!0),l.tieneClienteExistente?(d(),s("div",R,e[9]||(e[9]=[t("h4",{class:"font-semibold text-gray-800"},"Información Personal",-1),t("div",{class:"flex items-center text-green-600 text-sm"},[t("svg",{class:"w-4 h-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})]),t("span",null,"Datos precargados")],-1)]))):p("",!0),t("div",G,[t("div",null,[e[10]||(e[10]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Número de Identificación",-1)),x(t("input",{"onUpdate:modelValue":e[0]||(e[0]=r=>a.value.numero_identificacion=r),type:"text",required:"",maxlength:"25",disabled:l.tieneClienteExistente,class:f(["w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",{"bg-gray-100 cursor-not-allowed":l.tieneClienteExistente}]),placeholder:"Ingrese su DUI o documento"},null,10,$),[[E,a.value.numero_identificacion]])]),t("div",null,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Tipo de Documento",-1)),t("select",{value:a.value.tipo_documento_id,onChange:e[1]||(e[1]=r=>C(u.value.find(g=>g.id===parseInt(r.target.value)))),required:"",disabled:v.value||l.tieneClienteExistente,class:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100"},[v.value?(d(),s("option",O,"Cargando tipos...")):u.value.length===0?(d(),s("option",Z,"No hay tipos disponibles")):(d(),s(V,{key:2},[e[11]||(e[11]=t("option",{value:"",disabled:""},"Seleccione un tipo",-1)),(d(!0),s(V,null,U(u.value,r=>(d(),s("option",{key:r.id,value:r.id},c(r.nombre),9,J))),128))],64))],40,H)])]),t("div",K,[t("div",null,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Fecha de Nacimiento",-1)),N(D(M),{modelValue:a.value.fecha_nacimiento,"onUpdate:modelValue":e[2]||(e[2]=r=>a.value.fecha_nacimiento=r),maxDate:h(),dateFormat:"dd/mm/yy",placeholder:"Seleccionar fecha de nacimiento",showIcon:"",showOnFocus:!1,touchUI:"",yearNavigator:"",yearRange:"1920:2010",disabled:l.tieneClienteExistente,class:"w-full",inputClass:`w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 ${l.tieneClienteExistente?"bg-gray-100 cursor-not-allowed":""}`},null,8,["modelValue","maxDate","disabled","inputClass"])]),t("div",null,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Género",-1)),x(t("select",{"onUpdate:modelValue":e[3]||(e[3]=r=>a.value.genero=r),required:"",disabled:l.tieneClienteExistente,class:f(["w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",{"bg-gray-100 cursor-not-allowed":l.tieneClienteExistente}])},e[14]||(e[14]=[t("option",{value:""},"Seleccione",-1),t("option",{value:"MASCULINO"},"Masculino",-1),t("option",{value:"FEMENINO"},"Femenino",-1)]),10,Q),[[A,a.value.genero]])])]),t("div",W,[t("div",null,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Teléfono",-1)),N(D(j),{modelValue:a.value.telefono,"onUpdate:modelValue":e[4]||(e[4]=r=>a.value.telefono=r),defaultCountry:"SV",preferredCountries:["SV","GT","HN","CR","NI","PA","BZ"],validCharactersOnly:!0,disabled:l.tieneClienteExistente,dropdownOptions:{showDialCodeInSelection:!0,showFlags:!0,showSearchBox:!0,showDialCodeInList:!0},inputOptions:{placeholder:"Número de teléfono"},mode:"international",class:f(["w-full border border-gray-300 rounded-lg",{"bg-gray-100 cursor-not-allowed":l.tieneClienteExistente}]),onValidate:F},null,8,["modelValue","disabled","class"]),i.value.mensaje?(d(),s("p",{key:0,class:f(["text-xs mt-1 flex items-center",i.value.isValid?"text-green-600":"text-red-600"])},[t("span",X,c(i.value.isValid?"✓":"⚠️"),1),b(" "+c(i.value.mensaje),1)],2)):p("",!0)]),t("div",Y,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Dirección",-1)),x(t("input",{"onUpdate:modelValue":e[5]||(e[5]=r=>a.value.direccion=r),type:"text",required:"",maxlength:"200",disabled:l.tieneClienteExistente,class:f(["w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",{"bg-gray-100 cursor-not-allowed":l.tieneClienteExistente}]),placeholder:"Dirección completa"},null,10,_),[[E,a.value.direccion]])])])]))}};export{re as default};
