import{p as Z,r,U as ee,s as oe,B as y,E as p,f as m,o as v,a as t,u as A,g as le,w as c,b as a,h,n as E,F as j,y as ae,e as B,t as te,L as se}from"./app-DP8tsAem.js";import{_ as ie}from"./AuthenticatedLayout-BvfF3yw2.js";import"./logo-DN1bLr27.js";import"./index-ClJ1gEnJ.js";const ne={class:"py-6 px-6 mt-10 mx-auto bg-red-50 shadow-md rounded-lg"},re={class:"flex justify-between items-center mb-4"},ue={class:"space-y-4"},de={class:"w-full flex flex-col"},ce={class:"flex items-center gap-4"},pe={key:0,class:"text-red-500 ml-28"},me={class:"w-full flex flex-col"},ve={class:"flex items-center gap-4"},fe={key:0,class:"text-red-500 ml-28"},be={class:"w-full flex flex-col"},ge={class:"flex items-center gap-4"},_e={key:0,class:"text-red-500 ml-28"},xe={class:"grid grid-cols-12 gap-4"},ye={class:"col-span-6"},he={key:0,class:"text-red-500"},we={class:"col-span-6"},ke={key:0,class:"text-red-500"},Ce={class:"w-full flex flex-col"},Ve={class:"flex items-center gap-4"};const Se={class:"flex gap-4 flex-wrap mt-4 ml-28"},Ie=["src"],De=["onClick"],Ee={class:"flex justify-center gap-4 w-full"},Ue={class:"relative flex justify-center items-center h-96 w-full"},Ne=["src"],Pe={class:"flex justify-center"},I="/api/productos",$e="/images/productos/",Le={__name:"Productos",setup(Te){const g=Z(),f=r([]),o=r({id:null,nombre:"",descripcion:"",precio:null,inventario_id:null,categoria_id:null}),b=r([]),_=r([]);r();const x=r(!1),w=r(!1),u=r(!1),V=r("Guardar"),U=r([]),N=r([]);r({global:{value:null,matchMode:ee.CONTAINS}});const S=r(!1),P=r([]),k=r([]);oe(()=>{$(),M(),L()});const $=async()=>{try{const l=await y.get(I);f.value=l.data}catch(l){console.error("Error al obtener los productos",l)}},M=async()=>{try{const l=await y.get("/api/inventarios");U.value=l.data}catch(l){console.error("Error al obtener los inventarios",l)}},L=async()=>{try{const l=await y.get("/api/categorias-productos");N.value=l.data}catch(l){console.error("Error al obtener las categorías",l)}},z=()=>{o.value={id:null,nombre:"",descripcion:"",precio:null,inventario_id:null,categoria_id:null},_.value=[],b.value=[],u.value=!1,V.value="Guardar",x.value=!0},O=l=>{o.value={...l},b.value=Array.isArray(l.imagenes)?l.imagenes.map(e=>`/images/productos/${e.nombre}`):[],_.value=[],k.value=[],V.value="Actualizar",x.value=!0},R=async()=>{var l;u.value=!0;try{const e=new FormData;e.append("nombre",String(o.value.nombre)),e.append("descripcion",String(o.value.descripcion)),e.append("precio",String(o.value.precio)),e.append("inventario_id",String(o.value.inventario_id)),e.append("categoria_id",String(o.value.categoria_id)),_.value.length>0&&_.value.forEach(i=>{e.append("imagenes[]",i)}),k.value.length>0&&k.value.forEach(i=>{const d=i.split("/").pop();e.append("removed_images[]",d)}),console.log("Datos enviados:",[...e.entries()]);let n;if(!o.value.id)n=await y.post(I,e),console.log("Respuesta del servidor (crear):",n),n&&n.data&&f.value.push(n.data),g.add({severity:"success",summary:"Producto agregado",life:3e3});else{e.append("_method","PUT"),n=await y.post(`${I}/${o.value.id}`,e),console.log("Respuesta del servidor (actualizar):",n);const i=f.value.findIndex(d=>d.id===o.value.id);i!==-1&&(f.value[i]=n.data),g.add({severity:"info",summary:"Producto actualizado",life:3e3})}await $(),x.value=!1,o.value={id:null,nombre:"",descripcion:"",precio:null,inventario_id:null,categoria_id:null},_.value=[],b.value=[],k.value=[]}catch(e){if(console.error("Error al guardar el producto",e),((l=e.response)==null?void 0:l.status)===422){const n=e.response.data.errors;g.add({severity:"error",summary:"Error de validación",detail:Object.values(n).flat().join(", "),life:4e3})}else g.add({severity:"error",summary:"Error",detail:"No se pudo guardar el producto.",life:3e3})}},G=l=>{o.value={...l},w.value=!0},H=async()=>{try{await y.delete(`${I}/${o.value.id}`),f.value=f.value.filter(l=>l.id!==o.value.id),w.value=!1,g.add({severity:"success",summary:"Producto eliminado",life:3e3})}catch(l){console.error("Error al eliminar el producto",l),g.add({severity:"error",summary:"Error",detail:"No se pudo eliminar el producto.",life:3e3})}},K=()=>{x.value=!1},q=l=>{for(const e of l.files)if(e instanceof File){_.value.push(e);const n=new FileReader;n.onload=i=>{b.value.push(i.target.result)},n.readAsDataURL(e)}else console.error("El archivo seleccionado no es válido:",e)},J=l=>{const e=b.value[l];k.value.push(e),b.value.splice(l,1)},Q=l=>{P.value=(l||[]).map(e=>`${$e}${e.nombre}`),S.value=!0};return(l,e)=>{const n=p("Toast"),i=p("Button"),d=p("Column"),W=p("DataTable"),T=p("InputText"),X=p("InputNumber"),F=p("Select"),Y=p("FileUpload"),D=p("Dialog");return v(),m(j,null,[t(A(le),{title:"Productos"}),t(ie,null,{default:c(()=>[t(n),a("div",ne,[a("div",re,[e[10]||(e[10]=a("h3",{class:"text-xl font-bold"},"Catálogo productos",-1)),t(i,{label:"Agregar producto",icon:"pi pi-plus",class:"p-button-sm p-button-danger",onClick:z})]),t(W,{value:f.value,dataKey:"id"},{default:c(()=>[t(d,{field:"nombre",header:"Nombre"}),t(d,{field:"descripcion",header:"Descripción"}),t(d,{field:"precio",header:"Precio"}),t(d,{field:"inventario.estado",header:"Inventario"}),t(d,{field:"categoria.nombre",header:"Categoría"}),t(d,{header:"Acciones"},{body:c(s=>[t(i,{icon:"pi pi-eye",class:"p-button-rounded p-button-info p-button-md mr-2",onClick:C=>Q(s.data.imagenes)},null,8,["onClick"]),t(i,{icon:"pi pi-pencil",class:"p-button-rounded p-button-warn p-button-md mr-2",onClick:C=>O(s.data)},null,8,["onClick"]),t(i,{icon:"pi pi-trash",class:"p-button-rounded p-button-danger p-button-md",onClick:C=>G(s.data)},null,8,["onClick"])]),_:1})]),_:1},8,["value"]),t(D,{visible:x.value,"onUpdate:visible":e[5]||(e[5]=s=>x.value=s),header:V.value+" Producto",modal:!0,style:{width:"500px"}},{footer:c(()=>[a("div",Ee,[t(i,{label:"Cancelar",icon:"pi pi-times",class:"p-button-rounded p-button-danger p-button-md mr-2",text:"",onClick:K}),t(i,{label:V.value,icon:"pi pi-check",class:"p-button-rounded p-button-warn p-button-md mr-2",onClick:R},null,8,["label"])])]),default:c(()=>[a("div",ue,[a("div",de,[a("div",ce,[e[11]||(e[11]=a("label",{for:"nombre",class:"w-24"},"Nombre:",-1)),t(T,{modelValue:o.value.nombre,"onUpdate:modelValue":e[0]||(e[0]=s=>o.value.nombre=s),modelModifiers:{trim:!0},id:"nombre",class:E([{"p-invalid":u.value&&!o.value.nombre},"flex-1"])},null,8,["modelValue","class"])]),u.value&&!o.value.nombre?(v(),m("small",pe,"El nombre es obligatorio.")):h("",!0)]),a("div",me,[a("div",ve,[e[12]||(e[12]=a("label",{for:"descripcion",class:"w-24"},"Descripción:",-1)),t(T,{modelValue:o.value.descripcion,"onUpdate:modelValue":e[1]||(e[1]=s=>o.value.descripcion=s),modelModifiers:{trim:!0},id:"descripcion",class:E([{"p-invalid":u.value&&!o.value.descripcion},"flex-1"])},null,8,["modelValue","class"])]),u.value&&!o.value.descripcion?(v(),m("small",fe,"La descripción es obligatoria.")):h("",!0)]),a("div",be,[a("div",ge,[e[13]||(e[13]=a("label",{for:"precio",class:"w-24"},"Precio:",-1)),t(X,{modelValue:o.value.precio,"onUpdate:modelValue":e[2]||(e[2]=s=>o.value.precio=s),id:"precio",mode:"currency",currency:"USD",locale:"en-US",min:.01,max:9999.99,maxFractionDigits:2,minFractionDigits:2,class:E([{"p-invalid":u.value&&(!o.value.precio||o.value.precio<=0||o.value.precio>999999.99)},"flex-1"])},null,8,["modelValue","class"])]),u.value&&(o.value.precio==null||o.value.precio<=0||o.value.precio>999999.99)?(v(),m("small",_e," El precio es obligatorio, debe ser mayor a 0 y menor o igual a 9999.99. ")):h("",!0)]),a("div",xe,[a("div",ye,[e[14]||(e[14]=a("label",{for:"inventario"},"Inventario",-1)),t(F,{placeholder:"Seleccionar...",modelValue:o.value.inventario_id,"onUpdate:modelValue":e[3]||(e[3]=s=>o.value.inventario_id=s),options:U.value,"option-label":"estado","option-value":"id",class:"w-full"},null,8,["modelValue","options"]),u.value&&!o.value.inventario_id?(v(),m("small",he,"Seleccione un inventario")):h("",!0)]),a("div",we,[e[15]||(e[15]=a("label",{for:"categoria"},"Categorías",-1)),t(F,{placeholder:"Seleccionar...",modelValue:o.value.categoria_id,"onUpdate:modelValue":e[4]||(e[4]=s=>o.value.categoria_id=s),options:N.value,"option-label":"nombre","option-value":"id",class:"w-full"},null,8,["modelValue","options"]),u.value&&!o.value.categoria_id?(v(),m("small",ke,"Seleccione una categoría")):h("",!0)])]),a("div",Ce,[a("div",Ve,[e[16]||(e[16]=a("label",{for:"imagen",class:"w-24"},"Imágenes:",-1)),t(Y,{mode:"basic",name:"imagenes[]",accept:"image/*",auto:!0,chooseLabel:"Seleccionar imágenes",onSelect:q,customUpload:!0,multiple:!0,class:"flex-1 p-button-rounded p-button-warn p-button-md mr-2"})]),h("",!0)]),a("div",Se,[(v(!0),m(j,null,ae(b.value,(s,C)=>(v(),m("div",{key:C,class:"relative w-32 h-32"},[a("img",{src:s,alt:"Vista previa",class:"w-full h-full object-cover rounded border"},null,8,Ie),a("button",{onClick:Fe=>J(C),class:"absolute top-0 right-0 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 shadow",style:{transform:"translate(50%, -50%)"}},e[17]||(e[17]=[a("i",{class:"pi pi-times text-xs"},null,-1)]),8,De)]))),128))])])]),_:1},8,["visible","header"]),t(D,{visible:w.value,"onUpdate:visible":e[7]||(e[7]=s=>w.value=s),header:"Confirmar",modal:!0,style:{width:"350px"}},{footer:c(()=>[t(i,{label:"No",icon:"pi pi-times",text:"",onClick:e[6]||(e[6]=s=>w.value=!1),class:"p-button-rounded p-button-warn p-button-md mr-2"}),t(i,{label:"Sí",icon:"pi pi-check",severity:"danger",onClick:H})]),default:c(()=>[a("span",null,[e[18]||(e[18]=B("¿Eliminar el producto ")),a("b",null,te(o.value.nombre),1),e[19]||(e[19]=B("?"))])]),_:1},8,["visible"]),t(D,{visible:S.value,"onUpdate:visible":e[9]||(e[9]=s=>S.value=s),header:"Imágenes del producto",modal:!0,style:{width:"700px"}},{footer:c(()=>[a("div",Pe,[t(i,{label:"Cerrar",icon:"pi pi-times",class:"p-button-rounded-md p-button-danger",onClick:e[8]||(e[8]=s=>S.value=!1)})])]),default:c(()=>[t(A(se),{value:P.value,numVisible:1,numScroll:1,circular:"",responsiveOptions:[{breakpoint:"1024px",numVisible:1,numScroll:1},{breakpoint:"600px",numVisible:1,numScroll:1}],showNavigators:!0,showIndicators:!0},{item:c(s=>[a("div",Ue,[a("img",{src:s.data,alt:"Producto",class:"max-h-full max-w-full object-contain rounded shadow"},null,8,Ne)])]),_:1},8,["value"])]),_:1},8,["visible"])])]),_:1})],64)}}};export{Le as default};
