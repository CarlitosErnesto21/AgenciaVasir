import{p as j,r as p,s as M,l as R,i as D,f as F,o as H,a as l,u as t,g as O,w as c,b as n,z as X,K as m,X as V,Y as G,Z as N,$,e as U,t as I,F as K,B as w}from"./app-DP8tsAem.js";import{_ as W}from"./AuthenticatedLayout-BvfF3yw2.js";import{s as h}from"./index-CPLYCsb2.js";import"./logo-DN1bLr27.js";import"./index-ClJ1gEnJ.js";const Y={class:"py-6 px-2 sm:px-4 md:px-6 mt-10 mx-auto bg-red-50 shadow-md rounded-lg max-w-3xl"},Z={class:"flex justify-between items-center mb-4"},J={class:"flex flex-col md:flex-row items-center gap-4 mt-10 mb-2"},Q={class:"flex justify-end"},_={class:"flex flex-col gap-3"},ee={class:"flex flex-col gap-3"},ae={class:"mb-4"},ne={__name:"ControlCategorias",setup(oe){const u=j(),E=p([]),k=[{label:"Tours",value:"tours"},{label:"Productos",value:"productos"},{label:"Hoteles",value:"hoteles"}],d=p("tours"),x=p(""),P=[{label:"Tours",value:"tours"},{label:"Productos",value:"productos"},{label:"Hoteles",value:"hoteles"}],b=p(!1),g=p(!1),f=p(!1),s=p({id:null,nombre:"",tipo:null}),i=p({id:null,nombre:"",tipo:null}),C=p(null),y=async o=>{try{const e=o==="hoteles"?"categorias-hoteles":o==="productos"?"categorias-productos":"categorias-tours";console.log("Cargando categorías de:",`/api/${e}`);const a=await w.get(`/api/${e}`);console.log("Datos recibidos:",a.data),E.value=a.data.map(r=>({...r,tipo:o,categoria_id:r.id})),console.log("Categorías procesadas:",E.value)}catch(e){console.error("Error al cargar categorías:",e.response||e),u.add({severity:"error",summary:"Error",detail:`No se pudieron cargar las categorías de ${o}.`,life:3e3})}};M(()=>{y(d.value)}),R(d,o=>{y(o)});const T=D(()=>{let o=E.value.filter(e=>e.tipo===d.value);return x.value&&(o=o.filter(e=>e.nombre.toLowerCase().includes(x.value.toLowerCase()))),o});function q(){s.value={id:null,nombre:"",tipo:d.value},b.value=!0}async function A(){var o,e;if(!s.value.nombre||!s.value.tipo){u.add({severity:"error",summary:"Error",detail:"Por favor completa todos los campos.",life:3e3});return}try{const a=s.value.tipo,r=a==="hoteles"?"categorias-hoteles":a==="productos"?"categorias-productos":"categorias-tours";console.log("Enviando petición a:",`/api/${r}`,"con datos:",{nombre:s.value.nombre});const v=await w.post(`/api/${r}`,{nombre:s.value.nombre});console.log("Respuesta:",v),u.add({severity:"success",summary:"Éxito",detail:"Categoría agregada correctamente.",life:3e3}),b.value=!1,y(d.value)}catch(a){console.error("Error al guardar categoría:",a.response||a);const r=((e=(o=a.response)==null?void 0:o.data)==null?void 0:e.message)||"No se pudo agregar la categoría.";u.add({severity:"error",summary:"Error",detail:r,life:3e3})}}function L(o){console.log("Editando categoría:",o),i.value={id:o.id,nombre:o.nombre,tipo:o.tipo},g.value=!0}async function z(){var o,e;if(!i.value.nombre||!i.value.tipo){u.add({severity:"error",summary:"Error",detail:"Por favor completa todos los campos.",life:3e3});return}try{const a=i.value.tipo;(await w({method:"POST",url:`/api/${a==="hoteles"?"categorias-hoteles":a==="productos"?"categorias-productos":"categorias-tours"}/${i.value.id}`,data:{_method:"PUT",nombre:i.value.nombre}})).data.categoria&&(u.add({severity:"success",summary:"Éxito",detail:"Categoría actualizada correctamente",life:3e3}),g.value=!1,await y(d.value))}catch(a){console.error("Error al actualizar:",a),u.add({severity:"error",summary:"Error",detail:((e=(o=a.response)==null?void 0:o.data)==null?void 0:e.message)||"No se pudo actualizar la categoría",life:3e3})}}function B(o){console.log("Confirmando eliminación de categoría:",o),C.value={id:o.id,nombre:o.nombre,tipo:o.tipo},f.value=!0}async function S(){var o,e;try{const a=C.value.tipo,r=a==="hoteles"?"categorias-hoteles":a==="productos"?"categorias-productos":"categorias-tours";console.log("Intentando eliminar:",{tipo:a,ruta:r,id:C.value.id});const v=await w({method:"POST",url:`/api/${r}/${C.value.id}`,data:{_method:"DELETE"},headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"}});console.log("Respuesta del servidor:",v.data),(v.data.success||v.status===200)&&(u.add({severity:"success",summary:"Éxito",detail:v.data.message||"Categoría eliminada correctamente",life:3e3}),f.value=!1,await y(d.value))}catch(a){console.error("Error al eliminar:",a),u.add({severity:"error",summary:"Error",detail:((e=(o=a.response)==null?void 0:o.data)==null?void 0:e.message)||"No se pudo eliminar la categoría",life:3e3})}}return(o,e)=>(H(),F(K,null,[l(t(O),{title:"Categorías de Tours"}),l(W,null,{default:c(()=>[l(t(X)),n("div",Y,[n("div",Z,[e[12]||(e[12]=n("h3",{class:"text-xl font-bold text-center w-full"},"Control de Categorías",-1)),l(t(m),{label:"Agregar Categoría",icon:"pi pi-plus",class:"p-button-danger",onClick:q})]),n("div",J,[e[13]||(e[13]=n("label",{for:"tipo-estado",class:"font-semibold mb-0"},"Ver categorías:",-1)),l(t(h),{id:"tipo-estado",modelValue:d.value,"onUpdate:modelValue":e[0]||(e[0]=a=>d.value=a),options:P,optionValue:"value",optionLabel:"label",class:"w-36"},null,8,["modelValue"]),e[14]||(e[14]=n("label",{for:"busqueda-nombre-general",class:"sr-only"},"Buscar por nombre",-1)),l(t(V),{id:"busqueda-nombre-general",name:"busqueda-nombre-general",modelValue:x.value,"onUpdate:modelValue":e[1]||(e[1]=a=>x.value=a),placeholder:"Buscar por nombre...",class:"w-64"},null,8,["modelValue"])]),l(t(G),{value:T.value,class:"mb-4 min-w-[400px] w-full",rows:8,paginator:T.value.length>8,rowsPerPageOptions:[8,16]},{default:c(()=>[l(t(N),{field:"nombre",header:"Nombre"}),l(t(N),{header:"Acciones",style:{"text-align":"right",width:"200px"}},{body:c(a=>[n("div",Q,[l(t(m),{label:"Editar",icon:"pi pi-pencil",class:"p-button-sm p-button-info mr-2",onClick:r=>L(a.data)},null,8,["onClick"]),l(t(m),{label:"Eliminar",icon:"pi pi-trash",class:"p-button-sm p-button-danger",onClick:r=>B(a.data)},null,8,["onClick"])])]),_:1})]),_:1},8,["value","paginator"]),l(t($),{visible:b.value,"onUpdate:visible":e[5]||(e[5]=a=>b.value=a),header:"Agregar Categoría",modal:!0,closable:!1,style:{width:"350px"}},{footer:c(()=>[l(t(m),{label:"Guardar",icon:"pi pi-check",class:"p-button-rounded p-button-warn mr-2",onClick:A,disabled:!s.value.nombre},null,8,["disabled"]),l(t(m),{label:"Cerrar",icon:"pi pi-times",class:"p-button-rounded p-button-danger mr-2",onClick:e[4]||(e[4]=a=>b.value=!1)})]),default:c(()=>[n("div",_,[l(t(h),{modelValue:s.value.tipo,"onUpdate:modelValue":e[2]||(e[2]=a=>s.value.tipo=a),options:k,optionLabel:"label",optionValue:"value",placeholder:"Tipo de categoría",class:"w-full"},null,8,["modelValue"]),l(t(V),{modelValue:s.value.nombre,"onUpdate:modelValue":e[3]||(e[3]=a=>s.value.nombre=a),placeholder:"Nombre",class:"w-full"},null,8,["modelValue"])])]),_:1},8,["visible"]),l(t($),{visible:g.value,"onUpdate:visible":e[9]||(e[9]=a=>g.value=a),header:"Editar Categoría",modal:!0,closable:!1,style:{width:"350px"}},{footer:c(()=>[l(t(m),{label:"Actualizar",icon:"pi pi-check",onClick:z,disabled:!i.value.nombre},null,8,["disabled"]),l(t(m),{label:"Cerrar",icon:"pi pi-times",class:"p-button-text",onClick:e[8]||(e[8]=a=>g.value=!1)})]),default:c(()=>[n("div",ee,[l(t(h),{modelValue:i.value.tipo,"onUpdate:modelValue":e[6]||(e[6]=a=>i.value.tipo=a),options:k,optionLabel:"label",optionValue:"value",placeholder:"Tipo de categoría",class:"w-full"},null,8,["modelValue"]),l(t(V),{modelValue:i.value.nombre,"onUpdate:modelValue":e[7]||(e[7]=a=>i.value.nombre=a),placeholder:"Nombre",class:"w-full"},null,8,["modelValue"])])]),_:1},8,["visible"]),l(t($),{visible:f.value,"onUpdate:visible":e[11]||(e[11]=a=>f.value=a),header:"Eliminar Categoría",modal:!0,closable:!1,style:{width:"350px"}},{footer:c(()=>[l(t(m),{label:"Eliminar",icon:"pi pi-trash",class:"p-button-danger",onClick:S}),l(t(m),{label:"Cancelar",icon:"pi pi-times",class:"p-button-text",onClick:e[10]||(e[10]=a=>f.value=!1)})]),default:c(()=>{var a;return[n("div",ae,[e[15]||(e[15]=U("¿Seguro que deseas eliminar la categoría ")),n("b",null,I((a=C.value)==null?void 0:a.nombre),1),e[16]||(e[16]=U("?"))])]}),_:1},8,["visible"])])]),_:1})],64))}};export{ne as default};
