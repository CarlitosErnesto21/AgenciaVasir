import{r as i,E as B,w as me,n as j,o as ve,a6 as ge,N as P,k as E,h as be,d as v,x as d,p as l,e as t,$ as o,a0 as pe,a2 as fe,y as D,q as T,t as w,A as W,c as g,j as L}from"./vendor-gbh1WW5n.js";import{A as he}from"./AuthenticatedLayout-DUTj9WxD.js";import{z as we,A as ye,F as u}from"./ui-BrU4k96Z.js";import{c as I,e as xe,k as Ce,l as q,m as _e,n as ke,a as Z,o as J,i as H,p as Pe}from"./index-BURLB9l4.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Ee={class:"container mx-auto px-4 py-6"},De={class:"mb-6 mt-2"},Te={class:"bg-white rounded-lg shadow-md"},Le={class:"flex flex-col sm:flex-row lg:justify-between lg:items-center gap-4 p-1 sm:p-1 md:p-3 lg:p-4"},Ne={class:"flex items-center gap-2 w-full justify-center lg:w-auto lg:justify-end"},Se={class:"bg-blue-50 p-3 rounded-lg shadow-sm border mb-4"},Ae={class:"space-y-3"},ze={class:"relative"},Ue={class:"text-sm font-medium leading-relaxed"},Ve={class:"flex gap-2 justify-center items-center"},Oe=["onClick"],Me=["onClick"],je={class:"space-y-4"},We={class:"w-full flex flex-col"},Ie={class:"flex items-center gap-4"},Re={key:0,class:"text-gray-500 ml-28 text-xs"},Fe={key:1,class:"text-red-500 ml-28"},Ge={key:2,class:"text-orange-500 ml-28"},$e={key:3,class:"text-red-500 ml-28"},Be={key:4,class:"text-red-500 ml-28"},qe={class:"flex justify-center gap-4 w-full mt-6"},Ze=["disabled"],Je={key:0},He={key:1},Ke=["disabled"],Xe={class:"flex items-center gap-3"},Qe={class:"flex flex-col"},Ye={class:"flex justify-center gap-4 w-full"},ea=["disabled"],aa={key:0},ta={key:1},sa=["disabled"],oa={class:"flex items-center gap-3"},la={class:"flex justify-center gap-3 w-full"},ma={__name:"CategoriaProductos",setup(ra){const c=we(),z=i([]),a=i({id:null,nombre:""}),b=i(!1),p=i(!1),N=i(!1),U=i(typeof window<"u"?window.innerWidth:1024),V=B(()=>U.value<640?{width:"95vw",maxWidth:"380px"}:U.value<768?{width:"400px"}:{width:"450px"}),f=i(!1),y=i(!1),_=i(!1),x=i(!1),C=i(!1),h=i(null),S=i({global:{value:null,matchMode:ye.CONTAINS}}),O=i(10),K=i([5,10,20,50]),k=i("Guardar"),X=B(()=>{let s=z.value;if(S.value.global.value){const e=S.value.global.value.toLowerCase();s=s.filter(r=>r.nombre.toLowerCase().includes(e))}return s});me([a],()=>{h.value&&f.value&&j(()=>{const s={...a.value},e=JSON.stringify(s)!==JSON.stringify(h.value),r=!h.value.id,m=a.value.nombre;C.value=e||r&&m})},{deep:!0,flush:"post"});function A(){a.value={id:null,nombre:""},x.value=!1}const R=()=>{typeof window<"u"&&(U.value=window.innerWidth)},Q=()=>{N.value=!0};ve(()=>{Y(),typeof window<"u"&&window.addEventListener("resize",R)}),ge(()=>{typeof window<"u"&&window.removeEventListener("resize",R)});const F=async()=>{try{const s=await P.get("/api/categorias-productos");z.value=(s.data.data||s.data||[]).map(e=>({...e,categoria_id:e.id})).sort((e,r)=>new Date(r.created_at)-new Date(e.created_at))}catch{c.add({severity:"error",summary:"Error",detail:"No se pudieron cargar las categorías de productos.",life:4e3})}},Y=async()=>{c.add({severity:"info",summary:"Cargando categorías...",life:2e3});try{const s=await P.get("/api/categorias-productos");z.value=(s.data.data||s.data||[]).map(e=>({...e,categoria_id:e.id})).sort((e,r)=>new Date(r.created_at)-new Date(e.created_at)),c.add({severity:"success",summary:"Categorías cargadas",life:2e3})}catch{c.add({severity:"error",summary:"Error",detail:"No se pudieron cargar las categorías de productos.",life:4e3})}},ee=()=>{A(),k.value="Guardar",x.value=!1,f.value=!0,j(()=>{h.value={...a.value},C.value=!1})},ae=s=>{A(),x.value=!1,a.value={...s},k.value="Actualizar",f.value=!0,j(()=>{h.value={...a.value},C.value=!1})},te=async()=>{var s,e;if(x.value=!0,b.value=!0,!a.value.nombre||a.value.nombre.length<3||a.value.nombre.length>50){c.add({severity:"warn",summary:"Campos requeridos",detail:"El nombre debe tener entre 3 y 50 caracteres.",life:4e3}),b.value=!1;return}try{a.value.id?(await P.put(`/api/categorias-productos/${a.value.id}`,{nombre:a.value.nombre}),c.add({severity:"success",summary:"¡Éxito!",detail:"La categoría ha sido actualizada correctamente.",life:5e3})):(await P.post("/api/categorias-productos",{nombre:a.value.nombre}),c.add({severity:"success",summary:"¡Éxito!",detail:"La categoría ha sido creada correctamente.",life:5e3})),await F(),f.value=!1,C.value=!1,h.value=null,A()}catch(r){console.error("Error al procesar categoría:",r),c.add({severity:"error",summary:"Error",detail:((e=(s=r.response)==null?void 0:s.data)==null?void 0:e.message)||"Error al procesar la categoría",life:3e3})}finally{b.value=!1}},se=s=>{a.value={...s},y.value=!0},oe=async()=>{var s,e;p.value=!0;try{await P.delete(`/api/categorias-productos/${a.value.id}`),await F(),y.value=!1,c.add({severity:"success",summary:"¡Eliminada!",detail:"La categoría ha sido eliminada correctamente.",life:5e3})}catch(r){y.value=!1;const m=((e=(s=r.response)==null?void 0:s.data)==null?void 0:e.message)||r.message||"Error desconocido al eliminar la categoría";c.add({severity:"error",summary:"Error",detail:m,life:6e3})}finally{p.value=!1}},le=()=>{C.value?_.value=!0:G()},G=()=>{f.value=!1,_.value=!1,C.value=!1,h.value=null,A()},re=()=>{_.value=!1},ne=()=>{a.value.nombre&&a.value.nombre.length>50&&(a.value.nombre=a.value.nombre.substring(0,50))},ie=s=>{const e=s.target.value,r=e.match(/[^a-zA-ZáéíóúÁÉÍÓÚñÑ\s]/g);r&&r.length>0&&c.add({severity:"warn",summary:"Caracteres no permitidos",detail:"Solo se permiten letras, espacios y acentos. Se han removido los caracteres no válidos.",life:3e3});const m=e.replace(/[^a-zA-ZáéíóúÁÉÍÓÚñÑ\s]/g,"").toLocaleUpperCase("es-ES");s.target.value=m,a.value.nombre=m,ne()},de=s=>{s.preventDefault();const e=(s.clipboardData||window.clipboardData).getData("text"),r=e.replace(/[^a-zA-ZáéíóúÁÉÍÓÚñÑ\s]/g,"").replace(/\s+/g," ").trim().toLocaleUpperCase("es-ES");r!==e.toLocaleUpperCase("es-ES")&&c.add({severity:"info",summary:"Texto limpiado",detail:"Se han removido números y caracteres especiales del texto pegado y convertido a mayúsculas.",life:3e3});const m=r.length>50?r.substring(0,50):r;a.value.nombre=m,s.target.value=m};return(s,e)=>{const r=E("Toast"),m=E("InputText"),$=E("Column"),ue=E("DataTable"),M=E("Dialog");return v(),be(he,null,{default:d(()=>[l(o(pe),{title:"Control de Categorías de Productos"}),l(r,{class:"z-[9999]"}),t("div",Ee,[t("div",De,[l(o(fe),{href:s.route("productos"),onClick:Q,class:D([{"opacity-50 cursor-not-allowed":N.value},"inline-flex p-2 items-center bg-blue-500 hover:bg-blue-600 text-white hover:text-gray-200 rounded-md transition-colors duration-200 mb-4"]),title:"Regresar a Productos"},{default:d(()=>[l(o(u),{icon:N.value?o(I):o(xe),class:D({"animate-spin":N.value,"h-5 w-5 mr-2":!0})},null,8,["icon","class"]),e[7]||(e[7]=T(" Volver a Productos "))]),_:1,__:[7]},8,["href","class"])]),t("div",Te,[t("div",Le,[e[9]||(e[9]=t("div",{class:"text-center sm:text-left"},[t("h1",{class:"text-3xl font-bold text-blue-600 mb-2"},"Control de las Categorías de Productos"),t("p",{class:"text-gray-600"},"Gestiona las categorías de productos del inventario")],-1)),t("div",Ne,[t("button",{class:"bg-red-500 border border-red-500 p-2 text-sm text-white shadow-md hover:shadow-lg rounded-md hover:-translate-y-1 transition-transform duration-300 flex items-center gap-2",onClick:ee},[l(o(u),{icon:o(Ce),class:"h-4 w-4"},null,8,["icon"]),e[8]||(e[8]=t("span",null,"Agregar",-1))])])]),l(ue,{value:X.value,dataKey:"id",paginator:!0,rows:O.value,rowsPerPageOptions:K.value,rowsPerPage:O.value,"onUpdate:rowsPerPage":e[1]||(e[1]=n=>O.value=n),paginatorTemplate:"RowsPerPageDropdown FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink",currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} categorías",class:"overflow-x-auto max-w-full",responsiveLayout:"scroll"},{header:d(()=>[t("div",Se,[t("div",Ae,[t("div",ze,[l(o(u),{icon:o(ke),class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"},null,8,["icon"]),l(m,{modelValue:S.value.global.value,"onUpdate:modelValue":e[0]||(e[0]=n=>S.value.global.value=n),placeholder:"Buscar categorías...",class:"w-full h-9 text-sm rounded-md pl-10",style:{"background-color":"white","border-color":"#93c5fd"}},null,8,["modelValue"])])])])]),default:d(()=>[l($,{field:"nombre",header:"Nombre",sortable:"",class:"w-96 min-w-52"},{body:d(n=>[t("div",Ue,w(n.data.nombre),1)]),_:1}),l($,{exportable:!1,class:"w-52 min-w-28"},{header:d(()=>e[10]||(e[10]=[t("div",{class:"text-center w-full font-bold"}," Acciones ",-1)])),body:d(n=>[t("div",Ve,[t("button",{class:"flex bg-blue-500 border p-1 py-2 sm:p-2 text-sm shadow-md hover:shadow-lg rounded-md hover:-translate-y-1 transition-transform duration-300",onClick:ce=>ae(n.data)},[l(o(u),{icon:o(q),class:"h-3 w-6 sm:h-4 sm:w-7 text-white"},null,8,["icon"]),e[11]||(e[11]=t("span",{class:"hidden md:block text-white"},"Editar",-1))],8,Oe),t("button",{class:"flex bg-red-500 border p-1 py-2 sm:p-2 text-sm shadow-md hover:shadow-lg rounded-md hover:-translate-y-1 transition-transform duration-300",onClick:ce=>se(n.data)},[l(o(u),{icon:o(_e),class:"h-3 w-6 sm:h-4 sm:w-7 text-white"},null,8,["icon"]),e[12]||(e[12]=t("span",{class:"hidden md:block text-white"},"Eliminar",-1))],8,Me)])]),_:1})]),_:1},8,["value","rows","rowsPerPageOptions","rowsPerPage"]),l(M,{visible:f.value,"onUpdate:visible":e[3]||(e[3]=n=>f.value=n),header:k.value+" Categoría",modal:!0,style:W(V.value),closable:!1,draggable:!1},{footer:d(()=>[t("div",qe,[t("button",{class:"bg-red-500 hover:bg-red-700 text-white border-none px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",onClick:te,disabled:b.value||!a.value.nombre||a.value.nombre.length<3||a.value.nombre.length>50},[l(o(u),{icon:b.value?o(I):o(Z),class:D(["h-5 text-white",{"animate-spin":b.value}])},null,8,["icon","class"]),b.value?(v(),g("span",He,w(k.value==="Guardar"?"Guardando...":"Actualizando..."),1)):(v(),g("span",Je,w(k.value),1))],8,Ze),t("button",{type:"button",class:"bg-blue-500 hover:bg-blue-700 text-white px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",onClick:le,disabled:b.value},[l(o(u),{icon:o(J),class:"h-5"},null,8,["icon"]),e[14]||(e[14]=T("Cancelar "))],8,Ke)])]),default:d(()=>[t("div",je,[t("div",We,[t("div",Ie,[e[13]||(e[13]=t("label",{for:"nombre",class:"w-24 flex items-center gap-1"},[T(" Nombre: "),t("span",{class:"text-red-500 font-bold"},"*")],-1)),l(m,{modelValue:a.value.nombre,"onUpdate:modelValue":e[2]||(e[2]=n=>a.value.nombre=n),modelModifiers:{trim:!0},id:"nombre",name:"nombre",maxlength:50,class:D([{"p-invalid":x.value&&(!a.value.nombre||a.value.nombre.length<3||a.value.nombre.length>50),"border-orange-400 focus:border-orange-500":a.value.nombre&&a.value.nombre.length>45&&a.value.nombre.length<=50,"border-red-400 focus:border-red-500":a.value.nombre&&a.value.nombre.length>50},"flex-1 border-2 border-gray-400 hover:border-gray-500 focus:border-gray-500 focus:ring-0 focus:shadow-none rounded-md"]),onInput:ie,onPaste:de,placeholder:"MALETAS, ACCESORIOS, ROPA, ETC."},null,8,["modelValue","class"])]),a.value.nombre?(v(),g("small",Re," Caracteres: "+w(a.value.nombre.length)+"/50 ",1)):L("",!0),a.value.nombre&&a.value.nombre.length<3?(v(),g("small",Fe," El nombre debe tener al menos 3 caracteres. ")):L("",!0),a.value.nombre&&a.value.nombre.length>45&&a.value.nombre.length<=50?(v(),g("small",Ge," Te quedan "+w(50-a.value.nombre.length)+" caracteres ",1)):L("",!0),a.value.nombre&&a.value.nombre.length>50?(v(),g("small",$e," Has excedido el límite por "+w(a.value.nombre.length-50)+" caracteres ",1)):L("",!0),x.value&&!a.value.nombre?(v(),g("small",Be," El nombre es obligatorio. ")):L("",!0)])])]),_:1},8,["visible","header","style"]),l(M,{visible:y.value,"onUpdate:visible":e[5]||(e[5]=n=>y.value=n),header:"Eliminar categoría",modal:!0,style:W(V.value),closable:!1,draggable:!1},{footer:d(()=>[t("div",Ye,[t("button",{type:"button",class:"bg-red-500 hover:bg-red-700 text-white border-none px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",onClick:oe,disabled:p.value},[l(o(u),{icon:p.value?o(I):o(Z),class:D(["h-5",{"animate-spin":p.value}])},null,8,["icon","class"]),p.value?(v(),g("span",ta,"Eliminando...")):(v(),g("span",aa,"Eliminar"))],8,ea),t("button",{type:"button",class:"bg-blue-500 hover:bg-blue-700 text-white px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",onClick:e[4]||(e[4]=n=>y.value=!1),disabled:p.value},[l(o(u),{icon:o(J),class:"h-5"},null,8,["icon"]),e[18]||(e[18]=t("span",null,"Cancelar",-1))],8,sa)])]),default:d(()=>[t("div",Xe,[l(o(u),{icon:o(H),class:"h-8 w-8 text-red-500"},null,8,["icon"]),t("div",Qe,[t("span",null,[e[15]||(e[15]=T("¿Estás seguro de eliminar la categoría: ")),t("b",null,w(a.value.nombre),1),e[16]||(e[16]=T("?"))]),e[17]||(e[17]=t("span",{class:"text-red-600 text-sm font-medium mt-1"},"Esta acción es irreversible.",-1))])])]),_:1},8,["visible","style"]),l(M,{visible:_.value,"onUpdate:visible":e[6]||(e[6]=n=>_.value=n),header:"Cambios sin guardar",modal:!0,style:W(V.value),closable:!1,draggable:!1},{footer:d(()=>[t("div",la,[t("button",{type:"button",class:"bg-red-500 hover:bg-red-700 text-white border-none px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",onClick:G},[l(o(u),{icon:o(Pe),class:"h-4"},null,8,["icon"]),e[20]||(e[20]=t("span",null,"Salir sin guardar",-1))]),t("button",{type:"button",class:"bg-blue-500 hover:bg-blue-700 text-white px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",onClick:re},[l(o(u),{icon:o(q),class:"h-4"},null,8,["icon"]),e[21]||(e[21]=t("span",null,"Continuar",-1))])])]),default:d(()=>[t("div",oa,[l(o(u),{icon:o(H),class:"h-8 w-8 text-red-500"},null,8,["icon"]),e[19]||(e[19]=t("div",{class:"flex flex-col"},[t("span",null,"¡Tienes información sin guardar!"),t("span",{class:"text-red-600 text-sm font-medium mt-1"},"¿Deseas salir sin guardar?")],-1))])]),_:1},8,["visible","style"])])])]),_:1})}}};export{ma as default};
