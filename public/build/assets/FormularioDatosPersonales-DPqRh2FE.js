import{r as p,E as h,o as B,w as c,c as f,d as v,j as b,e as a,q as x,t as g,y as d,v as E,a7 as N,p as V,$ as P,a9 as z}from"./vendor-CaDzpwPW.js";import{z as L}from"./vue-tel-input-AlIeehSu.js";import{q as $}from"./ui-BjYE_i4I.js";const O={class:"space-y-6"},Y={key:0,class:"bg-gradient-to-r from-blue-50 to-purple-50 p-4 rounded-lg"},X={class:"text-sm text-gray-600 mb-1"},Z={class:"text-sm text-gray-600"},G={key:1,class:"flex items-center justify-between mb-3"},H={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},J=["value","maxlength","disabled","placeholder"],K=["disabled"],W={class:"grid grid-cols-1 sm:grid-cols-2 gap-4 mt-4"},Q=["disabled"],_={class:"grid grid-cols-1 sm:grid-cols-2 gap-4 mt-4"},ee={class:"mr-1"},te={class:"sm:col-span-1"},oe=["disabled"],ne={__name:"FormularioDatosPersonales",props:{formulario:{type:Object,required:!0},tieneClienteExistente:{type:Boolean,default:!1},user:{type:Object,default:null}},emits:["update:formulario","mostrar-toast"],setup(l,{expose:A,emit:I}){const u=l,n=I,S=p([{id:"DUI",nombre:"DUI"},{id:"PASAPORTE",nombre:"PASAPORTE"}]);p(!1);const i=p({isValid:!1,country:null,formattedNumber:"",mensaje:""}),o=h({get(){return u.formulario},set(t){n("update:formulario",t)}}),j=async t=>{try{t&&typeof t=="object"&&(i.value.isValid=t.valid===!0,i.value.country={name:t.country,code:t.countryCode},i.value.formattedNumber=t.formatted||"",t.valid===!0&&t.formatted&&(o.value.telefono=t.formatted),u.tieneClienteExistente?t.valid===!0?i.value.mensaje="Número válido (guardado previamente)":o.value.telefono&&t.valid===!1?i.value.mensaje="Número de teléfono inválido para "+t.country:i.value.mensaje="":o.value.telefono&&t.valid===!1?i.value.mensaje="Número de teléfono inválido para "+t.country:t.valid===!0?await R(o.value.telefono):i.value.mensaje="")}catch(e){console.error("[FormularioDatosPersonales] Error en validación:",e),i.value.mensaje="Error en validación"}},R=async t=>{var e,r;if(!(!t||t.length<8))try{const s=await(await fetch("/api/clientes/validar-telefono",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")||""}`,"X-CSRF-TOKEN":((e=document.querySelector('meta[name="csrf-token"]'))==null?void 0:e.getAttribute("content"))||"","X-Requested-With":"XMLHttpRequest"},credentials:"same-origin",body:JSON.stringify({telefono:t})})).json();s.disponible?i.value.mensaje="Número válido para "+((r=i.value.country)==null?void 0:r.name):(i.value.isValid=!1,i.value.mensaje=s.message||"Este teléfono ya está registrado")}catch(m){console.error("[FormularioDatosPersonales] Error validando teléfono:",m),i.value.mensaje="Error al validar teléfono"}},U=()=>{const t=new Date;return t.setFullYear(t.getFullYear()-18),t},C=t=>{if(!t)return{esValido:!0,mensaje:""};const e=new Date,r=new Date(t),m=e.getFullYear()-r.getFullYear(),s=r.getMonth(),k=r.getDate(),D=e.getMonth(),M=e.getDate(),w=m-(D<s||D===s&&M<k?1:0);return w<18?{esValido:!1,mensaje:`Debe ser mayor de edad (18 años). Edad actual: ${w} años`}:{esValido:!0,mensaje:""}};A({tiposDocumentos:S,validateForm:()=>{if(!o.value.tipo_documento)return n("mostrar-toast",{severity:"error",summary:"Campo requerido",detail:"Por favor, seleccione un tipo de documento.",life:4e3}),!1;if(!o.value.numero_identificacion)return n("mostrar-toast",{severity:"error",summary:"Campo requerido",detail:"Por favor, ingrese su número de identificación.",life:4e3}),!1;if(!y())return!1;if(o.value.fecha_nacimiento){const t=C(o.value.fecha_nacimiento);if(!t.esValido)return n("mostrar-toast",{severity:"error",summary:"Edad insuficiente",detail:t.mensaje,life:4e3}),!1}else return n("mostrar-toast",{severity:"error",summary:"Campo requerido",detail:"Por favor, seleccione su fecha de nacimiento.",life:4e3}),!1;return o.value.direccion?o.value.genero?o.value.telefono?o.value.telefono&&i.value.isValid===!1&&i.value.mensaje!=="Número válido (guardado previamente)"?(i.value.mensaje&&(i.value.mensaje.includes("registrado")||i.value.mensaje.includes("diferente"))?n("mostrar-toast",{severity:"warn",summary:"Teléfono ya registrado",detail:i.value.mensaje,life:5e3}):n("mostrar-toast",{severity:"error",summary:"Teléfono inválido",detail:"Por favor, ingrese un número de teléfono válido.",life:4e3}),!1):!0:(n("mostrar-toast",{severity:"error",summary:"Campo requerido",detail:"Por favor, ingrese su número de teléfono.",life:4e3}),!1):(n("mostrar-toast",{severity:"error",summary:"Campo requerido",detail:"Por favor, seleccione su género.",life:4e3}),!1):(n("mostrar-toast",{severity:"error",summary:"Campo requerido",detail:"Por favor, ingrese su dirección.",life:4e3}),!1)}});const F=t=>{const r=t.replace(/[^0-9]/g,"").substring(0,9);return r.length>8?r.substring(0,8)+"-"+r.substring(8):r},T=t=>t.toUpperCase().replace(/[^A-Z0-9]/g,"").substring(0,9),q=t=>{const e=t.target.value;let r="";o.value.tipo_documento==="DUI"?(r=F(e),o.value.numero_identificacion=r,t.target.value=r):o.value.tipo_documento==="PASAPORTE"&&(r=T(e),o.value.numero_identificacion=r,t.target.value=r),y()},y=()=>{if(!o.value.numero_identificacion)return!0;if(o.value.tipo_documento==="DUI"){if(!/^\d{8}-\d{1}$/.test(o.value.numero_identificacion))return n("mostrar-toast",{severity:"error",summary:"Formato incorrecto",detail:"El DUI debe tener 9 dígitos (formato: 12345678-9)",life:4e3}),!1}else if(o.value.tipo_documento==="PASAPORTE"&&!/^[A-Z0-9]{6,9}$/.test(o.value.numero_identificacion))return n("mostrar-toast",{severity:"error",summary:"Formato incorrecto",detail:"El PASAPORTE debe tener entre 6 y 9 caracteres (solo letras mayúsculas y números)",life:4e3}),!1;return!0};return B(()=>{}),c(()=>o.value.numero_identificacion,()=>{o.value.numero_identificacion&&o.value.tipo_documento&&y()}),c(()=>o.value.tipo_documento,()=>{o.value.numero_identificacion=""}),c(()=>o.value.fecha_nacimiento,t=>{if(t){const e=C(t);e.esValido||n("mostrar-toast",{severity:"error",summary:"Edad insuficiente",detail:e.mensaje,life:4e3})}}),c(()=>u.formulario.telefono,(t,e)=>{t&&t!==e&&u.tieneClienteExistente&&(i.value={isValid:!0,country:{name:"Válido",code:""},formattedNumber:t,mensaje:"Número válido (guardado previamente)"})},{immediate:!0}),(t,e)=>(v(),f("div",O,[l.user?(v(),f("div",Y,[e[7]||(e[7]=a("h3",{class:"font-bold text-lg text-gray-800 mb-2"},"Información de tu cuenta:",-1)),a("p",X,[e[5]||(e[5]=a("strong",null,"Nombre:",-1)),x(" "+g(l.user.name),1)]),a("p",Z,[e[6]||(e[6]=a("strong",null,"Email:",-1)),x(" "+g(l.user.email),1)])])):b("",!0),l.tieneClienteExistente?(v(),f("div",G,e[8]||(e[8]=[a("h4",{class:"font-semibold text-gray-800"},"Información Personal",-1),a("div",{class:"flex items-center text-green-600 text-sm"},[a("svg",{class:"w-4 h-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20"},[a("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})]),a("span",null,"Datos precargados")],-1)]))):b("",!0),a("div",H,[a("div",null,[e[9]||(e[9]=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Número de Identificación",-1)),a("input",{value:o.value.numero_identificacion,onInput:q,type:"text",required:"",maxlength:o.value.tipo_documento==="DUI"?10:9,disabled:l.tieneClienteExistente,class:d(["w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",{"bg-gray-100 cursor-not-allowed":l.tieneClienteExistente}]),placeholder:o.value.tipo_documento==="DUI"?"Ingrese 9 dígitos (ej: 123456789)":"Ingrese su PASAPORTE (ej: A1B2C3D4)"},null,42,J)]),a("div",null,[e[11]||(e[11]=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Tipo de Documento",-1)),E(a("select",{"onUpdate:modelValue":e[0]||(e[0]=r=>o.value.tipo_documento=r),required:"",disabled:l.tieneClienteExistente,class:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100"},e[10]||(e[10]=[a("option",{value:"",disabled:""},"Seleccione un tipo",-1),a("option",{value:"DUI"},"DUI",-1),a("option",{value:"PASAPORTE"},"PASAPORTE",-1)]),8,K),[[N,o.value.tipo_documento]])])]),a("div",W,[a("div",null,[e[12]||(e[12]=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Fecha de Nacimiento",-1)),V(P($),{modelValue:o.value.fecha_nacimiento,"onUpdate:modelValue":e[1]||(e[1]=r=>o.value.fecha_nacimiento=r),maxDate:U(),"date-format":"dd/mm/yy",placeholder:"Seleccionar fecha de nacimiento (debe ser mayor de 18 años)",showIcon:"",yearNavigator:"",yearRange:"1920:2006",disabled:l.tieneClienteExistente,class:"w-full",inputClass:`w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 ${l.tieneClienteExistente?"bg-gray-100 cursor-not-allowed":""}`},null,8,["modelValue","maxDate","disabled","inputClass"])]),a("div",null,[e[14]||(e[14]=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Género",-1)),E(a("select",{"onUpdate:modelValue":e[2]||(e[2]=r=>o.value.genero=r),required:"",disabled:l.tieneClienteExistente,class:d(["w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",{"bg-gray-100 cursor-not-allowed":l.tieneClienteExistente}])},e[13]||(e[13]=[a("option",{value:""},"Seleccione",-1),a("option",{value:"MASCULINO"},"Masculino",-1),a("option",{value:"FEMENINO"},"Femenino",-1)]),10,Q),[[N,o.value.genero]])])]),a("div",_,[a("div",null,[e[15]||(e[15]=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Teléfono",-1)),V(P(L),{modelValue:o.value.telefono,"onUpdate:modelValue":e[3]||(e[3]=r=>o.value.telefono=r),defaultCountry:"SV",preferredCountries:["SV","GT","HN","CR","NI","PA","BZ"],validCharactersOnly:!0,disabled:l.tieneClienteExistente,dropdownOptions:{showDialCodeInSelection:!0,showFlags:!0,showSearchBox:!0,showDialCodeInList:!0},inputOptions:{placeholder:"Número de teléfono"},mode:"international",class:d(["w-full border border-gray-300 rounded-lg",{"bg-gray-100 cursor-not-allowed":l.tieneClienteExistente}]),onValidate:j},null,8,["modelValue","disabled","class"]),i.value.mensaje?(v(),f("p",{key:0,class:d(["text-xs mt-1 flex items-center",i.value.isValid?"text-green-600":"text-red-600"])},[a("span",ee,g(i.value.isValid?"✓":"⚠️"),1),x(" "+g(i.value.mensaje),1)],2)):b("",!0)]),a("div",te,[e[16]||(e[16]=a("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Dirección",-1)),E(a("input",{"onUpdate:modelValue":e[4]||(e[4]=r=>o.value.direccion=r),type:"text",required:"",maxlength:"200",disabled:l.tieneClienteExistente,class:d(["w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",{"bg-gray-100 cursor-not-allowed":l.tieneClienteExistente}]),placeholder:"Dirección completa"},null,10,oe),[[z,o.value.direccion]])])])]))}};export{ne as default};
