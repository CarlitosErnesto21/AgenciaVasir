import{_ as H}from"./AuthenticatedLayout-baeqBx4a.js";import{r as x,s as L,y as Z,c as a,o as l,a as F,u as q,g as G,w as J,b as t,f as K,A as m,B as h,n as p,t as r,p as S,h as Q,E as A}from"./app-WKwrJkJC.js";import"./logo-DN1bLr27.js";import"./index-Cz7jU3Cp.js";const U={key:0,class:"flex justify-center items-center py-12"},W={key:1},X={class:"pt-6"},Y={class:"hidden md:grid md:grid-cols-5 gap-4 xl:gap-6 mt-6"},tt={class:"flex items-center justify-between mb-2"},et={class:"hidden sm:grid md:hidden"},st={class:"grid grid-cols-3 gap-3 mb-3"},ot={class:"flex items-center justify-between mb-1"},lt={class:"font-bold text-white text-xs leading-tight"},at={class:"font-extrabold text-white text-lg leading-none"},nt={class:"grid grid-cols-2 gap-3 max-w-md mx-auto"},it={class:"flex items-center justify-between mb-1"},dt={class:"font-bold text-white text-xs leading-tight"},rt={class:"font-extrabold text-white text-lg leading-none"},ct={class:"sm:hidden"},pt={class:"grid grid-cols-3 gap-2 mb-2"},ut={class:"flex flex-col items-center text-center"},xt={class:"font-bold text-white text-xs leading-none mb-1"},mt={class:"font-extrabold text-white text-sm leading-none"},gt={class:"grid grid-cols-2 gap-2"},ht={class:"flex flex-col items-center text-center"},ft={class:"font-bold text-white text-xs leading-none mb-1"},bt={class:"font-extrabold text-white text-sm leading-none"},vt={class:"pt-6 sm:pt-8 md:pt-10"},yt={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4 md:gap-6 mb-4 sm:mb-6 lg:mb-0"},_t={class:"w-full h-64 sm:h-80 md:h-96 rounded-lg shadow-lg bg-white overflow-hidden flex flex-col items-center p-2 sm:p-3 md:p-4"},wt={key:1,class:"flex items-center justify-center w-full h-full"},kt={class:"w-full h-64 sm:h-80 md:h-96 rounded-lg shadow-lg bg-white overflow-hidden flex flex-col items-center p-2 sm:p-3 md:p-4"},jt={key:1,class:"flex items-center justify-center w-full h-full"},Bt={class:"w-full h-64 sm:h-80 md:h-96 rounded-lg shadow-lg bg-white overflow-hidden flex flex-col items-center p-2 sm:p-3 md:p-4 sm:col-span-2 lg:col-span-1 sm:mx-auto lg:mx-0 sm:max-w-md lg:max-w-none"},St={key:1,class:"flex items-center justify-center w-full h-full"},At={key:0,class:"mt-6 sm:mt-8 md:mt-10 bg-white rounded-lg shadow-lg p-3 sm:p-4 md:p-6"},$t={class:"overflow-x-auto"},Ct={class:"min-w-full divide-y divide-gray-200"},Pt={class:"bg-white divide-y divide-gray-200"},Vt={class:"px-2 sm:px-3 md:px-6 py-2 sm:py-4 whitespace-nowrap text-xs sm:text-sm font-medium text-gray-900"},Et={class:"px-2 sm:px-3 md:px-6 py-2 sm:py-4 whitespace-nowrap text-xs sm:text-sm text-gray-500"},Ot={class:"px-2 sm:px-3 md:px-6 py-2 sm:py-4 whitespace-nowrap text-xs sm:text-sm text-gray-500"},zt={__name:"Dashboard",setup(Nt){const _=x(),w=x(),k=x(),$=x(),C=x(),P=x(),j=x(!0),f=x({}),u=x([{label:"Valor Inventario",value:"$0",icon:"pi pi-wallet",color:"from-green-500 to-green-300",text:"text-green-900",key:"valor_total_inventario"},{label:"Total Productos",value:"0",icon:"pi pi-box",color:"from-blue-600 to-blue-300",text:"text-blue-900",key:"total_productos"},{label:"Stock Bajo",value:"0",icon:"pi pi-exclamation-triangle",color:"from-yellow-500 to-yellow-400",text:"text-yellow-900",key:"productos_stock_bajo"},{label:"Agotados",value:"0",icon:"pi pi-times-circle",color:"from-red-600 to-red-400",text:"text-red-900",key:"productos_agotados"},{label:"Ventas Hoy",value:"0",icon:"pi pi-shopping-cart",color:"from-purple-600 to-purple-400",text:"text-purple-900",key:"ventas_hoy"}]),M=(s,o=null)=>{if(s.includes("$")){let n;return o&&o.valor_total_inventario?n=parseFloat(o.valor_total_inventario):n=parseFloat(s.replace(/[$,.\s]/g,"")),isNaN(n)?"$0":n>=1e6?"$"+(n/1e6).toFixed(1)+"M":n>=1e3?"$"+(n/1e3).toFixed(0)+"k":"$"+n.toFixed(0)}return s},R=async()=>{j.value=!0;try{const s=await A.get("/api/inventario/resumen",{headers:{Accept:"application/json"}}),o=await A.get("/api/ventas",{headers:{Accept:"application/json"}}),n=await A.get("/api/inventario/stock-bajo",{headers:{Accept:"application/json"}}),e=s.data.data||s.data,i=o.data.data||o.data||[],c=n.data.data||n.data||[];V(e,i),E(e,i,c),f.value={inventario:e,ventas:i,stockBajo:c}}catch{V({},[]),E({},[])}finally{j.value=!1}},V=(s,o)=>{const n=Array.isArray(o)?o:[],e=new Date().toISOString().split("T")[0],i=n.filter(c=>c.fecha?c.fecha.split("T")[0]===e:!1).length;u.value[0].value=`$${Number(s.valor_total_inventario||0).toLocaleString("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2})}`,u.value[1].value=(s.total_productos||0).toString(),u.value[2].value=(s.productos_stock_bajo||0).toString(),u.value[3].value=(s.productos_agotados||0).toString(),u.value[4].value=(s.movimientos_hoy||i||0).toString()},E=(s,o,n)=>{const e=s.total_productos||0,i=s.productos_stock_bajo||0,c=s.productos_agotados||0,O=s.productos_disponibles||Math.max(0,e-i-c),N=Array.isArray(o)?o:[];_.value={labels:["Productos Disponibles","Stock Bajo","Agotados"],datasets:[{label:"Estado del Inventario",data:[O,i,c],backgroundColor:["#10b981","#f59e0b","#ef4444"],hoverBackgroundColor:["#34d399","#fbbf24","#f87171"]}]};const v=N.reduce((d,g)=>{const b=g.estado||"Sin estado";return d[b]=(d[b]||0)+1,d},{});Object.keys(v).length===0&&(v["Sin ventas"]=0),w.value={labels:Object.keys(v),datasets:[{label:"Ventas por Estado",data:Object.values(v),backgroundColor:["#3b82f6","#10b981","#f59e0b","#ef4444"]}]};const B={};N.forEach(d=>{d.detalle_ventas&&Array.isArray(d.detalle_ventas)&&d.detalle_ventas.forEach(g=>{var D;const b=((D=g.producto)==null?void 0:D.nombre)||"Producto desconocido";B[b]=(B[b]||0)+(g.cantidad||0)})});let y=Object.entries(B).sort(([,d],[,g])=>g-d).slice(0,5);y.length===0&&(y=[["Sin ventas",0]]),k.value={labels:y.map(([d])=>d),datasets:[{label:"Productos Más Vendidos",data:y.map(([,d])=>d),backgroundColor:["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6"]}]}},z=()=>({maintainAspectRatio:!1,plugins:{title:{display:!0,text:"Estado del Inventario",font:{size:18}},legend:{display:!0,position:"bottom",labels:{usePointStyle:!0,color:"#374151"}},tooltip:{callbacks:{label:function(s){return`${s.label}: ${s.parsed} productos`}}}}}),I=()=>({maintainAspectRatio:!1,plugins:{title:{display:!0,text:"Ventas por Estado",font:{size:18}},legend:{display:!1},tooltip:{callbacks:{label:function(s){return`${s.label}: ${s.parsed.y} ventas`}}}},scales:{x:{ticks:{color:"#374151"},grid:{color:"#e5e7eb"}},y:{beginAtZero:!0,ticks:{color:"#374151"},grid:{color:"#e5e7eb"}}}}),T=()=>({maintainAspectRatio:!1,plugins:{title:{display:!0,text:"Productos Más Vendidos",font:{size:18}},legend:{display:!0,position:"bottom",labels:{usePointStyle:!0,color:"#374151"}},tooltip:{callbacks:{label:function(s){return`${s.label}: ${s.parsed} unidades`}}}}});return L(()=>{$.value=z(),C.value=I(),P.value=T(),R()}),(s,o)=>{const n=Z("Chart");return l(),a(m,null,[F(q(G),{title:"Dashboard"}),F(H,null,{default:J(()=>[j.value?(l(),a("div",U,o[0]||(o[0]=[t("div",{class:"text-center"},[t("i",{class:"pi pi-spin pi-spinner text-4xl text-indigo-600 mb-4"}),t("p",{class:"text-gray-600"},"Cargando datos del dashboard...")],-1)]))):(l(),a("div",W,[t("div",X,[t("div",Y,[(l(!0),a(m,null,h(u.value,e=>(l(),a("div",{key:e.label,class:p(["flex flex-col justify-between rounded-xl shadow-lg bg-gradient-to-br p-4 xl:p-6 min-h-[100px] xl:min-h-[110px]",e.color])},[t("div",tt,[t("span",{class:p(["font-bold text-white leading-tight",e.label.length>12?"text-sm xl:text-base":"text-base xl:text-lg"])},r(e.label),3),t("i",{class:p(e.icon+" text-xl xl:text-2xl text-white flex-shrink-0")},null,2)]),t("span",{class:p(["font-extrabold text-white leading-none",e.value.length>8?"text-xl xl:text-2xl":"text-2xl xl:text-3xl"])},r(e.value),3)],2))),128))]),t("div",et,[t("div",st,[(l(!0),a(m,null,h(u.value.slice(0,3),(e,i)=>(l(),a("div",{key:e.label,class:p(["flex flex-col justify-between rounded-xl shadow-lg bg-gradient-to-br p-3 min-h-[85px]",e.color])},[t("div",ot,[t("span",lt,r(e.label.split(" ").map(c=>c.slice(0,6)).join(" ")),1),t("i",{class:p(e.icon+" text-lg text-white flex-shrink-0")},null,2)]),t("span",at,r(e.value.length>10?e.value.slice(0,10)+"...":e.value),1)],2))),128))]),t("div",nt,[(l(!0),a(m,null,h(u.value.slice(3,5),(e,i)=>(l(),a("div",{key:e.label,class:p(["flex flex-col justify-between rounded-xl shadow-lg bg-gradient-to-br p-3 min-h-[85px]",e.color])},[t("div",it,[t("span",dt,r(e.label.split(" ").map(c=>c.slice(0,6)).join(" ")),1),t("i",{class:p(e.icon+" text-lg text-white flex-shrink-0")},null,2)]),t("span",rt,r(e.value),1)],2))),128))])]),t("div",ct,[t("div",pt,[(l(!0),a(m,null,h(u.value.slice(0,3),(e,i)=>(l(),a("div",{key:e.label,class:p(["flex flex-col justify-between rounded-lg shadow-lg bg-gradient-to-br p-2 min-h-[70px]",e.color])},[t("div",ut,[t("i",{class:p(e.icon+" text-base text-white mb-1")},null,2),t("span",xt,r(e.label.split(" ")[0]),1),t("span",mt,r(i===0?M(e.value,f.value.inventario):e.value),1)])],2))),128))]),t("div",gt,[(l(!0),a(m,null,h(u.value.slice(3,5),(e,i)=>(l(),a("div",{key:e.label,class:p(["flex flex-col justify-between rounded-lg shadow-lg bg-gradient-to-br p-2 min-h-[70px]",e.color])},[t("div",ht,[t("i",{class:p(e.icon+" text-base text-white mb-1")},null,2),t("span",ft,r(e.label.split(" ")[0]),1),t("span",bt,r(e.value),1)])],2))),128))])]),t("div",vt,[t("div",yt,[t("div",_t,[_.value?(l(),S(n,{key:0,type:"pie",data:_.value,options:$.value,class:"w-full h-full"},null,8,["data","options"])):(l(),a("div",wt,o[1]||(o[1]=[t("p",{class:"text-gray-500 text-xs sm:text-sm"},"No hay datos de inventario",-1)])))]),t("div",kt,[w.value?(l(),S(n,{key:0,type:"bar",data:w.value,options:C.value,class:"w-full h-full"},null,8,["data","options"])):(l(),a("div",jt,o[2]||(o[2]=[t("p",{class:"text-gray-500 text-xs sm:text-sm"},"No hay datos de ventas",-1)])))]),t("div",Bt,[k.value?(l(),S(n,{key:0,type:"doughnut",data:k.value,options:P.value,class:"w-full h-full"},null,8,["data","options"])):(l(),a("div",St,o[3]||(o[3]=[t("p",{class:"text-gray-500 text-xs sm:text-sm"},"No hay productos vendidos",-1)])))])])]),f.value.stockBajo&&f.value.stockBajo.length>0?(l(),a("div",At,[o[6]||(o[6]=t("h3",{class:"text-sm sm:text-base md:text-lg font-semibold text-gray-900 mb-3 sm:mb-4"},[t("i",{class:"pi pi-exclamation-triangle text-yellow-500 mr-2"}),Q(" Productos con Stock Bajo ")],-1)),t("div",$t,[t("table",Ct,[o[5]||(o[5]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-2 sm:px-3 md:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Producto"),t("th",{class:"px-2 sm:px-3 md:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Stock Actual"),t("th",{class:"px-2 sm:px-3 md:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Stock Mínimo"),t("th",{class:"px-2 sm:px-3 md:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Estado")])],-1)),t("tbody",Pt,[(l(!0),a(m,null,h(f.value.stockBajo,e=>(l(),a("tr",{key:e.id},[t("td",Vt,r(e.nombre),1),t("td",Et,r(e.stock_actual),1),t("td",Ot,r(e.stock_minimo),1),o[4]||(o[4]=t("td",{class:"px-2 sm:px-3 md:px-6 py-2 sm:py-4 whitespace-nowrap"},[t("span",{class:"inline-flex px-1 sm:px-2 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-800"}," Stock Bajo ")],-1))]))),128))])])])])):K("",!0)])]))]),_:1})],64)}}};export{zt as default};
