import{p as H,q as M,r as _,s as O,c as P,o as m,w as K,b as e,a as d,u as a,W as Q,e as x,n as V,t as w,f,F as W,y as Y,z as X,A as I,B as y}from"./app-DP8tsAem.js";import{s as J,_ as Z}from"./AuthenticatedLayout-BvfF3yw2.js";import{F as c,f as ee,a as C,b as $,c as L,d as se,e as ae,g as te}from"./index-ClJ1gEnJ.js";import"./logo-DN1bLr27.js";const oe={class:"container mx-auto px-4 py-8"},re={class:"bg-white rounded-lg shadow-lg overflow-hidden"},ne={class:"bg-gradient-to-r from-red-600 to-red-700 px-6 py-4"},ie={class:"flex items-center justify-between"},le={class:"flex items-center"},de={class:"text-2xl font-bold text-white flex items-center"},ce={class:"p-6"},ue={class:"mb-8"},pe={class:"bg-blue-50 border border-blue-200 rounded-lg p-6"},me={class:"space-y-6"},fe={class:"flex space-x-4"},ye=["disabled"],ge=["disabled"],be={class:"mb-8"},ve={key:0,class:"text-center py-8 text-gray-500"},he={key:1,class:"text-center py-8 text-gray-500"},xe={key:2,class:"space-y-3"},we={class:"flex items-center"},ke={class:"font-medium text-gray-800"},_e={class:"text-sm text-gray-500"},Ee={class:"flex space-x-2"},Be=["onClick"],Ce=["onClick"],g=3,Se={__name:"Backup",setup($e){const i=H(),E=M(),u=_(!1),k=_(!1),p=_([]),b=()=>({"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),Accept:"application/json","Content-Type":"application/json"}),v=async()=>{k.value=!0;try{const n=await y.get("/api/backups",{headers:b()});n.data.success?p.value=n.data.backups:i.add({severity:"error",summary:"Error",detail:n.data.message||"Error al cargar los backups",life:5e3})}catch(n){n.response?i.add({severity:"error",summary:"Error de Conexi칩n",detail:`Error ${n.response.status}: ${n.response.data.message||"Error desconocido"}`,life:5e3}):i.add({severity:"error",summary:"Error de Red",detail:"No se pudo conectar con el servidor",life:5e3})}finally{k.value=!1}},A=async()=>{var n,s;if(u.value){i.add({severity:"warn",summary:"Backup en Proceso",detail:"Ya se est치 generando un backup. Por favor espere.",life:3e3});return}u.value=!0;try{i.add({severity:"info",summary:"Generando Backup",detail:"El proceso puede tomar unos minutos...",life:5e3});const t=await y.post("/api/backups/generate",{},{headers:b()});if(t.data.success)i.add({severity:"success",summary:"Backup Generado",detail:"El backup se ha generado correctamente.",life:4e3}),await v();else throw new Error(t.data.message||"Error al generar el backup")}catch(t){i.add({severity:"error",summary:"Error al Generar Backup",detail:((s=(n=t.response)==null?void 0:n.data)==null?void 0:s.message)||t.message||"Error desconocido",life:5e3})}finally{u.value=!1}},N=async n=>{try{const s=await y.get(`/api/backups/${n}/download`,{responseType:"blob"}),t=window.URL.createObjectURL(new Blob([s.data])),o=document.createElement("a");o.href=t;const l=s.headers["content-disposition"];let r="backup.zip";if(l){const h=l.match(/filename="(.+)"/);h&&(r=h[1])}o.setAttribute("download",r),document.body.appendChild(o),o.click(),o.remove(),window.URL.revokeObjectURL(t),i.add({severity:"success",summary:"Descarga Iniciada",detail:"El archivo se est치 descargando",life:3e3})}catch{i.add({severity:"error",summary:"Error de Descarga",detail:"No se pudo descargar el respaldo",life:5e3})}},D=n=>{const s=p.value.find(o=>o.id===n),t=s?s.name:`Backup ${n}`;E.require({message:`쮼st치 seguro de que desea eliminar el backup "${t}"? Esta acci칩n no se puede deshacer.`,header:"Confirmar Eliminaci칩n",icon:"pi pi-exclamation-triangle",acceptClass:"p-button-danger",rejectClass:"p-button-outlined",acceptLabel:"S칤, Eliminar",rejectLabel:"Cancelar",accept:async()=>{var o,l;try{const r=await y.delete(`/api/backups/${n}`,{headers:b()});if(r.data.success)i.add({severity:"success",summary:"Backup Eliminado",detail:`El backup "${t}" ha sido eliminado correctamente.`,life:3e3}),await v();else throw new Error(r.data.message||"Error al eliminar el backup")}catch(r){i.add({severity:"error",summary:"Error al Eliminar",detail:((l=(o=r.response)==null?void 0:o.data)==null?void 0:l.message)||r.message||"Error desconocido",life:5e3})}}})},j=()=>{if(p.value.length===0){i.add({severity:"info",summary:"No Hay Nada Que Limpiar",detail:"No hay respaldos disponibles para limpiar.",life:3e3});return}if(p.value.length<=g){i.add({severity:"info",summary:"No Hay Nada Que Limpiar",detail:`Solo hay ${p.value.length} respaldo(s). Se mantienen autom치ticamente los 칰ltimos ${g}.`,life:3e3});return}const s=[...p.value].sort((o,l)=>{try{const r=o.date.split(" "),[h,S,R]=r[0].split("/"),T=r[1]||"00:00",G=new Date(`${R}-${S}-${h}T${T}`),B=l.date.split(" "),[F,z,q]=B[0].split("/"),U=B[1]||"00:00";return new Date(`${q}-${z}-${F}T${U}`)-G}catch(r){return console.warn("Error parsing backup dates, falling back to filename sort:",r),l.name.localeCompare(o.name)}}).slice(g);if(s.length===0){i.add({severity:"info",summary:"No Hay Nada Que Limpiar",detail:`Ya tienes solo los 칰ltimos ${g} respaldos.`,life:3e3});return}const t=s.map(o=>o.name).join(", ");E.require({message:`쮼st치 seguro de limpiar los respaldos antiguos? Se eliminar치n ${s.length} respaldo(s): ${t}. Se mantendr치n solo los 칰ltimos ${g}. Esta acci칩n no se puede deshacer.`,header:"Confirmar Limpieza",rejectLabel:"Cancelar",acceptLabel:"S칤, Limpiar",rejectClass:"p-button-secondary p-button-outlined",acceptClass:"p-button-warning",accept:async()=>{var o,l;try{const r=await y.post("/api/backups/cleanup",{},{headers:b()});if(r.data.success)i.add({severity:"success",summary:"Limpieza Completada",detail:`Se han eliminado ${s.length} respaldo(s) antiguos.`,life:4e3}),await v();else throw new Error(r.data.message||"Error al limpiar los backups")}catch(r){i.add({severity:"error",summary:"Error al Limpiar",detail:((l=(o=r.response)==null?void 0:o.data)==null?void 0:l.message)||r.message||"Error desconocido",life:5e3})}}})};return O(()=>{v()}),(n,s)=>(m(),P(Z,null,{default:K(()=>[e("div",oe,[e("div",re,[e("div",ne,[e("div",ie,[e("div",le,[e("button",{onClick:s[0]||(s[0]=t=>a(Q).visit(a(J)("settings"))),class:"flex items-center text-white hover:text-red-200 transition-colors duration-200 p-2 rounded-lg hover:bg-red-800 mr-4",title:"Regresar a Configuraci칩n"},[d(a(c),{icon:a(ee),class:"h-5 w-5"},null,8,["icon"])]),e("div",null,[e("h1",de,[d(a(c),{icon:a(C),class:"mr-3"},null,8,["icon"]),s[1]||(s[1]=x(" Respaldo de Base de Datos "))]),s[2]||(s[2]=e("p",{class:"text-red-100 mt-2"},"Genere y gestione copias de seguridad de la base de datos",-1))])])])]),e("div",ce,[e("div",ue,[s[5]||(s[5]=e("h2",{class:"text-xl font-semibold text-gray-800 mb-4 flex items-center"},[e("span",{class:"text-2xl mr-2"},"游"),x(" Gesti칩n Manual de Respaldos ")],-1)),e("div",pe,[e("div",me,[s[4]||(s[4]=e("div",{class:"bg-white border rounded-lg p-4"},[e("div",{class:"flex items-center justify-between"},[e("div",{class:"flex items-center"},[e("div",{class:"bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium mr-3"}," 游댢 Manual "),e("span",{class:"text-gray-700 font-medium"}," Respaldos bajo demanda ")])])],-1)),e("div",fe,[e("button",{onClick:A,disabled:u.value,class:"bg-red-600 hover:bg-red-700 disabled:bg-gray-400 text-white font-semibold py-3 px-6 rounded-lg flex items-center transition-colors duration-200"},[d(a(c),{icon:u.value?a($):a(L),class:V([{"animate-spin":u.value},"mr-2"])},null,8,["icon","class"]),x(" "+w(u.value?"Generando...":"Generar Respaldo"),1)],8,ye),e("button",{onClick:j,disabled:u.value,class:"bg-yellow-600 hover:bg-yellow-700 disabled:bg-gray-400 text-white font-semibold py-3 px-6 rounded-lg flex items-center transition-colors duration-200"},[d(a(c),{icon:a(se),class:"mr-2"},null,8,["icon"]),s[3]||(s[3]=x(" Limpiar Antiguos "))],8,ge)])])])]),e("div",be,[s[8]||(s[8]=e("h2",{class:"text-xl font-semibold text-gray-800 mb-4"},"Respaldos Disponibles",-1)),k.value?(m(),f("div",ve,[d(a(c),{icon:a($),class:"text-4xl mb-2 animate-spin"},null,8,["icon"]),s[6]||(s[6]=e("p",null,"Cargando respaldos...",-1))])):p.value.length===0?(m(),f("div",he,[d(a(c),{icon:a(ae),class:"text-4xl mb-2"},null,8,["icon"]),s[7]||(s[7]=e("p",null,"No hay respaldos disponibles",-1))])):(m(),f("div",xe,[(m(!0),f(W,null,Y(p.value,t=>(m(),f("div",{key:t.id,class:"flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors duration-200"},[e("div",we,[d(a(c),{icon:a(C),class:"text-red-600 mr-3"},null,8,["icon"]),e("div",null,[e("h3",ke,w(t.name),1),e("p",_e,w(t.date)+" - "+w(t.size),1)])]),e("div",Ee,[e("button",{onClick:o=>N(t.id),class:"text-blue-600 hover:text-blue-800 p-2 rounded-full hover:bg-blue-50 transition-colors duration-200",title:"Descargar"},[d(a(c),{icon:a(L)},null,8,["icon"])],8,Be),e("button",{onClick:o=>D(t.id),class:"text-red-600 hover:text-red-800 p-2 rounded-full hover:bg-red-50 transition-colors duration-200",title:"Eliminar"},[d(a(c),{icon:a(te)},null,8,["icon"])],8,Ce)])]))),128))]))])])])]),d(a(X)),d(a(I),{style:{width:"450px"},breakpoints:{"1199px":"75vw","575px":"90vw"}})]),_:1}))}};export{Se as default};
