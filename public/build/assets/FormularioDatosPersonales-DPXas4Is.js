import{r as y,E as h,o as T,w,c as s,d,j as p,e as t,q as b,t as f,v as x,a9 as N,y as v,F as V,l as A,p as D,$ as k,a7 as U}from"./vendor-CaDzpwPW.js";import{z as M}from"./vue-tel-input-AlIeehSu.js";import{q as B}from"./ui-BDcZAQlG.js";const L={class:"space-y-6"},R={key:0,class:"bg-gradient-to-r from-blue-50 to-purple-50 p-4 rounded-lg"},z={class:"text-sm text-gray-600 mb-1"},G={class:"text-sm text-gray-600"},X={key:1,class:"flex items-center justify-between mb-3"},$={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},H=["disabled"],J=["value","disabled"],K={key:0,value:"",disabled:""},W={key:1,value:"",disabled:""},Z=["value"],Q={class:"grid grid-cols-1 sm:grid-cols-2 gap-4 mt-4"},Y=["disabled"],O={class:"grid grid-cols-1 sm:grid-cols-2 gap-4 mt-4"},_={class:"mr-1"},ee={class:"sm:col-span-1"},oe=["disabled"],ie={__name:"FormularioDatosPersonales",props:{formulario:{type:Object,required:!0},tieneClienteExistente:{type:Boolean,default:!1},user:{type:Object,default:null}},emits:["update:formulario","mostrar-toast"],setup(i,{expose:P,emit:S}){const m=i,n=S,u=y([]),g=y(!1),a=y({isValid:!1,country:null,formattedNumber:"",mensaje:""}),r=h({get(){return m.formulario},set(o){n("update:formulario",o)}}),q=async()=>{try{g.value=!0;const o=await fetch("/api/tipo-documentos",{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"}});if(o.ok){const e=await o.json();u.value=e.tipos||e}else console.error("Error al cargar tipos de documentos:",o.status),u.value=[{id:1,nombre:"DUI"},{id:2,nombre:"CÉDULA"},{id:3,nombre:"PASAPORTE"}]}catch(o){console.error("Error al cargar tipos de documentos:",o),u.value=[{id:1,nombre:"DUI"},{id:2,nombre:"CÉDULA"},{id:3,nombre:"PASAPORTE"}]}finally{g.value=!1}},j=async o=>{try{o&&typeof o=="object"&&(a.value.isValid=o.valid===!0,a.value.country={name:o.country,code:o.countryCode},a.value.formattedNumber=o.formatted||"",o.valid===!0&&o.formatted&&(r.value.telefono=o.formatted),m.tieneClienteExistente?o.valid===!0?a.value.mensaje="Número válido (guardado previamente)":r.value.telefono&&o.valid===!1?a.value.mensaje="Número de teléfono inválido para "+o.country:a.value.mensaje="":r.value.telefono&&o.valid===!1?a.value.mensaje="Número de teléfono inválido para "+o.country:o.valid===!0?await F(r.value.telefono):a.value.mensaje="")}catch(e){console.error("[FormularioDatosPersonales] Error en validación:",e),a.value.mensaje="Error en validación"}},F=async o=>{var e,l;if(!(!o||o.length<8))try{const E=await(await fetch("/api/clientes/validar-telefono",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${localStorage.getItem("auth_token")||""}`,"X-CSRF-TOKEN":((e=document.querySelector('meta[name="csrf-token"]'))==null?void 0:e.getAttribute("content"))||"","X-Requested-With":"XMLHttpRequest"},credentials:"same-origin",body:JSON.stringify({telefono:o})})).json();E.disponible?a.value.mensaje="Número válido para "+((l=a.value.country)==null?void 0:l.name):(a.value.isValid=!1,a.value.mensaje=E.message||"Este teléfono ya está registrado")}catch(c){console.error("[FormularioDatosPersonales] Error validando teléfono:",c),a.value.mensaje="Error al validar teléfono"}},I=()=>{const o=new Date;return o.setDate(o.getDate()-1),o};P({tiposDocumentos:u,validateForm:()=>!r.value.tipo_documento&&!r.value.tipo_documento_id?(n("mostrar-toast",{severity:"error",summary:"Campo requerido",detail:"Por favor, seleccione un tipo de documento.",life:4e3}),!1):r.value.numero_identificacion?r.value.fecha_nacimiento?r.value.direccion?r.value.genero?r.value.telefono?r.value.telefono&&a.value.isValid===!1&&a.value.mensaje!=="Número válido (guardado previamente)"?(a.value.mensaje&&(a.value.mensaje.includes("registrado")||a.value.mensaje.includes("diferente"))?n("mostrar-toast",{severity:"warn",summary:"Teléfono ya registrado",detail:a.value.mensaje,life:5e3}):n("mostrar-toast",{severity:"error",summary:"Teléfono inválido",detail:"Por favor, ingrese un número de teléfono válido.",life:4e3}),!1):!0:(n("mostrar-toast",{severity:"error",summary:"Campo requerido",detail:"Por favor, ingrese su número de teléfono.",life:4e3}),!1):(n("mostrar-toast",{severity:"error",summary:"Campo requerido",detail:"Por favor, seleccione su género.",life:4e3}),!1):(n("mostrar-toast",{severity:"error",summary:"Campo requerido",detail:"Por favor, ingrese su dirección.",life:4e3}),!1):(n("mostrar-toast",{severity:"error",summary:"Campo requerido",detail:"Por favor, seleccione su fecha de nacimiento.",life:4e3}),!1):(n("mostrar-toast",{severity:"error",summary:"Campo requerido",detail:"Por favor, ingrese su número de identificación.",life:4e3}),!1)});const C=o=>{if(o&&o.id){const e={...r.value,tipo_documento:o,tipo_documento_id:o.id};n("update:formulario",e)}};return T(()=>{q()}),w([u,()=>m.formulario.tipo_documento_id],([o,e])=>{if(o.length>0&&e&&!m.formulario.tipo_documento){const l=o.find(c=>c.id===e);l&&C(l)}},{immediate:!0,flush:"post"}),w(()=>m.formulario.telefono,(o,e)=>{o&&o!==e&&m.tieneClienteExistente&&(a.value={isValid:!0,country:{name:"Válido",code:""},formattedNumber:o,mensaje:"Número válido (guardado previamente)"})},{immediate:!0}),(o,e)=>(d(),s("div",L,[i.user?(d(),s("div",R,[e[8]||(e[8]=t("h3",{class:"font-bold text-lg text-gray-800 mb-2"},"Información de tu cuenta:",-1)),t("p",z,[e[6]||(e[6]=t("strong",null,"Nombre:",-1)),b(" "+f(i.user.name),1)]),t("p",G,[e[7]||(e[7]=t("strong",null,"Email:",-1)),b(" "+f(i.user.email),1)])])):p("",!0),i.tieneClienteExistente?(d(),s("div",X,e[9]||(e[9]=[t("h4",{class:"font-semibold text-gray-800"},"Información Personal",-1),t("div",{class:"flex items-center text-green-600 text-sm"},[t("svg",{class:"w-4 h-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})]),t("span",null,"Datos precargados")],-1)]))):p("",!0),t("div",$,[t("div",null,[e[10]||(e[10]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Número de Identificación",-1)),x(t("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>r.value.numero_identificacion=l),type:"text",required:"",maxlength:"25",disabled:i.tieneClienteExistente,class:v(["w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",{"bg-gray-100 cursor-not-allowed":i.tieneClienteExistente}]),placeholder:"Ingrese su DUI o documento"},null,10,H),[[N,r.value.numero_identificacion]])]),t("div",null,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Tipo de Documento",-1)),t("select",{value:r.value.tipo_documento_id,onChange:e[1]||(e[1]=l=>C(u.value.find(c=>c.id===parseInt(l.target.value)))),required:"",disabled:g.value||i.tieneClienteExistente,class:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100"},[g.value?(d(),s("option",K,"Cargando tipos...")):u.value.length===0?(d(),s("option",W,"No hay tipos disponibles")):(d(),s(V,{key:2},[e[11]||(e[11]=t("option",{value:"",disabled:""},"Seleccione un tipo",-1)),(d(!0),s(V,null,A(u.value,l=>(d(),s("option",{key:l.id,value:l.id},f(l.nombre),9,Z))),128))],64))],40,J)])]),t("div",Q,[t("div",null,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Fecha de Nacimiento",-1)),D(k(B),{modelValue:r.value.fecha_nacimiento,"onUpdate:modelValue":e[2]||(e[2]=l=>r.value.fecha_nacimiento=l),maxDate:I(),"date-format":"dd/mm/yy",placeholder:"Seleccionar fecha de nacimiento",showIcon:"",yearNavigator:"",yearRange:"1920:2010",disabled:i.tieneClienteExistente,class:"w-full",inputClass:`w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 ${i.tieneClienteExistente?"bg-gray-100 cursor-not-allowed":""}`},null,8,["modelValue","maxDate","disabled","inputClass"])]),t("div",null,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Género",-1)),x(t("select",{"onUpdate:modelValue":e[3]||(e[3]=l=>r.value.genero=l),required:"",disabled:i.tieneClienteExistente,class:v(["w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",{"bg-gray-100 cursor-not-allowed":i.tieneClienteExistente}])},e[14]||(e[14]=[t("option",{value:""},"Seleccione",-1),t("option",{value:"MASCULINO"},"Masculino",-1),t("option",{value:"FEMENINO"},"Femenino",-1)]),10,Y),[[U,r.value.genero]])])]),t("div",O,[t("div",null,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Teléfono",-1)),D(k(M),{modelValue:r.value.telefono,"onUpdate:modelValue":e[4]||(e[4]=l=>r.value.telefono=l),defaultCountry:"SV",preferredCountries:["SV","GT","HN","CR","NI","PA","BZ"],validCharactersOnly:!0,disabled:i.tieneClienteExistente,dropdownOptions:{showDialCodeInSelection:!0,showFlags:!0,showSearchBox:!0,showDialCodeInList:!0},inputOptions:{placeholder:"Número de teléfono"},mode:"international",class:v(["w-full border border-gray-300 rounded-lg",{"bg-gray-100 cursor-not-allowed":i.tieneClienteExistente}]),onValidate:j},null,8,["modelValue","disabled","class"]),a.value.mensaje?(d(),s("p",{key:0,class:v(["text-xs mt-1 flex items-center",a.value.isValid?"text-green-600":"text-red-600"])},[t("span",_,f(a.value.isValid?"✓":"⚠️"),1),b(" "+f(a.value.mensaje),1)],2)):p("",!0)]),t("div",ee,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Dirección",-1)),x(t("input",{"onUpdate:modelValue":e[5]||(e[5]=l=>r.value.direccion=l),type:"text",required:"",maxlength:"200",disabled:i.tieneClienteExistente,class:v(["w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",{"bg-gray-100 cursor-not-allowed":i.tieneClienteExistente}]),placeholder:"Dirección completa"},null,10,oe),[[N,r.value.direccion]])])])]))}};export{ie as default};
