import{A as ue}from"./AuthenticatedLayout-CSuYxj7F.js";import{b as me,r as i,E as B,o as fe,h as P,d as w,x as r,p as o,e as s,$ as a,a0 as ve,c as pe,t as u,j as z,q as ge,a5 as W}from"./vendor-gbh1WW5n.js";import{z as be,a as xe,F as m,e as we,f as h,h as he}from"./ui-BrU4k96Z.js";import{c as S,z as ye,m as _e,n as q,o as Ce}from"./index-B6nVaz6S.js";import ke from"./Modales-MCJ2N3Ll.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-DtyEsSN9.js";const Le={class:"container mx-auto px-4 py-6"},Pe={class:"bg-white rounded-lg shadow-md"},Ve={key:0,class:"flex flex-col items-center justify-center py-12"},Ee={class:"bg-blue-50 p-3 rounded-lg shadow-sm border mb-4"},De={class:"flex flex-col sm:flex-row items-center justify-between mb-3"},Re={class:"flex items-center gap-3"},Se={class:"bg-blue-50 border border-blue-200 text-blue-700 px-3 py-1 rounded text-sm font-medium"},Te=["disabled"],$e=["disabled"],Ne={class:"space-y-3"},je={class:"relative"},Ae={class:"text-blue-600 text-xs font-medium flex items-center gap-1"},Fe=["title"],Me={class:"text-sm leading-relaxed"},Ue={class:"text-sm leading-relaxed"},Oe=["title"],Be={class:"flex gap-2 justify-center items-center"},ze=["onClick"],We=["onClick"],qe={class:"flex flex-col items-center justify-center py-12 text-center"},Qe={__name:"Clientes",props:{clientes:{type:Array,default:()=>[]}},setup(H){const I=H,y=be(),T=me({id:null,nombre:"",apellido:"",genero:"",fecha_nacimiento:"",tipo_documento_id:null,numero_identificacion:"",telefono:"",email:"",direccion:""}),d=i(null),G=i(!1),_=i(!1),c=i(!1),$=i(!1),N=i(!0),C=i(!1),p=i(!1),g=i(!1),k=i(!1),V=i(10),K=i([5,10,20,50]),b=i({global:{value:null,matchMode:"contains"}}),J=B(()=>({width:"95vw",maxWidth:"500px",maxHeight:"95vh"})),E=B(()=>{let l=I.clientes;if(b.value.global.value){const t=b.value.global.value.toLowerCase();l=l.filter(e=>e.user&&e.user.name&&e.user.name.toLowerCase().includes(t)||e.numero_identificacion&&e.numero_identificacion.toLowerCase().includes(t)||e.user&&e.user.email&&e.user.email.toLowerCase().includes(t)||e.telefono&&e.telefono.toLowerCase().includes(t))}return l}),X=l=>{d.value=l,p.value=!0},Y=l=>{d.value=l,g.value=!0},Q=async l=>{var t,e,f,x,A,F;_.value=!0;try{const L=d.value.id||d.value.user_id,M=await fetch(`/api/clientes/${L}`,{method:"DELETE",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({deletion_reason:l})}),v=await M.json();if(M.ok){const de=((t=v.info)==null?void 0:t.reservas_count)||0,ce=((e=v.info)==null?void 0:e.ventas_count)||0,D=((f=v.info)==null?void 0:f.pagos_reservas_count)||0,R=((x=v.info)==null?void 0:x.pagos_ventas_count)||0,U=((A=v.info)==null?void 0:A.total_pagos_count)||0,O=((F=v.info)==null?void 0:F.stock_reservations_count)||0;let n=`Usuario y cliente eliminados completamente. Se eliminaron:
`;n+=`• Cuenta de usuario completa
`,n+=`• Datos del cliente
`,n+=`• ${de} reserva(s)
`,n+=`• ${ce} venta(s)
`,U>0?(n+=`• ${U} pago(s) total`,D>0&&R>0?n+=` (${D} de reservas, ${R} de ventas)`:D>0?n+=" (todos de reservas)":R>0&&(n+=" (todos de ventas)")):n+="• Sin pagos asociados",O>0&&(n+=`
• ${O} reserva(s) de stock`),y.add({severity:"success",summary:"Usuario eliminado completamente",detail:n,life:6e3}),W.reload()}else throw new Error(v.message||"Error al eliminar el cliente");g.value=!1,d.value=null}catch(L){console.error("Error al eliminar cliente:",L),y.add({severity:"error",summary:"Error",detail:L.message||"Error al eliminar el cliente",life:5e3}),g.value=!1}finally{_.value=!1}},Z=()=>{g.value=!1,d.value=null,_.value=!1},j=async()=>{c.value=!0;try{await new Promise(l=>setTimeout(l,300)),b.value.global.value=null,y.add({severity:"success",summary:"Filtros limpiados",life:2e3})}finally{c.value=!1}},ee=l=>{d.value=l,C.value=!0,p.value=!1},te=()=>{},se=()=>{},ae=l=>{l.originalEvent.target.closest("button")||(d.value=l.data,C.value=!0)},le=l=>{W.visit("/generar-informes"),p.value=!1},oe=l=>{y.add({severity:"info",summary:"Función pendiente",detail:"Cambiar estado aún no implementado",life:3e3}),p.value=!1},ie=()=>{Object.assign(T,{id:null,nombre:"",apellido:"",genero:"",fecha_nacimiento:"",tipo_documento_id:null,numero_identificacion:"",telefono:"",email:"",direccion:""}),$.value=!1,k.value=!1},ne=()=>{k.value=!1},re=()=>{setTimeout(()=>{N.value=!1},1e3)};return fe(()=>{re()}),(l,t)=>(w(),P(ue,null,{default:r(()=>[o(a(ve),{title:"Clientes"}),o(a(xe),{class:"z-[9999]"}),s("div",Le,[s("div",Pe,[t[14]||(t[14]=s("div",{class:"flex flex-col sm:flex-row lg:justify-between lg:items-center text-center sm:text-left gap-4 p-4"},[s("div",{class:"w-full"},[s("h1",{class:"text-3xl font-bold text-blue-600 mb-2"},"Gestión de Clientes"),s("p",{class:"text-gray-600"},"Visualización de la información de los clientes del sistema")])],-1)),N.value?(w(),pe("div",Ve,[o(a(m),{icon:a(S),class:"animate-spin h-8 w-8 text-blue-600 mb-3"},null,8,["icon"]),t[6]||(t[6]=s("p",{class:"text-gray-600 font-medium"},"Cargando clientes...",-1))])):(w(),P(a(we),{key:1,value:E.value,dataKey:"id",paginator:!0,rows:V.value,rowsPerPageOptions:K.value,rowsPerPage:V.value,"onUpdate:rowsPerPage":t[1]||(t[1]=e=>V.value=e),paginatorTemplate:"RowsPerPageDropdown FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink",currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} clientes",class:"overflow-x-auto max-w-full",responsiveLayout:"scroll",onRowClick:ae,pt:{root:{class:"text-sm"},wrapper:{class:"text-sm"},table:{class:"text-sm"},thead:{class:"text-sm"},headerRow:{class:"text-sm"},headerCell:{class:"text-sm font-medium py-3 px-2"},tbody:{class:"text-sm"},bodyRow:{class:"h-20 text-sm cursor-pointer hover:bg-blue-50 transition-colors duration-200"},bodyCell:{class:"py-3 px-2 text-sm"},paginator:{class:"text-xs sm:text-sm"},paginatorWrapper:{class:"flex flex-wrap justify-center sm:justify-between items-center gap-2 p-2"}}},{header:r(()=>[s("div",Ee,[s("div",De,[s("div",Re,[t[7]||(t[7]=s("h3",{class:"text-base font-medium text-gray-800 flex items-center gap-2"},[s("i",{class:"pi pi-filter text-blue-600 text-sm"}),s("span",null,"Filtros")],-1)),s("div",Se,u(E.value.length)+" resultado"+u(E.value.length!==1?"s":""),1),s("button",{class:"bg-red-500 hover:bg-red-600 border border-red-500 px-3 py-1 text-sm text-white shadow-md rounded-md flex sm:hidden disabled:opacity-50 disabled:cursor-not-allowed items-center gap-2",onClick:j,disabled:c.value},[c.value?(w(),P(a(m),{key:0,icon:a(S),class:"animate-spin h-3 w-3"},null,8,["icon"])):z("",!0),s("span",null,u(c.value?"Limpia...":"Limpiar"),1)],8,Te)]),s("button",{class:"bg-red-500 hover:bg-red-600 border border-red-500 px-3 py-1 text-sm text-white shadow-md rounded-md hidden sm:flex disabled:opacity-50 disabled:cursor-not-allowed items-center gap-2",onClick:j,disabled:c.value},[c.value?(w(),P(a(m),{key:0,icon:a(S),class:"animate-spin h-3 w-3"},null,8,["icon"])):z("",!0),s("span",null,u(c.value?"Limpiando...":"Limpiar filtros"),1)],8,$e)]),s("div",Ne,[s("div",je,[o(a(m),{icon:a(Ce),class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"},null,8,["icon"]),o(a(he),{modelValue:b.value.global.value,"onUpdate:modelValue":t[0]||(t[0]=e=>b.value.global.value=e),placeholder:"Buscar clientes...",class:"w-full h-9 text-sm rounded-md pl-10",style:{"background-color":"white","border-color":"#93c5fd"}},null,8,["modelValue"])]),s("p",Ae,[o(a(m),{icon:a(q),class:"h-3 w-3 text-yellow-500"},null,8,["icon"]),t[8]||(t[8]=ge(" Haz clic en cualquier fila para ver los detalles del cliente. "))])])])]),empty:r(()=>[s("div",qe,[o(a(m),{icon:a(q),class:"h-16 w-16 text-gray-400 mb-4"},null,8,["icon"]),t[12]||(t[12]=s("p",{class:"text-xl font-semibold text-gray-600 mb-2"},"NO HAY CLIENTES REGISTRADOS",-1)),t[13]||(t[13]=s("p",{class:"text-gray-500 mb-6"},"Los clientes aparecerán aquí cuando se registren en el sistema",-1))])]),default:r(()=>[o(a(h),{field:"user.name",header:"Nombre Completo",sortable:"",class:"w-40"},{body:r(e=>{var f,x;return[s("div",{class:"text-sm font-medium leading-relaxed overflow-hidden",style:{"max-width":"150px","text-overflow":"ellipsis","white-space":"nowrap"},title:((f=e.data.user)==null?void 0:f.name)||"Sin nombre"},u(((x=e.data.user)==null?void 0:x.name)||"Sin nombre"),9,Fe)]}),_:1}),o(a(h),{field:"numero_identificacion",header:"Identificación",class:"w-32 hidden md:table-cell"},{body:r(e=>[s("div",Me,u(e.data.numero_identificacion),1)]),_:1}),o(a(h),{field:"telefono",header:"Teléfono",class:"w-32 hidden sm:table-cell"},{body:r(e=>[s("div",Ue,u(e.data.telefono),1)]),_:1}),o(a(h),{field:"email",header:"Email",class:"w-16 hidden sm:table-cell"},{body:r(e=>[s("div",{class:"text-sm font-medium leading-relaxed overflow-hidden",style:{"max-width":"150px","text-overflow":"ellipsis","white-space":"nowrap"},title:e.data.email||e.data.user&&e.data.user.email||"No registrado"},u(e.data.email||e.data.user&&e.data.user.email||"No registrado"),9,Oe)]),_:1}),o(a(h),{exportable:!1,class:"w-52 min-w-36"},{header:r(()=>t[9]||(t[9]=[s("div",{class:"text-center w-full font-bold"}," Acciones ",-1)])),body:r(e=>[s("div",Be,[s("button",{class:"flex bg-green-500 border p-1 py-2 sm:p-2 text-sm shadow-md hover:shadow-lg rounded-md hover:-translate-y-1 transition-transform duration-300",onClick:f=>X(e.data)},[o(a(m),{icon:a(ye),class:"h-3 w-6 sm:h-4 sm:w-7 text-white"},null,8,["icon"]),t[10]||(t[10]=s("span",{class:"hidden md:block text-white"},"Más",-1))],8,ze),s("button",{class:"flex bg-red-500 border p-1 py-2 sm:p-2 text-sm shadow-md hover:shadow-lg rounded-md hover:-translate-y-1 transition-transform duration-300",onClick:f=>Y(e.data)},[o(a(m),{icon:a(_e),class:"h-3 w-6 sm:h-4 sm:w-7 text-white"},null,8,["icon"]),t[11]||(t[11]=s("span",{class:"hidden md:block text-white"},"Eliminar",-1))],8,We)])]),_:1})]),_:1},8,["value","rows","rowsPerPageOptions","rowsPerPage"])),o(ke,{visible:p.value,"onUpdate:visible":t[2]||(t[2]=e=>p.value=e),"delete-visible":g.value,"onUpdate:deleteVisible":t[3]||(t[3]=e=>g.value=e),"unsaved-changes-visible":k.value,"onUpdate:unsavedChangesVisible":t[4]||(t[4]=e=>k.value=e),"detalles-visible":C.value,"onUpdate:detallesVisible":t[5]||(t[5]=e=>C.value=e),cliente:d.value||T,"dialog-style":J.value,"is-deleting":_.value,"is-loading":G.value,submitted:$.value,onViewDetails:ee,onViewReservations:te,onViewPurchases:se,onViewReports:le,onToggleStatus:oe,onDeleteCliente:Q,onCancelDelete:Z,onCloseWithoutSaving:ie,onContinueEditing:ne},null,8,["visible","delete-visible","unsaved-changes-visible","detalles-visible","cliente","dialog-style","is-deleting","is-loading","submitted"])])])]),_:1}))}};export{Qe as default};
