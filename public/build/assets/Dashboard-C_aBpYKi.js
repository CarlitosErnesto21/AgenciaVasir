import{A as G}from"./AuthenticatedLayout-DLrSmUd9.js";import{r,o as J,c as $,d as x,p as _,$ as V,a0 as K,x as Q,h as O,e as l,y as W,t as X,F as ee,N as k}from"./vendor-Bf9odu9b.js";import{s as L}from"./app-CTdG6slE.js";import"./ui-ByAzYu1X.js";import te from"./LoadingState-rwzUpqRZ.js";import ae from"./MetricasCard-2D6mXjh5.js";import se from"./WidgetsSecundarios-Z6Cu0777.js";import oe from"./ActividadReciente-BupZlaG8.js";import le from"./ModalesInteractivos-Ws-HgJsi.js";import re from"./GraficosSection-BZ1Q-LwF.js";import"./index-dTLVUhwl.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ie={key:1,class:"px-2 sm:px-4 lg:px-6 py-4 sm:py-6 space-y-4 sm:space-y-6 mt-1 sm:mt-1"},ne={class:"flex justify-between items-center"},de=["disabled"],ue={class:"grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6"},ce={class:"bg-white rounded-lg shadow-sm border border-gray-100 p-4 sm:p-6"},ve={class:"h-48 sm:h-64"},fe={key:1,class:"flex items-center justify-center h-full"},pe={class:"bg-white rounded-lg shadow-sm border border-gray-100 p-4 sm:p-6"},me={class:"h-48 sm:h-64"},ge={key:1,class:"flex items-center justify-center h-full"},be={class:"grid grid-cols-1 xl:grid-cols-2 gap-4 sm:gap-6"},he=5*60*1e3,Me={__name:"Dashboard",setup(ye){const j=r(),C=r(),I=r(),T=r(),m=r(!0),o=r({}),B=r(null),M=r(null),w=r([{label:"Ventas Hoy",value:"0",icon:"pi pi-shopping-cart",color:"from-[#ef233c] to-[#d90429]",text:"text-[#7b1f26]",key:"ventas_hoy",category:"ventas",description:"Ventas del día"},{label:"Ingresos Hoy",value:"$0",icon:"pi pi-dollar",color:"from-[#ffd600] to-[#ffb700]",text:"text-[#a68700]",key:"ingresos_hoy",category:"ventas",description:"Ingresos del día"},{label:"Reservas del Mes",value:"0",icon:"pi pi-calendar-plus",color:"from-[#6c00f9] to-[#480ca8]",text:"text-[#240046]",key:"reservas_mes",category:"reservas",description:"Reservas este mes"},{label:"Tours Activos",value:"0",icon:"pi pi-map-marker",color:"from-[#0077b6] to-[#023e8a]",text:"text-[#03045e]",key:"tours_activos",category:"reservas",description:"Tours disponibles"}]),S=r([{title:"Reservas Pendientes",value:"0",icon:"pi pi-clock",color:"bg-[#fff3b0] border-[#ffd600]",iconColor:"text-[#ffd600]",key:"reservas_pendientes"},{title:"Productos Stock Bajo",value:"0",icon:"pi pi-exclamation-triangle",color:"bg-[#ffe5e5] border-[#ef233c]",iconColor:"text-[#d90429]",key:"productos_stock_bajo"},{title:"Valor Inventario",value:"$0",icon:"pi pi-wallet",color:"bg-[#e5daff] border-[#6c00f9]",iconColor:"text-[#480ca8]",key:"valor_total_inventario"},{title:"Clientes Activos",value:"0",icon:"pi pi-users",color:"bg-[#d0f1ff] border-[#0077b6]",iconColor:"text-[#023e8a]",key:"clientes_activos"}]),R=r(!1),D=r(!1),z=()=>{R.value=!R.value},H=()=>{D.value=!D.value},F=(s,e=null)=>{if(s.includes("$")){let t;return e&&e.valor_total_inventario?t=parseFloat(e.valor_total_inventario):t=parseFloat(s.replace(/[$,.\s]/g,"")),isNaN(t)?"$0":t>=1e6?"$"+(t/1e6).toFixed(1)+"M":t>=1e3?"$"+(t/1e3).toFixed(0)+"k":"$"+t.toFixed(0)}return s},N=async(s=!1)=>{const e=Date.now();if(!s&&B.value&&M.value&&e<M.value){o.value=B.value,P(o.value.inventario,o.value.ventas,o.value.reservas,o.value.resumenReservas,o.value.tours),E(o.value.inventario,o.value.ventas,o.value.stockBajo,o.value.reservas,o.value.resumenReservas),m.value=!1;return}m.value=!0;try{const t={headers:{Accept:"application/json"},timeout:1e4},[g,b,u,i,c,v]=await Promise.allSettled([k.get("/api/inventario/resumen",t),k.get("/api/ventas?desde="+new Date(Date.now()-30*24*60*60*1e3).toISOString().split("T")[0],t),k.get("/api/inventario/stock-bajo?limit=20",t),k.get("/api/reservas?per_page=100&desde="+new Date(Date.now()-60*24*60*60*1e3).toISOString().split("T")[0],t),k.get("/api/reservas/resumen",t),k.get("/api/tours?estado=activo,disponible&limit=50",t)]),h=g.status==="fulfilled"?g.value.data.data||g.value.data||{}:{},n=b.status==="fulfilled"?b.value.data.data||b.value.data||[]:[],f=u.status==="fulfilled"?u.value.data.data||u.value.data||[]:[],y=i.status==="fulfilled"?i.value.data.data||i.value.data||[]:[],p=c.status==="fulfilled"?c.value.data.data||c.value.data||[]:[],A=v.status==="fulfilled"?v.value.data.data||v.value.data||[]:[];P(h,n,y,p,A),E(h,n,f,y,p),o.value={inventario:h,ventas:n,stockBajo:f,reservas:y,resumenReservas:p,tours:A},B.value={...o.value},M.value=Date.now()+he}catch{P({},[],[],[],[]),E({},[],[],[])}finally{m.value=!1}},P=(s,e,t,g,b)=>{const u=Array.isArray(e)?e:[],i=Array.isArray(t)?t:[],c=Array.isArray(b)?b:[],v=new Date().toISOString().split("T")[0],h=u.filter(a=>a.fecha?a.fecha.split("T")[0]===v:!1).length,n=u.filter(a=>a.fecha?a.fecha.split("T")[0]===v:!1).reduce((a,d)=>a+(parseFloat(d.total)||0),0),f=new Date().getMonth(),y=new Date().getFullYear(),p=i.filter(a=>{if(!a.fecha_reserva&&!a.fecha)return!1;const d=new Date(a.fecha_reserva||a.fecha);return d.getMonth()===f&&d.getFullYear()===y}).length,A=c.filter(a=>!a.estado||a.estado.toLowerCase()==="activo"||a.estado.toLowerCase()==="disponible").length;w.value[0].value=h.toString(),w.value[1].value=`$${n.toLocaleString("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2})}`,w.value[2].value=p.toString(),w.value[3].value=A.toString();const Z=i.filter(a=>a.estado&&a.estado.toLowerCase()==="pendiente").length,q=new Set(i.map(a=>{var d;return(d=a.cliente)==null?void 0:d.id}).filter(a=>a)).size;S.value[0].value=Z.toString(),S.value[1].value=(s.productos_stock_bajo||0).toString(),S.value[2].value=`$${Number(s.valor_total_inventario||0).toLocaleString("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2})}`,S.value[3].value=q.toString()},E=(s,e,t,g,b)=>{const u=s.total_productos||0,i=s.productos_stock_bajo||0,c=s.productos_agotados||0,v=s.productos_disponibles||Math.max(0,u-i-c),h=Array.isArray(g)?g:[];j.value={labels:["Productos Disponibles","Stock Bajo","Agotados"],datasets:[{label:"Estado del Inventario",data:[v,i,c],backgroundColor:["#10b981","#f59e0b","#ef4444"],hoverBackgroundColor:["#34d399","#fbbf24","#f87171"]}]};const n=h.reduce((f,y)=>{const p=y.estado||"Sin estado";return f[p]=(f[p]||0)+1,f},{});Object.keys(n).length===0&&(n["Sin reservas"]=0),C.value={labels:Object.keys(n),datasets:[{label:"Reservas por Estado",data:Object.values(n),backgroundColor:["#f59e0b","#10b981","#ef4444","#3b82f6"]}]}},Y=()=>({maintainAspectRatio:!1,plugins:{title:{display:!0,text:"Estado del Inventario",font:{size:18}},legend:{display:!0,position:"bottom",labels:{usePointStyle:!0,color:"#374151"}},tooltip:{callbacks:{label:function(s){return`${s.label}: ${s.parsed} productos`}}}}}),U=()=>({maintainAspectRatio:!1,plugins:{title:{display:!0,text:"Reservas por Estado",font:{size:18}},legend:{display:!1},tooltip:{callbacks:{label:function(s){return`${s.label}: ${s.parsed.y} reservas`}}}},scales:{x:{ticks:{color:"#374151"},grid:{color:"#e5e7eb"}},y:{beginAtZero:!0,ticks:{color:"#374151"},grid:{color:"#e5e7eb"}}}});return J(()=>{I.value=Y(),T.value=U(),N()}),(s,e)=>(x(),$(ee,null,[_(V(K),{title:"Dashboard"}),_(G,null,{default:Q(()=>[m.value?(x(),O(te,{key:0})):(x(),$("div",ie,[l("div",ne,[e[3]||(e[3]=l("h1",{class:"text-2xl sm:text-3xl font-bold text-blue-600"},"Dashboard administrativo",-1)),l("button",{onClick:e[0]||(e[0]=t=>N(!0)),disabled:m.value,class:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white text-sm font-medium rounded-lg transition-colors duration-200"},[l("i",{class:W(["pi pi-refresh",{"animate-spin":m.value}])},null,2),l("span",null,X(m.value?"Actualizando...":"Actualizar"),1)],8,de)]),_(ae,{metrics:w.value,"dashboard-data":o.value,"format-value-for-mobile":F},null,8,["metrics","dashboard-data"]),l("div",ue,[_(se,{widgets:S.value,"dashboard-data":o.value,"format-value-for-mobile":F,onToggleReservasModal:z,onToggleStockModal:H},null,8,["widgets","dashboard-data"]),l("div",ce,[e[5]||(e[5]=l("h3",{class:"text-base sm:text-lg font-semibold text-gray-900 mb-3 sm:mb-4"},"Inventario por Estado",-1)),l("div",ve,[j.value?(x(),O(V(L),{key:0,type:"pie",data:j.value,options:I.value,class:"w-full h-full"},null,8,["data","options"])):(x(),$("div",fe,e[4]||(e[4]=[l("p",{class:"text-gray-500 text-xs sm:text-sm"},"No hay datos de inventario",-1)])))])]),l("div",pe,[e[7]||(e[7]=l("h3",{class:"text-base sm:text-lg font-semibold text-gray-900 mb-3 sm:mb-4"},"Reservas por Estado",-1)),l("div",me,[C.value?(x(),O(V(L),{key:0,type:"bar",data:C.value,options:T.value,class:"w-full h-full"},null,8,["data","options"])):(x(),$("div",ge,e[6]||(e[6]=[l("p",{class:"text-gray-500 text-xs sm:text-sm"},"No hay datos de reservas",-1)])))])])]),l("div",be,[_(re,{"resumen-reservas-data":o.value.resumenReservas,"reservas-data":o.value.reservas},null,8,["resumen-reservas-data","reservas-data"]),_(oe,{"dashboard-data":o.value,"format-value-for-mobile":F},null,8,["dashboard-data"])])])),_(le,{"show-reservas-pendientes-modal":R.value,"show-productos-stock-bajo-modal":D.value,"dashboard-data":o.value,onCloseReservasModal:e[1]||(e[1]=t=>R.value=!1),onCloseStockModal:e[2]||(e[2]=t=>D.value=!1)},null,8,["show-reservas-pendientes-modal","show-productos-stock-bajo-modal","dashboard-data"])]),_:1})],64))}};export{Me as default};
