import{r as i,E as M,w as ce,n as R,o as me,a5 as ve,N as E,k as T,h as fe,d as g,x as c,p as o,e as a,$ as s,a0 as ge,a1 as be,y as D,t as _,A as F,c as b,j as z,q as O}from"./vendor-DbRibEpp.js";import{A as pe}from"./AuthenticatedLayout-CFWaTI0x.js";import{z as xe,F as we,A as m}from"./ui-CrZM8ROW.js";import{f as H,a as he,b as ye,c as q,d as Ce,e as Y,g as J,h as K,i as _e}from"./index-DWkcdlMl.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ke={class:"container mx-auto px-4 py-6"},Pe={class:"bg-white rounded-lg shadow-md"},Ee={class:"flex flex-col sm:flex-row lg:justify-between lg:items-center mb-4 gap-4 p-6"},Te={class:"flex items-center gap-3"},De={class:"flex items-center gap-2 w-full justify-center lg:w-auto lg:justify-end"},Ne={class:"bg-blue-50 p-3 rounded-lg shadow-sm border mb-4"},Le={class:"text-sm font-medium leading-relaxed"},Ae={class:"flex gap-2 justify-center items-center"},Se=["onClick"],je=["onClick"],ze={class:"space-y-4"},Oe={class:"w-full flex flex-col"},Ue={class:"flex items-center gap-4"},Ve={key:0,class:"text-red-500 ml-28"},We={key:1,class:"text-red-500 ml-28"},$e={key:2,class:"text-orange-500 ml-28"},Me={key:3,class:"text-red-500 ml-28"},Re={class:"flex justify-center gap-4 w-full mt-6"},Fe=["disabled"],He={key:0},Be={key:1},Ge=["disabled"],Ie={class:"flex items-center gap-3"},qe={class:"flex flex-col"},Ye={class:"flex justify-center gap-4 w-full"},Je=["disabled"],Ke={key:0},Xe={key:1},Ze=["disabled"],Qe={class:"flex items-center gap-3"},ea={class:"flex justify-center gap-3 w-full"},na={__name:"CategoriaHoteles",setup(aa){const d=xe(),N=i([]),t=i({id:null,nombre:""}),v=i(!1),p=i(!1),L=i(!1),U=i(typeof window<"u"?window.innerWidth:1024),V=M(()=>U.value<640?{width:"95vw",maxWidth:"380px"}:U.value<768?{width:"400px"}:{width:"450px"}),x=i(!1),h=i(!1),k=i(!1),y=i(!1),C=i(!1),w=i(null),A=i({global:{value:null,matchMode:we.CONTAINS}}),W=i(10),X=i([5,10,20,50]),P=i("Guardar"),Z=M(()=>{let l=N.value;if(A.value.global.value){const e=A.value.global.value.toLowerCase();l=l.filter(n=>n.nombre.toLowerCase().includes(e))}return l}),S=M(()=>!t.value.nombre||t.value.nombre.length<3?!1:N.value.some(l=>l.nombre.toLowerCase()===t.value.nombre.toLowerCase()&&l.id!==t.value.id));ce([t],()=>{w.value&&x.value&&R(()=>{const l={...t.value},e=JSON.stringify(l)!==JSON.stringify(w.value),n=!w.value.id,u=t.value.nombre;C.value=e||n&&u})},{deep:!0,flush:"post"});function j(){t.value={id:null,nombre:""},y.value=!1}const B=()=>{typeof window<"u"&&(U.value=window.innerWidth)},Q=()=>{L.value=!0};me(()=>{ee(),typeof window<"u"&&window.addEventListener("resize",B)}),ve(()=>{typeof window<"u"&&window.removeEventListener("resize",B)});const G=async()=>{try{const l=await E.get("/api/categorias-hoteles");N.value=(l.data.data||l.data||[]).map(e=>({...e,categoria_id:e.id})).sort((e,n)=>new Date(n.created_at)-new Date(e.created_at))}catch{d.add({severity:"error",summary:"Error",detail:"No se pudieron cargar las categorías de hoteles.",life:4e3})}},ee=async()=>{d.add({severity:"info",summary:"Cargando categorías...",life:2e3});try{const l=await E.get("/api/categorias-hoteles");N.value=(l.data.data||l.data||[]).map(e=>({...e,categoria_id:e.id})).sort((e,n)=>new Date(n.created_at)-new Date(e.created_at)),d.add({severity:"success",summary:"Categorías cargadas",life:2e3})}catch{d.add({severity:"error",summary:"Error",detail:"No se pudieron cargar las categorías de hoteles.",life:4e3})}},ae=()=>{j(),P.value="Guardar",y.value=!1,x.value=!0,R(()=>{w.value={...t.value},C.value=!1})},te=l=>{j(),y.value=!1,t.value={...l},P.value="Actualizar",x.value=!0,R(()=>{w.value={...t.value},C.value=!1})},se=async()=>{var l,e;if(y.value=!0,v.value=!0,!t.value.nombre||t.value.nombre.length<3||t.value.nombre.length>50){d.add({severity:"warn",summary:"Campos requeridos",detail:"El nombre debe tener entre 3 y 50 caracteres.",life:4e3}),v.value=!1;return}if(S.value){d.add({severity:"warn",summary:"Categoría duplicada",detail:`Ya existe una categoría con el nombre "${t.value.nombre}". Por favor, elige un nombre diferente.`,life:6e3}),v.value=!1;return}try{t.value.id?(await E({method:"POST",url:`/api/categorias-hoteles/${t.value.id}`,data:{_method:"PUT",nombre:t.value.nombre}}),d.add({severity:"success",summary:"¡Éxito!",detail:"La categoría ha sido actualizada correctamente.",life:5e3})):(await E.post("/api/categorias-hoteles",{nombre:t.value.nombre}),d.add({severity:"success",summary:"¡Éxito!",detail:"La categoría ha sido creada correctamente.",life:5e3})),await G(),x.value=!1,C.value=!1,w.value=null,j()}catch(n){if(n.response&&n.response.status===422){const u=n.response.data.errors;if(u&&u.nombre){const f=u.nombre[0];f.includes("unique")||f.includes("ya existe")||f.includes("duplicado")?d.add({severity:"warn",summary:"Categoría duplicada",detail:`Ya existe una categoría con el nombre "${t.value.nombre}". Por favor, elige un nombre diferente.`,life:6e3}):d.add({severity:"warn",summary:"Error de validación",detail:f,life:5e3})}else d.add({severity:"warn",summary:"Error de validación",detail:n.response.data.message||"Por favor verifica los datos ingresados.",life:5e3})}else{const u=((e=(l=n.response)==null?void 0:l.data)==null?void 0:e.message)||"Error al procesar la categoría.";d.add({severity:"error",summary:"Error",detail:u,life:6e3})}}finally{v.value=!1}},le=l=>{t.value={...l},h.value=!0},oe=async()=>{var l,e,n;p.value=!0;try{await E({method:"POST",url:`/api/categorias-hoteles/${t.value.id}`,data:{_method:"DELETE"}}),await G(),h.value=!1,d.add({severity:"success",summary:"¡Eliminada!",detail:"La categoría ha sido eliminada correctamente.",life:5e3})}catch(u){if(h.value=!1,((l=u.response)==null?void 0:l.status)===422)d.add({severity:"warn",summary:"No se puede eliminar",detail:u.response.data.message,life:5e3});else{const f=((n=(e=u.response)==null?void 0:e.data)==null?void 0:n.error)||u.message||"Error desconocido";d.add({severity:"error",summary:"Error",detail:`No se pudo eliminar la categoría: ${f}`,life:6e3})}}finally{p.value=!1}},re=()=>{C.value?k.value=!0:I()},I=()=>{x.value=!1,k.value=!1,C.value=!1,w.value=null,j()},ne=()=>{k.value=!1},ie=()=>{t.value.nombre&&t.value.nombre.length>50&&(t.value.nombre=t.value.nombre.substring(0,50))};return(l,e)=>{const n=T("Toast"),u=T("InputText"),f=T("Column"),de=T("DataTable"),$=T("Dialog");return g(),fe(pe,null,{default:c(()=>[o(s(ge),{title:"Control de Categorías de Hoteles"}),o(n,{class:"z-[9999]"}),a("div",ke,[e[22]||(e[22]=a("div",{class:"mb-6"},[a("h1",{class:"text-3xl font-bold text-blue-600 mb-2"},"Control de Categorías de Hoteles"),a("p",{class:"text-gray-600"},"Gestión de categorías de hoteles")],-1)),a("div",Pe,[a("div",Ee,[a("div",Te,[o(s(be),{href:l.route("hoteles"),onClick:Q,class:D([{"opacity-50 cursor-not-allowed":L.value},"flex items-center text-blue-600 hover:text-blue-700 transition-colors duration-200 px-3 py-2 rounded-lg"]),title:"Regresar a Hoteles"},{default:c(()=>[o(s(m),{icon:L.value?s(H):s(he),class:D({"animate-spin":L.value,"h-5 w-5":!0})},null,8,["icon","class"])]),_:1},8,["href","class"]),e[8]||(e[8]=a("h3",{class:"text-2xl sm:text-3xl text-blue-600 font-bold text-center sm:text-start"},"Lista de Categorías",-1))]),a("div",De,[a("button",{class:"bg-red-500 border border-red-500 p-2 text-sm text-white shadow-md hover:shadow-lg rounded-md hover:-translate-y-1 transition-transform duration-300 flex items-center gap-2",onClick:ae},[o(s(m),{icon:s(ye),class:"h-4 w-4"},null,8,["icon"]),e[9]||(e[9]=a("span",null,"Agregar categoría",-1))])])]),o(de,{value:Z.value,dataKey:"id",paginator:!0,rows:W.value,rowsPerPageOptions:X.value,rowsPerPage:W.value,"onUpdate:rowsPerPage":e[1]||(e[1]=r=>W.value=r),paginatorTemplate:"RowsPerPageDropdown FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink",currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} categorías",class:"overflow-x-auto max-w-full",responsiveLayout:"scroll",pt:{root:{class:"text-sm"},wrapper:{class:"text-sm"},table:{class:"text-sm"},thead:{class:"text-sm"},headerRow:{class:"text-sm"},headerCell:{class:"text-sm font-medium py-3 px-2"},tbody:{class:"text-sm"},bodyRow:{class:"h-16 text-sm"},bodyCell:{class:"py-3 px-2 text-sm"},paginator:{class:"text-xs sm:text-sm"},paginatorWrapper:{class:"flex flex-wrap justify-center sm:justify-between items-center gap-2 p-2"}}},{header:c(()=>[a("div",Ne,[o(u,{modelValue:A.value.global.value,"onUpdate:modelValue":e[0]||(e[0]=r=>A.value.global.value=r),placeholder:"🔍 Buscar categorías...",class:"w-full h-9 text-sm rounded-md",style:{"background-color":"white","border-color":"#93c5fd"}},null,8,["modelValue"])])]),default:c(()=>[o(f,{field:"nombre",header:"Nombre",sortable:"",class:"w-96 min-w-52"},{body:c(r=>[a("div",Le,_(r.data.nombre),1)]),_:1}),o(f,{exportable:!1,class:"w-52 min-w-28"},{header:c(()=>e[10]||(e[10]=[a("div",{class:"text-center w-full font-bold"}," Acciones ",-1)])),body:c(r=>[a("div",Ae,[a("button",{class:"flex bg-blue-500 border p-1 py-2 sm:p-2 text-sm shadow-md hover:shadow-lg rounded-md hover:-translate-y-1 transition-transform duration-300",onClick:ue=>te(r.data)},[o(s(m),{icon:s(q),class:"h-3 w-6 sm:h-4 sm:w-7 text-white"},null,8,["icon"]),e[11]||(e[11]=a("span",{class:"hidden md:block text-white"},"Editar",-1))],8,Se),a("button",{class:"flex bg-red-500 border p-1 py-2 sm:p-2 text-sm shadow-md hover:shadow-lg rounded-md hover:-translate-y-1 transition-transform duration-300",onClick:ue=>le(r.data)},[o(s(m),{icon:s(Ce),class:"h-3 w-6 sm:h-4 sm:w-7 text-white"},null,8,["icon"]),e[12]||(e[12]=a("span",{class:"hidden md:block text-white"},"Eliminar",-1))],8,je)])]),_:1})]),_:1},8,["value","rows","rowsPerPageOptions","rowsPerPage"]),o($,{visible:x.value,"onUpdate:visible":e[4]||(e[4]=r=>x.value=r),header:P.value+" Categoría",modal:!0,style:F(V.value),closable:!1,draggable:!1},{footer:c(()=>[a("div",Re,[a("button",{class:"bg-red-500 hover:bg-red-700 text-white border-none px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",onClick:se,disabled:S.value||v.value},[o(s(m),{icon:v.value?s(H):s(Y),class:D(["h-5 text-white",{"animate-spin":v.value}])},null,8,["icon","class"]),v.value?(g(),b("span",Be,_(P.value==="Guardar"?"Guardando...":"Actualizando..."),1)):(g(),b("span",He,_(P.value),1))],8,Fe),a("button",{type:"button",class:"bg-blue-500 hover:bg-blue-700 text-white px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",onClick:re,disabled:v.value},[o(s(m),{icon:s(J),class:"h-5"},null,8,["icon"]),e[14]||(e[14]=O("Cancelar "))],8,Ge)])]),default:c(()=>[a("div",ze,[a("div",Oe,[a("div",Ue,[e[13]||(e[13]=a("label",{for:"nombre",class:"w-24 flex items-center gap-1"},[O(" Nombre: "),a("span",{class:"text-red-500 font-bold"},"*")],-1)),o(u,{modelValue:t.value.nombre,"onUpdate:modelValue":e[2]||(e[2]=r=>t.value.nombre=r),modelModifiers:{trim:!0},id:"nombre",name:"nombre",maxlength:50,class:D([{"p-invalid":y.value&&(!t.value.nombre||t.value.nombre.length<3||t.value.nombre.length>50)||S.value},"flex-1"]),onInput:ie,placeholder:"Nombre de la categoría",onKeypress:e[3]||(e[3]=r=>{/[A-Za-zÀ-ÿ\s]/.test(r.key)||r.preventDefault()})},null,8,["modelValue","class"])]),t.value.nombre&&t.value.nombre.length<3?(g(),b("small",Ve," El nombre debe tener al menos 3 caracteres. Actual: "+_(t.value.nombre.length)+"/3 ",1)):z("",!0),S.value?(g(),b("small",We," Ya existe una categoría con este nombre. Por favor, elige un nombre diferente. ")):z("",!0),t.value.nombre&&t.value.nombre.length>=45&&t.value.nombre.length<=50?(g(),b("small",$e," Caracteres restantes: "+_(50-t.value.nombre.length),1)):z("",!0),y.value&&!t.value.nombre?(g(),b("small",Me," El nombre es obligatorio. ")):z("",!0)])])]),_:1},8,["visible","header","style"]),o($,{visible:h.value,"onUpdate:visible":e[6]||(e[6]=r=>h.value=r),header:"Eliminar categoría",modal:!0,style:F(V.value),closable:!1,draggable:!1},{footer:c(()=>[a("div",Ye,[a("button",{type:"button",class:"bg-red-500 hover:bg-red-700 text-white border-none px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",onClick:oe,disabled:p.value},[o(s(m),{icon:p.value?s(H):s(Y),class:D(["h-5",{"animate-spin":p.value}])},null,8,["icon","class"]),p.value?(g(),b("span",Xe,"Eliminando...")):(g(),b("span",Ke,"Eliminar"))],8,Je),a("button",{type:"button",class:"bg-blue-500 hover:bg-blue-700 text-white px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",onClick:e[5]||(e[5]=r=>h.value=!1),disabled:p.value},[o(s(m),{icon:s(J),class:"h-5"},null,8,["icon"]),e[18]||(e[18]=a("span",null,"Cancelar",-1))],8,Ze)])]),default:c(()=>[a("div",Ie,[o(s(m),{icon:s(K),class:"h-8 w-8 text-red-500"},null,8,["icon"]),a("div",qe,[a("span",null,[e[15]||(e[15]=O("¿Estás seguro de eliminar la categoría: ")),a("b",null,_(t.value.nombre),1),e[16]||(e[16]=O("?"))]),e[17]||(e[17]=a("span",{class:"text-red-600 text-sm font-medium mt-1"},"Esta acción es irreversible.",-1))])])]),_:1},8,["visible","style"]),o($,{visible:k.value,"onUpdate:visible":e[7]||(e[7]=r=>k.value=r),header:"Cambios sin guardar",modal:!0,style:F(V.value),closable:!1,draggable:!1},{footer:c(()=>[a("div",ea,[a("button",{type:"button",class:"bg-red-500 hover:bg-red-700 text-white border-none px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",onClick:I},[o(s(m),{icon:s(_e),class:"h-4"},null,8,["icon"]),e[20]||(e[20]=a("span",null,"Salir sin guardar",-1))]),a("button",{type:"button",class:"bg-blue-500 hover:bg-blue-700 text-white px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",onClick:ne},[o(s(m),{icon:s(q),class:"h-4"},null,8,["icon"]),e[21]||(e[21]=a("span",null,"Continuar",-1))])])]),default:c(()=>[a("div",Qe,[o(s(m),{icon:s(K),class:"h-8 w-8 text-red-500"},null,8,["icon"]),e[19]||(e[19]=a("div",{class:"flex flex-col"},[a("span",null,"¡Tienes información sin guardar!"),a("span",{class:"text-red-600 text-sm font-medium mt-1"},"¿Deseas salir sin guardar?")],-1))])]),_:1},8,["visible","style"])])])]),_:1})}}};export{na as default};
