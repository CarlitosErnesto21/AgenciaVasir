import{N as Y,r as m,w as qe,E as oe,o as Qe,a6 as Xe,h as ne,d as b,x as p,p as n,e,$ as a,a0 as Ke,t as i,y as w,c as y,j,v as ge,F as xe,l as be,a7 as he,q as g,A as ye,a5 as we}from"./vendor-gbh1WW5n.js";import{A as Ye}from"./AuthenticatedLayout-DUTj9WxD.js";import{z as Je,A as _e,a as Ze,F as r,e as Ce,f as k,h as et,q as J,g as ke}from"./ui-BrU4k96Z.js";import{R as tt,a as at,o as O,u as Ee,T as De,m as lt,x as st,c as $,U as Ve,n as ot,r as nt,V as it,b as rt,L as dt,N as Pe,W as ct,h as Se,O as ut,P as mt,Q as vt,j as pt,X as ft,Y as gt,i as Ae}from"./index-BURLB9l4.js";import{f as xt}from"./index-DtyEsSN9.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const bt={class:"container mx-auto px-4 py-6"},ht={class:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6"},yt={class:"bg-gradient-to-r from-yellow-400 to-yellow-600 text-white rounded-lg p-4 shadow-md"},wt={class:"flex items-center justify-between"},_t={class:"text-2xl font-bold"},Ct={class:"bg-gradient-to-r from-green-400 to-green-600 text-white rounded-lg p-4 shadow-md"},kt={class:"flex items-center justify-between"},Et={class:"text-2xl font-bold"},Dt={class:"bg-gradient-to-r from-red-400 to-red-600 text-white rounded-lg p-4 shadow-md"},Vt={class:"flex items-center justify-between"},Pt={class:"text-2xl font-bold"},St={class:"bg-gradient-to-r from-blue-400 to-blue-600 text-white rounded-lg p-4 shadow-md"},At={class:"flex items-center justify-between"},Ft={class:"text-2xl font-bold"},Lt={class:"bg-white rounded-lg shadow-md"},jt={class:"bg-blue-50 p-3 rounded-lg shadow-sm border mb-4"},$t={class:"flex flex-col sm:flex-row items-center justify-between mb-3"},Tt={class:"flex flex-col sm:flex-row sm:items-center gap-3"},It={class:"flex items-center gap-3"},Wt={class:"text-base font-medium text-gray-800 flex items-center gap-2"},Rt={class:"bg-blue-50 border border-blue-200 text-blue-700 px-3 py-1 rounded text-sm font-medium"},Bt={class:"grid grid-cols-2 gap-2 sm:hidden"},Nt=["disabled"],Ut=["disabled"],Ht={class:"flex gap-2"},Mt=["disabled"],Gt=["disabled"],zt={class:"space-y-3"},Ot={class:"relative"},qt={class:"sm:hidden"},Qt=["value"],Xt={class:"grid grid-cols-2 gap-3 sm:hidden"},Kt={class:"hidden sm:grid sm:grid-cols-3 gap-3"},Yt=["value"],Jt={class:"px-1 mt-3"},Zt={class:"text-blue-600 text-xs font-medium flex items-center gap-1"},ea={class:"text-sm leading-relaxed"},ta={class:"flex items-center gap-2"},aa={class:"text-sm font-medium"},la={class:"text-sm font-bold text-green-600"},sa={class:"text-sm text-center"},oa={class:"flex flex-wrap gap-2 justify-center items-center"},na=["onClick"],ia=["onClick"],ra={class:"w-full"},da={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3"},ca={class:"flex flex-col sm:flex-row gap-3 sm:items-center"},ua={class:"flex items-center gap-2"},ma={class:"flex items-center gap-2"},va={class:"text-right"},pa={class:"text-sm font-bold text-blue-700 leading-tight"},fa={key:0,class:"space-y-4"},ga={class:"bg-white rounded-lg border p-4"},xa={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ba={class:"space-y-3"},ha={class:"flex items-center gap-2"},ya={class:"flex items-center gap-2"},wa={class:"flex flex-col gap-1"},_a={key:0,class:"flex flex-wrap items-center gap-2"},Ca={class:"text-xs sm:text-sm break-all"},ka={key:1,class:"text-gray-500 italic text-xs sm:text-sm"},Ea={class:"flex flex-col gap-1"},Da={key:0,class:"flex flex-wrap items-center gap-2"},Va={class:"text-xs sm:text-sm"},Pa={class:"flex gap-1"},Sa=["href"],Aa=["href"],Fa={key:1,class:"text-gray-500 italic text-xs sm:text-sm"},La={key:0,class:"bg-gradient-to-r from-yellow-50 to-orange-50 rounded-lg border-2 border-yellow-300 p-4"},ja={class:"flex items-center justify-between mb-4"},$a={class:"flex items-center gap-2"},Ta={class:"flex items-center gap-2"},Ia={class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800"},Wa={class:"space-y-3"},Ra={class:"text-sm text-gray-600"},Ba={key:0,class:"flex justify-center"},Na=["disabled"],Ua={key:1,class:"space-y-3"},Ha={class:"bg-white rounded-lg border border-yellow-300 p-4"},Ma={class:"flex items-center justify-between mb-2"},Ga={class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800"},za={class:"bg-gray-50 rounded-md p-3 mb-3"},Oa={class:"text-sm text-gray-800 break-all font-mono"},qa={class:"flex items-center justify-between text-xs text-gray-500"},Qa={class:"flex flex-wrap gap-2 justify-center"},Xa={class:"bg-blue-50 border border-blue-200 rounded-lg p-3"},Ka={class:"text-sm font-medium text-blue-800 mb-2"},Ya={class:"bg-white rounded-lg border p-4"},Ja={class:"text-lg font-semibold text-gray-800 mb-4"},Za={class:"flex items-center gap-2"},el={class:"font-medium"},tl={class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800"},al={class:"font-medium"},ll={class:"font-bold text-green-600"},sl={class:"flex justify-center gap-4 w-full mt-6"},ol={key:0,class:"space-y-4"},nl={class:"bg-gray-50 p-4 rounded-lg border"},il={class:"space-y-2 text-sm"},rl={class:"bg-yellow-50 border border-yellow-200 rounded-lg p-4"},dl={class:"flex items-start gap-2"},cl={class:"text-sm text-yellow-800"},ul={class:"flex justify-center gap-4 w-full mt-6"},ml=["disabled"],vl=["disabled"],yl={__name:"Ventas",props:{ventas:{type:[Array,Object],default:()=>[]}},setup(Fe){var fe;Y.defaults.withCredentials=!0;const h=Je(),q=Fe,V=m(Array.isArray(q.ventas)?q.ventas:((fe=q.ventas)==null?void 0:fe.data)||[]),f=m(null);qe(()=>q.ventas,s=>{V.value=Array.isArray(s)?s:(s==null?void 0:s.data)||[]},{deep:!0});const Q=m(!1),A=m(!1),o=m({tipo:null,venta:null,titulo:"",mensaje:"",color:"",icono:null,textoBoton:"",importante:""}),R=m(!1),_=m(null),M=m(!1),B=m(!1),F=m(!1),T=m(!1),E=m(!1),N=m(new Set),I=m(new Set),G=m(""),P=m(""),Z=m({global:{value:null,matchMode:_e.CONTAINS},estado:{value:null,matchMode:_e.EQUALS}}),x=m({estado:null,fechaDesde:null,fechaHasta:null}),ie=m([{name:"Pendiente",value:"pendiente"},{name:"Completada",value:"completada"},{name:"Cancelada",value:"cancelada"}]),ee=m(10),Le=m([5,10,20,50]),te=oe(()=>{let s=V.value;if(G.value){const t=G.value.toLowerCase();s=s.filter(l=>{var d,c,v;return((v=(c=(d=l.cliente)==null?void 0:d.user)==null?void 0:c.name)==null?void 0:v.toLowerCase().includes(t))||l.id.toString().includes(t)||l.estado.toLowerCase().includes(t)})}if(P.value&&(s=s.filter(t=>t.estado===P.value)),x.value.fechaDesde){const t=new Date(x.value.fechaDesde);s=s.filter(l=>new Date(l.fecha)>=t)}if(x.value.fechaHasta){const t=new Date(x.value.fechaHasta);s=s.filter(l=>new Date(l.fecha)<=t)}return s.sort((t,l)=>{const d={pendiente:1,completada:2,cancelada:3},c=d[t.estado.toLowerCase()]||4,v=d[l.estado.toLowerCase()]||4;if(c!==v)return c-v;const D=new Date(t.fecha);return new Date(l.fecha)-D})}),X=oe(()=>{const s={pendientes:0,completadas:0,canceladas:0,totalVendido:0};return V.value.forEach(t=>{switch(t.estado){case"pendiente":s.pendientes++;break;case"completada":s.completadas++,s.totalVendido+=parseFloat(t.total||0);break;case"cancelada":s.canceladas++;break}}),s}),re=m(typeof window<"u"?window.innerWidth:1024),de=oe(()=>re.value<640?{width:"95vw",maxWidth:"380px"}:re.value<768?{width:"80vw"}:{width:"70vw",maxWidth:"900px"}),ce=()=>{Z.value.estado.value=P.value===""?null:P.value},ue=async()=>{F.value=!0;try{await new Promise(s=>setTimeout(s,300)),P.value="",G.value="",Z.value.global.value=null,Z.value.estado.value=null,x.value={estado:null,fechaDesde:null,fechaHasta:null},h.add({severity:"success",summary:"Filtros limpiados",life:2e3})}finally{F.value=!1}},L=()=>{},me=async()=>{E.value=!0,h.add({severity:"info",summary:"Cargando ventas...",life:2e3});try{await we.reload({only:["ventas"],preserveScroll:!0,preserveState:!0}),setTimeout(()=>{h.add({severity:"success",summary:"Ventas actualizadas",detail:`${V.value.length} registros cargados`,life:2e3})},300)}catch(s){console.error("Error al cargar las ventas:",s),h.add({severity:"error",summary:"Error",detail:"No se pudieron cargar las ventas",life:3e3})}finally{setTimeout(()=>{E.value=!1},500)}},je=async()=>{const s=o.value.venta;if(s)try{console.warn("procesarVenta() - Función deshabilitada: las ventas se crean como completadas"),h.add({severity:"info",summary:"Información",detail:"Las ventas se procesan automáticamente al crear el pago",life:3e3}),A.value=!1,o.value={tipo:null,venta:null}}finally{N.value.delete(s.id)}},$e=s=>{o.value={tipo:"cancelar",venta:s,titulo:"¿Cancelar esta venta?",mensaje:"Esta acción cancelará la venta y restaurará el stock si estaba completada.",color:"orange",icono:O,textoBoton:"Sí, Cancelar",importante:"Si la venta estaba completada, se restaurará automáticamente el stock de todos los productos."},A.value=!0},Te=async()=>{var t,l;const s=o.value.venta;if(s){I.value.add(s.id);try{const d=await Y.post(`/api/ventas/${s.id}/cancelar`),c=V.value.findIndex(v=>v.id===s.id);c!==-1&&(V.value[c]={...V.value[c],estado:"cancelada"}),h.add({severity:"success",summary:"Éxito",detail:"Venta cancelada correctamente",life:3e3}),A.value=!1,o.value={tipo:null,venta:null}}catch(d){h.add({severity:"error",summary:"Error",detail:((l=(t=d.response)==null?void 0:t.data)==null?void 0:l.message)||"Error al cancelar la venta",life:3e3})}finally{I.value.delete(s.id)}}},Ie=s=>{o.value={tipo:"eliminar",venta:s,titulo:"¿Eliminar esta venta?",mensaje:"Esta acción no se puede deshacer.",color:"red",icono:Ae,textoBoton:"Sí, Eliminar",importante:s.estado==="completada"?"Se restaurará el stock de todos los productos de esta venta.":"Esta venta será eliminada permanentemente del sistema."},A.value=!0},We=async()=>{var t,l;const s=o.value.venta;if(s){T.value=!0;try{const d=await Y.delete(`/api/ventas/${s.id}/eliminar`),c=V.value.findIndex(v=>v.id===s.id);c!==-1&&V.value.splice(c,1),h.add({severity:"success",summary:"Éxito",detail:"Venta eliminada correctamente",life:3e3}),A.value=!1,o.value={tipo:null,venta:null}}catch(d){h.add({severity:"error",summary:"Error",detail:((l=(t=d.response)==null?void 0:t.data)==null?void 0:l.message)||"Error al eliminar la venta",life:3e3})}finally{T.value=!1}}},Re=()=>{switch(o.value.tipo){case"procesar":je();break;case"cancelar":Te();break;case"eliminar":We();break}},Be=()=>{A.value=!1,o.value={tipo:null,venta:null}},Ne=async()=>{var s,t,l,d,c,v,D,S;if(f.value){R.value=!0,_.value=null,M.value=!1;try{const u=f.value,C=u.detalle_ventas||[],W=C.map(H=>({id:H.producto.id,nombre:H.producto.nombre,precio:H.precio_unitario,cantidad:H.cantidad,imagen:H.producto.primera_imagen||null,subtotal:H.subtotal})),K=`Venta #${u.id} - ${C.length} producto(s) - Cliente: ${((t=(s=u.cliente)==null?void 0:s.user)==null?void 0:t.name)||"Cliente"}`,z=await Y.post("/api/wompi/payment-link",{customer_email:((d=(l=u.cliente)==null?void 0:l.user)==null?void 0:d.email)||"",amount:parseFloat(u.total),description:K,reference:`VENTA-${u.id}-${Date.now()}`,customer_name:((v=(c=u.cliente)==null?void 0:c.user)==null?void 0:v.name)||"Cliente",venta_id:u.id,productos:W});if(z.data.success)_.value={payment_link:z.data.payment_link,reference:z.data.reference,link_id:z.data.link_id},M.value=!0,h.add({severity:"success",summary:"¡Enlace generado!",detail:"Enlace de pago de Wompi creado exitosamente",life:4e3});else throw new Error(z.data.message||"Error al generar enlace")}catch(u){console.error("Error generando enlace Wompi:",u),h.add({severity:"error",summary:"Error",detail:((S=(D=u.response)==null?void 0:D.data)==null?void 0:S.message)||"No se pudo generar el enlace de pago",life:5e3})}finally{R.value=!1}}},Ue=async()=>{var s;if((s=_.value)!=null&&s.payment_link)try{await navigator.clipboard.writeText(_.value.payment_link),B.value=!0,h.add({severity:"success",summary:"¡Copiado!",detail:"Enlace copiado al portapapeles",life:3e3}),setTimeout(()=>{B.value=!1},3e3)}catch{const l=document.createElement("textarea");l.value=_.value.payment_link,document.body.appendChild(l),l.select(),document.execCommand("copy"),document.body.removeChild(l),h.add({severity:"info",summary:"Enlace copiado",detail:"Enlace copiado usando método alternativo",life:3e3})}},He=()=>{var s;(s=_.value)!=null&&s.payment_link&&window.open(_.value.payment_link,"_blank")},ve=()=>{_.value=null,M.value=!1,B.value=!1},Me=()=>{Q.value=!1,setTimeout(()=>{ve()},200)},Ge=s=>{s.originalEvent.target.closest("button")||(f.value=s.data,Q.value=!0)},pe=s=>s?new Date(s).toLocaleDateString("es-ES",{year:"numeric",month:"2-digit",day:"2-digit"}):"N/A",U=s=>s?parseFloat(s).toLocaleString("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00",ae=s=>{switch(s){case"pendiente":return"bg-yellow-100 text-yellow-800";case"completada":return"bg-green-100 text-green-800";case"cancelada":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},le=s=>{switch(s){case"pendiente":return"Pendiente de Pago";case"completada":return"Completada";case"cancelada":return"Cancelada";default:return"Desconocido"}},ze=s=>{if(!s)return;/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?window.location.href=`mailto:${s}`:window.open(`https://mail.google.com/mail/?view=cm&fs=1&to=${s}`,"_blank")};let se=null;const Oe=()=>{we.reload({only:["ventas"],preserveScroll:!0,preserveState:!0})};return Qe(()=>{h.add({severity:"info",summary:"Cargando ventas...",life:2e3}),setTimeout(()=>{h.add({severity:"success",summary:"Ventas cargadas",life:2e3})},1e3),se=setInterval(()=>{Oe()},3e4)}),Xe(()=>{se&&clearInterval(se)}),(s,t)=>(b(),ne(Ye,null,{default:p(()=>[n(a(Ke),{title:"Ventas"}),n(a(Ze),{class:"z-[9999]"}),e("div",bt,[t[22]||(t[22]=e("div",{class:"mb-6 text-center sm:text-left"},[e("h1",{class:"text-3xl font-bold text-blue-600 mb-2"},"Gestión de Ventas de Productos"),e("p",{class:"text-gray-600"},"Visualiza y administra todas las ventas de productos realizadas en el sistema.")],-1)),e("div",ht,[e("div",yt,[e("div",wt,[e("div",null,[t[11]||(t[11]=e("div",{class:"text-yellow-100 text-sm"},"Ventas Pendientes",-1)),e("div",_t,i(X.value.pendientes),1)]),n(a(r),{icon:a(tt),class:"text-3xl text-yellow-200"},null,8,["icon"])])]),e("div",Ct,[e("div",kt,[e("div",null,[t[12]||(t[12]=e("div",{class:"text-green-100 text-sm"},"Ventas Completadas",-1)),e("div",Et,i(X.value.completadas),1)]),n(a(r),{icon:a(at),class:"text-3xl text-green-200"},null,8,["icon"])])]),e("div",Dt,[e("div",Vt,[e("div",null,[t[13]||(t[13]=e("div",{class:"text-red-100 text-sm"},"Ventas Canceladas",-1)),e("div",Pt,i(X.value.canceladas),1)]),n(a(r),{icon:a(O),class:"text-3xl text-red-200"},null,8,["icon"])])]),e("div",St,[e("div",At,[e("div",null,[t[14]||(t[14]=e("div",{class:"text-blue-100 text-sm"},"Total Vendido",-1)),e("div",Ft,"$"+i(U(X.value.totalVendido)),1)]),n(a(r),{icon:a(Ee),class:"text-3xl text-blue-200"},null,8,["icon"])])])]),e("div",Lt,[n(a(Ce),{value:te.value,dataKey:"id",paginator:!0,rows:ee.value,rowsPerPageOptions:Le.value,rowsPerPage:ee.value,"onUpdate:rowsPerPage":t[7]||(t[7]=l=>ee.value=l),paginatorTemplate:"RowsPerPageDropdown FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink",currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} ventas",class:"overflow-x-auto max-w-full",responsiveLayout:"scroll",onRowClick:Ge,pt:{root:{class:"text-sm"},wrapper:{class:"text-sm"},table:{class:"text-sm"},thead:{class:"text-sm"},headerRow:{class:"text-sm"},headerCell:{class:"text-sm font-medium py-3 px-2"},tbody:{class:"text-sm"},bodyRow:{class:"h-20 text-sm cursor-pointer hover:bg-blue-50 transition-colors duration-200"},bodyCell:{class:"py-3 px-2 text-sm"},paginator:{class:"text-xs sm:text-sm"},paginatorWrapper:{class:"flex flex-wrap justify-center sm:justify-between items-center gap-2 p-2"}}},{header:p(()=>[e("div",jt,[e("div",$t,[e("div",Tt,[e("div",It,[e("h3",Wt,[n(a(r),{icon:a(st),class:"text-blue-600 text-sm"},null,8,["icon"]),t[15]||(t[15]=e("span",null,"Filtros",-1))]),e("div",Rt,i(te.value.length)+" resultado"+i(te.value.length!==1?"s":""),1)]),e("div",Bt,[e("button",{class:"bg-blue-500 hover:bg-blue-600 border border-blue-500 px-3 py-2 text-sm text-white shadow-md rounded-md disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",onClick:me,disabled:E.value},[n(a(r),{icon:E.value?a($):a(Ve),class:w([{"animate-spin":E.value},"h-3 w-3"])},null,8,["icon","class"]),e("span",null,i(E.value?"Recargando...":"Recargar"),1)],8,Nt),e("button",{class:"bg-red-500 hover:bg-red-600 border border-red-500 px-3 py-2 text-sm text-white shadow-md rounded-md disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",onClick:ue,disabled:F.value},[F.value?(b(),ne(a(r),{key:0,icon:a($),class:"animate-spin h-3 w-3"},null,8,["icon"])):j("",!0),e("span",null,i(F.value?"Limpiando...":"Limpiar"),1)],8,Ut)])]),e("div",Ht,[e("button",{class:"bg-blue-500 hover:bg-blue-600 border border-blue-500 px-3 py-1 text-sm text-white shadow-md rounded-md hidden sm:flex disabled:opacity-50 disabled:cursor-not-allowed items-center gap-2",onClick:me,disabled:E.value},[n(a(r),{icon:E.value?a($):a(Ve),class:w([{"animate-spin":E.value},"h-3 w-3"])},null,8,["icon","class"]),e("span",null,i(E.value?"Recargando...":"Recargar"),1)],8,Mt),e("button",{class:"bg-red-500 hover:bg-red-600 border border-red-500 px-3 py-1 text-sm text-white shadow-md rounded-md hidden sm:flex disabled:opacity-50 disabled:cursor-not-allowed items-center gap-2",onClick:ue,disabled:F.value},[F.value?(b(),ne(a(r),{key:0,icon:a($),class:"animate-spin h-3 w-3"},null,8,["icon"])):j("",!0),e("span",null,i(F.value?"Limpiando...":"Limpiar filtros"),1)],8,Gt)])]),e("div",zt,[e("div",Ot,[n(a(r),{icon:a(ot),class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"},null,8,["icon"]),n(a(et),{modelValue:G.value,"onUpdate:modelValue":t[0]||(t[0]=l=>G.value=l),placeholder:"Buscar ventas...",class:"w-full h-9 text-sm rounded-md pl-10",style:{"background-color":"white","border-color":"#93c5fd"}},null,8,["modelValue"])]),e("div",qt,[ge(e("select",{"onUpdate:modelValue":t[1]||(t[1]=l=>P.value=l),onChange:ce,class:"w-full h-9 text-sm border border-blue-300 rounded-md px-3 py-1 bg-white text-gray-400 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 truncate"},[t[16]||(t[16]=e("option",{value:"",disabled:"",selected:"",hidden:""},"Estado",-1)),(b(!0),y(xe,null,be(ie.value,l=>(b(),y("option",{key:l.value,value:l.value,class:"truncate"},i(l.name),9,Qt))),128))],544),[[he,P.value]])]),e("div",Xt,[e("div",null,[n(a(J),{modelValue:x.value.fechaDesde,"onUpdate:modelValue":t[2]||(t[2]=l=>x.value.fechaDesde=l),placeholder:"Fecha Desde",class:"w-full h-9 text-sm border",style:{"background-color":"white","border-color":"#93c5fd"},onDateSelect:L,onClear:L,showIcon:!0,dateFormat:"dd/mm/yy",maxDate:x.value.fechaHasta},null,8,["modelValue","maxDate"])]),e("div",null,[n(a(J),{modelValue:x.value.fechaHasta,"onUpdate:modelValue":t[3]||(t[3]=l=>x.value.fechaHasta=l),placeholder:"Fecha Hasta",class:"w-full h-9 text-sm border",style:{"background-color":"white","border-color":"#93c5fd"},onDateSelect:L,onClear:L,showIcon:!0,dateFormat:"dd/mm/yy",minDate:x.value.fechaDesde},null,8,["modelValue","minDate"])])]),e("div",Kt,[e("div",null,[ge(e("select",{"onUpdate:modelValue":t[4]||(t[4]=l=>P.value=l),onChange:ce,class:"w-full h-9 text-sm border border-blue-300 rounded-md px-3 py-1 bg-white text-gray-400 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 truncate"},[t[17]||(t[17]=e("option",{value:"",disabled:"",selected:"",hidden:""},"Estado",-1)),(b(!0),y(xe,null,be(ie.value,l=>(b(),y("option",{key:l.value,value:l.value,class:"truncate text-gray-900"},i(l.name),9,Yt))),128))],544),[[he,P.value]])]),e("div",null,[n(a(J),{modelValue:x.value.fechaDesde,"onUpdate:modelValue":t[5]||(t[5]=l=>x.value.fechaDesde=l),placeholder:"Fecha desde",class:"w-full h-9 text-sm border",style:{"background-color":"white","border-color":"#93c5fd"},onDateSelect:L,onClear:L,showIcon:!0,dateFormat:"dd/mm/yy",maxDate:x.value.fechaHasta},null,8,["modelValue","maxDate"])]),e("div",null,[n(a(J),{modelValue:x.value.fechaHasta,"onUpdate:modelValue":t[6]||(t[6]=l=>x.value.fechaHasta=l),placeholder:"Fecha hasta",class:"w-full h-9 text-sm border",style:{"background-color":"white","border-color":"#93c5fd"},onDateSelect:L,onClear:L,showIcon:!0,dateFormat:"dd/mm/yy",minDate:x.value.fechaDesde},null,8,["modelValue","minDate"])])]),e("div",Jt,[e("p",Zt,[n(a(r),{icon:a(nt),class:"h-3 w-3 text-yellow-500"},null,8,["icon"]),t[18]||(t[18]=g(" Haz clic en cualquier fila para ver los detalles. "))])])])])]),default:p(()=>[n(a(k),{field:"fecha",header:"Fecha",sortable:"",class:"w-24 hidden md:table-cell"},{body:p(l=>[e("div",ea,i(pe(l.data.fecha)),1)]),_:1}),n(a(k),{field:"cliente.user.name",header:"Cliente",sortable:"",class:"w-32 min-w-24"},{body:p(l=>{var d,c;return[e("div",ta,[n(a(r),{icon:a(De),class:"text-gray-500 text-xs"},null,8,["icon"]),e("span",aa,i(((c=(d=l.data.cliente)==null?void 0:d.user)==null?void 0:c.name)||"N/A"),1)])]}),_:1}),n(a(k),{field:"total",header:"Total",class:"w-24"},{body:p(l=>[e("div",la," $"+i(U(l.data.total)),1)]),_:1}),n(a(k),{field:"estado",header:"Estado",class:"w-28 hidden sm:table-cell"},{body:p(l=>[e("span",{class:w("inline-flex items-center px-2 py-1 rounded-full text-xs font-medium "+ae(l.data.estado))},i(le(l.data.estado)),3)]),_:1}),n(a(k),{header:"Items",class:"w-16 hidden md:table-cell"},{body:p(l=>{var d;return[e("div",sa,i(((d=l.data.detalle_ventas)==null?void 0:d.length)||0),1)]}),_:1}),n(a(k),{exportable:!1,class:"w-64 min-w-32"},{header:p(()=>t[19]||(t[19]=[e("div",{class:"text-center w-full font-bold"}," Acciones ",-1)])),body:p(l=>[e("div",oa,[l.data.estado==="completada"?(b(),y("button",{key:0,class:"flex bg-orange-500 border p-1 py-2 sm:p-2 text-sm shadow-md hover:shadow-lg rounded-md hover:-translate-y-1 transition-transform duration-300",onClick:d=>$e(l.data),title:"Cancelar venta"},[n(a(r),{icon:a(O),class:"h-4 w-5 sm:h-4 sm:w-6 text-white"},null,8,["icon"]),t[20]||(t[20]=e("span",{class:"hidden lg:block text-white ml-1"},"Cancelar",-1))],8,na)):j("",!0),e("button",{class:"flex bg-red-500 border p-1 py-2 sm:p-2 text-sm shadow-md hover:shadow-lg rounded-md hover:-translate-y-1 transition-transform duration-300",onClick:d=>Ie(l.data),title:"Eliminar venta"},[n(a(r),{icon:a(lt),class:"h-4 w-5 sm:h-4 sm:w-6 text-white"},null,8,["icon"]),t[21]||(t[21]=e("span",{class:"hidden lg:block text-white ml-1"},"Eliminar",-1))],8,ia)])]),_:1})]),_:1},8,["value","rows","rowsPerPageOptions","rowsPerPage"])])]),n(a(ke),{visible:Q.value,"onUpdate:visible":t[9]||(t[9]=l=>Q.value=l),style:ye(de.value),modal:!0,closable:!1,draggable:!1},{header:p(()=>[e("div",ra,[e("div",da,[t[23]||(t[23]=e("div",null,[e("h3",{class:"text-lg sm:text-xl font-bold text-gray-800 mb-1"}," Detalles de la Venta ")],-1)),e("div",ca,[e("div",ua,[e("span",{class:w("px-3 py-1.5 rounded-full text-sm font-bold shadow-md border-2 border-white "+ae(f.value.estado))},i(le(f.value.estado)),3)]),e("div",ma,[n(a(r),{icon:a(gt),class:"text-blue-600 text-lg"},null,8,["icon"]),e("div",va,[e("p",pa,i(pe(f.value.fecha)),1)])])])])])]),footer:p(()=>[e("div",sl,[e("button",{class:"bg-blue-500 hover:bg-blue-700 text-white px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",onClick:Me},[n(a(r),{icon:a(O),class:"h-5"},null,8,["icon"]),t[42]||(t[42]=g(" Cerrar "))])])]),default:p(()=>{var l,d,c,v,D,S;return[f.value?(b(),y("div",fa,[e("div",ga,[t[31]||(t[31]=e("div",{class:"mb-4"},[e("h4",{class:"text-lg font-semibold text-gray-800"},"Información General")],-1)),e("div",xa,[e("div",ba,[e("div",ha,[n(a(r),{icon:a(it),class:"text-gray-500 text-sm"},null,8,["icon"]),t[24]||(t[24]=e("strong",null,"ID:",-1)),g(" #"+i(f.value.id),1)]),e("div",ya,[n(a(r),{icon:a(De),class:"text-gray-500 text-sm"},null,8,["icon"]),t[25]||(t[25]=e("strong",null,"Cliente:",-1)),g(" "+i(((d=(l=f.value.cliente)==null?void 0:l.user)==null?void 0:d.name)||"N/A"),1)]),e("div",wa,[t[27]||(t[27]=e("span",{class:"font-medium text-gray-700"},"Email:",-1)),(v=(c=f.value.cliente)==null?void 0:c.user)!=null&&v.email?(b(),y("div",_a,[e("span",Ca,i(f.value.cliente.user.email),1),e("a",{onClick:t[8]||(t[8]=u=>ze(f.value.cliente.user.email)),href:"#",class:"inline-flex items-center gap-1 px-2 py-1 bg-red-500 hover:bg-red-600 text-white text-xs rounded-md transition-colors duration-200 cursor-pointer",title:"Abrir Gmail para enviar correo"},[n(a(r),{icon:a(rt),class:"h-3 w-3"},null,8,["icon"]),t[26]||(t[26]=e("span",{class:"hidden sm:inline"},"Enviar Email",-1))])])):(b(),y("span",ka,"Email no disponible"))]),e("div",Ea,[t[30]||(t[30]=e("span",{class:"font-medium text-gray-700"},"Teléfono:",-1)),(D=f.value.cliente)!=null&&D.telefono?(b(),y("div",Da,[e("span",Va,i(f.value.cliente.telefono),1),e("div",Pa,[e("a",{href:`https://wa.me/${f.value.cliente.telefono.replace(/[^0-9]/g,"")}`,target:"_blank",rel:"noopener noreferrer",class:"inline-flex items-center gap-1 px-2 py-1 bg-green-500 hover:bg-green-600 text-white text-xs rounded-md transition-colors duration-200",title:"Enviar mensaje por WhatsApp"},[n(a(r),{icon:a(xt),class:"h-3 w-3"},null,8,["icon"]),t[28]||(t[28]=e("span",{class:"hidden sm:inline"},"WhatsApp",-1))],8,Sa),e("a",{href:`tel:${f.value.cliente.telefono}`,class:"inline-flex items-center gap-1 px-2 py-1 bg-blue-500 hover:bg-blue-600 text-white text-xs rounded-md transition-colors duration-200",title:"Llamar por teléfono"},[n(a(r),{icon:a(dt),class:"h-3 w-3"},null,8,["icon"]),t[29]||(t[29]=e("span",{class:"hidden sm:inline"},"Llamar",-1))],8,Aa)])])):(b(),y("span",Fa,"Teléfono no disponible"))])])])]),f.value.estado==="pendiente"?(b(),y("div",La,[e("div",ja,[e("div",$a,[n(a(r),{icon:a(Pe),class:"text-orange-600 text-lg"},null,8,["icon"]),t[32]||(t[32]=e("h4",{class:"text-lg font-semibold text-gray-800"},"Generar Enlace de Pago Wompi",-1))]),e("div",Ta,[e("span",Ia,[n(a(r),{icon:a(Ee),class:"mr-1"},null,8,["icon"]),g(" Total: $"+i(U(f.value.total)),1)])])]),e("div",Wa,[e("p",Ra,[n(a(r),{icon:a(ct),class:"text-blue-500 mr-1"},null,8,["icon"]),t[33]||(t[33]=e("strong",null,"¿El cliente aún no ha pagado?",-1)),t[34]||(t[34]=e("br",null,null,-1)),t[35]||(t[35]=g(" Genera un enlace de pago personalizado para que el cliente pueda pagar esta venta directamente. "))]),M.value?j("",!0):(b(),y("div",Ba,[e("button",{onClick:Ne,disabled:R.value,class:"bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-600 hover:to-orange-600 disabled:opacity-50 disabled:cursor-not-allowed text-white px-6 py-3 rounded-lg transition-all duration-200 flex items-center gap-2 shadow-lg hover:shadow-xl"},[n(a(r),{icon:R.value?a($):a(Pe),class:w({"animate-spin":R.value})},null,8,["icon","class"]),g(" "+i(R.value?"Generando enlace...":"Generar Enlace de Pago"),1)],8,Na)])),M.value&&_.value?(b(),y("div",Ua,[e("div",Ha,[e("div",Ma,[t[37]||(t[37]=e("span",{class:"text-sm font-medium text-gray-700"},"Enlace de Pago Generado:",-1)),e("span",Ga,[n(a(r),{icon:a(Se),class:"mr-1"},null,8,["icon"]),t[36]||(t[36]=g(" ¡Listo para usar! "))])]),e("div",za,[e("p",Oa,i(_.value.payment_link),1)]),e("div",qa,[e("span",null,"Referencia: "+i(_.value.reference),1),e("span",null,"ID: "+i(_.value.link_id),1)])]),e("div",Qa,[e("button",{onClick:Ue,class:w(["px-4 py-2 rounded-lg transition-all duration-200 flex items-center gap-2 text-sm font-medium",B.value?"bg-green-500 text-white":"bg-blue-500 hover:bg-blue-600 text-white"])},[n(a(r),{icon:B.value?a(Se):a(ut)},null,8,["icon"]),g(" "+i(B.value?"¡Copiado!":"Copiar Enlace"),1)],2),e("button",{onClick:He,class:"bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-lg transition-all duration-200 flex items-center gap-2 text-sm font-medium"},[n(a(r),{icon:a(mt)},null,8,["icon"]),t[38]||(t[38]=g(" Ver Enlace "))]),e("button",{onClick:ve,class:"bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-all duration-200 flex items-center gap-2 text-sm font-medium"},[n(a(r),{icon:a(vt)},null,8,["icon"]),t[39]||(t[39]=g(" Limpiar "))])]),e("div",Xa,[e("h5",Ka,[n(a(r),{icon:a(pt),class:"mr-1"},null,8,["icon"]),t[40]||(t[40]=g(" Instrucciones de uso: "))]),t[41]||(t[41]=e("ul",{class:"text-xs text-blue-700 space-y-1"},[e("li",null,"• Copia el enlace y envíalo al cliente por WhatsApp, email o SMS"),e("li",null,"• El cliente podrá pagar correctamente su carrito"),e("li",null,"• Recibirás notificación automática cuando se complete el pago"),e("li",null,"• El enlace es seguro y está protegido por Wompi")],-1))])])):j("",!0)])])):j("",!0),e("div",Ya,[e("h4",Ja," Productos Vendidos ("+i(((S=f.value.detalle_ventas)==null?void 0:S.length)||0)+") ",1),n(a(Ce),{value:f.value.detalle_ventas,class:"text-sm",stripedRows:""},{default:p(()=>[n(a(k),{field:"producto.nombre",header:"Producto"},{body:p(({data:u})=>{var C;return[e("div",Za,[n(a(r),{icon:a(ft),class:"text-blue-500 text-sm"},null,8,["icon"]),e("span",el,i((C=u.producto)==null?void 0:C.nombre),1)])]}),_:1}),n(a(k),{field:"producto.categoria.nombre",header:"Categoría"},{body:p(({data:u})=>{var C,W;return[e("span",tl,i(((W=(C=u.producto)==null?void 0:C.categoria)==null?void 0:W.nombre)||"Sin categoría"),1)]}),_:1}),n(a(k),{field:"cantidad",header:"Cantidad",style:{width:"100px"}},{body:p(({data:u})=>[e("span",al,i(u.cantidad),1)]),_:1}),n(a(k),{field:"precio_unitario",header:"Precio Unit.",style:{width:"120px"}},{body:p(({data:u})=>[e("span",null,"$"+i(U(u.precio_unitario)),1)]),_:1}),n(a(k),{field:"subtotal",header:"Subtotal",style:{width:"120px","font-size":"17px"}},{body:p(({data:u})=>[e("span",ll," $"+i(U(u.subtotal)),1)]),_:1})]),_:1},8,["value"])])])):j("",!0)]}),_:1},8,["visible","style"]),n(a(ke),{visible:A.value,"onUpdate:visible":t[10]||(t[10]=l=>A.value=l),style:ye(de.value),header:o.value.titulo,modal:!0,closable:!1,draggable:!1},{footer:p(()=>{var l,d,c,v,D,S,u,C,W,K;return[e("div",ul,[e("button",{class:w(["text-white px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",o.value.color==="green"?"bg-green-500 hover:bg-green-600":o.value.color==="orange"?"bg-orange-500 hover:bg-orange-600":"bg-red-500 hover:bg-red-600"]),onClick:Re,disabled:o.value.tipo==="procesar"&&N.value.has((l=o.value.venta)==null?void 0:l.id)||o.value.tipo==="cancelar"&&I.value.has((d=o.value.venta)==null?void 0:d.id)||o.value.tipo==="eliminar"&&T.value},[n(a(r),{icon:o.value.tipo==="procesar"&&N.value.has((c=o.value.venta)==null?void 0:c.id)?a($):o.value.tipo==="cancelar"&&I.value.has((v=o.value.venta)==null?void 0:v.id)?a($):o.value.tipo==="eliminar"&&T.value?a($):o.value.icono,class:w(["h-4",{"animate-spin":o.value.tipo==="procesar"&&N.value.has((D=o.value.venta)==null?void 0:D.id)||o.value.tipo==="cancelar"&&I.value.has((S=o.value.venta)==null?void 0:S.id)||o.value.tipo==="eliminar"&&T.value}])},null,8,["icon","class"]),g(" "+i(o.value.tipo==="procesar"&&N.value.has((u=o.value.venta)==null?void 0:u.id)?"Procesando...":o.value.tipo==="cancelar"&&I.value.has((C=o.value.venta)==null?void 0:C.id)?"Cancelando...":o.value.tipo==="eliminar"&&T.value?"Eliminando...":o.value.textoBoton),1)],10,ml),e("button",{class:"bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",onClick:Be,disabled:o.value.tipo==="procesar"&&N.value.has((W=o.value.venta)==null?void 0:W.id)||o.value.tipo==="cancelar"&&I.value.has((K=o.value.venta)==null?void 0:K.id)||o.value.tipo==="eliminar"&&T.value},[n(a(r),{icon:a(O),class:"h-4"},null,8,["icon"]),t[50]||(t[50]=g(" Cerrar "))],8,vl)])]}),default:p(()=>{var l,d,c,v;return[o.value.venta?(b(),y("div",ol,[e("div",{class:w(["flex items-center gap-3 p-4 rounded-lg border",o.value.color==="green"?"bg-green-50 border-green-200":o.value.color==="orange"?"bg-orange-50 border-orange-200":"bg-red-50 border-red-200"])},[n(a(r),{icon:o.value.icono,class:w(["text-2xl",o.value.color==="green"?"text-green-500":o.value.color==="orange"?"text-orange-500":"text-red-500"])},null,8,["icon","class"]),e("div",null,[e("h4",{class:w(["text-lg font-semibold",o.value.color==="green"?"text-green-800":o.value.color==="orange"?"text-orange-800":"text-red-800"])},i(o.value.titulo),3),e("p",{class:w([o.value.color==="green"?"text-green-700":o.value.color==="orange"?"text-orange-700":"text-red-700"])},i(o.value.mensaje),3)])],2),e("div",nl,[t[48]||(t[48]=e("h5",{class:"font-semibold text-gray-800 mb-2"},"Información de la venta:",-1)),e("div",il,[e("div",null,[t[43]||(t[43]=e("strong",null,"ID:",-1)),g(" #"+i(o.value.venta.id),1)]),e("div",null,[t[44]||(t[44]=e("strong",null,"Cliente:",-1)),g(" "+i(((d=(l=o.value.venta.cliente)==null?void 0:l.user)==null?void 0:d.name)||"N/A"),1)]),e("div",null,[t[45]||(t[45]=e("strong",null,"Email:",-1)),g(" "+i(((v=(c=o.value.venta.cliente)==null?void 0:c.user)==null?void 0:v.email)||"N/A"),1)]),e("div",null,[t[46]||(t[46]=e("strong",null,"Total:",-1)),g(" $"+i(U(o.value.venta.total)),1)]),e("div",null,[t[47]||(t[47]=e("strong",null,"Estado:",-1)),e("span",{class:w("inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ml-1 "+ae(o.value.venta.estado))},i(le(o.value.venta.estado)),3)])])]),e("div",rl,[e("div",dl,[n(a(r),{icon:a(Ae),class:"text-yellow-500 text-sm mt-0.5"},null,8,["icon"]),e("div",cl,[t[49]||(t[49]=e("strong",null,"Importante:",-1)),g(" "+i(o.value.importante),1)])])])])):j("",!0)]}),_:1},8,["visible","style","header"])]),_:1}))}};export{yl as default};
