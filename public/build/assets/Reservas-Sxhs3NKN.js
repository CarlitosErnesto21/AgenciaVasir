import{r as u,E as T,w as ie,o as Ke,a3 as Ce,a6 as Qe,h as de,d as h,x as y,p as n,e as s,$ as l,a0 as Ye,A as ue,t as m,y as E,c as D,j as w,q as H,v as De,a9 as Re,N as O,n as ea}from"./vendor-CqKcGHPa.js";import{A as aa}from"./AuthenticatedLayout-DnegqiP_.js";import{z as sa,D as ta,a as la,r as oa,F as f,h as ra,q as Y,o as na,e as ia,f as P,g as _e}from"./ui-DrLUz167.js";import{c as ee,e as _,g as da,z as ae,B as se,C as Ne,l as ce,n as ua,D as Te,E as ca,k as ma,w as va}from"./index-t8PHqkOa.js";import pa from"./Modales-tjLuI1vf.js";import fa from"./CambiarEstado-Dq3pyi_m.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-DtyEsSN9.js";const ga={class:"flex items-center gap-3"},ba={class:"flex flex-col"},xa={class:"text-red-600 text-sm font-medium mt-1"},ya={class:"container mx-auto px-4 py-6"},ha={class:"mb-6"},wa=["disabled"],Ea={class:"bg-white rounded-lg shadow-md"},Aa={key:0,class:"p-6 border-b border-gray-200"},Ca={class:"mb-4 space-y-2"},Da={class:"text-sm text-blue-600 flex items-center gap-2"},Ra={key:0,class:"text-sm text-amber-600 flex items-center gap-2 bg-amber-50 p-2 rounded-md"},_a={key:1,class:"text-sm text-blue-600 flex items-center gap-2 bg-blue-50 p-3 rounded-md border border-blue-200"},Na={key:2,class:"text-sm text-gray-600 flex items-center gap-2 bg-gray-50 p-2 rounded-md"},Ta={class:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:flex lg:flex-wrap gap-2 md:gap-3"},Oa={class:"bg-gray-100 border-2 border-gray-300 rounded-lg px-2 py-2 md:px-4 md:py-3 flex-1 min-w-0"},La={class:"text-xs md:text-sm font-bold text-gray-800"},Ia={class:"flex items-center gap-2 text-white"},Sa={class:"flex items-center gap-2 text-white"},Ma={class:"flex items-center gap-2 text-white"},ka=["title"],Fa={class:"flex items-center gap-2 text-white"},Pa={class:"flex-1"},za={key:0,class:"text-xs opacity-70"},Va={class:"bg-blue-50 p-3 rounded-lg shadow-sm border mb-4 mx-4"},Ua={class:"flex flex-wrap items-center justify-between gap-2 mb-3"},$a={class:"flex items-center gap-2 flex-wrap"},qa={class:"bg-blue-50 border border-blue-200 text-blue-700 px-2 py-1 rounded text-xs font-medium"},ja=["disabled"],Ba={class:"space-y-3"},Ha={class:"grid grid-cols-1 md:grid-cols-3 gap-3"},Ga={class:"px-4 mb-3"},Za={class:"text-blue-600 text-xs font-medium flex items-center gap-1"},Wa={class:"text-center py-12"},Xa={class:"font-medium text-xs sm:text-sm"},Ja={class:"flex items-center gap-1 sm:gap-3"},Ka={class:"w-6 h-6 sm:w-8 sm:h-8 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0"},Qa={class:"min-w-0 flex-1"},Ya=["title"],es=["title"],as={class:"text-xs sm:text-sm"},ss={class:"font-medium"},ts={class:"text-xs text-gray-500"},ls={class:"font-medium text-green-600 text-xs sm:text-sm"},os={class:"hidden xl:inline"},rs={class:"xl:hidden"},ns=["onClick"],is={class:"space-y-4"},ds={class:"bg-orange-50 p-4 rounded-lg border border-orange-200 mb-4"},us={class:"flex items-start gap-3"},cs={class:"bg-red-50 p-4 rounded-lg border border-red-200"},ms={class:"flex items-center gap-2 mb-2"},vs={class:"font-semibold text-red-800"},ps={class:"text-xs text-red-600 mt-2"},fs={class:"text-gray-500"},gs={class:"flex justify-end gap-3 pt-4"},bs=["disabled"],xs={class:"space-y-4"},ys={class:"bg-blue-50 p-4 rounded-lg border border-blue-200"},hs={class:"font-semibold text-blue-800 mb-2"},ws={class:"text-sm text-blue-600"},Es={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},As={class:"flex justify-center items-center gap-3 pt-4"},Cs=["disabled"],Ds=["disabled"],ks={__name:"Reservas",setup(Rs){const v=sa(),Oe=ta(),b=u([]),Le=u([]),me=u(!1);u(!1);const L=u(null),o=u(null),ve=u(!1),G=u(!1),x=u({cambiarEstado:!1}),Z=u(!1),I=u(!1),g=u({fechaSalida:null,fechaRegreso:null,motivo:""}),c=u({busqueda:"",fechaDesde:null,fechaHasta:null,estado:null}),S=u(!1),W=u(!1),z=u(!1),X=u(!1),J=u(null),te=u(null),Ie=u(""),R=u("");u(null),u(""),u("");const pe=u(typeof window<"u"?window.innerWidth:1024),V=u(!1),le=u(!1),oe=u(!1),re=u(!1),N=u(!1),K=[{label:"Pendiente",value:"PENDIENTE",severity:"warn",color:"bg-yellow-100 text-yellow-800",icon:ca},{label:"Confirmada",value:"CONFIRMADA",severity:"success",color:"bg-green-100 text-green-800",icon:ma},{label:"En Curso",value:"EN_CURSO",severity:"info",color:"bg-blue-100 text-blue-800",icon:se},{label:"Finalizada",value:"FINALIZADA",severity:"secondary",color:"bg-gray-100 text-gray-800",icon:Ne},{label:"Rechazada",value:"CANCELADA",severity:"danger",color:"bg-red-100 text-red-800",icon:ce},{label:"Reprogramada",value:"REPROGRAMADA",severity:"info",color:"bg-purple-100 text-purple-800",icon:se}],fe=[{label:"Disponible",value:"DISPONIBLE",color:"bg-green-100 text-green-800"},{label:"Completo",value:"COMPLETO",color:"bg-orange-100 text-orange-800"},{label:"En Curso",value:"EN_CURSO",color:"bg-blue-100 text-blue-800"},{label:"Finalizado",value:"FINALIZADO",color:"bg-gray-100 text-gray-800"},{label:"Cancelada",value:"CANCELADA",color:"bg-red-100 text-red-800"},{label:"Reprogramada",value:"REPROGRAMADA",color:"bg-purple-100 text-purple-800"}],A=T(()=>{if(!o.value)return!1;const t=$.value.filter(a=>a.estado==="CONFIRMADA").reduce((a,r)=>{const i=r.mayores_edad||0,d=r.menores_edad||0;return a+i+d},0),e=o.value.cupo_min||0;return t>=e}),M=T(()=>!o.value||!b.value?!1:b.value.some(t=>["PENDIENTE","CONFIRMADA","EN_CURSO","REPROGRAMADA"].includes(t.estado))),U=T(()=>{if(!o.value||!b.value||b.value.length===0)return!1;const t=b.value.some(a=>a.estado==="PENDIENTE"),e=b.value.some(a=>a.estado==="CONFIRMADA");return!t&&e}),$=T(()=>{let t=b.value;if(c.value.busqueda){const a=c.value.busqueda.toLowerCase();t=t.filter(r=>{var i,d,p,C,j,B;return(((d=(i=r.cliente)==null?void 0:i.user)==null?void 0:d.name)||((p=r.cliente)==null?void 0:p.nombres)||"").toLowerCase().includes(a)||(((j=(C=r.cliente)==null?void 0:C.user)==null?void 0:j.email)||((B=r.cliente)==null?void 0:B.correo)||"").toLowerCase().includes(a)})}return c.value.fechaDesde&&(t=t.filter(a=>new Date(a.fecha_reserva)>=new Date(c.value.fechaDesde))),c.value.fechaHasta&&(t=t.filter(a=>new Date(a.fecha_reserva)<=new Date(c.value.fechaHasta))),c.value.estado&&(t=t.filter(a=>a.estado===c.value.estado)),t.sort((a,r)=>{const i={PENDIENTE:1,CONFIRMADA:2,EN_CURSO:3,REPROGRAMADA:4,COMPLETADA:5,SUSPENDIDA:6,CANCELADA:7},d=i[a.estado]||6,p=i[r.estado]||6;return d!==p?d-p:new Date(r.fecha_reserva)-new Date(a.fecha_reserva)})});T(()=>({pendientes:b.value.filter(t=>t.estado==="PENDIENTE").length,confirmadas:b.value.filter(t=>t.estado==="CONFIRMADA").length}));const Se=async t=>{ve.value=!0;try{const e=await O.get(`/api/tours/${t}`);o.value=e.data}catch(e){console.error("Error cargando tour:",e),v.add({severity:"error",summary:"Error",detail:"No se pudo cargar la informaci√≥n del tour",life:4e3})}finally{ve.value=!1}},Me=()=>{const e=new URLSearchParams(window.location.search).get("tour");return console.log("Tour ID obtenido de URL:",e),e},Q=async t=>{if(!o.value)return;if(t==="REPROGRAMADA"){k(),g.value={fechaSalida:o.value.fecha_salida?new Date(o.value.fecha_salida):null,fechaRegreso:o.value.fecha_regreso?new Date(o.value.fecha_regreso):null,motivo:""},I.value=!0;return}if(t==="CANCELADA"){Ve();return}const a={EN_CURSO:{header:"Cambio de Estado del Tour",message:"¬°Tienes un cambio de estado pendiente!",detail:'¬øDeseas marcar este tour como "En Curso"?'},FINALIZADO:{header:"Finalizar Tour",message:"¬°Tienes un cambio de estado pendiente!",detail:"¬øDeseas finalizar este tour permanentemente?"}}[t];a&&Oe.require({message:{header:a.message,content:a.detail},header:a.header,icon:"pi pi-exclamation-triangle",position:"center",rejectClass:"bg-blue-500 hover:bg-blue-700 text-white border-none px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",acceptClass:"bg-red-500 hover:bg-red-700 text-white border-none px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2 ml-3",rejectLabel:"‚úì Continuar",acceptLabel:"‚úï Cancelar",accept:()=>{},reject:async()=>{await ke(t)}})},ke=async t=>{var e,a,r;x.value.cambiarEstado=!0;try{const i=await O.put(`/api/tours/${o.value.id}/cambiar-estado`,{estado:t});o.value.estado=t,v.add({severity:"success",summary:"Estado actualizado",detail:`El tour ahora est√° ${t.toLowerCase()}`,life:3e3}),await F()}catch(i){console.error("Error actualizando estado:",i),((e=i.response)==null?void 0:e.status)===422?v.add({severity:"warn",summary:"Validaci√≥n fallida",detail:i.response.data.message||"No se pudo actualizar el estado",life:6e3}):v.add({severity:"error",summary:"Error",detail:((r=(a=i.response)==null?void 0:a.data)==null?void 0:r.message)||"No se pudo actualizar el estado",life:4e3})}finally{x.value.cambiarEstado=!1}},Fe=async t=>{o.value=t,Z.value=!1;const e={CANCELADA:{severity:"warn",summary:"Tour cancelado",detail:`El tour ha sido cancelado. Se enviaron notificaciones de cancelaci√≥n a ${t.reservas_canceladas||0} cliente(s) con reservas.`},FINALIZADO:{severity:"success",summary:"Tour finalizado",detail:`El tour ha sido finalizado correctamente. Se enviaron notificaciones a ${t.reservas_finalizadas||0} cliente(s).`},default:{severity:"success",summary:"Estado actualizado",detail:"El estado del tour se ha actualizado correctamente"}},a=e[t.estado]||e.default;v.add({severity:a.severity,summary:a.summary,detail:a.detail,life:5e3}),await F()},ne=()=>{document.body.style.overflow="",document.body.style.paddingRight=""},k=()=>{S.value=!1,W.value=!1,z.value=!1,X.value=!1,Z.value=!1,I.value=!1,J.value=null,te.value=null,Ie.value="",R.value="",N.value=!1,ne()},Pe=async()=>{var t,e;if(!g.value.fechaSalida||!g.value.fechaRegreso){v.add({severity:"warn",summary:"Campos requeridos",detail:"Debe seleccionar las nuevas fechas de salida y regreso",life:4e3});return}if(!g.value.motivo.trim()){v.add({severity:"warn",summary:"Motivo requerido",detail:"Debe ingresar un motivo para la reprogramaci√≥n",life:4e3});return}if(g.value.fechaRegreso<=g.value.fechaSalida){v.add({severity:"warn",summary:"Fechas inv√°lidas",detail:"La fecha de regreso debe ser posterior a la fecha de salida",life:4e3});return}x.value.cambiarEstado=!0;try{const a=d=>d instanceof Date?d.toISOString().slice(0,19).replace("T"," "):d,r=await O.put(`/api/tours/${o.value.id}/cambiar-estado`,{estado:"REPROGRAMADA",fecha_salida:a(g.value.fechaSalida),fecha_regreso:a(g.value.fechaRegreso),motivo_reprogramacion:g.value.motivo,reprogramar_reservas:!0});o.value={...o.value,...r.data},k();const i=r.data.reservas_reprogramadas||0;v.add({severity:"success",summary:"Tour y reservas reprogramados",detail:`El tour ha sido reprogramado correctamente. ${i} reserva(s) fueron reprogramada(s) y se enviaron notificaciones por correo.`,life:5e3}),await F()}catch(a){console.error("Error reprogramando tour:",a),v.add({severity:"error",summary:"Error",detail:((e=(t=a.response)==null?void 0:t.data)==null?void 0:e.message)||"No se pudo reprogramar el tour",life:4e3})}finally{x.value.cambiarEstado=!1}},ze=()=>{G.value=!0,Ce.visit("/tours")},q=T(()=>pe.value<640?{width:"95vw",maxWidth:"380px"}:pe.value<768?{width:"400px"}:{width:"450px"}),F=async()=>{if(L.value){me.value=!0;try{const t={busqueda:c.value.busqueda||void 0,fecha_inicio:c.value.fechaDesde||void 0,fecha_fin:c.value.fechaHasta||void 0,tour_id:L.value},e=await O.get("/api/reservas",{params:t,withCredentials:!0});b.value=Array.isArray(e.data)?e.data:e.data.data||[]}catch(t){console.error("Error cargando reservas:",t),v.add({severity:"error",summary:"Error",detail:"No se pudieron cargar las reservas del tour",life:4e3}),b.value=[]}finally{me.value=!1}}},Ve=()=>{k(),R.value="",z.value=!0},Ue=async()=>{var t,e;if(!R.value.trim()){v.add({severity:"warn",summary:"Campo requerido",detail:"Debe ingresar un motivo para cancelar el tour",life:4e3});return}N.value=!0;try{const a=await O.put(`/api/tours/${o.value.id}/cambiar-estado`,{estado:"CANCELADA",motivo_cancelacion:R.value,cancelar_reservas:!0});o.value.estado="CANCELADA",await F(),k();const r=a.data.reservas_canceladas||0;v.add({severity:"warn",summary:"¬°Tour Cancelado!",detail:`El tour ha sido cancelado. Se cancelaron ${r} reserva(s) y se enviaron notificaciones por correo.`,life:5e3})}catch(a){console.error("Error cancelando tour:",a),v.add({severity:"error",summary:"Error",detail:((e=(t=a.response)==null?void 0:t.data)==null?void 0:e.message)||"No se pudo cancelar el tour",life:4e3})}finally{N.value=!1}},ge=t=>{k(),J.value=t,X.value=!0},$e=t=>{k(),J.value=t;const e=Le.value.find(a=>{var r;return((r=t.detallesTours)==null?void 0:r.some(i=>i.tour_id===a.id))||t.entidad_nombre===a.nombre});te.value=e,S.value=!0},qe=t=>{t.originalEvent.target.closest("button")||ge(t.data)},je=t=>{const e=K.find(a=>a.value===t);return(e==null?void 0:e.color)||"bg-gray-100 text-gray-800"},Be=t=>{const e=fe.find(a=>a.value===t);return(e==null?void 0:e.label)||t},He=t=>{if(!t)return"N/A";const e=new Date(t);return e.getHours()===0&&e.getMinutes()===0?e.toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"}):e.toLocaleString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})},be=t=>{if(!t)return"N/A";const e=new Date(t);return e.getHours()===0&&e.getMinutes()===0?e.toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"})+" (Sin hora especificada)":e.toLocaleString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})},Ge=async()=>{V.value=!0;try{c.value={busqueda:"",fechaDesde:null,fechaHasta:null,estado:null},v.add({severity:"success",summary:"Filtros limpiados",life:1500})}finally{V.value=!1}},Ze=T(()=>{if(g.value.fechaSalida instanceof Date){const t=new Date(g.value.fechaSalida);return t.setDate(t.getDate()+1),t}return new Date}),We=async t=>{var e,a,r,i,d;oe.value=!0;try{await O.put(`/api/reservas/${t.id}/confirmar`);const p=b.value.findIndex(C=>C.id===t.id);p!==-1&&(b.value[p].estado="CONFIRMADA"),S.value=!1,v.add({severity:"success",summary:"¬°Confirmada!",detail:`Reserva de ${((a=(e=t.cliente)==null?void 0:e.user)==null?void 0:a.name)||((r=t.cliente)==null?void 0:r.nombres)} confirmada correctamente`,life:4e3})}catch(p){console.error("Error confirmando reserva:",p),v.add({severity:"error",summary:"Error",detail:((d=(i=p.response)==null?void 0:i.data)==null?void 0:d.message)||"No se pudo confirmar la reserva",life:4e3})}finally{oe.value=!1}},Xe=async t=>{var e,a,r,i,d;re.value=!0,le.value=!0;try{await O.put(`/api/reservas/${t.reserva.id}/rechazar`,{motivo:t.motivo});const p=b.value.findIndex(C=>C.id===t.reserva.id);p!==-1&&(b.value[p].estado="CANCELADA"),W.value=!1,S.value=!1,v.add({severity:"success",summary:"¬°Cancelada!",detail:`Reserva de ${((a=(e=t.reserva.cliente)==null?void 0:e.user)==null?void 0:a.name)||((r=t.reserva.cliente)==null?void 0:r.nombres)} cancelada correctamente`,life:4e3})}catch(p){console.error("Error rechazando reserva:",p),v.add({severity:"error",summary:"Error",detail:((d=(i=p.response)==null?void 0:i.data)==null?void 0:d.message)||"No se pudo rechazar la reserva",life:4e3})}finally{le.value=!1,re.value=!1}},Je=t=>{ge(t)};ie(()=>[c.value.busqueda,c.value.fechaDesde,c.value.fechaHasta,c.value.estado],()=>{clearTimeout(window.searchTimeout),window.searchTimeout=setTimeout(()=>{F()},500)},{deep:!0}),ie(I,t=>{t?(document.body.style.overflow="hidden",document.body.style.paddingRight="15px"):(document.body.style.overflow="",document.body.style.paddingRight="")});const xe=()=>{ea(()=>{setTimeout(()=>{document.querySelectorAll(".p-select").forEach(e=>{const a=e.querySelector(".p-select-label, .p-placeholder");a&&(a.style.overflow="hidden",a.style.textOverflow="ellipsis",a.style.whiteSpace="nowrap",a.style.maxWidth="calc(100% - 2.5rem)",a.style.display="block")})},100)})};return ie([c],()=>{xe()},{deep:!0}),Ke(async()=>{try{if(console.log("Montando componente Reservas.vue"),console.log("URL actual:",window.location.href),L.value=Me(),console.log("Tour ID establecido:",L.value),!L.value){console.warn("No se encontr√≥ tour ID en la URL"),v.add({severity:"warn",summary:"Tour no especificado",detail:"Redirigiendo a la lista de tours...",life:3e3}),setTimeout(()=>{Ce.visit("/tours")},2e3);return}console.log("Cargando tour y reservas..."),await Promise.all([Se(L.value),F()]),console.log("Tour y reservas cargados exitosamente"),xe()}catch(t){console.error("Error cargando datos iniciales:",t)}}),Qe(()=>{ne()}),(t,e)=>(h(),de(aa,null,{default:y(()=>[n(l(Ye),{title:"Gesti√≥n de Reservas"}),n(l(la),{class:"z-[9999]"}),n(l(oa),{class:"z-[9999]",style:ue(q.value),draggable:!1,closable:!1},{message:y(a=>[s("div",ga,[n(l(f),{icon:l(ee),class:"h-8 w-8 text-red-500"},null,8,["icon"]),s("div",ba,[s("span",null,m(a.message.header),1),s("span",xa,m(a.message.content),1)])])]),_:1},8,["style"]),s("div",ya,[s("div",ha,[s("button",{onClick:ze,disabled:G.value,class:"flex items-center text-blue-600 hover:text-blue-700 transition-colors duration-200 px-3 py-2 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed",title:"Regresar a Tours"},[n(l(f),{icon:G.value?l(_):l(da),class:E(["h-5 w-5 mr-2",{"animate-spin":G.value}])},null,8,["icon","class"]),e[20]||(e[20]=s("span",{class:"font-medium"},"Volver a Tours",-1))],8,wa)]),s("div",Ea,[o.value?(h(),D("div",Aa,[e[29]||(e[29]=s("h3",{class:"text-lg font-semibold text-blue-600 mb-2"},"Cambiar Estado del Tour",-1)),s("div",Ca,[s("p",Da,[n(l(f),{icon:l(ae),class:"h-4 w-4 text-blue-500"},null,8,["icon"]),e[21]||(e[21]=H(" Haz clic en cualquier tarjeta para cambiar el estado del tour "))]),!A.value&&o.value.estado==="DISPONIBLE"&&M.value?(h(),D("p",Ra,[n(l(f),{icon:l(ee),class:"h-4 w-4 text-amber-500"},null,8,["icon"]),s("span",null," Cupo m√≠nimo no cumplido ("+m(o.value.cupo_min)+" personas requeridas). Actualmente hay "+m($.value.filter(a=>a.estado==="CONFIRMADA").reduce((a,r)=>a+(r.mayores_edad||0)+(r.menores_edad||0),0))+" personas confirmadas. Solo se puede cancelar el tour. ",1)])):w("",!0),o.value.estado==="COMPLETO"&&!U.value?(h(),D("p",_a,[n(l(f),{icon:l(ae),class:"h-4 w-4 text-blue-500"},null,8,["icon"]),e[22]||(e[22]=s("span",{class:"font-medium"}," Tour completo - Debe confirmar TODAS las reservas pendientes para poder poner el tour en curso ",-1))])):w("",!0),!M.value&&(o.value.estado==="DISPONIBLE"||o.value.estado==="REPROGRAMADA")?(h(),D("p",Na,[n(l(f),{icon:l(ae),class:"h-4 w-4 text-gray-500"},null,8,["icon"]),e[23]||(e[23]=s("span",null," Este tour no tiene reservas activas. ",-1))])):w("",!0)]),s("div",Ta,[s("div",Oa,[e[24]||(e[24]=s("p",{class:"text-xs md:text-sm text-gray-600 mb-1"},"Estado Actual",-1)),s("p",La,m(Be(o.value.estado)),1)]),o.value.estado!=="EN_CURSO"&&o.value.estado!=="FINALIZADO"&&o.value.estado!=="CANCELADA"?(h(),D("div",{key:0,class:E(["rounded-lg px-2 py-2 md:px-4 md:py-3 flex-1 min-w-0 transition-all duration-200",o.value.estado==="DISPONIBLE"&&A.value||o.value.estado==="REPROGRAMADA"&&A.value||o.value.estado==="COMPLETO"&&U.value&&A.value?"bg-gradient-to-r from-blue-500 to-blue-600 cursor-pointer hover:shadow-lg hover:scale-105":"bg-gray-400 cursor-not-allowed opacity-60"]),onClick:e[0]||(e[0]=a=>o.value.estado==="DISPONIBLE"&&A.value||o.value.estado==="REPROGRAMADA"&&A.value||o.value.estado==="COMPLETO"&&U.value&&A.value?Q("EN_CURSO"):null)},[s("div",Ia,[e[25]||(e[25]=s("div",{class:"flex-1"},[s("p",{class:"text-xs md:text-sm opacity-90"},"En Curso")],-1)),n(l(f),{icon:x.value.cambiarEstado?l(_):l(se),class:E([{"animate-spin":x.value.cambiarEstado},"text-xs md:text-sm opacity-75"])},null,8,["icon","class"])])],2)):w("",!0),o.value.estado!=="FINALIZADO"&&o.value.estado!=="CANCELADA"&&o.value.estado==="EN_CURSO"?(h(),D("div",{key:1,class:"bg-gradient-to-r from-gray-500 to-gray-600 cursor-pointer hover:shadow-lg transition-all duration-200 hover:scale-105 rounded-lg px-2 py-2 md:px-4 md:py-3 flex-1 min-w-0",onClick:e[1]||(e[1]=a=>Q("FINALIZADO"))},[s("div",Sa,[e[26]||(e[26]=s("div",{class:"flex-1"},[s("p",{class:"text-xs md:text-sm opacity-90"},"Finalizar")],-1)),n(l(f),{icon:x.value.cambiarEstado?l(_):l(Ne),class:E([{"animate-spin":x.value.cambiarEstado},"text-xs md:text-sm opacity-75"])},null,8,["icon","class"])])])):w("",!0),o.value.estado!=="REPROGRAMADA"&&o.value.estado!=="FINALIZADO"&&o.value.estado!=="CANCELADA"&&o.value.estado!=="EN_CURSO"?(h(),D("div",{key:2,class:E(["rounded-lg px-2 py-2 md:px-4 md:py-3 flex-1 min-w-0 transition-all duration-200",o.value.estado==="DISPONIBLE"&&A.value||o.value.estado==="COMPLETO"&&U.value?"bg-gradient-to-r from-purple-500 to-purple-600 cursor-pointer hover:shadow-lg hover:scale-105":"bg-gray-400 cursor-not-allowed opacity-60"]),onClick:e[2]||(e[2]=a=>o.value.estado==="DISPONIBLE"&&A.value||o.value.estado==="COMPLETO"&&U.value?Q("REPROGRAMADA"):null)},[s("div",Ma,[e[27]||(e[27]=s("div",{class:"flex-1"},[s("p",{class:"text-xs md:text-sm opacity-90"},"Reprogramar")],-1)),n(l(f),{icon:x.value.cambiarEstado?l(_):l(se),class:E([{"animate-spin":x.value.cambiarEstado},"text-xs md:text-sm opacity-75"])},null,8,["icon","class"])])],2)):w("",!0),o.value.estado!=="CANCELADA"&&o.value.estado!=="FINALIZADO"&&o.value.estado!=="EN_CURSO"?(h(),D("div",{key:3,class:E(["rounded-lg px-2 py-2 md:px-4 md:py-3 flex-1 min-w-0 transition-all duration-200",M.value||o.value.estado==="COMPLETO"?"bg-gradient-to-r from-red-500 to-red-600 cursor-pointer hover:shadow-lg hover:scale-105":"bg-gray-400 cursor-not-allowed opacity-60"]),onClick:e[3]||(e[3]=a=>M.value||o.value.estado==="COMPLETO"?Q("CANCELADA"):null),title:!M.value&&o.value.estado!=="COMPLETO"?"No se puede cancelar un tour sin reservas activas":"Cancelar tour y todas sus reservas"},[s("div",Fa,[s("div",Pa,[e[28]||(e[28]=s("p",{class:"text-xs md:text-sm opacity-90"},"Cancelar",-1)),M.value?w("",!0):(h(),D("p",za,"Sin reservas"))]),n(l(f),{icon:x.value.cambiarEstado?l(_):l(ce),class:E([{"animate-spin":x.value.cambiarEstado},"text-xs md:text-sm opacity-75"])},null,8,["icon","class"])])],10,ka)):w("",!0)])])):w("",!0),s("div",Va,[s("div",Ua,[s("div",$a,[e[30]||(e[30]=s("h3",{class:"text-base font-medium text-gray-800 flex items-center gap-2"},[s("i",{class:"pi pi-filter text-blue-600 text-sm"}),s("span",null,"Filtros")],-1)),s("div",qa,m($.value.length)+" resultado"+m($.value.length!==1?"s":""),1)]),s("button",{onClick:Ge,disabled:V.value,class:"bg-red-500 hover:bg-red-600 border border-red-500 px-2 py-1 text-xs text-white shadow-md rounded-md disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-1 shrink-0"},[V.value?(h(),de(l(f),{key:0,icon:l(_),class:"animate-spin h-3 w-3"},null,8,["icon"])):w("",!0),s("span",null,m(V.value?"Limpiando...":"Limpiar"),1)],8,ja)]),s("div",Ba,[s("div",null,[n(l(ra),{modelValue:c.value.busqueda,"onUpdate:modelValue":e[4]||(e[4]=a=>c.value.busqueda=a),placeholder:"üîç Buscar por cliente...",class:"w-full h-9 text-sm rounded-md",style:{"background-color":"white","border-color":"#93c5fd"}},null,8,["modelValue"])]),s("div",Ha,[n(l(Y),{modelValue:c.value.fechaDesde,"onUpdate:modelValue":e[5]||(e[5]=a=>c.value.fechaDesde=a),placeholder:"Fecha desde",dateFormat:"dd/mm/yy",class:"w-full h-9 text-sm",style:{"background-color":"white","border-color":"#93c5fd"},showIcon:""},null,8,["modelValue"]),n(l(Y),{modelValue:c.value.fechaHasta,"onUpdate:modelValue":e[6]||(e[6]=a=>c.value.fechaHasta=a),placeholder:"Fecha hasta",dateFormat:"dd/mm/yy",class:"w-full h-9 text-sm",style:{"background-color":"white","border-color":"#93c5fd"},showIcon:""},null,8,["modelValue"]),n(l(na),{modelValue:c.value.estado,"onUpdate:modelValue":e[7]||(e[7]=a=>c.value.estado=a),options:[{label:"Todos los estados",value:null},{label:"Pendientes",value:"PENDIENTE"},{label:"Confirmadas",value:"CONFIRMADA"}],optionLabel:"label",optionValue:"value",placeholder:"Filtrar por estado",class:"w-full h-9 text-sm",style:{"background-color":"white","border-color":"#93c5fd"}},null,8,["modelValue"])])])]),s("div",Ga,[s("p",Za,[n(l(f),{icon:l(ua),class:"h-3 w-3 text-yellow-500"},null,8,["icon"]),e[31]||(e[31]=H(" Haz clic en cualquier fila para ver los detalles. "))])]),n(l(ia),{value:$.value,paginator:"",rows:10,rowsPerPageOptions:[5,10,20,50],paginatorTemplate:"RowsPerPageDropdown FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink",currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} reservas",responsiveLayout:"scroll",class:"mt-2 sm:mt-4 overflow-x-auto",onRowClick:qe,pt:{root:{class:"text-xs sm:text-sm"},wrapper:{class:"text-xs sm:text-sm overflow-x-auto"},table:{class:"text-xs sm:text-sm min-w-full"},thead:{class:"text-xs sm:text-sm"},headerRow:{class:"text-xs sm:text-sm"},headerCell:{class:"text-xs sm:text-sm font-medium py-2 sm:py-3 px-1 sm:px-2"},tbody:{class:"text-xs sm:text-sm"},bodyRow:{class:"text-xs sm:text-sm cursor-pointer hover:bg-blue-50 transition-colors duration-200"},bodyCell:{class:"py-2 sm:py-3 px-1 sm:px-2 text-xs sm:text-sm"}}},{empty:y(()=>[s("div",Wa,[n(l(f),{icon:l(ae),class:"text-4xl text-gray-400 mb-4"},null,8,["icon"]),e[32]||(e[32]=s("p",{class:"text-gray-500 text-lg"},"No se encontraron reservas",-1)),e[33]||(e[33]=s("p",{class:"text-gray-400 text-sm mt-2"}," Ajusta los filtros para encontrar las reservas que buscas ",-1))])]),loading:y(()=>e[34]||(e[34]=[s("div",{class:"text-center py-12"},[s("i",{class:"pi pi-spin pi-spinner text-3xl text-blue-500 mb-4"}),s("p",{class:"text-gray-500 text-lg"},"Cargando reservas...")],-1)])),default:y(()=>[n(l(P),{field:"fecha_reserva",header:"Fecha",class:"w-28 min-w-16"},{body:y(a=>[s("span",Xa,m(He(a.data.fecha_reserva)),1)]),_:1}),n(l(P),{field:"cliente.nombres",header:"Cliente",class:"w-16 hidden sm:table-cell"},{body:y(a=>{var r,i,d,p,C,j,B,ye,he,we,Ee,Ae;return[s("div",Ja,[s("div",Ka,[n(l(f),{icon:l(Te),class:"text-blue-600 text-xs sm:text-sm"},null,8,["icon"])]),s("div",Qa,[s("div",{class:"font-medium text-gray-900 text-xs sm:text-sm truncate",title:((i=(r=a.data.cliente)==null?void 0:r.user)==null?void 0:i.name)||((d=a.data.cliente)==null?void 0:d.nombres)||"N/A"},m(((C=(p=a.data.cliente)==null?void 0:p.user)==null?void 0:C.name)||((j=a.data.cliente)==null?void 0:j.nombres)||"N/A"),9,Ya),s("div",{class:"text-xs text-gray-500 truncate hidden sm:block",title:((ye=(B=a.data.cliente)==null?void 0:B.user)==null?void 0:ye.email)||((he=a.data.cliente)==null?void 0:he.correo)||"N/A"},m(((Ee=(we=a.data.cliente)==null?void 0:we.user)==null?void 0:Ee.email)||((Ae=a.data.cliente)==null?void 0:Ae.correo)||"N/A"),9,es)])])]}),_:1}),n(l(P),{header:"Personas",class:"w-20 sm:w-24 lg:w-28 min-w-16 hidden md:table-cell"},{body:y(a=>[s("div",null,[s("div",as,[n(l(f),{icon:l(Te),class:"text-gray-400 text-xs mr-1"},null,8,["icon"]),s("span",ss,m((a.data.mayores_edad||0)+(a.data.menores_edad||0)),1)]),s("div",ts,m(a.data.mayores_edad||0)+"A ‚Ä¢ "+m(a.data.menores_edad||0)+"N ",1)])]),_:1}),n(l(P),{field:"total",header:"Total",class:"w-12 min-w-12"},{body:y(a=>[s("span",ls," $"+m(Number(a.data.total||0).toFixed(2)),1)]),_:1}),n(l(P),{field:"estado",header:"Estado",class:"w-24 sm:w-28 lg:w-36 min-w-20 hidden lg:table-cell"},{body:y(a=>{var r,i;return[s("span",{class:E([je(a.data.estado),"px-2 py-1 rounded-full text-xs font-medium"])},[s("span",os,m(((r=K.find(d=>d.value===a.data.estado))==null?void 0:r.label)||a.data.estado),1),s("span",rs,m((((i=K.find(d=>d.value===a.data.estado))==null?void 0:i.label)||a.data.estado).substring(0,4)),1)],2)]}),_:1}),n(l(P),{header:"Acciones",class:"w-24 sm:w-28 lg:w-32 min-w-20"},{body:y(a=>[s("button",{class:"bg-green-500 hover:bg-green-600 text-white px-2 py-2 rounded-md transition-all duration-200 ease-in-out inline-flex items-center gap-1 text-xs shadow-md hover:shadow-lg hover:-translate-y-1",onClick:r=>$e(a.data),title:"M√°s acciones"},[n(l(f),{icon:l(va),class:"h-3 w-4 sm:h-4 sm:w-5"},null,8,["icon"]),e[35]||(e[35]=s("span",{class:"hidden md:inline"},"M√°s",-1))],8,ns)]),_:1})]),_:1},8,["value"]),n(pa,{visible:S.value,"onUpdate:visible":e[8]||(e[8]=a=>S.value=a),"detalles-visible":X.value,"onUpdate:detallesVisible":e[9]||(e[9]=a=>X.value=a),"rechazar-visible":W.value,"onUpdate:rechazarVisible":e[10]||(e[10]=a=>W.value=a),reserva:J.value,tour:te.value,"dialog-style":q.value,procesando:le.value,"confirmando-reserva":oe.value,"rechazando-reserva":re.value,"estados-reservas":K,"estados-tours":fe,onConfirmar:We,onRechazar:Xe,onVerDetalles:Je},null,8,["visible","detalles-visible","rechazar-visible","reserva","tour","dialog-style","procesando","confirmando-reserva","rechazando-reserva"]),n(fa,{visible:Z.value,"onUpdate:visible":e[11]||(e[11]=a=>Z.value=a),tour:o.value,"dialog-style":q.value,onEstadoActualizado:Fe},null,8,["visible","tour","dialog-style"]),n(l(_e),{visible:z.value,"onUpdate:visible":e[14]||(e[14]=a=>z.value=a),modal:"",header:"Cancelar Tour Completo",style:ue(q.value),closable:!1,draggable:!1},{default:y(()=>{var a;return[s("div",is,[s("div",ds,[s("div",us,[n(l(f),{icon:l(ee),class:"text-orange-600 text-lg mt-1 flex-shrink-0"},null,8,["icon"]),e[36]||(e[36]=s("div",null,[s("h4",{class:"font-bold text-orange-800 mb-2"},"¬°ADVERTENCIA - ELIMINACI√ìN MASIVA PERMANENTE!"),s("div",{class:"text-sm text-orange-700 space-y-2"},[s("p",null,[s("strong",null,"‚Ä¢ Esta acci√≥n NO se puede deshacer bajo ninguna circunstancia")]),s("p",null,"‚Ä¢ Se eliminar√°n TODAS las reservas del tour de forma PERMANENTE"),s("p",null,"‚Ä¢ Se eliminar√°n TODOS los detalles asociados a cada reserva"),s("p",null,"‚Ä¢ Los cupos del tour ser√°n liberados autom√°ticamente"),s("p",null,"‚Ä¢ Se enviar√°n emails de cancelaci√≥n a TODOS los clientes"),s("p",null,"‚Ä¢ No ser√° posible recuperar ninguna informaci√≥n posteriormente"),s("div",{class:"mt-3 p-2 bg-orange-100 rounded border border-orange-300"},[s("p",{class:"font-semibold text-orange-900 text-xs"}," Aseg√∫rese de que realmente desea eliminar toda la informaci√≥n antes de continuar ")])])],-1))])]),s("div",cs,[s("div",ms,[n(l(f),{icon:l(ee),class:"text-red-600"},null,8,["icon"]),s("h4",vs,"Cancelar Tour: "+m((a=o.value)==null?void 0:a.nombre),1)]),e[37]||(e[37]=s("p",{class:"text-sm text-red-700"}," Esta acci√≥n cancelar√° el tour completo y TODAS las reservas asociadas. Se enviar√°n notificaciones por correo a todos los clientes. ",-1)),s("p",ps,[s("strong",null,"Reservas que ser√°n ELIMINADAS PERMANENTEMENTE: "+m(b.value.length),1)])]),s("div",null,[e[38]||(e[38]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[H(" Motivo de la Cancelaci√≥n del Tour "),s("span",{class:"text-red-500"},"*")],-1)),De(s("textarea",{"onUpdate:modelValue":e[12]||(e[12]=r=>R.value=r),placeholder:"Explique por qu√© se cancela el tour completo...",class:"w-full p-3 border border-gray-300 rounded-md focus:ring-red-500 focus:border-red-500",rows:"4",maxlength:"500"},null,512),[[Re,R.value]]),s("small",fs,m(R.value.length)+"/500 caracteres",1)]),s("div",gs,[s("button",{onClick:e[13]||(e[13]=r=>z.value=!1),class:"px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50"}," Cancelar "),s("button",{onClick:Ue,disabled:!R.value.trim()||N.value,class:"px-4 py-2 bg-red-700 text-white rounded-md hover:bg-red-800 disabled:bg-red-300 flex items-center gap-2"},[n(l(f),{icon:N.value?l(_):l(ce),class:E({"animate-spin":N.value})},null,8,["icon","class"]),H(" "+m(N.value?"Eliminando Todo...":"Eliminar Tour y Reservas Definitivamente"),1)],8,bs)])])]}),_:1},8,["visible","style"]),n(l(_e),{visible:I.value,"onUpdate:visible":e[19]||(e[19]=a=>I.value=a),modal:"",header:"Reprogramar Tour",style:ue(q.value),closable:!1,draggable:!1},{default:y(()=>{var a,r,i;return[s("div",xs,[s("div",ys,[s("h4",hs,m((a=o.value)==null?void 0:a.nombre),1),s("p",ws," Fechas actuales: "+m(be((r=o.value)==null?void 0:r.fecha_salida))+" - "+m(be((i=o.value)==null?void 0:i.fecha_regreso)),1)]),s("div",Es,[s("div",null,[e[39]||(e[39]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Salida:",-1)),n(l(Y),{modelValue:g.value.fechaSalida,"onUpdate:modelValue":e[15]||(e[15]=d=>g.value.fechaSalida=d),showTime:"",hourFormat:"12",dateFormat:"dd/mm/yy",showIcon:"",placeholder:"Seleccionar fecha y hora",class:"w-full",minDate:new Date},null,8,["modelValue","minDate"])]),s("div",null,[e[40]||(e[40]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Regreso:",-1)),n(l(Y),{modelValue:g.value.fechaRegreso,"onUpdate:modelValue":e[16]||(e[16]=d=>g.value.fechaRegreso=d),showTime:"",hourFormat:"12",dateFormat:"dd/mm/yy",showIcon:"",placeholder:"Seleccionar fecha y hora",class:"w-full",minDate:Ze.value},null,8,["modelValue","minDate"])])]),s("div",null,[e[41]||(e[41]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Motivo de la Reprogramaci√≥n",-1)),De(s("textarea",{"onUpdate:modelValue":e[17]||(e[17]=d=>g.value.motivo=d),placeholder:"Ingrese el motivo de la reprogramaci√≥n...",class:"w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",rows:"3"},null,512),[[Re,g.value.motivo]]),e[42]||(e[42]=s("p",{class:"text-xs text-gray-500 mt-2"}," üí° Al reprogramar el tour, todas las reservas asociadas ser√°n reprogramadas autom√°ticamente y se enviar√°n correos de notificaci√≥n a los clientes. ",-1))]),s("div",As,[s("button",{onClick:Pe,disabled:x.value.cambiarEstado,class:"px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"},[x.value.cambiarEstado?(h(),de(l(f),{key:0,icon:l(_),class:"animate-spin"},null,8,["icon"])):w("",!0),H(" "+m(x.value.cambiarEstado?"Reprogramando...":"Reprogramar Tour"),1)],8,Cs),s("button",{onClick:e[18]||(e[18]=d=>{I.value=!1,ne()}),class:"border rounded-md bg-blue-500 hover:bg-blue-700 text-white px-6 py-2",disabled:x.value.cambiarEstado}," Cancelar ",8,Ds)])])]}),_:1},8,["visible","style"])])])]),_:1}))}};export{ks as default};
