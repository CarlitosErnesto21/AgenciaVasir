import{A as ee,c as b,o as te,q as U,h as q,b as v,e as M,f as u,z as V,g as se,a as le}from"./ui-DPmvhuIJ.js";import{A as ae}from"./AuthenticatedLayout-C17532f3.js";import{r as g,E as R,o as oe,s as ne,h as C,d as y,x as i,e as t,p as o,$ as l,t as d,v as w,j as k,c as ie,q as x,N as F}from"./vendor-CLNWHdEK.js";import{_ as re}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-D3qnJ-6K.js";const de={class:"flex items-center justify-between"},ce={class:"flex gap-2"},ue={class:"py-6"},pe={class:"max-w-full mx-auto sm:px-6 lg:px-8"},me={class:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6"},ve={class:"flex items-center justify-between"},fe={class:"text-2xl font-bold"},be={class:"flex items-center justify-between"},xe={class:"text-2xl font-bold"},ge={class:"flex items-center justify-between"},ye={class:"text-2xl font-bold"},we={class:"flex items-center justify-between"},he={class:"text-2xl font-bold"},_e={class:"grid grid-cols-1 md:grid-cols-5 gap-4"},Ve={class:"flex items-end"},Ce={class:"flex justify-between items-center"},ke={class:"text-lg font-semibold text-gray-800"},De={class:"p-input-icon-left"},$e={class:"text-gray-700"},Ee={class:"flex items-center gap-2"},Fe={class:"font-medium"},Se={class:"flex items-center gap-2"},Le={class:"flex items-center gap-2"},Ie={class:"font-bold text-green-600"},Ne={class:"flex gap-1"},Pe={key:0,class:"space-y-6"},He={class:"flex items-center justify-between"},je={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ae={class:"space-y-3"},Be={class:"flex items-center gap-2"},Te={class:"flex items-center gap-2"},Ue={class:"flex items-center gap-2"},qe={class:"space-y-3"},Me={class:"flex items-center gap-2"},Re={class:"flex items-center gap-2"},Ge={class:"flex items-center gap-2"},Oe={class:"text-green-600 font-bold text-lg"},ze={class:"flex items-center gap-2"},Je={class:"font-medium"},Ke={class:"font-medium"},Qe={class:"font-bold text-green-600"},We={__name:"Ventas",setup(Xe){const m=ee(),S=g([]),L=g(!1),I=g(!1),p=g(null),h=g(""),c=g({estado:null,fechaDesde:null,fechaHasta:null,cliente:""}),G=[{name:"Todos",value:null},{name:"Pendiente",value:"pendiente"},{name:"Completada",value:"completada"},{name:"Cancelada",value:"cancelada"}],N=R(()=>{let a=S.value;if(c.value.estado&&(a=a.filter(e=>e.estado===c.value.estado)),c.value.fechaDesde){const e=new Date(c.value.fechaDesde);a=a.filter(r=>new Date(r.fecha)>=e)}if(c.value.fechaHasta){const e=new Date(c.value.fechaHasta);a=a.filter(r=>new Date(r.fecha)<=e)}if(c.value.cliente){const e=c.value.cliente.toLowerCase();a=a.filter(r=>{var s,n;return(n=(s=r.cliente)==null?void 0:s.nombre)==null?void 0:n.toLowerCase().includes(e)})}if(h.value){const e=h.value.toLowerCase();a=a.filter(r=>{var s,n,f,A,B,T;return((n=(s=r.cliente)==null?void 0:s.nombre)==null?void 0:n.toLowerCase().includes(e))||((A=(f=r.empleado)==null?void 0:f.nombre)==null?void 0:A.toLowerCase().includes(e))||((T=(B=r.metodo_pago)==null?void 0:B.nombre)==null?void 0:T.toLowerCase().includes(e))||r.id.toString().includes(e)})}return a}),D=R(()=>{const a={completadas:0,pendientes:0,canceladas:0,totalVendido:0};return S.value.forEach(e=>{switch(e.estado){case"completada":a.completadas++,a.totalVendido+=parseFloat(e.total||0);break;case"pendiente":a.pendientes++;break;case"cancelada":a.canceladas++;break}}),a}),$=async()=>{try{L.value=!0;const a=await F.get("/api/ventas");S.value=a.data}catch(a){console.error("Error cargando ventas:",a),m.add({severity:"error",summary:"Error",detail:"No se pudieron cargar las ventas",life:3e3})}finally{L.value=!1}},O=a=>{p.value=a,I.value=!0},z=async a=>{var e,r;try{await F.post(`/api/ventas/${a.id}/procesar`),m.add({severity:"success",summary:"Éxito",detail:"Venta procesada correctamente",life:3e3}),await $()}catch(s){m.add({severity:"error",summary:"Error",detail:((r=(e=s.response)==null?void 0:e.data)==null?void 0:r.message)||"Error al procesar la venta",life:3e3})}},J=async a=>{var e,r;try{await F.post(`/api/ventas/${a.id}/cancelar`),m.add({severity:"success",summary:"Éxito",detail:"Venta cancelada correctamente",life:3e3}),await $()}catch(s){m.add({severity:"error",summary:"Error",detail:((r=(e=s.response)==null?void 0:e.data)==null?void 0:r.message)||"Error al cancelar la venta",life:3e3})}},K=async a=>{var e,r;if(confirm("¿Está seguro de eliminar esta venta?"))try{await F.delete(`/api/ventas/${a.id}`),m.add({severity:"success",summary:"Éxito",detail:"Venta eliminada correctamente",life:3e3}),await $()}catch(s){m.add({severity:"error",summary:"Error",detail:((r=(e=s.response)==null?void 0:e.data)==null?void 0:r.message)||"Error al eliminar la venta",life:3e3})}},E=()=>{},Q=()=>{c.value={estado:null,fechaDesde:null,fechaHasta:null,cliente:""},h.value=""},W=()=>{m.add({severity:"info",summary:"Información",detail:"Función de crear venta pendiente de implementar",life:3e3})},X=a=>{m.add({severity:"info",summary:"Información",detail:"Función de editar venta pendiente de implementar",life:3e3})},Y=()=>{m.add({severity:"info",summary:"Información",detail:"Función de exportar pendiente de implementar",life:3e3})},Z=a=>{m.add({severity:"info",summary:"Información",detail:"Función de imprimir pendiente de implementar",life:3e3})},P=a=>a?new Date(a).toLocaleDateString("es-ES",{year:"numeric",month:"2-digit",day:"2-digit"}):"N/A",_=a=>a?parseFloat(a).toLocaleString("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00",H=a=>{switch(a){case"completada":return"success";case"pendiente":return"warning";case"cancelada":return"danger";default:return"info"}},j=a=>{switch(a){case"completada":return"pi pi-check";case"pendiente":return"pi pi-clock";case"cancelada":return"pi pi-times";default:return"pi pi-question"}};return oe(()=>{$()}),(a,e)=>{const r=ne("tooltip");return y(),C(ae,null,{header:i(()=>[t("div",de,[e[6]||(e[6]=t("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"},[t("i",{class:"pi pi-shopping-cart mr-2 text-blue-600"}),x(" Gestión de Ventas ")],-1)),t("div",ce,[o(l(v),{label:"Nueva Venta",icon:"pi pi-plus",class:"p-button-success p-button-sm",onClick:W}),o(l(v),{label:"Exportar",icon:"pi pi-download",class:"p-button-info p-button-sm p-button-outlined",onClick:Y})])])]),default:i(()=>[t("div",ue,[t("div",pe,[t("div",me,[o(l(b),{class:"bg-gradient-to-r from-green-400 to-green-600 text-white"},{content:i(()=>[t("div",ve,[t("div",null,[e[7]||(e[7]=t("div",{class:"text-green-100 text-sm"},"Ventas Completadas",-1)),t("div",fe,d(D.value.completadas),1)]),e[8]||(e[8]=t("i",{class:"pi pi-check-circle text-3xl text-green-200"},null,-1))])]),_:1}),o(l(b),{class:"bg-gradient-to-r from-yellow-400 to-yellow-600 text-white"},{content:i(()=>[t("div",be,[t("div",null,[e[9]||(e[9]=t("div",{class:"text-yellow-100 text-sm"},"Ventas Pendientes",-1)),t("div",xe,d(D.value.pendientes),1)]),e[10]||(e[10]=t("i",{class:"pi pi-clock text-3xl text-yellow-200"},null,-1))])]),_:1}),o(l(b),{class:"bg-gradient-to-r from-red-400 to-red-600 text-white"},{content:i(()=>[t("div",ge,[t("div",null,[e[11]||(e[11]=t("div",{class:"text-red-100 text-sm"},"Ventas Canceladas",-1)),t("div",ye,d(D.value.canceladas),1)]),e[12]||(e[12]=t("i",{class:"pi pi-times-circle text-3xl text-red-200"},null,-1))])]),_:1}),o(l(b),{class:"bg-gradient-to-r from-blue-400 to-blue-600 text-white"},{content:i(()=>[t("div",we,[t("div",null,[e[13]||(e[13]=t("div",{class:"text-blue-100 text-sm"},"Total Vendido",-1)),t("div",he,"$"+d(_(D.value.totalVendido)),1)]),e[14]||(e[14]=t("i",{class:"pi pi-dollar text-3xl text-blue-200"},null,-1))])]),_:1})]),o(l(b),{class:"mb-6"},{content:i(()=>[t("div",_e,[t("div",null,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Estado",-1)),o(l(te),{modelValue:c.value.estado,"onUpdate:modelValue":e[0]||(e[0]=s=>c.value.estado=s),options:G,optionLabel:"name",optionValue:"value",placeholder:"Todos los estados",class:"w-full",onChange:E},null,8,["modelValue"])]),t("div",null,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Fecha Desde",-1)),o(l(U),{modelValue:c.value.fechaDesde,"onUpdate:modelValue":e[1]||(e[1]=s=>c.value.fechaDesde=s),placeholder:"Seleccionar fecha",class:"w-full",onDateSelect:E},null,8,["modelValue"])]),t("div",null,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Fecha Hasta",-1)),o(l(U),{modelValue:c.value.fechaHasta,"onUpdate:modelValue":e[2]||(e[2]=s=>c.value.fechaHasta=s),placeholder:"Seleccionar fecha",class:"w-full",onDateSelect:E},null,8,["modelValue"])]),t("div",null,[e[18]||(e[18]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Cliente",-1)),o(l(q),{modelValue:c.value.cliente,"onUpdate:modelValue":e[3]||(e[3]=s=>c.value.cliente=s),placeholder:"Buscar cliente",class:"w-full",onInput:E},null,8,["modelValue"])]),t("div",Ve,[o(l(v),{label:"Limpiar Filtros",icon:"pi pi-times",class:"p-button-outlined w-full",onClick:Q})])])]),_:1}),o(l(b),null,{content:i(()=>[o(l(M),{value:N.value,paginator:!0,rows:10,loading:L.value,rowsPerPageOptions:[5,10,20,50],totalRecords:N.value.length,globalFilterFields:["cliente.nombre","empleado.nombre","metodo_pago.nombre"],scrollable:"",scrollHeight:"60vh",class:"p-datatable-sm",stripedRows:"",responsiveLayout:"scroll"},{header:i(()=>[t("div",Ce,[t("h5",ke," Lista de Ventas ("+d(N.value.length)+") ",1),t("span",De,[e[19]||(e[19]=t("i",{class:"pi pi-search"},null,-1)),o(l(q),{modelValue:h.value,"onUpdate:modelValue":e[4]||(e[4]=s=>h.value=s),placeholder:"Buscar ventas...",class:"p-inputtext-sm"},null,8,["modelValue"])])])]),default:i(()=>[o(l(u),{field:"id",header:"ID",sortable:"",style:{width:"80px"}},{body:i(({data:s})=>[o(l(V),{value:`#${s.id}`,severity:"info"},null,8,["value"])]),_:1}),o(l(u),{field:"fecha",header:"Fecha",sortable:"",style:{width:"120px"}},{body:i(({data:s})=>[t("span",$e,d(P(s.fecha)),1)]),_:1}),o(l(u),{field:"cliente.nombre",header:"Cliente",sortable:""},{body:i(({data:s})=>{var n;return[t("div",Ee,[e[20]||(e[20]=t("i",{class:"pi pi-user text-gray-500"},null,-1)),t("span",Fe,d(((n=s.cliente)==null?void 0:n.nombre)||"N/A"),1)])]}),_:1}),o(l(u),{field:"empleado.nombre",header:"Empleado",sortable:""},{body:i(({data:s})=>{var n;return[t("div",Se,[e[21]||(e[21]=t("i",{class:"pi pi-user-edit text-blue-500"},null,-1)),t("span",null,d(((n=s.empleado)==null?void 0:n.nombre)||"N/A"),1)])]}),_:1}),o(l(u),{field:"metodo_pago.nombre",header:"Método Pago",sortable:""},{body:i(({data:s})=>{var n;return[t("div",Le,[e[22]||(e[22]=t("i",{class:"pi pi-credit-card text-green-500"},null,-1)),t("span",null,d(((n=s.metodo_pago)==null?void 0:n.nombre)||"N/A"),1)])]}),_:1}),o(l(u),{field:"total",header:"Total",sortable:"",style:{width:"120px"}},{body:i(({data:s})=>[t("span",Ie,"$"+d(_(s.total)),1)]),_:1}),o(l(u),{field:"estado",header:"Estado",sortable:"",style:{width:"120px"}},{body:i(({data:s})=>[o(l(V),{value:s.estado,severity:H(s.estado),icon:j(s.estado)},null,8,["value","severity","icon"])]),_:1}),o(l(u),{header:"Productos",style:{width:"100px"}},{body:i(({data:s})=>{var n;return[o(l(V),{value:`${((n=s.detalle_ventas)==null?void 0:n.length)||0} items`,severity:"info",class:"text-xs"},null,8,["value"])]}),_:1}),o(l(u),{header:"Acciones",style:{width:"200px"}},{body:i(({data:s})=>[t("div",Ne,[w(o(l(v),{icon:"pi pi-eye",class:"p-button-sm p-button-info p-button-text",onClick:n=>O(s)},null,8,["onClick"]),[[r,"Ver detalles"]]),s.estado==="pendiente"?w((y(),C(l(v),{key:0,icon:"pi pi-pencil",class:"p-button-sm p-button-warning p-button-text",onClick:n=>X(s)},null,8,["onClick"])),[[r,"Editar venta"]]):k("",!0),s.estado==="pendiente"?w((y(),C(l(v),{key:1,icon:"pi pi-check",class:"p-button-sm p-button-success p-button-text",onClick:n=>z(s)},null,8,["onClick"])),[[r,"Procesar venta"]]):k("",!0),s.estado==="completada"?w((y(),C(l(v),{key:2,icon:"pi pi-times",class:"p-button-sm p-button-danger p-button-text",onClick:n=>J(s)},null,8,["onClick"])),[[r,"Cancelar venta"]]):k("",!0),s.estado!=="completada"?w((y(),C(l(v),{key:3,icon:"pi pi-trash",class:"p-button-sm p-button-danger p-button-text",onClick:n=>K(s)},null,8,["onClick"])),[[r,"Eliminar venta"]]):k("",!0),w(o(l(v),{icon:"pi pi-print",class:"p-button-sm p-button-info p-button-text",onClick:n=>Z(s)},null,8,["onClick"]),[[r,"Imprimir"]])])]),_:1})]),_:1},8,["value","loading","totalRecords"])]),_:1})])]),o(l(se),{visible:I.value,"onUpdate:visible":e[5]||(e[5]=s=>I.value=s),style:{width:"80vw"},header:"Detalles de la Venta",modal:!0,closable:!0},{default:i(()=>[p.value?(y(),ie("div",Pe,[o(l(b),null,{title:i(()=>[t("div",He,[e[23]||(e[23]=t("span",null,"Información General",-1)),o(l(V),{value:p.value.estado,severity:H(p.value.estado),icon:j(p.value.estado)},null,8,["value","severity","icon"])])]),content:i(()=>{var s,n,f;return[t("div",je,[t("div",Ae,[t("div",Be,[e[24]||(e[24]=t("i",{class:"pi pi-hashtag text-gray-500"},null,-1)),e[25]||(e[25]=t("strong",null,"ID:",-1)),x(" #"+d(p.value.id),1)]),t("div",Te,[e[26]||(e[26]=t("i",{class:"pi pi-calendar text-gray-500"},null,-1)),e[27]||(e[27]=t("strong",null,"Fecha:",-1)),x(" "+d(P(p.value.fecha)),1)]),t("div",Ue,[e[28]||(e[28]=t("i",{class:"pi pi-user text-gray-500"},null,-1)),e[29]||(e[29]=t("strong",null,"Cliente:",-1)),x(" "+d((s=p.value.cliente)==null?void 0:s.nombre),1)])]),t("div",qe,[t("div",Me,[e[30]||(e[30]=t("i",{class:"pi pi-user-edit text-gray-500"},null,-1)),e[31]||(e[31]=t("strong",null,"Empleado:",-1)),x(" "+d((n=p.value.empleado)==null?void 0:n.nombre),1)]),t("div",Re,[e[32]||(e[32]=t("i",{class:"pi pi-credit-card text-gray-500"},null,-1)),e[33]||(e[33]=t("strong",null,"Método Pago:",-1)),x(" "+d((f=p.value.metodo_pago)==null?void 0:f.nombre),1)]),t("div",Ge,[e[34]||(e[34]=t("i",{class:"pi pi-dollar text-gray-500"},null,-1)),e[35]||(e[35]=t("strong",null,"Total:",-1)),t("span",Oe," $"+d(_(p.value.total)),1)])])])]}),_:1}),o(l(b),null,{title:i(()=>{var s;return[x(" Productos Vendidos ("+d(((s=p.value.detalle_ventas)==null?void 0:s.length)||0)+") ",1)]}),content:i(()=>[o(l(M),{value:p.value.detalle_ventas,class:"p-datatable-sm",stripedRows:""},{default:i(()=>[o(l(u),{field:"producto.nombre",header:"Producto"},{body:i(({data:s})=>{var n;return[t("div",ze,[e[36]||(e[36]=t("i",{class:"pi pi-box text-blue-500"},null,-1)),t("span",Je,d((n=s.producto)==null?void 0:n.nombre),1)])]}),_:1}),o(l(u),{field:"producto.categoria.nombre",header:"Categoría"},{body:i(({data:s})=>{var n,f;return[o(l(V),{value:((f=(n=s.producto)==null?void 0:n.categoria)==null?void 0:f.nombre)||"Sin categoría"},null,8,["value"])]}),_:1}),o(l(u),{field:"cantidad",header:"Cantidad",style:{width:"100px"}},{body:i(({data:s})=>[t("span",Ke,d(s.cantidad),1)]),_:1}),o(l(u),{field:"precio_unitario",header:"Precio Unit.",style:{width:"120px"}},{body:i(({data:s})=>[t("span",null,"$"+d(_(s.precio_unitario)),1)]),_:1}),o(l(u),{field:"subtotal",header:"Subtotal",style:{width:"120px"}},{body:i(({data:s})=>[t("span",Qe," $"+d(_(s.subtotal)),1)]),_:1})]),_:1},8,["value"])]),_:1})])):k("",!0)]),_:1},8,["visible"]),o(l(le))]),_:1})}}},lt=re(We,[["__scopeId","data-v-f9f1a6fc"]]);export{lt as default};
