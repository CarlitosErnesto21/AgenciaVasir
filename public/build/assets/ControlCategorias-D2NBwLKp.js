import{q as ne,r as m,F as R,i as ie,m as q,D as $,s as de,E as A,y as k,c as L,o as N,a as s,u as l,g as ue,w as p,b as t,S as ce,t as x,h,f as j,n as B,A as me}from"./app-WKwrJkJC.js";import{_ as pe}from"./AuthenticatedLayout-baeqBx4a.js";import{F as v,f as ve,a as ge,b as z,c as fe,d as be,e as I,g as H,h as W,i as xe}from"./index-Cz7jU3Cp.js";import"./logo-DN1bLr27.js";const he={class:"py-4 sm:py-6 px-4 sm:px-7 mt-6 sm:mt-10 mx-auto bg-red-50 shadow-md rounded-lg h-screen-full"},ye={class:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-2 sm:gap-0"},we={class:"flex items-center gap-3"},Ce={class:"bg-blue-50 p-3 rounded-lg shadow-sm border mb-4"},_e={class:"flex items-center justify-between mb-3"},Pe={class:"flex items-center gap-3"},Ee={class:"bg-blue-50 border border-blue-200 text-blue-700 px-3 py-1 rounded text-sm font-medium"},ke={class:"flex items-center gap-2"},Te={class:"space-y-3"},De={class:"text-sm font-medium leading-relaxed"},Le={class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800"},Ne={class:"flex gap-1 justify-center items-center w-64"},Ve=["onClick"],Se=["onClick"],Ae={class:"space-y-4"},je={class:"w-full flex flex-col"},Fe={class:"flex items-center gap-4"},Ue={key:0,class:"text-red-500 ml-28"},$e={class:"w-full flex flex-col"},Oe={class:"flex items-center gap-4"},Me={key:0,class:"text-red-500 ml-28"},Re={key:1,class:"text-orange-500 ml-28"},qe={key:2,class:"text-red-500 ml-28"},Be={class:"flex justify-center gap-4 w-full"},ze={class:"flex items-center gap-3"},Ie={class:"flex flex-col"},He={class:"flex justify-center gap-4 w-full"},We={class:"flex items-center gap-3"},Xe={class:"flex justify-center gap-3 w-full"},Ze={__name:"ControlCategorias",setup(Ge){const u=ne(),O=m([]),a=m({id:null,nombre:"",tipo:null}),y=m(!1),P=m(!1),T=m(!1),b=m(!1),w=m(!1),C=m(null),E=m({global:{value:null,matchMode:R.CONTAINS},tipo:{value:null,matchMode:R.EQUALS}}),f=m("productos"),X=m(null),F=m(10),G=m([5,10,20,50]),V=m("Guardar"),J=[{label:"Productos",value:"productos"},{label:"Hoteles",value:"hoteles"}],K=[{label:"Productos",value:"productos"},{label:"Hoteles",value:"hoteles"}],U=ie(()=>{let o=O.value.filter(e=>e.tipo===f.value);if(E.value.global.value){const e=E.value.global.value.toLowerCase();o=o.filter(c=>c.nombre.toLowerCase().includes(e))}return o});q([a],()=>{C.value&&y.value&&$(()=>{const o={...a.value},e=JSON.stringify(o)!==JSON.stringify(C.value),c=!C.value.id,n=a.value.nombre||a.value.tipo;w.value=e||c&&n})},{deep:!0,flush:"post"});function S(){a.value={id:null,nombre:"",tipo:null},b.value=!1}de(()=>{D(f.value)}),q(f,o=>{D(o)});const D=async o=>{try{const e=o==="hoteles"?"categorias-hoteles":"categorias-productos",c=await A.get(`/api/${e}`);O.value=(c.data.data||c.data||[]).map(n=>({...n,tipo:o,categoria_id:n.id})).sort((n,d)=>{const i=new Date(n.created_at);return new Date(d.created_at)-i})}catch{u.add({severity:"error",summary:"Error",detail:`No se pudieron cargar las categorías de ${o}.`,life:4e3})}},Q=()=>{X.value=null,E.value.global.value=null,E.value.tipo.value=null,u.add({severity:"info",summary:"Filtros limpiados",detail:"Se han removido todos los filtros aplicados.",life:3e3})},Y=()=>{S(),a.value.tipo=f.value,V.value="Guardar",b.value=!1,y.value=!0,$(()=>{C.value={...a.value},w.value=!1})},Z=o=>{S(),b.value=!1,a.value={...o},w.value=!1,V.value="Actualizar",y.value=!0,$(()=>{C.value={...a.value},w.value=!1})},ee=async()=>{var o,e,c;if(b.value=!0,!a.value.nombre||a.value.nombre.length<3||a.value.nombre.length>50){u.add({severity:"warn",summary:"Campos requeridos",detail:"El nombre debe tener entre 3 y 50 caracteres.",life:4e3});return}if(!a.value.tipo){u.add({severity:"warn",summary:"Campos requeridos",detail:"Por favor selecciona el tipo de categoría.",life:4e3});return}try{const d=a.value.tipo==="hoteles"?"categorias-hoteles":"categorias-productos";let i;a.value.id?(i=await A({method:"POST",url:`/api/${d}/${a.value.id}`,data:{_method:"PUT",nombre:a.value.nombre}}),u.add({severity:"success",summary:"¡Éxito!",detail:"La categoría ha sido actualizada correctamente.",life:5e3})):(i=await A.post(`/api/${d}`,{nombre:a.value.nombre}),u.add({severity:"success",summary:"¡Éxito!",detail:"La categoría ha sido creada correctamente.",life:5e3})),await D(f.value),y.value=!1,w.value=!1,C.value=null,S()}catch(n){if(((o=n.response)==null?void 0:o.status)===422){const d=n.response.data.errors;if(d&&d.nombre)u.add({severity:"warn",summary:"Error de validación",detail:d.nombre[0],life:6e3});else{const i=n.response.data.message||"Error de validación.";u.add({severity:"warn",summary:"Error de validación",detail:i,life:6e3})}}else{const d=((c=(e=n.response)==null?void 0:e.data)==null?void 0:c.message)||"Error al procesar la categoría.";u.add({severity:"error",summary:"Error",detail:d,life:6e3})}}},te=o=>{a.value={...o},P.value=!0},ae=async()=>{var o,e,c,n,d;try{const g=a.value.tipo==="hoteles"?"categorias-hoteles":"categorias-productos",_=await A({method:"POST",url:`/api/${g}/${a.value.id}`,data:{_method:"DELETE"},headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json"}});await D(f.value),P.value=!1,u.add({severity:"success",summary:"¡Eliminada!",detail:"La categoría ha sido eliminada correctamente.",life:5e3})}catch(i){if(P.value=!1,((o=i.response)==null?void 0:o.status)===422){const g=i.response.data;let _=g.error||"La categoría está siendo utilizada en el sistema.";g.details&&Array.isArray(g.details)&&(_+=`

📋 Detalles:
• `+g.details.join(`
• `)),u.add({severity:"warn",summary:"❌ No se puede eliminar",detail:_,life:1e4})}else if(((e=i.response)==null?void 0:e.status)===404)u.add({severity:"error",summary:"Categoría no encontrada",detail:"La categoría que intentas eliminar no existe o ya fue eliminada.",life:5e3}),await D(f.value);else if(((c=i.response)==null?void 0:c.status)===500)u.add({severity:"error",summary:"Error del servidor",detail:"Ocurrió un error interno. Por favor, contacta al administrador.",life:6e3});else{const g=((d=(n=i.response)==null?void 0:n.data)==null?void 0:d.error)||i.message||"Error desconocido";u.add({severity:"error",summary:"Error",detail:`No se pudo eliminar la categoría: ${g}`,life:6e3})}}},se=()=>{w.value?T.value=!0:M()},M=()=>{y.value=!1,T.value=!1,w.value=!1,C.value=null,S()},le=()=>{T.value=!1},oe=()=>{a.value.nombre&&a.value.nombre.length>50&&(a.value.nombre=a.value.nombre.substring(0,50))};return(o,e)=>{const c=k("Toast"),n=k("Select"),d=k("InputText"),i=k("Column"),g=k("DataTable"),_=k("Dialog");return N(),L(me,null,[s(l(ue),{title:"Control de Categorías"}),s(pe,null,{default:p(()=>[s(c,{class:"z-[9999]"}),t("div",he,[t("div",ye,[t("div",we,[s(l(ce),{href:o.route("productos"),class:"flex items-center text-blue-600 hover:text-blue-700 transition-colors duration-200 px-4 rounded-lg",title:"Regresar a Productos"},{default:p(()=>[s(l(v),{icon:l(ve),class:"h-8"},null,8,["icon"])]),_:1},8,["href"]),e[9]||(e[9]=t("h3",{class:"text-lg sm:text-2xl text-blue-600 font-bold"},"Control de categorías",-1))]),t("button",{class:"bg-blue-500 border border-blue-500 p-2 text-sm text-white shadow-md hover:shadow-lg rounded-md hover:-translate-y-1 transition-transform duration-300",onClick:Y},[s(l(v),{icon:l(ge),class:"h-4 w-4 text-white"},null,8,["icon"]),e[10]||(e[10]=t("span",null," Agregar categoría",-1))])]),s(g,{value:U.value,dataKey:"id",paginator:!0,rows:F.value,rowsPerPageOptions:G.value,rowsPerPage:F.value,"onUpdate:rowsPerPage":e[2]||(e[2]=r=>F.value=r),paginatorTemplate:"RowsPerPageDropdown FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink",currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} categorías",class:"overflow-x-auto max-w-full",style:{display:"block","max-width":"84vw"},responsiveLayout:"scroll",pt:{root:{class:"text-sm"},wrapper:{class:"text-sm"},table:{class:"text-sm"},thead:{class:"text-sm"},headerRow:{class:"text-sm"},headerCell:{class:"text-sm font-medium py-3 px-2"},tbody:{class:"text-sm"},bodyRow:{class:"h-20 text-sm"},bodyCell:{class:"py-3 px-2 text-sm"},paginator:{class:"text-xs sm:text-sm"},paginatorWrapper:{class:"flex flex-wrap justify-center sm:justify-between items-center gap-2 p-2"}}},{header:p(()=>[t("div",Ce,[t("div",_e,[t("div",Pe,[e[11]||(e[11]=t("h3",{class:"text-base font-medium text-gray-800 flex items-center gap-2"},[t("i",{class:"pi pi-filter text-blue-600 text-sm"}),t("span",null,"Filtros")],-1)),t("div",Ee,x(U.value.length)+" resultado"+x(U.value.length!==1?"s":""),1)]),t("div",ke,[e[13]||(e[13]=t("label",{for:"tipo-estado",class:"text-sm font-medium text-gray-700"},"Ver categorías:",-1)),s(n,{id:"tipo-estado",modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=r=>f.value=r),options:K,optionValue:"value",optionLabel:"label",class:"w-32 h-8 text-sm",style:{"background-color":"white","border-color":"#93c5fd"}},null,8,["modelValue"]),t("button",{class:"bg-red-500 hover:bg-red-600 border border-red-500 px-3 py-1 text-sm text-white shadow-md rounded-md",onClick:Q},[s(l(v),{icon:l(be),class:"h-4 w-4 text-white"},null,8,["icon"]),e[12]||(e[12]=t("span",null," Limpiar filtros",-1))])])]),t("div",Te,[t("div",null,[s(d,{modelValue:E.value.global.value,"onUpdate:modelValue":e[1]||(e[1]=r=>E.value.global.value=r),placeholder:"🔍 Buscar categorías...",class:"w-full h-9 text-sm",style:{"background-color":"white","border-color":"#93c5fd"}},null,8,["modelValue"])])])])]),default:p(()=>[s(i,{field:"nombre",header:"Nombre",sortable:"",class:"w-96 min-w-96"},{body:p(r=>[t("div",De,x(r.data.nombre),1)]),_:1}),s(i,{field:"tipo",header:"Tipo",class:"w-32 min-w-32"},{body:p(r=>[t("span",Le,x(r.data.tipo==="productos"?"Productos":"Hoteles"),1)]),_:1}),s(i,{exportable:!1,class:"w-56 min-w-56"},{header:p(()=>e[14]||(e[14]=[t("div",{class:"text-center w-full font-bold"}," Acciones ",-1)])),body:p(r=>[t("div",Ne,[t("button",{class:"bg-orange-200/30 border py-2 px-1 text-sm shadow-md hover:shadow-lg rounded-md hover:-translate-y-1 transition-transform duration-300",onClick:re=>Z(r.data)},[s(l(v),{icon:l(z),class:"h-4 w-4 text-orange-600"},null,8,["icon"]),e[15]||(e[15]=h("  Editar "))],8,Ve),t("button",{class:"bg-red-200/30 border py-2 px-1 text-sm shadow-md hover:shadow-lg rounded-md hover:-translate-y-1 transition-transform duration-300",onClick:re=>te(r.data)},[s(l(v),{icon:l(fe),class:"h-4 w-4 text-red-600"},null,8,["icon"]),e[16]||(e[16]=h("  Eliminar "))],8,Se)])]),_:1})]),_:1},8,["value","rows","rowsPerPageOptions","rowsPerPage"]),s(_,{visible:y.value,"onUpdate:visible":e[5]||(e[5]=r=>y.value=r),header:V.value+" Categoría",modal:!0,style:{width:"450px"},closable:!1},{footer:p(()=>[t("div",Be,[t("button",{type:"button",class:"bg-white hover:bg-green-100 text-green-600 border border-green-600 px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",onClick:se},[s(l(v),{icon:l(I),class:"h-5 text-green-600"},null,8,["icon"]),e[19]||(e[19]=h(" Cancelar "))]),t("button",{class:"bg-red-500 hover:bg-red-700 text-white border-none px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",onClick:ee},[s(l(v),{icon:l(H),class:"h-5 text-white"},null,8,["icon"]),h(" "+x(V.value),1)])])]),default:p(()=>[t("div",Ae,[t("div",je,[t("div",Fe,[e[17]||(e[17]=t("label",{for:"tipo",class:"w-24 flex items-center gap-1"},[h(" Tipo: "),t("span",{class:"text-red-500 font-bold"},"*")],-1)),s(n,{modelValue:a.value.tipo,"onUpdate:modelValue":e[3]||(e[3]=r=>a.value.tipo=r),options:J,optionLabel:"label",optionValue:"value",id:"tipo",name:"tipo",class:B(["flex-1",{"p-invalid":b.value&&!a.value.tipo}]),placeholder:"Selecciona el tipo"},null,8,["modelValue","class"])]),b.value&&!a.value.tipo?(N(),L("small",Ue," El tipo es obligatorio. ")):j("",!0)]),t("div",$e,[t("div",Oe,[e[18]||(e[18]=t("label",{for:"nombre",class:"w-24 flex items-center gap-1"},[h(" Nombre: "),t("span",{class:"text-red-500 font-bold"},"*")],-1)),s(d,{modelValue:a.value.nombre,"onUpdate:modelValue":e[4]||(e[4]=r=>a.value.nombre=r),modelModifiers:{trim:!0},id:"nombre",name:"nombre",maxlength:50,class:B([{"p-invalid":b.value&&(!a.value.nombre||a.value.nombre.length<3||a.value.nombre.length>50)},"flex-1"]),onInput:oe,placeholder:"Nombre de la categoría"},null,8,["modelValue","class"])]),a.value.nombre&&a.value.nombre.length<3?(N(),L("small",Me," El nombre debe tener al menos 3 caracteres. Actual: "+x(a.value.nombre.length)+"/3 ",1)):j("",!0),a.value.nombre&&a.value.nombre.length>=45&&a.value.nombre.length<=50?(N(),L("small",Re," Caracteres restantes: "+x(50-a.value.nombre.length),1)):j("",!0),b.value&&!a.value.nombre?(N(),L("small",qe," El nombre es obligatorio. ")):j("",!0)])])]),_:1},8,["visible","header"]),s(_,{visible:P.value,"onUpdate:visible":e[7]||(e[7]=r=>P.value=r),header:"Eliminar categoría",modal:!0,style:{width:"350px"},closable:!1},{footer:p(()=>[t("div",He,[t("button",{type:"button",class:"bg-white hover:bg-green-100 text-green-600 border border-green-600 px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",onClick:e[6]||(e[6]=r=>P.value=!1)},[s(l(v),{icon:l(I),class:"h-5"},null,8,["icon"]),e[23]||(e[23]=t("span",null,"No",-1))]),t("button",{type:"button",class:"bg-red-500 hover:bg-red-700 text-white border-none px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",onClick:ae},[s(l(v),{icon:l(H),class:"h-5"},null,8,["icon"]),e[24]||(e[24]=t("span",null,"Sí",-1))])])]),default:p(()=>[t("div",ze,[s(l(v),{icon:l(W),class:"h-8 w-8 text-red-500"},null,8,["icon"]),t("div",Ie,[t("span",null,[e[20]||(e[20]=h("¿Estás seguro de eliminar la categoría: ")),t("b",null,x(a.value.nombre),1),e[21]||(e[21]=h("?"))]),e[22]||(e[22]=t("span",{class:"text-red-600 text-sm font-medium mt-1"},"Esta acción es irreversible.",-1))])])]),_:1},8,["visible"]),s(_,{visible:T.value,"onUpdate:visible":e[8]||(e[8]=r=>T.value=r),header:"Cambios sin guardar",modal:!0,style:{width:"400px"},closable:!1},{footer:p(()=>[t("div",Xe,[t("button",{type:"button",class:"bg-white hover:bg-green-100 text-green-600 border border-green-600 px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",onClick:le},[s(l(v),{icon:l(z),class:"h-4"},null,8,["icon"]),e[26]||(e[26]=t("span",null,"Continuar",-1))]),t("button",{type:"button",class:"bg-red-500 hover:bg-red-700 text-white border-none px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",onClick:M},[s(l(v),{icon:l(xe),class:"h-4"},null,8,["icon"]),e[27]||(e[27]=t("span",null,"Salir sin guardar",-1))])])]),default:p(()=>[t("div",We,[s(l(v),{icon:l(W),class:"h-8 w-8 text-red-500"},null,8,["icon"]),e[25]||(e[25]=t("div",{class:"flex flex-col"},[t("span",null,"¡Tienes información sin guardar!"),t("span",{class:"text-red-600 text-sm font-medium mt-1"},"¿Deseas salir sin guardar?")],-1))])]),_:1},8,["visible"])])]),_:1})],64)}}};export{Ze as default};
