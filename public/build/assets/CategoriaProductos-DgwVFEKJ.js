import{r as u,E as F,w as ee,n as U,o as ae,N as D,k as y,c as C,d as P,p as l,$ as o,a0 as te,x as i,e as t,a1 as oe,t as _,q as f,j as L,y as se,F as le}from"./vendor-BiysG-4G.js";import{A as re}from"./AuthenticatedLayout-yva5xhgW.js";import{z as ne,F as ie,A as c}from"./ui-CyD9Ijjf.js";import{f as de,a as ue,b as M,c as ce,d as j,e as z,g as I,h as me}from"./index-DRTZt2OH.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ve={class:"py-4 sm:py-6 px-4 sm:px-7 mt-6 sm:mt-10 mx-auto bg-red-50 shadow-md rounded-lg h-screen-full"},ge={class:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-2 sm:gap-0"},be={class:"flex items-center gap-3"},fe={class:"bg-blue-50 p-3 rounded-lg shadow-sm border mb-4"},pe={class:"text-sm font-medium leading-relaxed"},xe={class:"flex gap-1 justify-center items-center w-64"},he=["onClick"],we=["onClick"],ye={class:"space-y-4"},Ce={class:"w-full flex flex-col"},Pe={class:"flex items-center gap-4"},_e={key:0,class:"text-red-500 ml-28"},ke={key:1,class:"text-red-500 ml-28"},Ee={key:2,class:"text-orange-500 ml-28"},Te={key:3,class:"text-red-500 ml-28"},Ne={class:"flex justify-center gap-4 w-full"},De=["disabled"],Le={class:"flex items-center gap-3"},Ae={class:"flex flex-col"},Se={class:"flex justify-center gap-4 w-full"},Oe={class:"flex items-center gap-3"},Ve={class:"flex justify-center gap-3 w-full"},Ie={__name:"CategoriaProductos",setup(Ue){const m=ne(),A=u([]),a=u({id:null,nombre:""}),v=u(!1),p=u(!1),w=u(!1),x=u(!1),h=u(!1),g=u(null),k=u({global:{value:null,matchMode:ie.CONTAINS}}),S=u(10),R=u([5,10,20,50]),E=u("Guardar"),B=F(()=>{let s=A.value;if(k.value.global.value){const e=k.value.global.value.toLowerCase();s=s.filter(n=>n.nombre.toLowerCase().includes(e))}return s}),T=F(()=>!a.value.nombre||a.value.nombre.length<3?!1:A.value.some(s=>s.nombre.toLowerCase()===a.value.nombre.toLowerCase()&&s.id!==a.value.id));ee([a],()=>{g.value&&v.value&&U(()=>{const s={...a.value},e=JSON.stringify(s)!==JSON.stringify(g.value),n=!g.value.id,d=a.value.nombre;h.value=e||n&&d})},{deep:!0,flush:"post"});function N(){a.value={id:null,nombre:""},x.value=!1}ae(()=>{O()});const O=async()=>{try{const s=await D.get("/api/categorias-productos");A.value=(s.data.data||s.data||[]).map(e=>({...e,categoria_id:e.id})).sort((e,n)=>new Date(n.created_at)-new Date(e.created_at))}catch{m.add({severity:"error",summary:"Error",detail:"No se pudieron cargar las categor√≠as de productos.",life:4e3})}},q=()=>{N(),E.value="Guardar",x.value=!1,v.value=!0,U(()=>{g.value={...a.value},h.value=!1})},Y=s=>{N(),x.value=!1,a.value={...s},E.value="Actualizar",v.value=!0,U(()=>{g.value={...a.value},h.value=!1})},G=async()=>{var s,e;if(x.value=!0,!a.value.nombre||a.value.nombre.length<3||a.value.nombre.length>50){m.add({severity:"warn",summary:"Campos requeridos",detail:"El nombre debe tener entre 3 y 50 caracteres.",life:4e3});return}if(T.value){m.add({severity:"warn",summary:"Categor√≠a duplicada",detail:`Ya existe una categor√≠a con el nombre "${a.value.nombre}". Por favor, elige un nombre diferente.`,life:6e3});return}try{a.value.id?(await D({method:"POST",url:`/api/categorias-productos/${a.value.id}`,data:{_method:"PUT",nombre:a.value.nombre}}),m.add({severity:"success",summary:"¬°√âxito!",detail:"La categor√≠a ha sido actualizada correctamente.",life:5e3})):(await D.post("/api/categorias-productos",{nombre:a.value.nombre}),m.add({severity:"success",summary:"¬°√âxito!",detail:"La categor√≠a ha sido creada correctamente.",life:5e3})),await O(),v.value=!1,h.value=!1,g.value=null,N()}catch(n){if(n.response&&n.response.status===422){const d=n.response.data.errors;if(d&&d.nombre){const b=d.nombre[0];b.includes("unique")||b.includes("ya existe")||b.includes("duplicado")?m.add({severity:"warn",summary:"Categor√≠a duplicada",detail:`Ya existe una categor√≠a con el nombre "${a.value.nombre}". Por favor, elige un nombre diferente.`,life:6e3}):m.add({severity:"warn",summary:"Error de validaci√≥n",detail:b,life:5e3})}else m.add({severity:"warn",summary:"Error de validaci√≥n",detail:n.response.data.message||"Por favor verifica los datos ingresados.",life:5e3})}else{const d=((e=(s=n.response)==null?void 0:s.data)==null?void 0:e.message)||"Error al procesar la categor√≠a.";m.add({severity:"error",summary:"Error",detail:d,life:6e3})}}},J=s=>{a.value={...s},p.value=!0},K=async()=>{var s,e;try{await D({method:"POST",url:`/api/categorias-productos/${a.value.id}`,data:{_method:"DELETE"}}),await O(),p.value=!1,m.add({severity:"success",summary:"¬°Eliminada!",detail:"La categor√≠a ha sido eliminada correctamente.",life:5e3})}catch(n){p.value=!1;const d=((e=(s=n.response)==null?void 0:s.data)==null?void 0:e.error)||n.message||"Error desconocido";m.add({severity:"error",summary:"Error",detail:`No se pudo eliminar la categor√≠a: ${d}`,life:6e3})}},W=()=>{h.value?w.value=!0:$()},$=()=>{v.value=!1,w.value=!1,h.value=!1,g.value=null,N()},X=()=>{w.value=!1},H=()=>{a.value.nombre&&a.value.nombre.length>50&&(a.value.nombre=a.value.nombre.substring(0,50))};return(s,e)=>{const n=y("Toast"),d=y("InputText"),b=y("Column"),Q=y("DataTable"),V=y("Dialog");return P(),C(le,null,[l(o(te),{title:"Control de Categor√≠as de Productos"}),l(re,null,{default:i(()=>[l(n,{class:"z-[9999]"}),t("div",ve,[t("div",ge,[t("div",be,[l(o(oe),{href:s.route("productos"),class:"flex items-center text-blue-600 hover:text-blue-700 transition-colors duration-200 px-4 rounded-lg",title:"Regresar a Productos"},{default:i(()=>[l(o(c),{icon:o(de),class:"h-8"},null,8,["icon"])]),_:1},8,["href"]),e[7]||(e[7]=t("h3",{class:"text-lg sm:text-2xl text-blue-600 font-bold"},"Control de categor√≠as de productos",-1))]),t("button",{class:"bg-blue-500 border border-blue-500 p-2 text-sm text-white shadow-md hover:shadow-lg rounded-md hover:-translate-y-1 transition-transform duration-300",onClick:q},[l(o(c),{icon:o(ue),class:"h-4 w-4 text-white"},null,8,["icon"]),e[8]||(e[8]=t("span",null,"¬†Agregar categor√≠a",-1))])]),l(Q,{value:B.value,dataKey:"id",paginator:!0,rows:S.value,rowsPerPageOptions:R.value,rowsPerPage:S.value,"onUpdate:rowsPerPage":e[1]||(e[1]=r=>S.value=r),paginatorTemplate:"RowsPerPageDropdown FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink",currentPageReportTemplate:"Mostrando {first} a {last} de {totalRecords} categor√≠as",class:"overflow-x-auto max-w-full",style:{display:"block","max-width":"84vw"},responsiveLayout:"scroll"},{header:i(()=>[t("div",fe,[l(d,{modelValue:k.value.global.value,"onUpdate:modelValue":e[0]||(e[0]=r=>k.value.global.value=r),placeholder:"üîç Buscar categor√≠as...",class:"w-full h-9 text-sm",style:{"background-color":"white","border-color":"#93c5fd"}},null,8,["modelValue"])])]),default:i(()=>[l(b,{field:"nombre",header:"Nombre",sortable:"",class:"w-96 min-w-96"},{body:i(r=>[t("div",pe,_(r.data.nombre),1)]),_:1}),l(b,{exportable:!1,class:"w-56 min-w-56"},{header:i(()=>e[9]||(e[9]=[t("div",{class:"text-center w-full font-bold"}," Acciones ",-1)])),body:i(r=>[t("div",xe,[t("button",{class:"bg-orange-200/30 border py-2 px-1 text-sm shadow-md hover:shadow-lg rounded-md hover:-translate-y-1 transition-transform duration-300",onClick:Z=>Y(r.data)},[l(o(c),{icon:o(M),class:"h-4 w-4 text-orange-600"},null,8,["icon"]),e[10]||(e[10]=f(" ¬†Editar "))],8,he),t("button",{class:"bg-red-200/30 border py-2 px-1 text-sm shadow-md hover:shadow-lg rounded-md hover:-translate-y-1 transition-transform duration-300",onClick:Z=>J(r.data)},[l(o(c),{icon:o(ce),class:"h-4 w-4 text-red-600"},null,8,["icon"]),e[11]||(e[11]=f(" ¬†Eliminar "))],8,we)])]),_:1})]),_:1},8,["value","rows","rowsPerPageOptions","rowsPerPage"]),l(V,{visible:v.value,"onUpdate:visible":e[3]||(e[3]=r=>v.value=r),header:E.value+" Categor√≠a",modal:!0,style:{width:"450px"},closable:!1},{footer:i(()=>[t("div",Ne,[t("button",{type:"button",class:"bg-white hover:bg-green-100 text-green-600 border border-green-600 px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",onClick:W},[l(o(c),{icon:o(j),class:"h-5 text-green-600"},null,8,["icon"]),e[13]||(e[13]=f(" Cancelar "))]),t("button",{class:"bg-red-500 hover:bg-red-700 text-white border-none px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",onClick:G,disabled:T.value},[l(o(c),{icon:o(z),class:"h-5 text-white"},null,8,["icon"]),f(" "+_(E.value),1)],8,De)])]),default:i(()=>[t("div",ye,[t("div",Ce,[t("div",Pe,[e[12]||(e[12]=t("label",{for:"nombre",class:"w-24 flex items-center gap-1"},[f(" Nombre: "),t("span",{class:"text-red-500 font-bold"},"*")],-1)),l(d,{modelValue:a.value.nombre,"onUpdate:modelValue":e[2]||(e[2]=r=>a.value.nombre=r),modelModifiers:{trim:!0},id:"nombre",name:"nombre",maxlength:50,class:se([{"p-invalid":x.value&&(!a.value.nombre||a.value.nombre.length<3||a.value.nombre.length>50)||T.value},"flex-1"]),onInput:H,placeholder:"Nombre de la categor√≠a"},null,8,["modelValue","class"])]),a.value.nombre&&a.value.nombre.length<3?(P(),C("small",_e," El nombre debe tener al menos 3 caracteres. Actual: "+_(a.value.nombre.length)+"/3 ",1)):L("",!0),T.value?(P(),C("small",ke," Ya existe una categor√≠a con este nombre. Por favor, elige un nombre diferente. ")):L("",!0),a.value.nombre&&a.value.nombre.length>=45&&a.value.nombre.length<=50?(P(),C("small",Ee," Caracteres restantes: "+_(50-a.value.nombre.length),1)):L("",!0),x.value&&!a.value.nombre?(P(),C("small",Te," El nombre es obligatorio. ")):L("",!0)])])]),_:1},8,["visible","header"]),l(V,{visible:p.value,"onUpdate:visible":e[5]||(e[5]=r=>p.value=r),header:"Eliminar categor√≠a",modal:!0,style:{width:"350px"},closable:!1},{footer:i(()=>[t("div",Se,[t("button",{type:"button",class:"bg-white hover:bg-green-100 text-green-600 border border-green-600 px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",onClick:e[4]||(e[4]=r=>p.value=!1)},[l(o(c),{icon:o(j),class:"h-5"},null,8,["icon"]),e[17]||(e[17]=t("span",null,"No",-1))]),t("button",{type:"button",class:"bg-red-500 hover:bg-red-700 text-white border-none px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",onClick:K},[l(o(c),{icon:o(z),class:"h-5"},null,8,["icon"]),e[18]||(e[18]=t("span",null,"S√≠",-1))])])]),default:i(()=>[t("div",Le,[l(o(c),{icon:o(I),class:"h-8 w-8 text-red-500"},null,8,["icon"]),t("div",Ae,[t("span",null,[e[14]||(e[14]=f("¬øEst√°s seguro de eliminar la categor√≠a: ")),t("b",null,_(a.value.nombre),1),e[15]||(e[15]=f("?"))]),e[16]||(e[16]=t("span",{class:"text-red-600 text-sm font-medium mt-1"},"Esta acci√≥n es irreversible.",-1))])])]),_:1},8,["visible"]),l(V,{visible:w.value,"onUpdate:visible":e[6]||(e[6]=r=>w.value=r),header:"Cambios sin guardar",modal:!0,style:{width:"400px"},closable:!1},{footer:i(()=>[t("div",Ve,[t("button",{type:"button",class:"bg-white hover:bg-green-100 text-green-600 border border-green-600 px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",onClick:X},[l(o(c),{icon:o(M),class:"h-4"},null,8,["icon"]),e[20]||(e[20]=t("span",null,"Continuar",-1))]),t("button",{type:"button",class:"bg-red-500 hover:bg-red-700 text-white border-none px-6 py-2 rounded-md transition-all duration-200 ease-in-out flex items-center gap-2",onClick:$},[l(o(c),{icon:o(me),class:"h-4"},null,8,["icon"]),e[21]||(e[21]=t("span",null,"Salir sin guardar",-1))])])]),default:i(()=>[t("div",Oe,[l(o(c),{icon:o(I),class:"h-8 w-8 text-red-500"},null,8,["icon"]),e[19]||(e[19]=t("div",{class:"flex flex-col"},[t("span",null,"¬°Tienes informaci√≥n sin guardar!"),t("span",{class:"text-red-600 text-sm font-medium mt-1"},"¬øDeseas salir sin guardar?")],-1))])]),_:1},8,["visible"])])]),_:1})],64)}}};export{Ie as default};
