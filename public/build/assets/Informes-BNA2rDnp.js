import{r as c,i as k,s as P,am as $,q as H,y as j,c as D,o as M,a as m,u as f,g as z,w as A,b as o,j as _,ab as I,n as B,h as W,A as R}from"./app-WKwrJkJC.js";import{_ as J}from"./logo-DN1bLr27.js";import{_ as O}from"./AuthenticatedLayout-baeqBx4a.js";import"./index-Cz7jU3Cp.js";const Y={class:"min-h-[70vh] flex flex-col lg:flex-row items-start justify-start lg:justify-center py-10 bg-gray-50 gap-8"},q={class:"bg-white rounded-xl shadow-2xl border border-blue-100 px-8 py-10 max-w-lg w-full flex flex-col items-center lg:sticky lg:top-8 lg:self-start"},G={class:"w-full flex items-center mb-3 gap-3"},X={class:"w-full mb-5"},K={class:"w-full flex items-center mb-5 gap-3"},Q={class:"w-full mb-4 flex flex-col sm:flex-row gap-4"},Z={class:"flex-1"},ee={class:"flex-1"},oe={class:"w-full flex flex-row gap-3 mb-4 justify-center"},te=["disabled"],se={class:"w-full lg:flex-1 lg:max-w-4xl flex flex-col items-center"},ae={key:0,class:"w-full flex flex-col items-center"},le=["src","height"],re={key:1,class:"w-full h-96 lg:h-[600px] flex items-center justify-center border-2 border-dashed border-gray-300 rounded-lg bg-white"},me={__name:"Informes",setup(ne){const g={firstDayOfWeek:1,dayNames:["domingo","lunes","martes","miércoles","jueves","viernes","sábado"],dayNamesShort:["dom","lun","mar","mié","jue","vie","sáb"],dayNamesMin:["D","L","M","X","J","V","S"],monthNames:["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"],monthNamesShort:["ene","feb","mar","abr","may","jun","jul","ago","sep","oct","nov","dic"],today:"Hoy",clear:"Limpiar"},p=c(window.innerWidth),F=k(()=>p.value<768?"400":p.value<1024?"500":"700"),S=()=>{p.value=window.innerWidth};P(()=>{window.addEventListener("resize",S)}),$(()=>{window.removeEventListener("resize",S)});function U(){const a=[],e=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];let t=new Date(2022,0,1);const l=new Date;for(;t<=l;){const s=`${t.getFullYear()}-${(t.getMonth()+1).toString().padStart(2,"0")}`,y=`${e[t.getMonth()]} ${t.getFullYear()}`;a.push({value:s,label:y}),t.setMonth(t.getMonth()+1)}return a}const b=U(),n=c(null),i=c(null),x=new Date,r=c("unico"),d=c(null),v=c(null),E=H(),L=new Date(2019,2,1),w=a=>a?`${a.getFullYear()}-${(a.getMonth()+1).toString().padStart(2,"0")}`:"",V=k(()=>{if(!n.value||!i.value)return[];const a=w(n.value),e=w(i.value),t=b.findIndex(s=>s.value===a),l=b.findIndex(s=>s.value===e);return t===-1||l===-1||t>l?[]:b.slice(t,l+1).map(s=>s.value)}),h=k(()=>r.value==="unico"?!!d.value:!!(n.value&&i.value&&V.value.length));function u(a,e,t,l=3500){E.add({severity:a,summary:e,detail:t,life:l})}async function N(){let a=new URLSearchParams,e=[];if(r.value==="unico"){if(!d.value){u("error","Error","Seleccione un mes para generar el informe.");return}e=[w(d.value)]}else{if(!h.value){u("error","Error","Seleccione un rango válido de meses para generar el informe.");return}e=V.value}e.forEach(t=>a.append("meses[]",t));try{u("info","Generando informe...","",2e3);const t=await fetch(`/descargar-informe?${a.toString()}`),l=t.headers.get("content-type");if(l&&l.includes("application/json")){const C=await t.json();u("warn","Sin datos",C.message||"No se encontraron datos para el periodo seleccionado",5e3);return}if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const s=await t.blob(),y=window.URL.createObjectURL(s);v.value=y,u("success","Vista previa lista","Informe generado correctamente",2500)}catch(t){console.error("Error al generar el informe:",t),u("error","Error","Error al generar el informe. Por favor, inténtelo de nuevo.",5e3)}}function T(){d.value=null,n.value=null,i.value=null,v.value=null}return(a,e)=>{const t=j("Toast"),l=j("DatePicker");return M(),D(R,null,[m(f(z),{title:"Informe de Tours"}),m(O,null,{default:A(()=>[m(t),o("div",Y,[o("div",q,[e[11]||(e[11]=o("img",{src:J,alt:"Logo VASIR",class:"w-32 h-auto mb-6 drop-shadow-lg",loading:"lazy"},null,-1)),e[12]||(e[12]=o("div",{class:"flex items-center gap-3 mb-3"},[o("svg",{class:"w-8 h-8 text-blue-600",fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 17v-2a4 4 0 014-4h6M9 17v2a4 4 0 004 4h6M9 17H5a2 2 0 01-2-2V7a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-4"})]),o("h1",{class:"text-xl lg:text-2xl font-extrabold text-gray-800 tracking-tight"},"Informe de Cupos Vendidos Mensuales por Tour")],-1)),e[13]||(e[13]=o("p",{class:"text-gray-600 mb-5 text-center text-base"}," Seleccione el rango de meses o un solo mes para generar el informe PDF. ",-1)),o("div",G,[_(o("input",{id:"radio-mes-unico",type:"radio","onUpdate:modelValue":e[0]||(e[0]=s=>r.value=s),value:"unico",class:"mr-2 accent-blue-600"},null,512),[[I,r.value]]),e[5]||(e[5]=o("label",{for:"radio-mes-unico",class:"font-semibold text-gray-700 cursor-pointer select-none mr-2"}," Seleccionar un solo mes ",-1)),o("button",{onClick:T,class:"px-4 py-1 bg-gray-200 text-gray-700 rounded-lg shadow hover:bg-gray-300 transition font-semibold text-sm border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-200"}," Limpiar fechas ")]),o("div",X,[e[6]||(e[6]=o("label",{for:"mes-unico-picker",class:"block mb-2 font-semibold text-gray-700"},"Mes único:",-1)),m(l,{id:"mes-unico-picker",modelValue:d.value,"onUpdate:modelValue":e[1]||(e[1]=s=>d.value=s),view:"month",dateFormat:"MM yy",showIcon:"",class:"w-full",placeholder:"Seleccione un mes",manualInput:!1,maxDate:f(x),minDate:f(L),locale:g,disabled:r.value!=="unico"},null,8,["modelValue","maxDate","minDate","disabled"])]),o("div",K,[_(o("input",{id:"radio-activar-fechas",type:"radio","onUpdate:modelValue":e[2]||(e[2]=s=>r.value=s),value:"rango",class:"mr-2 accent-blue-600"},null,512),[[I,r.value]]),e[7]||(e[7]=o("label",{for:"radio-activar-fechas",class:"font-semibold text-gray-700 cursor-pointer select-none mr-2"}," Activar selección de meses ",-1))]),o("div",Q,[o("div",Z,[e[8]||(e[8]=o("label",{for:"desde-picker",class:"block mb-2 font-semibold text-gray-700"},"Desde:",-1)),m(l,{id:"desde-picker",modelValue:n.value,"onUpdate:modelValue":e[3]||(e[3]=s=>n.value=s),view:"month",dateFormat:"MM yy",showIcon:"",class:"w-full",placeholder:"Seleccione mes",manualInput:!1,maxDate:f(x),locale:g,disabled:r.value!=="rango"},null,8,["modelValue","maxDate","disabled"])]),o("div",ee,[e[9]||(e[9]=o("label",{for:"hasta-picker",class:"block mb-2 font-semibold text-gray-700"},"Hasta:",-1)),m(l,{id:"hasta-picker",modelValue:i.value,"onUpdate:modelValue":e[4]||(e[4]=s=>i.value=s),view:"month",dateFormat:"MM yy",showIcon:"",class:"w-full",placeholder:"Seleccione mes",manualInput:!1,maxDate:f(x),minDate:n.value,locale:g,disabled:r.value!=="rango"},null,8,["modelValue","maxDate","minDate","disabled"])])]),o("div",oe,[o("button",{onClick:N,class:B(["bg-gradient-to-r from-red-800 to-red-500 flex items-center gap-2 px-7 py-2 text-white rounded-lg shadow-lg hover:from-red-900 hover:to-red-600 transition font-semibold text-base border border-red-800 focus:outline-none focus:ring-2 focus:ring-red-400",{"opacity-60 cursor-not-allowed":!h.value}]),disabled:!h.value},e[10]||(e[10]=[o("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})],-1),W(" Vista previa PDF ")]),10,te)])]),o("div",se,[v.value?(M(),D("div",ae,[o("iframe",{src:v.value,width:"100%",height:F.value,class:"border rounded shadow w-full max-w-full",style:{"min-height":"400px"}},null,8,le)])):(M(),D("div",re,e[14]||(e[14]=[o("div",{class:"text-center px-6"},[o("svg",{class:"mx-auto mb-4 w-16 h-16 text-gray-300",fill:"none",stroke:"currentColor","stroke-width":"1.5",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4v16m8-8H4"})]),o("div",{class:"text-lg font-semibold text-gray-500 mb-2"},"Aquí se mostrará la vista previa del PDF"),o("div",{class:"text-sm text-gray-400"},"Seleccione las fechas y genere el informe")],-1)])))])])]),_:1})],64)}}};export{me as default};
